{"version":3,"sources":["app.js"],"names":["configure","i18nInit","init","module","modules","pluginsModules","pluginsWithModule","taiga","this","taigaContribPlugins","window","generateHash","components","_","map","x","JSON","stringify","hex_sha1","join","generateUniqueSessionIdentifier","date","randomNumber","Date","getTime","Math","floor","random","sessionId","$routeProvider","$locationProvider","$httpProvider","$provide","$tgEventsProvider","$compileProvider","$translateProvider","$translatePartialLoaderProvider","$animateProvider","authHttpIntercept","blockingIntercept","decorators","defaultHeaders","loaderIntercept","originalWhen","preferedLangCode","userInfo","versionCheckHttpIntercept","classNameFilter","when","path","route","resolve","angular","extend","languageLoad","$q","$translate","deferred","defer","then","promise","projectLoaded","projectService","$route","ref","setSection","current","$$route","section","params","pslug","setProjectBySlug","cleanProject","call","templateUrl","controller","controllerAs","loader","title","description","joyride","reloadOnSearch","access","requiresLogin","redirectTo","disableHeader","mobileViewport","otherwise","html5Mode","enabled","requireBase","Content-Type","Accept-Language","taigaConfig","defaultLanguage","X-Session-Id","defaults","headers","patch","post","put","get","useApplyAsync","setSessionId","$location","$navUrls","$lightboxService","errorHandlingService","httpResponseError","response","nextUrl","search","status","config","cancelable","closeAll","error","url","indexOf","force_next","reject","responseError","factory","interceptors","push","loaderService","request","logRequest","requestError","rejection","logResponse","$injector","data","version","element","injector","invoke","_this","$confirm","versionErrorMsg","instant","notify","redirectToBlockedPage","responseOk","block","blocked_code","debugInfoEnabled","debugInfo","localStorage","parse","lang","addPart","useLoader","urlTemplate","_version","useSanitizeValueStrategy","addInterpolation","preferredLanguage","fallbackLanguage","getDecorators","each","decorator","provider","messages","moment","locale","ljs","load","defaultMessage","type","email","urlstrict","number","digits","dateIso","alphanum","phone","notnull","notblank","required","regexp","min","max","range","minlength","maxlength","rangelength","mincheck","maxcheck","rangecheck","equalto","linewidth","pikaday","checksley","updateMessages","$log","$rootscope","$auth","$events","$analytics","appMetaService","navigationBarService","un","user","validators","debug","$on","refresh","val","width","lines","valid","nl2br","split","every","line","length","prettyDate","isValid","updateValidators","contribPlugins","adminPlugins","filter","userSettingsPlugins","e","ctx","language","Promise","setScheduler","cb","$evalAsync","setupConnection","isAuthenticated","getUser","initialize","event","next","start","setAll","addMobileViewport","removeMobileViewport","enableHeader","value","plugin","concat","run","TaigaBase","TaigaController","TaigaService","child","parent","ctor","constructor","key","hasProp","prototype","__super__","hasOwnProperty","bind","fn","me","apply","arguments","superClass","onInitialDataError","xhr","notfound","permissionDenied","q","Base","Service","Controller","DEFAULT_COLOR_LIST","addClass","bindMethods","bindOnce","cancelTimeout","debounce","debounceLeading","defineImmutableProperty","getDefaulColorList","getRandomDefaultColor","groupBy","isImage","isPdf","joinStr","mixOf","replaceTags","scopeDefer","sizeFormat","slugify","startswith","stripTags","timeout","toString","toggleText","trim","truncate","unslugify","item","i","l","slice","el","className","classList","add","str","breakTag","replace","object","dependencies","methods","keys","forIn","isFunction","bindAll","scope","attr","continuation","delBind","$eval","$watch","Mixed","base","method","mixin","mixins","name","char","toLowerCase","capitalize","texts","nextTextPosition","text","coll","pred","len","result","wait","setTimeout","timeoutVar","clearTimeout","func","$apply","isNumber","isString","isPlainObject","isUndefined","leading","trailing","str1","str2","startsWith","maxLength","suffix","out","String","substring","lastIndexOf","input","precision","size","units","isNaN","parseFloat","isFinite","log","pow","toFixed","exception","pattern","RegExp","tags","obj","Object","defineProperty","fn_result","isObject","removeKeys","chain","flatten","reduce","cartesianProduct","reduceRight","a","b","y","match","oldImmutable","newImmutable","pathObj","forEach","newValue","toJS","sample","clone","FiltersMixin","PageMixin","UsFiltersMixin","fillUsersAndRoles","users","roles","activeUsers","computableRoles","is_active","sortBy","activeUsersById","id","usersById","project","members","uniq","includes","loadUsersAndRoles","all","rs","projects","usersList","projectId","rolesList","results","selectFilter","existing","location","compact","isInCurrentRouteParams","noreload","replaceFilter","replaceAllFilters","filters","unselectFilter","newValues","parsedValues","isEmpty","applyStoredFilters","projectSlug","getFilters","storeFilters","filtersHashSuffix","hash","ns","storage","set","formatSelectedFilters","list","urlIds","selectedFilters","selectedIds","it","dataType","color","changeQ","filtersReloadContent","generateFilters","removeFilter","addFilter","newFilter","category","selectCustomFilter","customFilter","saveCustomFilter","urlfilters","assigned_to","owner","filterRemoteStorageService","storeCustomFiltersName","userFilters","removeCustomFilter","loadFilters","storeFiltersName","epic","userstories","filtersData","assignedTo","customFiltersRaw","selected","statuses","tagsWithAtLeastOneElement","tag","count","full_name","owners","epics","subject","filterQ","translate","content","hideEmpty","totalTaggedElements","customFilters","forOwn","AuthService","CancelAccountDirective","ChangeEmailDirective","ChangePasswordFromRecoveryDirective","ForgotPasswordDirective","InvitationDirective","LoginDirective","LoginPage","PublicRegisterMessageDirective","RegisterDirective","currentUserService","$routeParams","decodeURIComponent","$inject","rootscope","model","http","urls","config1","currentUserService1","themeService","userModel","_currentTheme","_getUserTheme","setUserdata","userData","Immutable","fromJS","getAttrs","setUser","theme","_setTheme","newTheme","use","_setLocales","make_model","auth","clear","remove","setToken","token","getToken","removeToken","auth_token","login","logout","removeUser","register","getInvitation","invitations","acceptInvitiationWithNewUser","acceptInvitiationWithExistingUser","forgotPassword","changePasswordFromRecovery","changeEmail","cancelAccount","service","$config","templates","template","templateFn","publicRegisterEnabled","encodeURIComponent","restrict","directive","$window","link","$scope","$el","$attrs","form","onError","onSuccess","submit","Form","find","href","onKeyUp","target","currentTarget","iscapsLockActivated","loginFormType","preventDefault","validate","username","password","on","prerenderReady","off","onErrorSubmit","onSuccessSubmit","onlyOneErrorElement","trackEvent","_error_message","setErrors","message","success","$params","tokenInParams","loginForm","onErrorSubmitLogin","onErrorSubmitRegister","onSuccessSubmitLogin","onSuccessSubmitRegister","registerForm","submitLogin","submitRegister","invitation","dataLogin","project_slug","project_name","dataRegister","escape","$repo","$model","email_token","queryOne","cancel_token","TaigaMainDirective","onresize","$broadcast","home","not-found","permission-denied","search-results","discover","discover-search","forgot-password","change-password","change-email","cancel-account","create-project","profile","user-profile","blocked-project","project-backlog","project-taskboard","project-kanban","project-issues","project-epics","project-search","project-epics-detail","project-userstories-detail","project-tasks-detail","project-issues-detail","project-wiki","project-wiki-list","project-wiki-page","project-team","project-admin-home","project-admin-project-profile-details","project-admin-project-profile-default-values","project-admin-project-profile-modules","project-admin-project-profile-export","project-admin-project-profile-reports","project-admin-project-values-status","project-admin-project-values-points","project-admin-project-values-priorities","project-admin-project-values-severities","project-admin-project-values-types","project-admin-project-values-custom-fields","project-admin-project-values-tags","project-admin-memberships","project-admin-roles","project-admin-third-parties-webhooks","project-admin-third-parties-github","project-admin-third-parties-gitlab","project-admin-third-parties-bitbucket","project-admin-third-parties-gogs","project-admin-contrib","user-settings-user-profile","user-settings-user-change-password","user-settings-user-avatar","user-settings-mail-notifications","user-settings-contrib","$navurls","update","AnimationFrame","Autofocus","Capslock","CheckPermissionDirective","ClassPermissionDirective","DataPickerConfig","LightboxClose","ProjectUrl","Qqueue","QueueModelTransformation","SelectedText","Svg","Template","ToggleCommentDirective","i18n","previousMonth","nextMonth","months","weekdays","weekdaysShort","isRTL","firstDay","parseInt","format","$document","getSelection","selection","createRange","render","permission","removeClass","unObserve","unwatch","tgCheckPermission","$observe","checkPermissions","tgClassPermissionWatchAction","unbindWatcher","negation","my_permissions","classes","animationFrame","performAnimation","tail","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","time","shift","slug","is_backlog_activated","is_kanban_activated","is_wiki_activated","is_issues_activated","lastPromise","qqueue","bindAdd","args","qqueue1","repo","model1","setObject","scope1","prop","attrs","cloneDeep","_attrs","_name","getObj","save","transformation","defered","comment","modified","omit","_modifiedAttrs","assign","$templateCache","lodash","tmp","svgIcon","svgTitle","svgTitleTranslate","svgTitleTranslateValues","$timeout","$element","focus","preload","spinner","src","onLoad","image","Image","onload","transclude","show","prepend","hide","EventsProvider","EventsService","win","liveAnnouncementService1","rootScope","liveAnnouncementService","processMessage","subscriptions","connected","pendingMessages","missedHeartbeats","heartbeatInterval","WebSocket","info","loc","scheme","stopExistingConnection","protocol","trimStart","host","ws","addEventListener","onOpen","onMessage","onClose","removeEventListener","stopHeartBeatMessages","close","notifications","subscribe","desc","$digest","startHeartBeatMessages","heartbeatIntervalTime","maxMissedHeartbeats","reconnectTryInterval","setInterval","Error","sendMessage","cmd","error1","clearInterval","processHeartBeatPongMessage","serialize","msg","send","routingKey","subscription","routing_key","callback","unsubscribe","$get","$win","$conf","$rootScope","FeedbackDirective","$loading","feedbackService","openLightbox","submitButton","currentLoading","create","feedback","finish","open","RelatedTaskAssignedToInlineEditionDirective","RelatedTaskCreateButtonDirective","RelatedTaskCreateFormDirective","RelatedTaskRowDirective","RelatedTasksDirective","$compile","$template","templateEdit","templateView","renderEdit","renderView","saveTask","task","html","keyCode","$modelValue","perms","modify_task","delete_task","select","askOnDelete","askResponse","$emit","ngModel","require","$tgmodel","newTask","createTask","reset","default_task_status","openNewRelatedTask","us","$rs","_isEditable","_isVisible","loadTasks","tasks","usId","us_order","showRelatedTasks","avatarService","$ctrl","autoSave","notAutoSave","updateRelatedTask","avatar","member","getAvatar","imgurl","bg","full_name_display","tgRelatedTaskAssignedToInlineEdition","unbind","userId","updatedRelatedTask","ResourcesService","initResources","initUrls","auth-register","by_username","users-password-recovery","users-change-password-from-recovery","users-change-password","users-change-email","users-cancel-account","user-stats","user-liked","user-voted","user-watched","user-contacts","user-me","permissions","notify-policies","user-storage","memberships","bulk-create-memberships","resolver","project-templates","project-modules","bulk-update-projects-order","project-like","project-unlike","project-watch","project-unwatch","project-transfer-validate-token","project-transfer-accept","project-transfer-reject","project-transfer-request","project-transfer-start","epic-statuses","userstory-statuses","points","task-statuses","issue-statuses","issue-types","priorities","severities","milestones","epic-upvote","epic-downvote","epic-watch","epic-unwatch","epic-related-userstories","epic-related-userstories-bulk-create","bulk-create-us","bulk-update-us-backlog-order","bulk-update-us-milestone","bulk-update-us-miles-order","bulk-update-us-kanban-order","userstories-filters","userstory-upvote","userstory-downvote","userstory-watch","userstory-unwatch","bulk-create-tasks","bulk-update-task-taskboard-order","task-upvote","task-downvote","task-watch","task-unwatch","task-filters","issues","bulk-create-issues","issues-filters","issue-upvote","issue-downvote","issue-watch","issue-unwatch","wiki","wiki-restore","wiki-links","history/epic","history/us","history/issue","history/task","history/wiki","attachments/epic","attachments/us","attachments/issue","attachments/task","attachments/wiki_page","custom-attributes/epic","custom-attributes/userstory","custom-attributes/task","custom-attributes/issue","custom-attributes-values/epic","custom-attributes-values/userstory","custom-attributes-values/task","custom-attributes-values/issue","webhooks","webhooks-test","webhooklogs","webhooklogs-resend","epics-csv","userstories-csv","tasks-csv","issues-csv","timeline-profile","timeline-user","timeline-project","exporter","importer","locales","applications","application-tokens","stats-discover","$urls","providers","toArray","SearchBoxDirective","SearchController","SearchDirective","navUrls","loadSearchData","sectionName","loadInitialData","projectName","projectDescription","searchTerm","t","searchResults","term","loadProject","getBySlug","epicStatusById","epic_statuses","issueStatusById","issue_statuses","taskStatusById","task_statuses","severityById","priorityById","usStatusById","us_statuses","loading","_loadSearchData","_promise","abort","reload","$templatecache","$routeparams","linkTable","activeSectionName","applyAutoTab","getActiveSection","lastSearchResults","markSectionTabActive","renderFilterTabs","renderTableContent","tabsDom","maxVal","selectedSection","wikipages","oldElements","oldScope","children","$destroy","$new","parseHTML","activeSection","sectionData","searchText","AnalyticsService","doc","conf","initialized","accountId","pageEvent","trackRoutes","ignoreFirstPageLoad","injectAnalytics","ga","getUrl","trackPage","s","o","g","r","m","createElement","getElementsByTagName","async","parentNode","insertBefore","document","page","action","label","BindScope","jQuery","CompileHtmlDirective","tgCompileHtml","oldValue","contents","AssignedToDirective","BlockButtonDirective","CreatedByDisplayDirective","DateRangeDirective","DateSelectorDirective","DeleteButtonDirective","EditableDescriptionDirective","EditableWysiwyg","ListItemAssignedtoDirective","ListItemEpicStatusDirective","ListItemIssueStatusDirective","ListItemPriorityDirective","ListItemSeverityDirective","ListItemTaskStatusDirective","ListItemTypeDirective","ListItemUsStatusDirective","SprintProgressBarDirective","TgMainTitleDirective","TgProgressBarDirective","UserDisplayDirective","WatchersDirective","renderRange","first","second","endDate","initDate","tgDateRange","valFirst","valSecond","datePickerConfigService","selectedDate","datePickerConfig","merge","field","onSelect","picker","setDate","Pikaday","renderProgress","percentage","visual_percentage","hasClass","css","tgSprintProgressbar","sprint","closedPoints","totalPoints","closed_points","total_points","round","owner_extra_info","created_date","tgUserId","$modelTransform","deleteWatcher","isEditable","renderWatchers","ref1","requiredPerm","watchers","transform","watcherId","watcherIds","revert","pull","$currentUserService","renderAssignedTo","assignedObject","fullName","isIocaine","isUnassigned","assigned_to_extra_info","is_iocaine","fullNameVisible","ask","instance","is_blocked","onDeleteGoToUrl","onDeleteTitle","subtitle","$selectedText","noDescriptionMegEditMode","noDescriptionMegReadMode","cancelEdition","is","$","scrollTop","offset","top","$applyAsync","noDescriptionMsg","attachmentsService","attachmentsFullService","isInEditMode","uploadFile","file","addAttachment","getIn","textarea","dataTransfer","promises","stopPropagation","originalEvent","files","markItUp","replaceWith","tgListitemEpicStatus","tgListitemUsStatus","tgListitemTaskStatus","tgListitemAssignedto","issue","tgListitemIssueStatus","issueTypeById","domNode","tgListitemType","priority","tgListitemPriority","severity","tgListitemSeverity","tgProgressBar","i18nSectionName","ConfirmService","NOTIFICATION_MSG","light-error","lightboxService","lightboxSelector","ok","askChoice","choices","replacement","warning","choicesField","append","icon","detailImage","svgContainer","useSVG","createElementNS","setAttributeNS","appendChild","stop","percent","body","selector","tsem","one","CustomAttributeValueDirective","CustomAttributesValuesController","CustomAttributesValuesDirective","DATE_TYPE","MULTILINE_TYPE","TEXT_TYPE","TYPE_CHOICES","URL_TYPE","confirm","objectId","customAttributes","customAttributesValues","loadCustomAttributesValues","getAttributeValue","attribute","attributeValue","attributes_values","updateAttributeValue","attributesValues","$templates","$storage","collapsedHash","$ctrls","collapsed","toggleCollapse","requiredEditionPerm","setFocusAndSelectOnInputField","edit","editable","tgCustomAttributeValue","EstimationsService","LbUsEstimationDirective","UsEstimationDirective","$tgEstimationsService","estimationProcess","onSelectedPointForRole","roleId","pointId","$setViewValue","mainTemplate","calculateTotalPoints","calculateRoles","$watchCollection","$qqueue","EstimationProcess","pointsTemplate","$el1","us1","project1","bindClickEvents","pointsById","notNullValues","values","v","k","acc","num","role","pointObj","renderPointsSelector","siblings","popover","horizontalList","maxPointLength","pop","point","some","horizontal","closest","height","clientHeight","byRefFilter","darkerFilter","defaultFilter","momentFormat","momentFromNow","toMutableFilter","yesNoFilter","defaultValue","without_suffix","fromNow","memoizedMutable","toMutable","js","memoize","List","$filterFilter","cleanRef","substr","luminosity","black","c","j","newColor","white","ImportProjectButtonDirective","LbImportErrorDirective","$lightboxFactory","$tgAuth","getRestrictionError","errorKey","maxMemberships","membersError","privateError","publicError","isPrivate","canCreatePrivateProjects","canCreatePublicProjects","max_memberships","trigger","loadProjects","errorMsg","restrictionError","class","error_message","AssignedToLightboxDirective","BlockLightboxDirective","BlockingMessageInputDirective","CreateBulkUserstoriesDirective","CreateEditUserstoryDirective","LightboxDirective","LightboxKeyboardNavigationService","LightboxLeaveProjectWarningDirective","LightboxService","WatchersLightboxDirective","docEl","lightboxContent","not","firstField","activeElement","blur","code","which","removeAttr","lightboxEl","dispatch","prev","$tgrepo","unblock","finishCallback","blocked_note","watch","ngmodel","attachmentsToAdd","attachmentsToDelete","createAttachments","deleteAttachments","resetAttachments","createEditUs","isNew","attachment","deleteAttachment","addTag","inserted","itemtags","projectTags","tags_colors","deleteTag","statusList","usStatusList","attachments","is_archived","createEditUsOpen","team_requirement","client_requirement","upload","broadcastEvent","include_attachments","include_tasks","getByRef","keydown","statusId","bulk","bulkCreate","lightboxKeyboardNavigationService","closeLightbox","filterUsers","normalizeString","selectedItem","selectedUser","usersTemplate","string","normalizedString","toUpperCase","visibleUsers","partial","showMore","assignedToId","searchingText","usersSearch","getFilteredUsers","_filterUsers","Loader","LoaderDirective","tgLoader","onStart","onEnd","autoClose","lastResponseDate","pageLoaded","requestCount","startLoadTime","minTime","force","diff","endTime","timeoutValue","intervalAuto","auto","LoadingDirective","TgLoadingService","settings","removeClasses","classess","timeoutId","tgLoading","showLoading","RelatedTaskStatusDirective","UsStatusDirective","usStatusDom","usStatusDomParent","tgUsStatus","onUpdate","selectionTemplate","updateTaskStatus","taskStatusDom","taskStatusDomParent","tgRelatedTaskStatus","closePopover","isVisible","docViewBottom","docViewLeft","docViewRight","docViewTop","docViewWidth","elemBottom","elemLeft","elemRight","elemTop","elemWidth","display","visibility","left","fadeOut","fadeIn","ExceptionHandlerFactory","ravenConfig","Raven","install","cause","captureException","ColorizeTagsDirective","LbTagLineDirective","TagsDirective","formatter","parser","isArray","$formatters","$parsers","backlog","kanban","taskboard","tgColorizeTagsType","tgColorizeTags","COMMA_KEY","ENTER_KEY","autocomplete","templateTags","addValue","deleteValue","hideSaveButton","renderTags","resetInput","saveInputTag","showSaveButton","withoutColors","has","tagsColors","style","fromCharCode","Awesomplete","MarkitupDirective","previewTemplate","addLine","cancelablePromise","closePreviewMode","markdownTitle","prepareUrlFormatting","preview","previewDomNode","previewInProgress","renderMarkItUp","setCaretPosition","urlFormatting","parents","markItUpDomNode","markdownDomNode","mdrender","vm","markdown","caretPosition","scrollRelation","totalLines","createTextRange","move","selectionStart","setSelectionRange","scrollHeight","nline","cursorPosition","indices","regex","exec","index","donotparse","endIndex","startIndex","heading","n","placeHolder","markdownSettings","nameSpace","onShiftEnter","keepDefault","openWith","onEnter","afterInsert","cursorLine","emptyListItem","lastLine","markdownCaretPositon","newLineContent","markupSet","closeWith","separator","beforeInsert","markItUpRemove","textcomplete","cache","searchProps","searchTypes","res","CreateEditSprint","createSprint","getLastSprint","hasErrors","resetSprint","estimated_start","estimated_finish","newSprint","copy","setAttr","sprintsCounter","__all__","milestonesCounter","openSprints","sortedSprints","sprints","closed","estimatedFinish","estimatedStart","lastSprint","lastSprintNameDom","editSprint","BacklogController","BacklogDirective","BurndownBacklogGraphDirective","TgBacklogProgressBarDirective","ToggleBurndownVisibility","UsPointsDirective","UsRolePointsSelectorDirective","params1","events","analytics","rs2","modelTransform","backlogOrder","milestonesOrder","disablePagination","firstLoadComplete","showTags","activeFilters","showGraphPlaceholder","initializeEventHandlers","getShowTags","loadUserstories","loadProjectStats","loadSprints","loadClosedSprints","findIndex","moveUs","unloadClosedSprints","initializeSubscription","routingKey1","routingKey2","loadAllPaginatedUserstories","toggleShowTags","storeShowTags","toggleActiveFilters","stats","defined_points","completedPercentage","total_milestones","setMilestonesOrder","len1","results1","user_stories","sprint_order","closedSprints","totalClosedMilestones","closedSprintsById","totalMilestones","totalOpenMilestones","reverse","sprintsById","currentSprint","findCurrentSprint","resetPagination","pageSize","loadingUserstories","storeQueryParams","listUnassigned","header","backlog_order","loadBacklog","closedMilestones","total_closed_milestones","prepareBulkUpdateData","uses","us_id","order","usList","newUsIndex","newSprintId","afterDestination","beforeDestination","currentSprintId","len2","len3","len4","len5","len6","modifiedUs","oldSprintId","options","orderField","orderList","p","previous","previousWithTheSameOrder","ref2","setOrders","setPreviousOrders","milestone","listIt","moveIt","bulkUpdateMilestone","bulkUpdateBacklogOrder","set-orders","updateUserStoryStatus","editUserStory","$event","deleteUserStory","without","addNewUs","default_us_status","addNewSprint","currentDate","end","doomLineTemplate","linkDoomLine","linkFilters","linkToolbar","openFilterInit","showHideFilter","showHideTags","addDoomLineDom","getUsItems","reloadDoomLine","removeDoomlineDom","current_sum","domElement","assigned_points","before","rowElements","checkSelected","getUsToMove","lastChecked","moveToCurrentSprint","moveToLatestSprint","moveUssToSprint","shiftPressed","ussDom","itemScope","selectedUss","extraPoints","totalExtraPoints","ussCurrent","union","saveAll","moveToSprintDom","selectedUsDom","toggleClass","shiftKey","elements","nextAll","prevAll","nextUntil","prevUntil","elm","ussToMove","sidebar","hideText","showText","filtersSearch","numberOfRoles","roleName","rolScope","$tgTemplate","rolesTemplate","bindClickElements","filteringRoleId","renderRolesSelector","selectedRoleId","updatingSelectedRoleId","tgBacklogUsPoints","popRolesDom","firstLoad","toggleGraph","isBurndownGraphCollapsed","redrawChart","dataToDraw","client_increment_line","colors","evolution_line","milestonesRange","optimal_line","team_increment_line","zero_line","ml","zip","fillColor","optimal","evolution","grid","borderWidth","right","bottom","borderColor","hoverable","xaxis","ticks","axisLabel","axisLabelUseCanvas","axisLabelFontSizePixels","axisLabelFontFamily","axisLabelPadding","tickFormatter","axis","yaxis","series","shadowSize","fill","radius","lineWidth","tooltip","tooltipOpts","xval","yval","flotItem","seriesIndex","sprintName","abs","empty","plot","adjustPercentaje","projectPointsPercentaje","closedPointsPercentaje","adjusted","tgBacklogProgressBar","definedPoints","BacklogSortableDirective","deleteElement","drake","initIsBacklog","scroll","dragula","copySortSource","isContainer","contains","moves","container","isChecked","dragMultiple","dragMultipleItems","firstElement","isBacklog","sameContainer","autoScroll","margin","pixels","scrollWhenOutside","down","dragging","destroy","BacklogSprintDirective","BacklogSprintHeaderDirective","ToggleExcludeClosedSprintsVisualization","slideOptions","sprintTableMinHeight","toggleSprint","duration","easing","sprintArrow","sprintTable","tgBacklogSprint","slideToggle","compiledTemplate","estimatedDateRange","taskboardUrl","templateScope","excludeClosedSprints","loadingElm","after","SprintGraphDirective","days","day","unshift","d","optimal_points","open_points","tickSize","last","mode","daysNames","formattedDate","roundedValue","CreateBulkTasksDirective","CreateEditTaskDirective","tagsToAdd","sprintId","user_story","createEditTaskOpen","console","TaskboardController","TaskboardDirective","TaskboardSquishColumnDirective","rs1","q1","taskboardTasksService","openFilter","_setMeta","usTasks","setZoom","zoomLevel","zoom","resetFolds","startDate","completedPoints","completedPointsSum","totalPointsSum","openTasks","totalTasks","total_tasks","refreshTagsColors","replaceModel","taskMove","onAssignedToChanged","userid","taskModel","loadTaskboard","loadSprintStats","loadSprint","pointsList","roleById","taskStatusList","remainingPointsSum","remainingTasks","completed_points","completed_tasks","setUserstories","sslug","setRolePoints","showPlaceHolder","tasksRaw","editTask","getTask","editingTask","oldStatusId","moveUpdateData","getTaskModel","status__is_archived","set_orders","assignOrders","addNewTask","toggleFold","changeTaskAssignedTo","getPoint","getRole","pointsByRole","poitnId","tableBodyDom","tableHeaderDom","scrollLeft","avatarWidth","maxColumnWidth","getCeilWidth","recalculateStatusColumnWidth","recalculateTaskboardWidth","refreshTaskboardTableWidth","setStatusColumnWidth","statusesFolded","getStatusColumnModes","usFolded","getUsRowModes","foldStatus","storeStatusColumnModes","foldUs","storeUsRowModes","tasksMatrixSize","sqrt","column","ctrl","columnWidths","columns","totalWidth","outerWidth","total","statusFoldedWidth","TaskboardSortableDirective","containers","filterError","itemEl","newParentScope","oldParentScope","tdom","$tgConfirm","mirrorContainer","accepts","cancel","itemIndex","itemTask","newStatusId","newUsId","oldUsId","parentEl","st","TaskboardTasksService","foldStatusChanged","Map","taskId","refreshRawOrder","taskboard_order","invert","findedTask","findedIndex","usItem","taksWithoutMoved","taskByUsStatus","task_id","images","thumbnail_card_url","colorized_tags","KanbanUserstoriesService","userstoriesRaw","archivedStatus","statusHide","usByStatus","addArchivedStatus","isUsInArchivedHiddenStatus","getUsModel","hideStatus","deleteStatus","showStatus","getStatus","toDelete","archived","difference","kanban_order","usByStatusWithoutMoved","getUs","findedUs","usModel","KanbanArchivedStatusHeaderDirective","KanbanArchivedStatusIntroDirective","KanbanController","KanbanDirective","KanbanSquishColumnDirective","KanbanWipLimitDirective","kanbanUserstoriesService1","kanbanUserstoriesService","openArchived","loadUserStoriesForStatus","uss","hideUserStoriesForStatus","editUs","editingUserStory","changeUsAssignedTo","listAll","filteredStatus","loadKanban","hideArchivedText","showArchivedText","hidden","tgKanbanArchivedStatusHeader","userStories","hiddenUserStoriexText","updateIntroText","tgKanbanArchivedStatusIntro","hasArchived","itemUs","userStoriesLoaded","updateTableWidth","folds","redrawWipLimit","tgKanbanWipLimit","wip_limit","KanbanSortableDirective","EpicDetailController","EpicStatusButtonDirective","EpicStatusDisplayDirective","epicRef","epicref","initializeOnDeleteGoToUrl","epicSubject","epicStatus","statusById","epicDescription","description_html","loadEpic","immutableProject","immutableEpic","epicId","commentModel","neighbors","previousUrl","listInEpic","onUpvote","upvote","onDownvote","downvote","onWatch","onUnwatch","onSelectColor","onSelectColorError","onSelectColorSuccess","is_closed","IssueDetailController","IssueDueDateSelectDirective","IssuePriorityButtonDirective","IssueSeverityButtonDirective","IssueStatusButtonDirective","IssueStatusDisplayDirective","IssueTypeButtonDirective","PromoteIssueToUsButtonDirective","issueRef","issueref","ref3","issueSubject","issueStatus","issueType","typeById","issueSeverity","issuePriority","issueDescription","loadIssue","issue_types","typeList","severityList","priorityList","issueId","typees","severityes","priorityes","initialDueDate","due_date","generated_from_issue","CreateBulkIssuesDirective","CreateIssueDirective","createIssueOpen","default_issue_status","default_issue_type","default_priority","default_severity","IssueAssignedToInlineEditionDirective","IssueStatusInlineEditionDirective","IssuesController","IssuesDirective","loadIssues","voting","myFiltersHashSuffix","orderBy","order_by","types","issueStatusList","issueTypes","loadIssuesRequests","models","paginatedBy","addNewIssue","addIssuesInBulk","upVoteIssue","downVoteIssue","getOrderBy","linkOrdering","linkPagination","$pagEl","afterCurrent","atBegin","atEnd","beforeCurrent","getNumPages","renderPagination","numPages","cpage","pages","showPrevious","showNext","pagenum","colHeadElement","currentOrder","svg","finalOrder","newOrder","updateIssueStatus","issueStatusDom","issueStatusDomParent","tgIssueStatusInlineEdition","updateIssue","tgIssueAssignedToInlineEdition","updatedIssue","UsClientRequirementButtonDirective","UsStatusButtonDirective","UsStatusDisplayDirective","UsTeamRequirementButtonDirective","UserStoryDetailController","configService","usRef","usref","tribeEnabled","tribeHost","closedTasks","progressPercentage","userStoryRef","userStorySubject","userStoryStatus","userStoryPoints","userStoryDescription","userStoryClosedTasks","userStoryTotalTasks","userStoryProgressPercentage","allClosed","loadUs","httpParams","kanbanStaus","noMilestone","pick","onTribeInfo","publishDesc","publishTitle","alt","canEdit","isRequired","TaskDetailController","TaskIsIocaineButtonDirective","TaskStatusButtonDirective","TaskStatusDisplayDirective","taskRef","taskref","taskSubject","taskStatus","taskDescription","loadTask","loadUserStory","LeaveProjectDirective","TeamController","TeamFiltersDirective","TeamMemberCurrentUserDirective","TeamMemberStatsDirective","TeamMembersDirective","membersFilter","setRole","filtersRole","loadMembers","totals","currentUser","issuesEnabled","tasksEnabled","wikiEnabled","loadMemberStats","memberStats","vals","statsKey","sum","_processStats","_processStat","stat","singleStat","userRoles","filtersQ","lightboxFactory","leaveConfirm","confirm_leave_project_text","leave_project_text","leave","isCurrentUser","EditableWikiContentDirective","WikiDetailController","WikiSummaryDirective","moveLink","wikiSlug","wikiTitle","linksVisible","wikiPageName","wikiPageContent","totalEditions","editions","lastModifiedDate","modified_date","loadWiki","wikiId","loadWikiLinks","listLinks","wikiLinks","selectedWikiLink","checkLinksPerms","splice","last_modifier","wikiPage","$wikiHistoryService","disableEdition","getSelectedText","switchToEditMode","switchToReadMode","loadHistoryEntries","button","WikiNavDirective","linkWikiLinks","addWikiLinkPermission","deleteWikiLinkPermission","direction","linkId","newLink","loadPromise","WikiPagesListController","loadWikiPages","ChangeOwnerLightboxController","ChangeOwnerLightboxDirective","LbRequestOwnershipDirective","LightboxAddMembersController","LightboxAddMembersDirective","LightboxAddMembersWarningMessageDirective","TransferProjectStartSuccessDirective","lightboxService1","pendingMembersCount","_defaultMaxInvites","_defaultRole","submitInvites","canAddUsers","memberInvites","membersLimit","total_memberships","addSingleMember","role_id","showWarningMessage","removeSingleMember","initializeFields","invites","bulkCreateMemberships","invitationText","_onSuccessInvite","_onErrorInvite","errors","bulk_memberships","bindToController","confirmService","transferRequest","commentOpen","limit","getUsers","currentOwnerId","userSearch","selectUser","transferStart","MembershipsController","MembershipsDirective","MembershipsRowActionsDirective","MembershipsRowAdminCheckboxDirective","MembershipsRowAvatarDirective","MembershipsRowRoleSelectorDirective","NoMoreMembershipsExplanationDirective","lightboxFactory1","i_am_admin","httpFilters","getUrlFilters","membership","is_user_active","addNewMembers","showLimitUsersWarningMessage","pending","user_email","isOwner","is_owner","tgMembershipsRowAvatar","tgMembershipsRowAdminCheckbox","inputId","is_admin","roleList","selectedRole","tgMembershipsRowRoleSelector","newRole","activedTemplate","pendingTemplate","tgMembershipsRowActions","resendInvitation","defaultMsg","AdminNavigationDirective","tgAdminNavigation","AdminProjectChangeOwnerDirective","AdminProjectRequestOwnershipDirective","AdminProjectRestrictionsDirective","CsvEpicDirective","CsvExporterController","CsvExporterEpicsController","CsvExporterIssuesController","CsvExporterTasksController","CsvExporterUserstoriesController","CsvIssueDirective","CsvTaskDirective","CsvUsDirective","ProjectDefaultValuesDirective","ProjectExportDirective","ProjectLogoDirective","ProjectLogoModelDirective","ProjectModulesDirective","ProjectProfileController","ProjectProfileDirective","tgAuth","epicStatusList","issueTypesList","prioritiesList","severitiesList","openDeleteLightbox","newUrl","fetchProject","newVal","oldVal","videoconferences_extra_data","videoconferences","isVideoconferenceActivated","asyn_message","buttonsEl","dump_ready_text","hideButtons","hideResult","hideSpinner","loading_msg","loading_title","resultEl","resultMessageEl","resultTitleEl","setAsyncMessage","setAsyncTitle","setLoadingMessage","setLoadingTitle","setSyncMessage","setSyncTitle","showButtons","showErrorMode","showExportResultAsyncMode","showExportResultSyncMode","showLoadingMode","showResult","showSpinner","spinnerEl","syn_message","dumpUrl","_generateUuid","setCsvUuid","csvUrl","resolveAbsolute","csvUuid","uuid","regenerateUuid","sectionTitle","showSizeInfo","click","logoAttachment","changeLogo","removeLogo","$parse","modelSetter","tgProjectLogoModel","requestOwnership","changeOwner","project-id","active-users","current-owner-id","ColorSelectionDirective","ProjectCustomAttributesController","ProjectCustomAttributesDirective","ProjectTagsController","ProjectTagsDirective","ProjectValuesController","ProjectValuesDirective","ProjectValuesSectionController","moveValue","loadValues","resource","listValues","maxValueOrder","maxBy","itemValue","linkDragAndDrop","linkValue","goToBottomList","initializeNewValue","initializeTextTranslations","objName","saveNewValue","saveValue","valueType","objname","addNewElementText","table","formEl","row","editionRow","option","onSucces","moveTo","colorList","allowEmpty","tgAllowEmpty","moveCustomAttributes","deleteCustomAttribute","saveCustomAttribute","createCustomAttribute","loadCustomAttributes","maxOrder","attrValues","attrModel","newIndex","idx","cancelCreate","cancelUpdate","hideAddButton","hideCancelButton","hideCreateForm","hideEditForm","resetNewAttr","revertChangesInCustomAttribute","showAddButton","showCancelButton","showCreateForm","showEditForm","sortableEl","itemAttr","newAttr","mixingClass","cancelMixingTags","confirmMixingTags","toggleMixingFromTags","startMixingTags","editTag","createTag","filterAndSortTags","loadTags","projectTagsAll","tagsFilter","from_tag","to_tag","loadingDelete","mixingTags","toTag","fromTags","loadingMixing","mixTags","initializeMixingTags","initializeTagsFilter","originalTag","loadingEdit","loadingCreate","EditRoleDirective","NewRoleDirective","RolePermissionsDirective","RolesController","RolesDirective","_disableComputable","_enableComputable","anyComputableRole","computable","loadRoles","public_permission","external_user","public_permissions","askOnError","askOnSuccess","toggleComputable","toggleView","toggle","DEFAULT_PERMISSIONS","insertPosition","baseTemplate","categoryTemplate","resumeTemplate","generateCategoriesFromRole","renderCategory","renderPermissions","renderResume","categories","epicPermissions","isPermissionEditable","issuePermissions","milestonePermissions","setActivePermissions","setActivePermissionsPerCategory","taskPermissions","userStoryPermissions","wikiPermissions","active","is_private","cat","activePermissions","getActivePermissions","categoryId","anon_permissions","BitbucketController","BitbucketWebhooksDirective","GithubController","GithubWebhooksDirective","GitlabController","GitlabWebhooksDirective","GogsController","NewWebhookDirective","SelectInputText","ValidOriginIpsDirective","WebhookDirective","WebhooksController","loadWebhooks","openHistory","showEditMode","showVisualizationMode","updateLogs","updateShowHideHistoryText","webhook","tgWebhook","validStatus","prettySentHeaders","toPairs","request_headers","arg","prettySentData","request_data","created","logs_counter","logs","historyElement","textElement","test","resend","addWebhookDOMNode","formDOMNode","loadModules","github","gitlab","bitbucket","saveAttribute","$ngModel","gogs","createProjectRestrictionDirective","CreateProject","DeleteProjectDirective","$projectUrl","$cacheFactory","removeAll","error_field","selectors","creation_template","head","projectToDelete","BindHtmlDirective","BindOnceAltDirective","BindOnceBindDirective","BindOnceHrefDirective","BindOnceHtmlDirective","BindOnceRefDirective","BindOnceSrcDirective","BindOnceTitleDirective","BindTitleDirective","tgBoBind","tgBoHtml","tgBoRef","tgBoSrc","tgBoHref","tgBoAlt","tgBoTitle","tgTitleHtml","tgBindHtml","ConfigurationService","ContribController","ContribUserSettingsController","currentPlugin","FiltersStorageService","HttpService","cacheFactory","locationFactory","lastRoute","Model","ModelService","dataTypes","_dataTypes","setAttrs","_isModified","applyCasts","attrName","castMethod","castName","casts","getIdAttrName","getName","getter","self","setter","enumerable","configurable","isModified","isAttributeModified","markSaved","desSerialize","sdata","ddata","$http","$gmUrls","$gmStorage","cls","int","float","NavigationUrlsDirective","NavigationUrlsService","formatUrl","replacer","bindOnceP","parseNav","param","tgNavGetParams","tgNav","fullUrl","getURLParams","getURLParamsStr","metaKey","ctrlKey","RepositoryService","resolveUrlForModel","idAttrName","resolveUrlForAttributeModel","extraParams","_data","_status","returnHeaders","queryMany","httpOptions","enablePagination","queryOneAttribute","queryOneRaw","queryPaginated","queryOnePaginatedRaw","wikipage","StorageService","_default","serializedValue","getItem","setItem","removeItem","UrlsService","fmt","mainUrl","trimEnd","resourceProvider","_get","userstory","_list","hashSuffix","getQueryParams","editComment","activityId","commentData","getCommentHistory","deleteComment","undeleteComment","history","listInAllProjects","project_id","bulk_issues","hashSuffixStatusColumnModes","hashSuffixStatusViewModes","listByUser","invitation_extra_text","notifyPolicies","listByMember","memberId","bulkUpdateOrder","bulkData","regenerate_epics_csv_uuid","regenerate_userstories_csv_uuid","regenerate_tasks_csv_uuid","regenerate_issues_csv_uuid","from_tags","statusUpdater","complete","failed","maxFileSize","uploadComplete","uploadFailed","uploadProgress","fileName","fileSize","evt","loaded","uploadedSize","totalSize","responseText","getResponseHeader","FormData","XMLHttpRequest","setRequestHeader","transformRequest","identity","deferredAbort","get_all","noop","u","hashSuffixUsRowModes","userStoryId","milestone_id","bulk_tasks","bulkUpdateTaskTaskboardOrder","changeAvatar","removeAvatar","changePassword","currentPassword","newPassword","current_password","userSettings","contacts","page_size","status_id","bulk_stories","milestoneId","bulkUpdateKanbanOrder","webhookId","webhooklogId","UserChangePasswordController","UserChangePasswordDirective","newPassword1","newPassword2","DeleteUserDirective","TaigaAvatarModelDirective","UserAvatarDirective","UserProfileDirective","UserSettingsController","getLan","getTheme","maxFileSizeMsg","availableThemes","avatarAttachment","tgAvatarModel","UserSettingsNavigationDirective","tgUserSettingsNavigation","UserNotificationsController","UserNotificationsDirective","UserNotificationsListDirective","policy","policyIndex","prev_level","notify_level","AssignedItemDirective","AssignedToSelectorController","assigned","_getAssignedMember","_filterAssignedMember","assignedMember","nonAssignedMembers","AssignedToSelectorDirective","onRemoveAssigned","onAssignTo","AssignedToController","has_permissions","_closeAndRemoveAssigned","_closeAndAssign","onSelectAssignedTo","on-remove-assigned","on-assign-to","assignTo","AttachmentLinkDirective","attachmentsPreviewService","tgAttachmentLink","fileId","AttachmentGalleryDirective","onDelete","AttachmentController","is_deprecated","editMode","mergeIn","AttachmentDirective","AttachmentsDropDirective","eventAttr","tgAttachmentsDrop","AttachmentsFullController","deprecatedsCount","attachmentsVisible","deprecatedsVisible","uploadingAttachments","objId","setMode","toggleDeprecatedsVisible","addAttachments","loadAttachments","toDeleteAttachment","errorMessage","reorderAttachment","updateAttachment","toUpdateAttachment","hasPermission","editPermission","showAttachments","AttachmentsFullDirective","AttachmentsFullService","_attachments","_deprecatedsCount","_attachmentsVisible","_deprecatedsVisible","regenerate","uploading","oldIndex","setIn","oldAttachment","AttachmentsPreviewController","getCurrent","hasPagination","getIndex","attachmentIndex","findLast","AttachmentPreviewLightboxDirective","AttachmentsPreviewService","AttachmentsSimpleController","onAdd","AttachmentsSimpleDirective","AttachmentSortableDirective","tgAttachmentsSortable","AutoSelectDirective","AvatarDirective","attributeName","tgAvatarBig","avatarBig","BelongToEpicsDirective","isIterable","BoardZoomDirective","levels","CardSlideshowController","cardSlideshowDirective","CardController","visible","onToggleFold","getClosedTasks","closedTasksPercent","getPermissionsKey","_setVisibility","related","slides","isRelatedTasksVisible","isSlideshowVisible","getNavKey","cardDirective","onClickAssignedTo","onClickEdit","ColorSelectorController","checkIsColorRequired","displayColorList","userCanChangeColor","isColorRequired","dropRight","setColor","initColor","resetColor","toggleColorList","onSelectDropdownColor","onKeyDown","ColorSelectorDirective","_timeout","mouseenter","mouseleave","StoryHeaderController","loadingSubject","originalSubject","_checkNav","_checkPermissions","editSubject","saveSubject","onEditSubjectError","onEditSubjectSuccess","DetailHeaderDirective","FileChangeDirective","tgFileChange","FilterRemoteStorageService","myFilters","innerPromise","FilterSlideDownDirective","ngIf","contentHeight","wrapperHeight","outerHeight","context","nextSibling","max-height","FilterController","opened","customFilterForm","customFilterName","toggleFilterCategory","filterName","isOpen","onSaveCustomFilter","onChangeQ","onRemoveFilter","filterCategory","onAddFilter","onRemoveCustomFilter","onSelectCustomFilter","isFilterSelected","FilterDirective","JoyRideDirective","joyRideService","initJoyrRide","intro","unsuscribe","introJs","oncomplete","onexit","disableJoyRide","setOptions","exitOnEsc","exitOnOverlayClick","showStepNumbers","nextLabel","prevLabel","skipLabel","doneLabel","disableInteraction","setOption","loadJoyRideConfig","exit","JoyRideService","checkPermissionsService","getConfig","dashboard","steps","position","check","joyRide","joyRides","KanbanBoardZoomDirective","getZoomView","zooms","zoomIndex","onZoomChange","LiveAnnouncementDirective","defineProperties","LiveAnnouncementService","ProjectLogoBigSrcDirective","projectLogoService","logo","projectLogo","getDefaultProjectLogo","ProjectLogoSmallSrcDirective","ProjectMenuController","menu","_getActiveSection","_setVideoConference","_setMenuPermissions","videoconferenceUrl","_videoConferenceUrl","indexBacklog","indexKanban","oldSectionName","sectionsBreadcrumb","baseUrl","ProjectMenuDirective","projectChange","fixed","TagOptionDirective","containerHeight","selectedPosition","onSelectTag","colorArray","TagLineCommonController","tagLineService","disableColorSelection","newTag","_createColorsArray","projectTagColors","createColorsArray","displayTagInput","addNewTag","onAddTag","selectColor","TagLineCommonDirective","tagName","loadingAddTag","loadingRemoveTag","onDeleteTag","TagLineController","onDeleteTagError","onDeleteTagSuccess","onAddTagError","onAddTagSuccess","TagLineDirective","TagLineService","myPermissions","projectPermissions","TagDirective","hasPermissions","TaskboardZoomDirective","TermsOfServiceAndPrivacyPolicyNoticeDirective","privacyPolicyUrl","termsOfServiceUrl","TribeButtonDirective","locationService","port","TribeLinkedDirective","gigTitle","gigId","VoteButtonController","isMouseOver","showTextWhenMouseIsOver","showTextWhenMouseIsLeave","toggleVote","is_voter","_downvote","_upvote","VoteButtonDirective","WatchButtonController","openWatchers","getPerms","toggleWatch","is_watcher","_unwatch","_watch","WatchButtonDirective","attributes","environment","DiscoverHomeOrderByController","is_open","week","month","year","currentText","currentOrderBy","onChange","DiscoverHomeOrderByDirective","DiscoverSearchBarController","discoverProjectsService","projectsCount","fetchStats","submitFilter","DiscoverSearchBarDirective","DiscoverSearchListHeaderController","like_is_open","activity_is_open","openLike","setOrderBy","openActivity","DiscoverSearchListHeaderDirective","FeaturedProjectsController","featured","fetchFeatured","FeaturedProjectsDirective","HighlightedDirective","highlighted","MostActiveController","mostActive","fetch","fetchMostActive","MostActiveDirective","MostLikedController","mostLiked","fetchMostLiked","MostLikedDirective","DiscoverHomeController","onSubmit","DiscoverSearchController","routeParams","searchResult","nextSearchPage","loadingGlobal","loadingList","loadingPagination","resetSearchList","fetchByGlobalSearch","fetchByOrderBy","getFilter","fetchSearch","is_looking_for_people","onChangeFilter","updateParams","onChangeOrder","DiscoverSearchDirective","DiscoverProjectsService","projectsService","_mostLiked","_mostActive","_featured","_searchResult","_projectsCount","decorate","_decorate","_nextSearchPage","_discoverParams","discover_mode","_params","getProjects","is_featured","CreateEpicController","epicsService","newEpic","default_epic_status","createEpic","validateForm","onCreateEpic","setFormErrors","CreateEpicDirective","EpicRowController","displayUserStories","displayAssignedTo","displayStatusList","loadingStatus","_calculateProgressBar","canEditEpics","toggleUserStoryList","listRelatedUserStories","epicStories","updateStatus","updateEpicStatus","updateAssignedTo","assignLoader","updateEpicAssignedTo","EpicRowDirective","EpicsDashboardController","setfn","isEpicsDashboardEnabled","fetchEpics","notFound","canCreateEpics","on-create-epic","EpicsSortableDirective","tgEpicsSortable","EpicsTableController","displayOptions","displayVotes","votes","progress","toggleEpicTableOptions","reorderEpic","hoverEpicTableOption","timer","hideEpicTableOption","EpicsTableDirective","StoryRowController","totalTasksCompleted","story","StoryRowDirective","EpicsService","resources","xhrError","_epics","epicData","withoutMoved","fromPairs","epics_order","reorder","reorderRelatedUserstory","epicUserstories","userstoryId","RelatedUserStoriesController","showCreateRelatedUserstoriesLightbox","showRelatedUserStoriesSection","legth","userCanSort","loadRelatedUserstories","RelatedUserstoriesCreateController","projectUserstories","selectProject","selectedProjectId","onSelectedProject","listAllInProject","excludeIds","filteredData","saveRelatedUserStory","selectedUserstoryId","onSavedRelatedUserstory","validateExistingUserstoryForm","setExistingUserstoryFormErrors","addRelatedUserstory","bulkCreateRelatedUserStories","userstoriesText","onCreatedRelatedUserstory","validateNewUserstoryForm","setNewUserstoryFormErrors","RelatedUserstoriesCreateDirective","existingUserstoryForm","newUserstoryForm","showLightbox","selectedUserstory","searchUserstory","relatedUserstoriesText","selectedProject","onUpdateSearchUserstory","RelatedUserstoriesSortableDirective","tgRelatedUserstoriesSortable","RelatedUserStoriesDirective","RelatedUserstoryRowController","setAvatarData","getAssignedToFullNameDisplay","onDeleteRelatedUserstory","deleteRelatedUserstory","RelatedUserstoryRowDirective","ExternalAppController","externalAppsService","loginUrl","createApplicationToken","_getApplicationToken","_redirect","_applicationId","application","_state","state","_user","_application","loginWithAnotherUserUrl","applicationToken","getApplicationToken","back","authorizeApplicationToken","ExternalAppsService","applicationId","externalapps","FeedbackService","sendFeedback","CommentController","permissionService","hiddenDeletedComment","commentContent","showDeletedComment","hideDeletedComment","checkCancelComment","onEditMode","commentId","canEditDeleteComment","pk","displayCommentHistory","CommentDirective","editing","deleting","onDeleteComment","onRestoreDeletedComment","onEditComment","CommentsController","initializePermissions","canAddCommentPermission","CommentsDirective","comments","onAddComment","LightboxDisplayHistoricController","_loadHistoric","commentHistoryEntries","LightboxDisplayHistoricDirective","HistoryEntryDirective","entry","HistoryTabsDirective","showCommentTab","showActivityTab","onActiveComments","onActiveActivities","onOrderComments","activeTab","commentsNum","activitiesNum","onReverse","HistorySectionController","viewComments","_loadHistory","_getComments","_getActivities","activities","values_diff","showHistorySection","toggleEditMode","onActiveHistoryTab","restoreDeletedComment","addComment","HistorySectionDirective","ActivitiesDiffController","diffTags","diffRemoveTags","diffAddTags","HistoryDiffDirective","HistoryDirective","DutyDirective","navurls","duty","getDutyType","HomeController","HomeService","_attachProjectInfoToWorkInProgress","workInProgress","projectsById","_attachProjectInfoToDuty","_duties","_getValidDutiesAndAttachProjectInfo","watching","objType","duties","dutyType","getWorkInProgress","assignedEpicsPromise","assignedIssuesPromise","assignedTasksPromise","assignedUserStoriesPromise","params_epics","params_us","projectsPromise","watchingEpicsPromise","watchingIssuesPromise","watchingTasksPromise","watchingUserStoriesPromise","getProjectsByUserId","status__is_closed","HomeProjectListDirective","newProject","WorkingOnController","homeService","_setAssignedTo","elem","_setWatching","WorkingOnDirective","DropdownProjectListDirective","DropdownUserDirective","authService","navUrlsService","isFeedbackEnabled","userMenu","NavigationBarDirective","isEnabledHeader","NavigationBarService","enabledHeader","ProfileBarController","userService","loadStats","getStats","ProfileBarDirective","ProfileContactsController","loadContacts","getContacts","ProfileContactsDirective","FavItemDirective","itemType","FavsBaseController","ProfileLikedController","ProfileVotedController","ProfileWatchedController","_init","enableFilterByAll","enableFilterByProjects","enableFilterByEpics","enableFilterByUserStories","enableFilterByTasks","enableFilterByIssues","enableFilterByTextQuery","_resetList","items","scrollDisabled","_page","_enableLoadingSpinner","isLoading","_disableLoadingSpinner","_enableScroll","_disableScroll","_checkIfHasMorePages","hasNext","_checkIfHasNoResults","hasNoResults","loadItems","_getItems","filterByTextQuery","showAll","showProjectsOnly","showEpicsOnly","showUserStoriesOnly","showTasksOnly","showIssuesOnly","tabName","getLiked","getVoted","getWatched","ProfileLikedDirective","ProfileVotedDirective","ProfileWatchedDirective","ProfileHints","hintKey","HINTS","hint","linkText","ProfileProjectsController","attachUserContactsToProjects","ProfileProjectsDirective","ProfileTabDirective","tab","tabIcon","tabActive","tabDisabled","addTab","ProfileTabsController","tabs","toggleTab","ProfileTabsDirective","ProfileController","getUserByUserName","userFullName","userUsername","BlockedProjectExplanationDirective","LikeProjectButtonController","likeButtonService","toggleLike","_unlike","_like","like","unlike","LikeProjectButtonDirective","LikeProjectButtonService","_getProjectIndex","_updateProjects","isFan","projectIndex","totalFans","is_fan","total_fans","setProjects","_updateCurrentProject","setProject","likeProject","unlikeProject","SortProjectsDirective","sortData","sorted_project_ids","bulkUpdateProjectsOrder","WatchProjectButtonController","watchButtonService","showWatchOptions","toggleWatcherOptions","closeWatcherOptions","notifyLevel","WatchProjectButtonDirective","WatchProjectButtonService","isWatcher","totalWatchers","total_watchers","watchProject","unwatchProject","ProjectsListingController","ProjectController","activeMembers","ProjectsService","projectUrl","getProjectBySlug","getProjectStats","paginate","transferValidateToken","transferAccept","reason","transferReject","CantOwnProjectExplanationDirective","TransferProject","showAddComment","_refreshUserData","_validateToken","_setProjectData","_checkOwnerData","canBeOwnedByUser","canOwnProject","ownerMessage","maxProjects","currentProjects","validNumberOfMemberships","loadingAccept","loadingReject","hideComment","TransferProjectDirective","Resource","urlsService","urlname","object_id","x-disable-pagination","progressMessage","progressPercent","bulk_userstories","pagination","paginateResponseService","x-lazy-pagination","getAllProjects","getTimeline","only_relevant","Resources","services","serviceFn","serviceName","serviceProperty","warm","getUserStorage","setUserStorage","createUserStorage","getUserByUsername","getProfileTimeline","getUserTimeline","epicIid","getWikiHistory","wikiHistory","DateInputController","fromFormats","from","hours_ago","days_ago","weeks_ago","months_ago","years_ago","selectedFromFormat","timeDeltaFrom","toFormats","end_of_day","in_hours","in_days","in_weeks","in_months","in_years","selectedToFormat","timeDeltaTo","selectFromFormat","fromFormat","previousFormat","isDateFormat","dateGte","submitTimeDelta","selectToFormat","toFormat","dateLte","resetDateValues","SearchDateInputDirective","inputDateGte","inputDateLte","searchFilterParamsProvider","defineMethod","getGenericMap","getStatusMap","forModel","details","getProjectMap","Array","getDateFilter","getUserMap","highlightTerms","html5ToEntities","charCodeAt","$sce","searchTerms","sort","trustAsHtml","FilterParamsController","SearchFormController","includesAny","array","filterSpecs","resetFilterValues","loadFilterSpecs","selectedSearchType","getFilterValuesFromRouteParams","filterValues","isSelectedFilterValue","choice","toggleFilterValue","removeFilterValue","setFilterValue","toggleAllFilterValues","filterSpec","negated_choice","updateFilterValueParam","paramValues","paramsValues","currentFilterSpecs","getIssuesFilterParams","commonFilters","filterParams","getIssueTypeMap","getIssueSeverityMap","getIssuePriorityMap","getIssueStatusMap","getTasksFilterParams","getTaskStatusMap","getUserstoriesFilterParams","getUserstoryStatusMap","getSprintsFilterParams","moreFilters","result_type","paramsChanged","getFiltersTemplate","selectSearchType","resetParams","getDateSelector","selectDate","changed","toggleItemType","item_types","currentResultType","SearchFormDirective","StoredSearchInputController","storedSearch","paramSerializer","initialParams","storedSearchName","justSaved","saveStoredSearchItem","updateStoredSearchItem","updateLocation","generateUrl","storedSearchItemExists","getStoredSearchItem","storedSearchUnmodified","StoredSearchInputDirective","StoredSearchItemsController","getStoredSearchItems","deleteItem","deleteStoredSearchItem","staticSearchesEmpty","getStaticSeaches","staticSearches","StoredSearchItemsDirective","storedSearchProvider","setStoredSearchItems","SearchHome","TEXT_SEARCH_CONFIG","search_in","fields","constant","SearchResults","searchResultsService","getSearchResultsListTemplate","getResultType","getResultCount","Iterable","getRouteParamsFilter","getFilterParamName","detail","filter_spec","updateRouteParamsFilter","updateRouteParamsFilters","resetSearchResult","fetchList","activeParams","SearchResultsDirective","SearchResultsTableDirective","addOrderSvg","orderSvg","endsWith","SearchResultsService","searchTypeText","searchTypeFiltered","_resultsCount","searchType","getResults","SearchTypeFiltered","dateFields","daysDelta","hoursDelta","montshDelta","transformToApi","now","monthsDelta","setHours","setMinutes","setSeconds","transformed_value","Number","sprintsProvider","client_params","SearchTypeText","projectsResources","_fetchOptionalSearches","projectParams","_updateProject","matchCount","_getMatchCount","_matches","AppMetaService","_set","meta","setTitle","setDescription","setTwitterMetas","origin","setOpenGraphMetas","listener","_listener","metas","AttachmentsService","getMaxFileSize","maxFileSizeFormated","sizeError","saveError","AvatarService","modulo","COLORS","IMAGES","logos","getDefault","murmurhash3_32_gc","getUnnamed","avatarParamName","gravatar","logoUrl","photo","root","gravatar_id","CheckPermissionsService","CurrentUserService","storageService","_projects","_projectsById","_joyride","_loadUserInfo","ErrorHandlingService","errorHandling","showingError","blocked","LightboxFactory","compile","scopeAttrs","PaginateResponse","paginateResponse","ProjectLogoService","ProjectService","_project","_section","_sectionsBreadcrumb","_activeMembers","ThemeService","themeName","stylesheetEl","UserService","pageNumber","objectType","textQuery","contactsFiltered","contact","contactId","UserTimelineAttachmentDirective","validFileExtensions","extension","is_image","templateHtml","UserTimelineItemTitle","sce","_fieldTranslationKey","description_diff","timeline","title_attr","_getLink","_getUsernameSpan","field_name","new_value","sprint_name","us_name","event_us","_getTimelineObj","_getDetailObjUrl","related_us_name","epic_name","obj_name","role_name","keySeq","_translateTitleParams","parent_userstory","span","_getParams","timeline_type","translate_params","getTitle","paramsKeys","translation","UserTimelineType","timelineType","hasIn","getType","UserTimelineItemDirective","UserTimelinePaginationSequence","generate","getContent","minItems","UserTimelineController","userTimelineService","timelineList","getProjectTimeline","loadTimeline","UserTimelineDirective","UserTimelineService","userTimelinePaginationSequenceService","userTimelineItemType","userTimelineItemTitle","_valid_fields","_invalid","fieldKey","value_diff","_isInValidTimeline","invalid","_parseEventType","event_type","_getTimelineObject","_attachExtraInfoToTimelineEntry","_parseTimeline","newdata","newItem","moveInBacklog","deleteIn","_addEntyAttributes","filterNot","IsolateClickDirective","WikiHistoryDiffDirective","WikiHistoryEntryDirective","singleHistoryEntry","historyEntry","WikiHistoryController","wikiHistoryService","historyEntries","initializeHistoryEntries","setWikiId","WikiHistoryDirective","WikiHistoryService","_wikiId","_historyEntries"],"mappings":"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","file":"../app.js","sourcesContent":["\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: app.coffee\n */\n\n(function() {\n  var configure, i18nInit, init, module, modules, pluginsModules, pluginsWithModule, taiga;\n\n  this.taiga = taiga = {};\n\n  this.taigaContribPlugins = this.taigaContribPlugins || window.taigaContribPlugins || [];\n\n  taiga.generateHash = function(components) {\n    if (components == null) {\n      components = [];\n    }\n    components = _.map(components, function(x) {\n      return JSON.stringify(x);\n    });\n    return hex_sha1(components.join(\":\"));\n  };\n\n  taiga.generateUniqueSessionIdentifier = function() {\n    var date, randomNumber;\n    date = (new Date()).getTime();\n    randomNumber = Math.floor(Math.random() * 0x9000000);\n    return taiga.generateHash([date, randomNumber]);\n  };\n\n  taiga.sessionId = taiga.generateUniqueSessionIdentifier();\n\n  configure = function($routeProvider, $locationProvider, $httpProvider, $provide, $tgEventsProvider, $compileProvider, $translateProvider, $translatePartialLoaderProvider, $animateProvider) {\n    var authHttpIntercept, blockingIntercept, decorators, defaultHeaders, loaderIntercept, originalWhen, preferedLangCode, userInfo, versionCheckHttpIntercept;\n    $animateProvider.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/);\n    originalWhen = $routeProvider.when;\n    $routeProvider.when = function(path, route) {\n      route.resolve || (route.resolve = {});\n      angular.extend(route.resolve, {\n        languageLoad: [\n          \"$q\", \"$translate\", function($q, $translate) {\n            var deferred;\n            deferred = $q.defer();\n            $translate().then(function() {\n              return deferred.resolve();\n            });\n            return deferred.promise;\n          }\n        ],\n        projectLoaded: [\n          \"$q\", \"tgProjectService\", \"$route\", function($q, projectService, $route) {\n            var deferred, ref;\n            deferred = $q.defer();\n            projectService.setSection((ref = $route.current.$$route) != null ? ref.section : void 0);\n            if ($route.current.params.pslug) {\n              projectService.setProjectBySlug($route.current.params.pslug).then(deferred.resolve);\n            } else {\n              projectService.cleanProject();\n              deferred.resolve();\n            }\n            return deferred.promise;\n          }\n        ]\n      });\n      return originalWhen.call($routeProvider, path, route);\n    };\n    $routeProvider.when(\"/\", {\n      templateUrl: \"home/home.html\",\n      controller: \"Home\",\n      controllerAs: \"vm\",\n      loader: true,\n      title: \"HOME.PAGE_TITLE\",\n      loader: true,\n      description: \"HOME.PAGE_DESCRIPTION\",\n      joyride: \"dashboard\"\n    });\n    $routeProvider.when(\"/search\", {\n      templateUrl: \"search/search-home/search-home.html\",\n      controller: \"SearchHome\",\n      controllerAs: \"vm\",\n      title: \"HOME.PAGE_TITLE\",\n      loader: true,\n      description: \"HOME.PAGE_DESCRIPTION\",\n      joyride: \"dashboard\"\n    });\n    $routeProvider.when(\"/search/results/:result_type\", {\n      templateUrl: \"search/search-results/search-results.html\",\n      controller: \"SearchResults\",\n      controllerAs: \"vm\",\n      title: \"HOME.PAGE_TITLE\",\n      loader: true,\n      description: \"HOME.PAGE_DESCRIPTION\",\n      joyride: \"dashboard\",\n      reloadOnSearch: false\n    });\n    $routeProvider.when(\"/discover\", {\n      templateUrl: \"discover/discover-home/discover-home.html\",\n      controller: \"DiscoverHome\",\n      controllerAs: \"vm\",\n      title: \"PROJECT.NAVIGATION.DISCOVER\",\n      loader: true\n    });\n    $routeProvider.when(\"/discover/search\", {\n      templateUrl: \"discover/discover-search/discover-search.html\",\n      title: \"PROJECT.NAVIGATION.DISCOVER\",\n      loader: true,\n      controller: \"DiscoverSearch\",\n      controllerAs: \"vm\",\n      reloadOnSearch: false\n    });\n    $routeProvider.when(\"/projects/\", {\n      templateUrl: \"projects/listing/projects-listing.html\",\n      access: {\n        requiresLogin: true\n      },\n      title: \"PROJECTS.PAGE_TITLE\",\n      description: \"PROJECTS.PAGE_DESCRIPTION\",\n      loader: true,\n      controller: \"ProjectsListing\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/project/:pslug/\", {\n      templateUrl: \"projects/project/project.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\",\n      section: \"project-timeline\"\n    });\n    $routeProvider.when(\"/project/:pslug/search\", {\n      templateUrl: \"search/search.html\",\n      reloadOnSearch: false,\n      section: \"search\",\n      loader: true\n    });\n    $routeProvider.when(\"/project/:pslug/epics\", {\n      section: \"epics\",\n      templateUrl: \"epics/dashboard/epics-dashboard.html\",\n      loader: true,\n      controller: \"EpicsDashboardCtrl\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/project/:pslug/epic/:epicref\", {\n      templateUrl: \"epic/epic-detail.html\",\n      loader: true,\n      section: \"epics\"\n    });\n    $routeProvider.when(\"/project/:pslug/backlog\", {\n      templateUrl: \"backlog/backlog.html\",\n      loader: true,\n      section: \"backlog\",\n      joyride: \"backlog\"\n    });\n    $routeProvider.when(\"/project/:pslug/kanban\", {\n      templateUrl: \"kanban/kanban.html\",\n      loader: true,\n      section: \"kanban\",\n      joyride: \"kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/taskboard/:sslug\", {\n      templateUrl: \"taskboard/taskboard.html\",\n      loader: true,\n      section: \"backlog\"\n    });\n    $routeProvider.when(\"/project/:pslug/us/:usref\", {\n      templateUrl: \"us/us-detail.html\",\n      loader: true,\n      section: \"backlog-kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/task/:taskref\", {\n      templateUrl: \"task/task-detail.html\",\n      loader: true,\n      section: \"backlog-kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/wiki\", {\n      redirectTo: function(params) {\n        return \"/project/\" + params.pslug + \"/wiki/home\";\n      }\n    });\n    $routeProvider.when(\"/project/:pslug/wiki-list\", {\n      templateUrl: \"wiki/wiki-list.html\",\n      loader: true,\n      section: \"wiki\"\n    });\n    $routeProvider.when(\"/project/:pslug/wiki/:slug\", {\n      templateUrl: \"wiki/wiki.html\",\n      loader: true,\n      section: \"wiki\"\n    });\n    $routeProvider.when(\"/project/:pslug/team\", {\n      templateUrl: \"team/team.html\",\n      loader: true,\n      section: \"team\"\n    });\n    $routeProvider.when(\"/project/:pslug/issues\", {\n      templateUrl: \"issue/issues.html\",\n      loader: true,\n      section: \"issues\"\n    });\n    $routeProvider.when(\"/project/:pslug/issue/:issueref\", {\n      templateUrl: \"issue/issues-detail.html\",\n      loader: true,\n      section: \"issues\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/details\", {\n      templateUrl: \"admin/admin-project-profile.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/default-values\", {\n      templateUrl: \"admin/admin-project-default-values.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/modules\", {\n      templateUrl: \"admin/admin-project-modules.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/export\", {\n      templateUrl: \"admin/admin-project-export.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/reports\", {\n      templateUrl: \"admin/admin-project-reports.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/status\", {\n      templateUrl: \"admin/admin-project-values-status.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/points\", {\n      templateUrl: \"admin/admin-project-values-points.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/priorities\", {\n      templateUrl: \"admin/admin-project-values-priorities.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/severities\", {\n      templateUrl: \"admin/admin-project-values-severities.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/types\", {\n      templateUrl: \"admin/admin-project-values-types.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/custom-fields\", {\n      templateUrl: \"admin/admin-project-values-custom-fields.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/tags\", {\n      templateUrl: \"admin/admin-project-values-tags.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/memberships\", {\n      templateUrl: \"admin/admin-memberships.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/roles\", {\n      templateUrl: \"admin/admin-roles.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/webhooks\", {\n      templateUrl: \"admin/admin-third-parties-webhooks.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/github\", {\n      templateUrl: \"admin/admin-third-parties-github.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/gitlab\", {\n      templateUrl: \"admin/admin-third-parties-gitlab.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/bitbucket\", {\n      templateUrl: \"admin/admin-third-parties-bitbucket.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/gogs\", {\n      templateUrl: \"admin/admin-third-parties-gogs.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/contrib/:plugin\", {\n      templateUrl: \"contrib/main.html\"\n    });\n    $routeProvider.when(\"/project/:pslug/transfer/:token\", {\n      templateUrl: \"projects/transfer/transfer-page.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/user-settings/user-profile\", {\n      templateUrl: \"user/user-profile.html\"\n    });\n    $routeProvider.when(\"/user-settings/user-change-password\", {\n      templateUrl: \"user/user-change-password.html\"\n    });\n    $routeProvider.when(\"/user-settings/mail-notifications\", {\n      templateUrl: \"user/mail-notifications.html\"\n    });\n    $routeProvider.when(\"/change-email/:email_token\", {\n      templateUrl: \"user/change-email.html\"\n    });\n    $routeProvider.when(\"/cancel-account/:cancel_token\", {\n      templateUrl: \"user/cancel-account.html\"\n    });\n    $routeProvider.when(\"/user-settings/contrib/:plugin\", {\n      templateUrl: \"contrib/user-settings.html\"\n    });\n    $routeProvider.when(\"/profile\", {\n      templateUrl: \"profile/profile.html\",\n      loader: true,\n      access: {\n        requiresLogin: true\n      },\n      controller: \"Profile\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/profile/:slug\", {\n      templateUrl: \"profile/profile.html\",\n      loader: true,\n      controller: \"Profile\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/login\", {\n      templateUrl: \"auth/login.html\",\n      title: \"LOGIN.PAGE_TITLE\",\n      description: \"LOGIN.PAGE_DESCRIPTION\",\n      disableHeader: true,\n      controller: \"LoginPage\"\n    });\n    $routeProvider.when(\"/register\", {\n      templateUrl: \"auth/register.html\",\n      title: \"REGISTER.PAGE_TITLE\",\n      description: \"REGISTER.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/forgot-password\", {\n      templateUrl: \"auth/forgot-password.html\",\n      title: \"FORGOT_PASSWORD.PAGE_TITLE\",\n      description: \"FORGOT_PASSWORD.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/change-password/:token\", {\n      templateUrl: \"auth/change-password-from-recovery.html\",\n      title: \"CHANGE_PASSWORD.PAGE_TITLE\",\n      description: \"CHANGE_PASSWORD.PAGE_TITLE\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/invitation/:token\", {\n      templateUrl: \"auth/invitation.html\",\n      title: \"INVITATION.PAGE_TITLE\",\n      description: \"INVITATION.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/external-apps\", {\n      templateUrl: \"external-apps/external-app.html\",\n      title: \"EXTERNAL_APP.PAGE_TITLE\",\n      description: \"EXTERNAL_APP.PAGE_DESCRIPTION\",\n      controller: \"ExternalApp\",\n      controllerAs: \"vm\",\n      disableHeader: true,\n      mobileViewport: true\n    });\n    $routeProvider.when(\"/blocked-project/:pslug/\", {\n      templateUrl: \"projects/project/blocked-project.html\",\n      loader: true\n    });\n    $routeProvider.when(\"/error\", {\n      templateUrl: \"error/error.html\"\n    });\n    $routeProvider.when(\"/not-found\", {\n      templateUrl: \"error/not-found.html\"\n    });\n    $routeProvider.when(\"/permission-denied\", {\n      templateUrl: \"error/permission-denied.html\"\n    });\n    $routeProvider.otherwise({\n      templateUrl: \"error/not-found.html\"\n    });\n    $locationProvider.html5Mode({\n      enabled: true,\n      requireBase: false\n    });\n    defaultHeaders = {\n      \"Content-Type\": \"application/json\",\n      \"Accept-Language\": window.taigaConfig.defaultLanguage || \"en\",\n      \"X-Session-Id\": taiga.sessionId\n    };\n    $httpProvider.defaults.headers[\"delete\"] = defaultHeaders;\n    $httpProvider.defaults.headers.patch = defaultHeaders;\n    $httpProvider.defaults.headers.post = defaultHeaders;\n    $httpProvider.defaults.headers.put = defaultHeaders;\n    $httpProvider.defaults.headers.get = {\n      \"X-Session-Id\": taiga.sessionId\n    };\n    $httpProvider.useApplyAsync(true);\n    $tgEventsProvider.setSessionId(taiga.sessionId);\n    authHttpIntercept = function($q, $location, $navUrls, $lightboxService, errorHandlingService) {\n      var httpResponseError;\n      httpResponseError = function(response) {\n        var nextUrl, search;\n        if (response.status === 0 || (response.status === -1 && !response.config.cancelable)) {\n          $lightboxService.closeAll();\n          errorHandlingService.error();\n        } else if (response.status === 401 && $location.url().indexOf('/login') === -1) {\n          nextUrl = $location.url();\n          search = $location.search();\n          if (search.force_next) {\n            $location.url($navUrls.resolve(\"login\")).search(\"force_next\", search.force_next);\n          } else {\n            $location.url($navUrls.resolve(\"login\")).search(\"next\", nextUrl);\n          }\n        }\n        return $q.reject(response);\n      };\n      return {\n        responseError: httpResponseError\n      };\n    };\n    $provide.factory(\"authHttpIntercept\", [\"$q\", \"$location\", \"$tgNavUrls\", \"lightboxService\", \"tgErrorHandlingService\", authHttpIntercept]);\n    $httpProvider.interceptors.push(\"authHttpIntercept\");\n    loaderIntercept = function($q, loaderService) {\n      return {\n        request: function(config) {\n          loaderService.logRequest();\n          return config;\n        },\n        requestError: function(rejection) {\n          loaderService.logResponse();\n          return $q.reject(rejection);\n        },\n        responseError: function(rejection) {\n          loaderService.logResponse();\n          return $q.reject(rejection);\n        },\n        response: function(response) {\n          loaderService.logResponse();\n          return response;\n        }\n      };\n    };\n    $provide.factory(\"loaderIntercept\", [\"$q\", \"tgLoader\", loaderIntercept]);\n    $httpProvider.interceptors.push(\"loaderIntercept\");\n    versionCheckHttpIntercept = function($q) {\n      var httpResponseError;\n      httpResponseError = function(response) {\n        var $injector;\n        if (response.status === 400 && response.data.version) {\n          $injector = angular.element(\"body\").injector();\n          $injector.invoke([\n            \"$tgConfirm\", \"$translate\", (function(_this) {\n              return function($confirm, $translate) {\n                var versionErrorMsg;\n                versionErrorMsg = $translate.instant(\"ERROR.VERSION_ERROR\");\n                return $confirm.notify(\"error\", versionErrorMsg, null, 10000);\n              };\n            })(this)\n          ]);\n        }\n        return $q.reject(response);\n      };\n      return {\n        responseError: httpResponseError\n      };\n    };\n    $provide.factory(\"versionCheckHttpIntercept\", [\"$q\", versionCheckHttpIntercept]);\n    $httpProvider.interceptors.push(\"versionCheckHttpIntercept\");\n    blockingIntercept = function($q, errorHandlingService) {\n      var redirectToBlockedPage, responseError, responseOk;\n      redirectToBlockedPage = function() {\n        return errorHandlingService.block();\n      };\n      responseOk = function(response) {\n        if (response.data.blocked_code) {\n          redirectToBlockedPage();\n        }\n        return response;\n      };\n      responseError = function(response) {\n        if (response.status === 451) {\n          redirectToBlockedPage();\n        }\n        return $q.reject(response);\n      };\n      return {\n        response: responseOk,\n        responseError: responseError\n      };\n    };\n    $provide.factory(\"blockingIntercept\", [\"$q\", \"tgErrorHandlingService\", blockingIntercept]);\n    $httpProvider.interceptors.push(\"blockingIntercept\");\n    $compileProvider.debugInfoEnabled(window.taigaConfig.debugInfo || false);\n    if (localStorage.userInfo) {\n      userInfo = JSON.parse(localStorage.userInfo);\n    }\n    preferedLangCode = (userInfo != null ? userInfo.lang : void 0) || window.taigaConfig.defaultLanguage || \"en\";\n    $translatePartialLoaderProvider.addPart('taiga');\n    $translateProvider.useLoader('$translatePartialLoader', {\n      urlTemplate: '/' + window._version + '/locales/{part}/locale-{lang}.json'\n    }).useSanitizeValueStrategy('escapeParameters').addInterpolation('$translateMessageFormatInterpolation').preferredLanguage(preferedLangCode);\n    $translateProvider.fallbackLanguage(preferedLangCode);\n    decorators = window.getDecorators();\n    return _.each(decorators, function(decorator) {\n      return $provide.decorator(decorator.provider, decorator.decorator);\n    });\n  };\n\n  i18nInit = function(lang, $translate) {\n    var messages;\n    moment.locale(lang);\n    if (lang !== 'en') {\n      ljs.load((\"/\" + window._version + \"/locales/moment-locales/\") + lang + \".js\");\n    }\n    messages = {\n      defaultMessage: $translate.instant(\"COMMON.FORM_ERRORS.DEFAULT_MESSAGE\"),\n      type: {\n        email: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_EMAIL\"),\n        url: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_URL\"),\n        urlstrict: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_URLSTRICT\"),\n        number: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_NUMBER\"),\n        digits: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_DIGITS\"),\n        dateIso: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_DATEISO\"),\n        alphanum: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_ALPHANUM\"),\n        phone: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_PHONE\")\n      },\n      notnull: $translate.instant(\"COMMON.FORM_ERRORS.NOTNULL\"),\n      notblank: $translate.instant(\"COMMON.FORM_ERRORS.NOT_BLANK\"),\n      required: $translate.instant(\"COMMON.FORM_ERRORS.REQUIRED\"),\n      regexp: $translate.instant(\"COMMON.FORM_ERRORS.REGEXP\"),\n      min: $translate.instant(\"COMMON.FORM_ERRORS.MIN\"),\n      max: $translate.instant(\"COMMON.FORM_ERRORS.MAX\"),\n      range: $translate.instant(\"COMMON.FORM_ERRORS.RANGE\"),\n      minlength: $translate.instant(\"COMMON.FORM_ERRORS.MIN_LENGTH\"),\n      maxlength: $translate.instant(\"COMMON.FORM_ERRORS.MAX_LENGTH\"),\n      rangelength: $translate.instant(\"COMMON.FORM_ERRORS.RANGE_LENGTH\"),\n      mincheck: $translate.instant(\"COMMON.FORM_ERRORS.MIN_CHECK\"),\n      maxcheck: $translate.instant(\"COMMON.FORM_ERRORS.MAX_CHECK\"),\n      rangecheck: $translate.instant(\"COMMON.FORM_ERRORS.RANGE_CHECK\"),\n      equalto: $translate.instant(\"COMMON.FORM_ERRORS.EQUAL_TO\"),\n      linewidth: $translate.instant(\"COMMON.FORM_ERRORS.LINEWIDTH\"),\n      pikaday: $translate.instant(\"COMMON.FORM_ERRORS.PIKADAY\")\n    };\n    return checksley.updateMessages('default', messages);\n  };\n\n  init = function($log, $rootscope, $auth, $events, $analytics, $translate, $location, $navUrls, appMetaService, loaderService, navigationBarService, errorHandlingService) {\n    var un, user, validators;\n    $log.debug(\"Initialize application\");\n    $rootscope.$on('$translatePartialLoaderStructureChanged', function() {\n      return $translate.refresh();\n    });\n    validators = {\n      linewidth: function(val, width) {\n        var lines, valid;\n        lines = taiga.nl2br(val).split(\"<br />\");\n        valid = _.every(lines, function(line) {\n          return line.length < width;\n        });\n        return valid;\n      },\n      pikaday: function(val) {\n        var prettyDate;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        return moment(val, prettyDate).isValid();\n      }\n    };\n    checksley.updateValidators(validators);\n    $rootscope.contribPlugins = this.taigaContribPlugins;\n    $rootscope.adminPlugins = _.filter(this.taigaContribPlugins, {\n      \"type\": \"admin\"\n    });\n    $rootscope.userSettingsPlugins = _.filter(this.taigaContribPlugins, {\n      \"type\": \"userSettings\"\n    });\n    $rootscope.$on(\"$translateChangeEnd\", function(e, ctx) {\n      var lang;\n      lang = ctx.language;\n      return i18nInit(lang, $translate);\n    });\n    Promise.setScheduler(function(cb) {\n      return $rootscope.$evalAsync(cb);\n    });\n    $events.setupConnection();\n    if ($auth.isAuthenticated()) {\n      user = $auth.getUser();\n    }\n    $analytics.initialize();\n    $rootscope.$on('$locationChangeStart', function(event) {\n      return errorHandlingService.init();\n    });\n    un = $rootscope.$on('$routeChangeStart', function(event, next) {\n      if (next.loader) {\n        loaderService.start(true);\n      }\n      return un();\n    });\n    return $rootscope.$on('$routeChangeSuccess', function(event, next) {\n      var description, title;\n      if (next.loader) {\n        loaderService.start(true);\n      }\n      if (next.access && next.access.requiresLogin) {\n        if (!$auth.isAuthenticated()) {\n          $location.path($navUrls.resolve(\"login\"));\n        }\n      }\n      if (next.title || next.description) {\n        title = $translate.instant(next.title || \"\");\n        description = $translate.instant(next.description || \"\");\n        appMetaService.setAll(title, description);\n      }\n      if (next.mobileViewport) {\n        appMetaService.addMobileViewport();\n      } else {\n        appMetaService.removeMobileViewport();\n      }\n      if (next.disableHeader) {\n        return navigationBarService.disableHeader();\n      } else {\n        return navigationBarService.enableHeader();\n      }\n    });\n  };\n\n  angular.module('infinite-scroll').value('THROTTLE_MILLISECONDS', 500);\n\n  pluginsWithModule = _.filter(this.taigaContribPlugins, function(plugin) {\n    return plugin.module;\n  });\n\n  pluginsModules = _.map(pluginsWithModule, function(plugin) {\n    return plugin.module;\n  });\n\n  modules = [\"taigaBase\", \"taigaCommon\", \"taigaResources\", \"taigaResources2\", \"taigaAuth\", \"taigaEvents\", \"taigaHome\", \"taigaNavigationBar\", \"taigaProjects\", \"taigaRelatedTasks\", \"taigaBacklog\", \"taigaTaskboard\", \"taigaKanban\", \"taigaIssues\", \"taigaUserStories\", \"taigaTasks\", \"taigaTeam\", \"taigaWiki\", \"taigaSearch\", \"taigaAdmin\", \"taigaProject\", \"taigaUserSettings\", \"taigaFeedback\", \"taigaPlugins\", \"taigaIntegrations\", \"taigaComponents\", \"taigaProfile\", \"taigaHome\", \"taigaUserTimeline\", \"taigaExternalApps\", \"taigaDiscover\", \"taigaHistory\", \"taigaWikiHistory\", \"taigaEpics\", \"taigaUtils\", \"taigaSearch\", \"templates\", \"ngSanitize\", \"ngRoute\", \"ngAnimate\", \"ngAria\", \"pascalprecht.translate\", \"infinite-scroll\", \"tgRepeat\"].concat(pluginsModules);\n\n  module = angular.module(\"taiga\", modules);\n\n  module.config([\"$routeProvider\", \"$locationProvider\", \"$httpProvider\", \"$provide\", \"$tgEventsProvider\", \"$compileProvider\", \"$translateProvider\", \"$translatePartialLoaderProvider\", \"$animateProvider\", configure]);\n\n  module.run([\"$log\", \"$rootScope\", \"$tgAuth\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"tgLoader\", \"tgNavigationBarService\", \"tgErrorHandlingService\", init]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: classes.coffee\n */\n\n(function() {\n  var TaigaBase, TaigaController, TaigaService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  TaigaBase = (function() {\n    function TaigaBase() {}\n\n    return TaigaBase;\n\n  })();\n\n  TaigaService = (function(superClass) {\n    extend(TaigaService, superClass);\n\n    function TaigaService() {\n      return TaigaService.__super__.constructor.apply(this, arguments);\n    }\n\n    return TaigaService;\n\n  })(TaigaBase);\n\n  TaigaController = (function(superClass) {\n    extend(TaigaController, superClass);\n\n    function TaigaController() {\n      this.onInitialDataError = bind(this.onInitialDataError, this);\n      return TaigaController.__super__.constructor.apply(this, arguments);\n    }\n\n    TaigaController.prototype.onInitialDataError = function(xhr) {\n      if (xhr) {\n        if (xhr.status === 404) {\n          this.errorHandlingService.notfound();\n        } else if (xhr.status === 403) {\n          this.errorHandlingService.permissionDenied();\n        }\n      }\n      return this.q.reject(xhr);\n    };\n\n    return TaigaController;\n\n  })(TaigaBase);\n\n  this.taiga.Base = TaigaBase;\n\n  this.taiga.Service = TaigaService;\n\n  this.taiga.Controller = TaigaController;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: utils.coffee\n */\n\n(function() {\n  var DEFAULT_COLOR_LIST, addClass, bindMethods, bindOnce, cancelTimeout, debounce, debounceLeading, defineImmutableProperty, getDefaulColorList, getRandomDefaultColor, groupBy, isImage, isPdf, joinStr, mixOf, nl2br, patch, replaceTags, scopeDefer, sizeFormat, slugify, startswith, stripTags, taiga, timeout, toString, toggleText, trim, truncate, unslugify,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    slice = [].slice,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  addClass = function(el, className) {\n    if (el.classList) {\n      return el.classList.add(className);\n    } else {\n      return el.className += ' ' + className;\n    }\n  };\n\n  nl2br = (function(_this) {\n    return function(str) {\n      var breakTag;\n      breakTag = '<br />';\n      return (str + '').replace(/([^>\\r\\n]?)(\\r\\n|\\n\\r|\\r|\\n)/g, '$1' + breakTag + '$2');\n    };\n  })(this);\n\n  bindMethods = (function(_this) {\n    return function(object) {\n      var dependencies, methods;\n      dependencies = _.keys(object);\n      methods = [];\n      _.forIn(object, function(value, key) {\n        if (indexOf.call(dependencies, key) < 0 && _.isFunction(value)) {\n          return methods.push(key);\n        }\n      });\n      return _.bindAll(object, methods);\n    };\n  })(this);\n\n  bindOnce = (function(_this) {\n    return function(scope, attr, continuation) {\n      var delBind, val;\n      val = scope.$eval(attr);\n      if (val !== void 0) {\n        return continuation(val);\n      }\n      delBind = null;\n      return delBind = scope.$watch(attr, function(val) {\n        if (val === void 0) {\n          return;\n        }\n        continuation(val);\n        if (delBind) {\n          return delBind();\n        }\n      });\n    };\n  })(this);\n\n  mixOf = function() {\n    var Mixed, base, i, method, mixin, mixins, name, ref;\n    base = arguments[0], mixins = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n    Mixed = (function(superClass) {\n      extend(Mixed, superClass);\n\n      function Mixed() {\n        return Mixed.__super__.constructor.apply(this, arguments);\n      }\n\n      return Mixed;\n\n    })(base);\n    for (i = mixins.length - 1; i >= 0; i += -1) {\n      mixin = mixins[i];\n      ref = mixin.prototype;\n      for (name in ref) {\n        method = ref[name];\n        Mixed.prototype[name] = method;\n      }\n    }\n    return Mixed;\n  };\n\n  trim = function(data, char) {\n    return _.trim(data, char);\n  };\n\n  slugify = function(data) {\n    return data.toString().toLowerCase().trim().replace(/\\s+/g, '-').replace(/&/g, '-and-').replace(/[^\\w\\-]+/g, '').replace(/\\-\\-+/g, '-');\n  };\n\n  unslugify = function(data) {\n    if (data) {\n      return _.capitalize(data.replace(/-/g, ' '));\n    }\n    return data;\n  };\n\n  toggleText = function(element, texts) {\n    var nextTextPosition, text;\n    nextTextPosition = element.data('nextTextPosition');\n    if ((nextTextPosition == null) || nextTextPosition >= texts.length) {\n      nextTextPosition = 0;\n    }\n    text = texts[nextTextPosition];\n    element.data('nextTextPosition', nextTextPosition + 1);\n    return element.text(text);\n  };\n\n  groupBy = function(coll, pred) {\n    var i, item, len, result;\n    result = {};\n    for (i = 0, len = coll.length; i < len; i++) {\n      item = coll[i];\n      result[pred(item)] = item;\n    }\n    return result;\n  };\n\n  timeout = function(wait, continuation) {\n    return window.setTimeout(continuation, wait);\n  };\n\n  cancelTimeout = function(timeoutVar) {\n    return window.clearTimeout(timeoutVar);\n  };\n\n  scopeDefer = function(scope, func) {\n    return _.defer((function(_this) {\n      return function() {\n        return scope.$apply(func);\n      };\n    })(this));\n  };\n\n  toString = function(value) {\n    if (_.isNumber(value)) {\n      return value + \"\";\n    } else if (_.isString(value)) {\n      return value;\n    } else if (_.isPlainObject(value)) {\n      return JSON.stringify(value);\n    } else if (_.isUndefined(value)) {\n      return \"\";\n    }\n    return value.toString();\n  };\n\n  joinStr = function(str, coll) {\n    return coll.join(str);\n  };\n\n  debounce = function(wait, func) {\n    return _.debounce(func, wait, {\n      leading: true,\n      trailing: false\n    });\n  };\n\n  debounceLeading = function(wait, func) {\n    return _.debounce(func, wait, {\n      leading: false,\n      trailing: true\n    });\n  };\n\n  startswith = function(str1, str2) {\n    return _.startsWith(str1, str2);\n  };\n\n  truncate = function(str, maxLength, suffix) {\n    var out;\n    if (suffix == null) {\n      suffix = \"...\";\n    }\n    if ((typeof str !== \"string\") && !(str instanceof String)) {\n      return str;\n    }\n    out = str.slice(0);\n    if (out.length > maxLength) {\n      out = out.substring(0, maxLength + 1);\n      out = out.substring(0, Math.min(out.length, out.lastIndexOf(\" \")));\n      out = out + suffix;\n    }\n    return out;\n  };\n\n  sizeFormat = function(input, precision) {\n    var number, size, units;\n    if (precision == null) {\n      precision = 1;\n    }\n    if (isNaN(parseFloat(input)) || !isFinite(input)) {\n      return \"-\";\n    }\n    if (input === 0) {\n      return \"0 bytes\";\n    }\n    units = [\"bytes\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\"];\n    number = Math.floor(Math.log(input) / Math.log(1024));\n    if (number > 5) {\n      number = 5;\n    }\n    size = (input / Math.pow(1024, number)).toFixed(precision);\n    return size + \" \" + units[number];\n  };\n\n  stripTags = function(str, exception) {\n    var pattern;\n    if (exception) {\n      pattern = new RegExp('<(?!' + exception + '\\s*\\/?)[^>]+>', 'gi');\n      return String(str).replace(pattern, '');\n    } else {\n      return String(str).replace(/<\\/?[^>]+>/g, '');\n    }\n  };\n\n  replaceTags = function(str, tags, replace) {\n    var pattern;\n    pattern = new RegExp('<(' + tags + ')>', 'gi');\n    str = str.replace(pattern, '<' + replace + '>');\n    pattern = new RegExp('<\\/(' + tags + ')>', 'gi');\n    str = str.replace(pattern, '</' + replace + '>');\n    return str;\n  };\n\n  defineImmutableProperty = (function(_this) {\n    return function(obj, name, fn) {\n      return Object.defineProperty(obj, name, {\n        get: function() {\n          var fn_result;\n          if (!_.isFunction(fn)) {\n            throw \"defineImmutableProperty third param must be a function\";\n          }\n          fn_result = fn();\n          if (fn_result && _.isObject(fn_result)) {\n            if (fn_result.size === void 0) {\n              throw \"defineImmutableProperty must return immutable data\";\n            }\n          }\n          return fn_result;\n        }\n      });\n    };\n  })(this);\n\n  _.mixin({\n    removeKeys: function(obj, keys) {\n      return _.chain([keys]).flatten().reduce(function(obj, key) {\n        delete obj[key];\n        return obj;\n      }, obj).value();\n    },\n    cartesianProduct: function() {\n      return _.reduceRight(arguments, function(a, b) {\n        return _.flatten(_.map(a, function(x) {\n          return _.map(b, function(y) {\n            return [y].concat(x);\n          });\n        }), true);\n      }, [[]]);\n    }\n  });\n\n  isImage = function(name) {\n    return name.match(/\\.(jpe?g|png|gif|gifv|webm)/i) !== null;\n  };\n\n  isPdf = function(name) {\n    return name.match(/\\.(pdf)/i) !== null;\n  };\n\n  patch = function(oldImmutable, newImmutable) {\n    var pathObj;\n    pathObj = {};\n    newImmutable.forEach(function(newValue, key) {\n      if (newValue !== oldImmutable.get(key)) {\n        if (newValue.toJS) {\n          return pathObj[key] = newValue.toJS();\n        } else {\n          return pathObj[key] = newValue;\n        }\n      }\n    });\n    return pathObj;\n  };\n\n  DEFAULT_COLOR_LIST = ['#fce94f', '#edd400', '#c4a000', '#8ae234', '#73d216', '#4e9a06', '#d3d7cf', '#fcaf3e', '#f57900', '#ce5c00', '#729fcf', '#3465a4', '#204a87', '#888a85', '#ad7fa8', '#75507b', '#5c3566', '#ef2929', '#cc0000', '#a40000', '#222222'];\n\n  getRandomDefaultColor = function() {\n    return _.sample(DEFAULT_COLOR_LIST);\n  };\n\n  getDefaulColorList = function() {\n    return _.clone(DEFAULT_COLOR_LIST);\n  };\n\n  taiga = this.taiga;\n\n  taiga.addClass = addClass;\n\n  taiga.nl2br = nl2br;\n\n  taiga.bindMethods = bindMethods;\n\n  taiga.bindOnce = bindOnce;\n\n  taiga.mixOf = mixOf;\n\n  taiga.trim = trim;\n\n  taiga.slugify = slugify;\n\n  taiga.unslugify = unslugify;\n\n  taiga.toggleText = toggleText;\n\n  taiga.groupBy = groupBy;\n\n  taiga.timeout = timeout;\n\n  taiga.cancelTimeout = cancelTimeout;\n\n  taiga.scopeDefer = scopeDefer;\n\n  taiga.toString = toString;\n\n  taiga.joinStr = joinStr;\n\n  taiga.truncate = truncate;\n\n  taiga.debounce = debounce;\n\n  taiga.debounceLeading = debounceLeading;\n\n  taiga.startswith = startswith;\n\n  taiga.sizeFormat = sizeFormat;\n\n  taiga.stripTags = stripTags;\n\n  taiga.replaceTags = replaceTags;\n\n  taiga.defineImmutableProperty = defineImmutableProperty;\n\n  taiga.isImage = isImage;\n\n  taiga.isPdf = isPdf;\n\n  taiga.patch = patch;\n\n  taiga.getRandomDefaultColor = getRandomDefaultColor;\n\n  taiga.getDefaulColorList = getDefaulColorList;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/controllerMixins.coffee\n */\n\n(function() {\n  var FiltersMixin, PageMixin, UsFiltersMixin, groupBy, joinStr, taiga, toString, trim;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  joinStr = this.taiga.joinStr;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  PageMixin = (function() {\n    function PageMixin() {}\n\n    PageMixin.prototype.fillUsersAndRoles = function(users, roles) {\n      var activeUsers, computableRoles;\n      activeUsers = _.filter(users, (function(_this) {\n        return function(user) {\n          return user.is_active;\n        };\n      })(this));\n      this.scope.activeUsers = _.sortBy(activeUsers, \"full_name_display\");\n      this.scope.activeUsersById = groupBy(this.scope.activeUsers, function(e) {\n        return e.id;\n      });\n      this.scope.users = _.sortBy(users, \"full_name_display\");\n      this.scope.usersById = groupBy(this.scope.users, function(e) {\n        return e.id;\n      });\n      this.scope.roles = _.sortBy(roles, \"order\");\n      computableRoles = _(this.scope.project.members).map(\"role\").uniq().value();\n      return this.scope.computableRoles = _(roles).filter(\"computable\").filter(function(x) {\n        return _.includes(computableRoles, x.id);\n      }).value();\n    };\n\n    PageMixin.prototype.loadUsersAndRoles = function() {\n      var promise;\n      promise = this.q.all([this.rs.projects.usersList(this.scope.projectId), this.rs.projects.rolesList(this.scope.projectId)]);\n      return promise.then((function(_this) {\n        return function(results) {\n          var roles, users;\n          users = results[0], roles = results[1];\n          _this.fillUsersAndRoles(users, roles);\n          return results;\n        };\n      })(this));\n    };\n\n    return PageMixin;\n\n  })();\n\n  taiga.PageMixin = PageMixin;\n\n  FiltersMixin = (function() {\n    function FiltersMixin() {}\n\n    FiltersMixin.prototype.selectFilter = function(name, value, load) {\n      var existing, location, params;\n      if (load == null) {\n        load = false;\n      }\n      params = this.location.search();\n      if (params[name] !== void 0 && name !== \"page\") {\n        existing = _.map(taiga.toString(params[name]).split(\",\"), function(x) {\n          return trim(x);\n        });\n        existing.push(taiga.toString(value));\n        existing = _.compact(existing);\n        value = joinStr(\",\", _.uniq(existing));\n      }\n      if (!this.location.isInCurrentRouteParams(name, value)) {\n        location = load ? this.location : this.location.noreload(this.scope);\n        return location.search(name, value);\n      }\n    };\n\n    FiltersMixin.prototype.replaceFilter = function(name, value, load) {\n      var location;\n      if (load == null) {\n        load = false;\n      }\n      if (!this.location.isInCurrentRouteParams(name, value)) {\n        location = load ? this.location : this.location.noreload(this.scope);\n        return location.search(name, value);\n      }\n    };\n\n    FiltersMixin.prototype.replaceAllFilters = function(filters, load) {\n      var location;\n      if (load == null) {\n        load = false;\n      }\n      location = load ? this.location : this.location.noreload(this.scope);\n      return location.search(filters);\n    };\n\n    FiltersMixin.prototype.unselectFilter = function(name, value, load) {\n      var location, newValues, params, parsedValues;\n      if (load == null) {\n        load = false;\n      }\n      params = this.location.search();\n      if (params[name] === void 0) {\n        return;\n      }\n      if (value === void 0 || value === null) {\n        delete params[name];\n      }\n      parsedValues = _.map(taiga.toString(params[name]).split(\",\"), function(x) {\n        return trim(x);\n      });\n      newValues = _.reject(parsedValues, function(x) {\n        return x === taiga.toString(value);\n      });\n      newValues = _.compact(newValues);\n      if (_.isEmpty(newValues)) {\n        value = null;\n      } else {\n        value = joinStr(\",\", _.uniq(newValues));\n      }\n      location = load ? this.location : this.location.noreload(this.scope);\n      return location.search(name, value);\n    };\n\n    FiltersMixin.prototype.applyStoredFilters = function(projectSlug, key) {\n      var filters;\n      if (_.isEmpty(this.location.search())) {\n        filters = this.getFilters(projectSlug, key);\n        if (Object.keys(filters).length) {\n          this.location.search(filters);\n          this.location.replace();\n          return true;\n        }\n      }\n      return false;\n    };\n\n    FiltersMixin.prototype.storeFilters = function(projectSlug, params, filtersHashSuffix) {\n      var hash, ns;\n      ns = projectSlug + \":\" + filtersHashSuffix;\n      hash = taiga.generateHash([projectSlug, ns]);\n      return this.storage.set(hash, params);\n    };\n\n    FiltersMixin.prototype.getFilters = function(projectSlug, filtersHashSuffix) {\n      var hash, ns;\n      ns = projectSlug + \":\" + filtersHashSuffix;\n      hash = taiga.generateHash([projectSlug, ns]);\n      return this.storage.get(hash) || {};\n    };\n\n    FiltersMixin.prototype.formatSelectedFilters = function(type, list, urlIds) {\n      var selectedFilters, selectedIds;\n      selectedIds = urlIds.split(',');\n      selectedFilters = _.filter(list, function(it) {\n        return selectedIds.indexOf(_.toString(it.id)) !== -1;\n      });\n      return _.map(selectedFilters, function(it) {\n        return {\n          id: it.id,\n          key: type + \":\" + it.id,\n          dataType: type,\n          name: it.name,\n          color: it.color\n        };\n      });\n    };\n\n    return FiltersMixin;\n\n  })();\n\n  taiga.FiltersMixin = FiltersMixin;\n\n  UsFiltersMixin = (function() {\n    function UsFiltersMixin() {}\n\n    UsFiltersMixin.prototype.changeQ = function(q) {\n      this.replaceFilter(\"q\", q);\n      this.filtersReloadContent();\n      return this.generateFilters();\n    };\n\n    UsFiltersMixin.prototype.removeFilter = function(filter) {\n      this.unselectFilter(filter.dataType, filter.id);\n      this.filtersReloadContent();\n      return this.generateFilters();\n    };\n\n    UsFiltersMixin.prototype.addFilter = function(newFilter) {\n      this.selectFilter(newFilter.category.dataType, newFilter.filter.id);\n      this.filtersReloadContent();\n      return this.generateFilters();\n    };\n\n    UsFiltersMixin.prototype.selectCustomFilter = function(customFilter) {\n      this.replaceAllFilters(customFilter.filter);\n      this.filtersReloadContent();\n      return this.generateFilters();\n    };\n\n    UsFiltersMixin.prototype.saveCustomFilter = function(name) {\n      var filters, urlfilters;\n      filters = {};\n      urlfilters = this.location.search();\n      filters.tags = urlfilters.tags;\n      filters.status = urlfilters.status;\n      filters.assigned_to = urlfilters.assigned_to;\n      filters.owner = urlfilters.owner;\n      return this.filterRemoteStorageService.getFilters(this.scope.projectId, this.storeCustomFiltersName).then((function(_this) {\n        return function(userFilters) {\n          userFilters[name] = filters;\n          return _this.filterRemoteStorageService.storeFilters(_this.scope.projectId, userFilters, _this.storeCustomFiltersName).then(_this.generateFilters);\n        };\n      })(this));\n    };\n\n    UsFiltersMixin.prototype.removeCustomFilter = function(customFilter) {\n      return this.filterRemoteStorageService.getFilters(this.scope.projectId, this.storeCustomFiltersName).then((function(_this) {\n        return function(userFilters) {\n          delete userFilters[customFilter.id];\n          _this.filterRemoteStorageService.storeFilters(_this.scope.projectId, userFilters, _this.storeCustomFiltersName).then(_this.generateFilters);\n          return _this.generateFilters();\n        };\n      })(this));\n    };\n\n    UsFiltersMixin.prototype.generateFilters = function() {\n      var loadFilters, urlfilters;\n      this.storeFilters(this.params.pslug, this.location.search(), this.storeFiltersName);\n      urlfilters = this.location.search();\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.assigned_to = urlfilters.assigned_to;\n      loadFilters.owner = urlfilters.owner;\n      loadFilters.epic = urlfilters.epic;\n      loadFilters.q = urlfilters.q;\n      return this.q.all([this.rs.userstories.filtersData(loadFilters), this.filterRemoteStorageService.getFilters(this.scope.projectId, this.storeCustomFiltersName)]).then((function(_this) {\n        return function(result) {\n          var assignedTo, customFiltersRaw, data, epic, owner, selected, statuses, tags, tagsWithAtLeastOneElement;\n          data = result[0];\n          customFiltersRaw = result[1];\n          statuses = _.map(data.statuses, function(it) {\n            it.id = it.id.toString();\n            return it;\n          });\n          tags = _.map(data.tags, function(it) {\n            it.id = it.name;\n            return it;\n          });\n          tagsWithAtLeastOneElement = _.filter(tags, function(tag) {\n            return tag.count > 0;\n          });\n          assignedTo = _.map(data.assigned_to, function(it) {\n            if (it.id) {\n              it.id = it.id.toString();\n            } else {\n              it.id = \"null\";\n            }\n            it.name = it.full_name || \"Unassigned\";\n            return it;\n          });\n          owner = _.map(data.owners, function(it) {\n            it.id = it.id.toString();\n            it.name = it.full_name;\n            return it;\n          });\n          epic = _.map(data.epics, function(it) {\n            if (it.id) {\n              it.id = it.id.toString();\n              it.name = \"#\" + it.ref + \" \" + it.subject;\n            } else {\n              it.id = \"null\";\n              it.name = \"Not in an epic\";\n            }\n            return it;\n          });\n          _this.selectedFilters = [];\n          if (loadFilters.status) {\n            selected = _this.formatSelectedFilters(\"status\", statuses, loadFilters.status);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.tags) {\n            selected = _this.formatSelectedFilters(\"tags\", tags, loadFilters.tags);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.assigned_to) {\n            selected = _this.formatSelectedFilters(\"assigned_to\", assignedTo, loadFilters.assigned_to);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.owner) {\n            selected = _this.formatSelectedFilters(\"owner\", owner, loadFilters.owner);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.epic) {\n            selected = _this.formatSelectedFilters(\"epic\", epic, loadFilters.epic);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          _this.filterQ = loadFilters.q;\n          _this.filters = [\n            {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.STATUS\"),\n              dataType: \"status\",\n              content: statuses\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.TAGS\"),\n              dataType: \"tags\",\n              content: tags,\n              hideEmpty: true,\n              totalTaggedElements: tagsWithAtLeastOneElement.length\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.ASSIGNED_TO\"),\n              dataType: \"assigned_to\",\n              content: assignedTo\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.CREATED_BY\"),\n              dataType: \"owner\",\n              content: owner\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.EPIC\"),\n              dataType: \"epic\",\n              content: epic\n            }\n          ];\n          _this.customFilters = [];\n          return _.forOwn(customFiltersRaw, function(value, key) {\n            return _this.customFilters.push({\n              id: key,\n              name: key,\n              filter: value\n            });\n          });\n        };\n      })(this));\n    };\n\n    return UsFiltersMixin;\n\n  })();\n\n  taiga.UsFiltersMixin = UsFiltersMixin;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaAdmin\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/auth.coffee\n */\n\n(function() {\n  var AuthService, CancelAccountDirective, ChangeEmailDirective, ChangePasswordFromRecoveryDirective, ForgotPasswordDirective, InvitationDirective, LoginDirective, LoginPage, PublicRegisterMessageDirective, RegisterDirective, debounce, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAuth\", [\"taigaResources\"]);\n\n  LoginPage = (function() {\n    LoginPage.$inject = ['tgCurrentUserService', '$location', '$tgNavUrls', '$routeParams'];\n\n    function LoginPage(currentUserService, $location, $navUrls, $routeParams) {\n      var url;\n      if (currentUserService.isAuthenticated()) {\n        if (!$routeParams['force_login']) {\n          url = $navUrls.resolve(\"home\");\n          if ($routeParams['next']) {\n            url = decodeURIComponent($routeParams['next']);\n            $location.search('next', null);\n          }\n          $location.url(url);\n        }\n      }\n    }\n\n    return LoginPage;\n\n  })();\n\n  module.controller('LoginPage', LoginPage);\n\n  AuthService = (function(superClass) {\n    extend(AuthService, superClass);\n\n    AuthService.$inject = [\"$rootScope\", \"$tgStorage\", \"$tgModel\", \"$tgResources\", \"$tgHttp\", \"$tgUrls\", \"$tgConfig\", \"$translate\", \"tgCurrentUserService\", \"tgThemeService\"];\n\n    function AuthService(rootscope, storage, model, rs, http, urls, config1, translate, currentUserService1, themeService) {\n      var userModel;\n      this.rootscope = rootscope;\n      this.storage = storage;\n      this.model = model;\n      this.rs = rs;\n      this.http = http;\n      this.urls = urls;\n      this.config = config1;\n      this.translate = translate;\n      this.currentUserService = currentUserService1;\n      this.themeService = themeService;\n      AuthService.__super__.constructor.call(this);\n      userModel = this.getUser();\n      this._currentTheme = this._getUserTheme();\n      this.setUserdata(userModel);\n    }\n\n    AuthService.prototype.setUserdata = function(userModel) {\n      if (userModel) {\n        this.userData = Immutable.fromJS(userModel.getAttrs());\n        return this.currentUserService.setUser(this.userData);\n      } else {\n        return this.userData = null;\n      }\n    };\n\n    AuthService.prototype._getUserTheme = function() {\n      var ref;\n      return ((ref = this.rootscope.user) != null ? ref.theme : void 0) || this.config.get(\"defaultTheme\") || \"taiga\";\n    };\n\n    AuthService.prototype._setTheme = function() {\n      var newTheme;\n      newTheme = this._getUserTheme();\n      if (this._currentTheme !== newTheme) {\n        this._currentTheme = newTheme;\n        return this.themeService.use(this._currentTheme);\n      }\n    };\n\n    AuthService.prototype._setLocales = function() {\n      var lang, ref;\n      lang = ((ref = this.rootscope.user) != null ? ref.lang : void 0) || this.config.get(\"defaultLanguage\") || \"en\";\n      this.translate.preferredLanguage(lang);\n      return this.translate.use(lang);\n    };\n\n    AuthService.prototype.getUser = function() {\n      var user, userData;\n      if (this.rootscope.user) {\n        return this.rootscope.user;\n      }\n      userData = this.storage.get(\"userInfo\");\n      if (userData) {\n        user = this.model.make_model(\"users\", userData);\n        this.rootscope.user = user;\n        this._setLocales();\n        this._setTheme();\n        return user;\n      } else {\n        this._setTheme();\n      }\n      return null;\n    };\n\n    AuthService.prototype.setUser = function(user) {\n      this.rootscope.auth = user;\n      this.storage.set(\"userInfo\", user.getAttrs());\n      this.rootscope.user = user;\n      this.setUserdata(user);\n      this._setLocales();\n      return this._setTheme();\n    };\n\n    AuthService.prototype.clear = function() {\n      this.rootscope.auth = null;\n      this.rootscope.user = null;\n      return this.storage.remove(\"userInfo\");\n    };\n\n    AuthService.prototype.setToken = function(token) {\n      return this.storage.set(\"token\", token);\n    };\n\n    AuthService.prototype.getToken = function() {\n      return this.storage.get(\"token\");\n    };\n\n    AuthService.prototype.removeToken = function() {\n      return this.storage.remove(\"token\");\n    };\n\n    AuthService.prototype.isAuthenticated = function() {\n      if (this.getUser() !== null) {\n        return true;\n      }\n      return false;\n    };\n\n    AuthService.prototype.refresh = function() {\n      var url;\n      url = this.urls.resolve(\"user-me\");\n      return this.http.get(url).then((function(_this) {\n        return function(data, status) {\n          var user;\n          user = data.data;\n          user.token = _this.getUser().auth_token;\n          user = _this.model.make_model(\"users\", user);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.login = function(data, type) {\n      var url;\n      url = this.urls.resolve(\"auth\");\n      data = _.clone(data, false);\n      data.type = type ? type : \"normal\";\n      this.removeToken();\n      return this.http.post(url, data).then((function(_this) {\n        return function(data, status) {\n          var user;\n          user = _this.model.make_model(\"users\", data.data);\n          _this.setToken(user.auth_token);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.logout = function() {\n      this.removeToken();\n      this.clear();\n      this.currentUserService.removeUser();\n      this._setTheme();\n      return this._setLocales();\n    };\n\n    AuthService.prototype.register = function(data, type, existing) {\n      var url;\n      url = this.urls.resolve(\"auth-register\");\n      data = _.clone(data, false);\n      data.type = type ? type : \"public\";\n      if (type === \"private\") {\n        data.existing = existing ? existing : false;\n      }\n      this.removeToken();\n      return this.http.post(url, data).then((function(_this) {\n        return function(response) {\n          var user;\n          user = _this.model.make_model(\"users\", response.data);\n          _this.setToken(user.auth_token);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.getInvitation = function(token) {\n      return this.rs.invitations.get(token);\n    };\n\n    AuthService.prototype.acceptInvitiationWithNewUser = function(data) {\n      return this.register(data, \"private\", false);\n    };\n\n    AuthService.prototype.acceptInvitiationWithExistingUser = function(data) {\n      return this.register(data, \"private\", true);\n    };\n\n    AuthService.prototype.forgotPassword = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-password-recovery\");\n      data = _.clone(data, false);\n      this.removeToken();\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.changePasswordFromRecovery = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-change-password-from-recovery\");\n      data = _.clone(data, false);\n      this.removeToken();\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.changeEmail = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-change-email\");\n      data = _.clone(data, false);\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.cancelAccount = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-cancel-account\");\n      data = _.clone(data, false);\n      return this.http.post(url, data);\n    };\n\n    return AuthService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgAuth\", AuthService);\n\n  PublicRegisterMessageDirective = function($config, $navUrls, $routeParams, templates) {\n    var template, templateFn;\n    template = templates.get(\"auth/login-text.html\", true);\n    templateFn = function() {\n      var nextUrl, publicRegisterEnabled, url;\n      publicRegisterEnabled = $config.get(\"publicRegisterEnabled\");\n      if (!publicRegisterEnabled) {\n        return \"\";\n      }\n      url = $navUrls.resolve(\"register\");\n      if ($routeParams['force_next']) {\n        nextUrl = encodeURIComponent($routeParams['force_next']);\n        url += \"?next=\" + nextUrl;\n      }\n      return template({\n        url: url\n      });\n    };\n    return {\n      restrict: \"AE\",\n      scope: {},\n      template: templateFn\n    };\n  };\n\n  module.directive(\"tgPublicRegisterMessage\", [\"$tgConfig\", \"$tgNavUrls\", \"$routeParams\", \"$tgTemplate\", PublicRegisterMessageDirective]);\n\n  LoginDirective = function($auth, $confirm, $location, $config, $routeParams, $navUrls, $events, $translate, $window) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onError, onSuccess, submit;\n      form = new checksley.Form($el.find(\"form.login-form\"));\n      if ($routeParams['next'] && $routeParams['next'] !== $navUrls.resolve(\"login\")) {\n        $scope.nextUrl = decodeURIComponent($routeParams['next']);\n      } else {\n        $scope.nextUrl = $navUrls.resolve(\"home\");\n      }\n      if ($routeParams['force_next']) {\n        $scope.nextUrl = decodeURIComponent($routeParams['force_next']);\n      }\n      onSuccess = function(response) {\n        $events.setupConnection();\n        if ($scope.nextUrl.indexOf('http') === 0) {\n          return $window.location.href = $scope.nextUrl;\n        } else {\n          return $location.url($scope.nextUrl);\n        }\n      };\n      onError = function(response) {\n        return $confirm.notify(\"light-error\", $translate.instant(\"LOGIN_FORM.ERROR_AUTH_INCORRECT\"));\n      };\n      $scope.onKeyUp = function(event) {\n        var target, value;\n        target = angular.element(event.currentTarget);\n        value = target.val();\n        $scope.iscapsLockActivated = false;\n        if (value !== value.toLowerCase()) {\n          return $scope.iscapsLockActivated = true;\n        }\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var data, loginFormType, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          data = {\n            \"username\": $el.find(\"form.login-form input[name=username]\").val(),\n            \"password\": $el.find(\"form.login-form input[name=password]\").val()\n          };\n          loginFormType = $config.get(\"loginFormType\", \"normal\");\n          promise = $auth.login(data, loginFormType);\n          return promise.then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      window.prerenderReady = true;\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLogin\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgConfig\", \"$routeParams\", \"$tgNavUrls\", \"$tgEvents\", \"$translate\", \"$window\", LoginDirective]);\n\n  RegisterDirective = function($auth, $confirm, $location, $navUrls, $config, $routeParams, $analytics, $translate, $window) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      if (!$config.get(\"publicRegisterEnabled\")) {\n        $location.path($navUrls.resolve(\"not-found\"));\n        $location.replace();\n      }\n      $scope.data = {};\n      form = $el.find(\"form\").checksley({\n        onlyOneErrorElement: true\n      });\n      if ($routeParams['next'] && $routeParams['next'] !== $navUrls.resolve(\"login\")) {\n        $scope.nextUrl = decodeURIComponent($routeParams['next']);\n      } else {\n        $scope.nextUrl = $navUrls.resolve(\"home\");\n      }\n      onSuccessSubmit = function(response) {\n        $analytics.trackEvent(\"auth\", \"register\", \"user registration\", 1);\n        if ($scope.nextUrl.indexOf('http') === 0) {\n          return $window.location.href = $scope.nextUrl;\n        } else {\n          return $location.url($scope.nextUrl);\n        }\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        if (response.data._error_message) {\n          text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n            error: response.data._error_message\n          });\n          $confirm.notify(\"light-error\", text);\n        }\n        return form.setErrors(response.data);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.register($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return window.prerenderReady = true;\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRegister\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfig\", \"$routeParams\", \"$tgAnalytics\", \"$translate\", \"$window\", RegisterDirective]);\n\n  ForgotPasswordDirective = function($auth, $confirm, $location, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var message, title;\n        $location.path($navUrls.resolve(\"login\"));\n        title = $translate.instant(\"FORGOT_PASSWORD_FORM.SUCCESS_TITLE\");\n        message = $translate.instant(\"FORGOT_PASSWORD_FORM.SUCCESS_TEXT\");\n        return $confirm.success(title, message);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"FORGOT_PASSWORD_FORM.ERROR\");\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.forgotPassword($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return window.prerenderReady = true;\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgForgotPassword\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgNavUrls\", \"$translate\", ForgotPasswordDirective]);\n\n  ChangePasswordFromRecoveryDirective = function($auth, $confirm, $location, $params, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit, text;\n      $scope.data = {};\n      if ($params.token != null) {\n        $scope.tokenInParams = true;\n        $scope.data.token = $params.token;\n      } else {\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.ERROR\");\n        $confirm.notify(\"light-error\", text);\n      }\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.ERROR\");\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.changePasswordFromRecovery($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgChangePasswordFromRecovery\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$translate\", ChangePasswordFromRecoveryDirective]);\n\n  InvitationDirective = function($auth, $confirm, $location, $params, $navUrls, $analytics, $translate, config) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var loginForm, onErrorSubmitLogin, onErrorSubmitRegister, onSuccessSubmitLogin, onSuccessSubmitRegister, promise, registerForm, submitLogin, submitRegister, token;\n      token = $params.token;\n      promise = $auth.getInvitation(token);\n      promise.then(function(invitation) {\n        $scope.invitation = invitation;\n        return $scope.publicRegisterEnabled = config.get(\"publicRegisterEnabled\");\n      });\n      promise.then(null, function(response) {\n        var text;\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"INVITATION_LOGIN_FORM.NOT_FOUND\");\n        return $confirm.notify(\"light-error\", text);\n      });\n      $scope.dataLogin = {\n        token: token\n      };\n      loginForm = $el.find(\"form.login-form\").checksley({\n        onlyOneErrorElement: true\n      });\n      onSuccessSubmitLogin = function(response) {\n        var text;\n        $analytics.trackEvent(\"auth\", \"invitationAccept\", \"invitation accept with existing user\", 1);\n        $location.path($navUrls.resolve(\"project\", {\n          project: $scope.invitation.project_slug\n        }));\n        text = $translate.instant(\"INVITATION_LOGIN_FORM.SUCCESS\", {\n          \"project_name\": $scope.invitation.project_name\n        });\n        return $confirm.notify(\"success\", text);\n      };\n      onErrorSubmitLogin = function(response) {\n        return $confirm.notify(\"light-error\", response.data._error_message);\n      };\n      submitLogin = debounce(2000, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          if (!loginForm.validate()) {\n            return;\n          }\n          promise = $auth.acceptInvitiationWithExistingUser($scope.dataLogin);\n          return promise.then(onSuccessSubmitLogin, onErrorSubmitLogin);\n        };\n      })(this));\n      $el.on(\"submit\", \"form.login-form\", submitLogin);\n      $el.on(\"click\", \".button-login\", submitLogin);\n      $scope.dataRegister = {\n        token: token\n      };\n      registerForm = $el.find(\"form.register-form\").checksley({\n        onlyOneErrorElement: true\n      });\n      onSuccessSubmitRegister = function(response) {\n        $analytics.trackEvent(\"auth\", \"invitationAccept\", \"invitation accept with new user\", 1);\n        $location.path($navUrls.resolve(\"project\", {\n          project: $scope.invitation.project_slug\n        }));\n        return $confirm.notify(\"success\", \"You've successfully joined this project\", \"Welcome to \" + (_.escape($scope.invitation.project_name)));\n      };\n      onErrorSubmitRegister = function(response) {\n        var text;\n        if (response.data._error_message) {\n          text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n            error: response.data._error_message\n          });\n          $confirm.notify(\"light-error\", text);\n        }\n        return registerForm.setErrors(response.data);\n      };\n      submitRegister = debounce(2000, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          if (!registerForm.validate()) {\n            return;\n          }\n          promise = $auth.acceptInvitiationWithNewUser($scope.dataRegister);\n          return promise.then(onSuccessSubmitRegister, onErrorSubmitRegister);\n        };\n      })(this));\n      $el.on(\"submit\", \"form.register-form\", submitRegister);\n      $el.on(\"click\", \".button-register\", submitRegister);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgInvitation\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", \"$tgConfig\", InvitationDirective]);\n\n  ChangeEmailDirective = function($repo, $model, $auth, $confirm, $location, $params, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      $scope.data.email_token = $params.email_token;\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        if ($auth.isAuthenticated()) {\n          $repo.queryOne(\"users\", $auth.getUser().id).then((function(_this) {\n            return function(data) {\n              $auth.setUser(data);\n              return $location.path($navUrls.resolve(\"home\"));\n            };\n          })(this));\n        } else {\n          $location.path($navUrls.resolve(\"login\"));\n        }\n        text = $translate.instant(\"CHANGE_EMAIL_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n          error: response.data._error_message\n        });\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = function() {\n        var promise;\n        if (!form.validate()) {\n          return;\n        }\n        promise = $auth.changeEmail($scope.data);\n        return promise.then(onSuccessSubmit, onErrorSubmit);\n      };\n      $el.on(\"submit\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"click\", \"a.button-change-email\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgChangeEmail\", [\"$tgRepo\", \"$tgModel\", \"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$translate\", ChangeEmailDirective]);\n\n  CancelAccountDirective = function($repo, $model, $auth, $confirm, $location, $params, $navUrls) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      $scope.data.cancel_token = $params.cancel_token;\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        $auth.logout();\n        $location.path($navUrls.resolve(\"home\"));\n        text = $translate.instant(\"CANCEL_ACCOUNT.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n          error: response.data._error_message\n        });\n        return $confirm.notify(\"error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.cancelAccount($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgCancelAccount\", [\"$tgRepo\", \"$tgModel\", \"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", CancelAccountDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaBacklog\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base.coffee\n */\n\n(function() {\n  var TaigaMainDirective, bindOnce, groupBy, init, module, taiga, urls;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBase\", []);\n\n  TaigaMainDirective = function($rootscope, $window) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $window.onresize = function() {\n        return $rootscope.$broadcast(\"resize\");\n      };\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMain\", [\"$rootScope\", \"$window\", TaigaMainDirective]);\n\n  urls = {\n    \"home\": \"/\",\n    \"projects\": \"/projects\",\n    \"error\": \"/error\",\n    \"not-found\": \"/not-found\",\n    \"permission-denied\": \"/permission-denied\",\n    \"search\": \"/search\",\n    \"search-results\": \"/search/results/:result_type\",\n    \"discover\": \"/discover\",\n    \"discover-search\": \"/discover/search\",\n    \"login\": \"/login\",\n    \"forgot-password\": \"/forgot-password\",\n    \"change-password\": \"/change-password/:token\",\n    \"change-email\": \"/change-email/:token\",\n    \"cancel-account\": \"/cancel-account/:token\",\n    \"register\": \"/register\",\n    \"invitation\": \"/invitation/:token\",\n    \"create-project\": \"/create-project\",\n    \"profile\": \"/profile\",\n    \"user-profile\": \"/profile/:username\",\n    \"blocked-project\": \"/blocked-project/:project\",\n    \"project\": \"/project/:project\",\n    \"project-backlog\": \"/project/:project/backlog\",\n    \"project-taskboard\": \"/project/:project/taskboard/:sprint\",\n    \"project-kanban\": \"/project/:project/kanban\",\n    \"project-issues\": \"/project/:project/issues\",\n    \"project-epics\": \"/project/:project/epics\",\n    \"project-search\": \"/project/:project/search\",\n    \"project-epics-detail\": \"/project/:project/epic/:ref\",\n    \"project-userstories-detail\": \"/project/:project/us/:ref\",\n    \"project-tasks-detail\": \"/project/:project/task/:ref\",\n    \"project-issues-detail\": \"/project/:project/issue/:ref\",\n    \"project-wiki\": \"/project/:project/wiki\",\n    \"project-wiki-list\": \"/project/:project/wiki-list\",\n    \"project-wiki-page\": \"/project/:project/wiki/:slug\",\n    \"project-team\": \"/project/:project/team\",\n    \"project-admin-home\": \"/project/:project/admin/project-profile/details\",\n    \"project-admin-project-profile-details\": \"/project/:project/admin/project-profile/details\",\n    \"project-admin-project-profile-default-values\": \"/project/:project/admin/project-profile/default-values\",\n    \"project-admin-project-profile-modules\": \"/project/:project/admin/project-profile/modules\",\n    \"project-admin-project-profile-export\": \"/project/:project/admin/project-profile/export\",\n    \"project-admin-project-profile-reports\": \"/project/:project/admin/project-profile/reports\",\n    \"project-admin-project-values-status\": \"/project/:project/admin/project-values/status\",\n    \"project-admin-project-values-points\": \"/project/:project/admin/project-values/points\",\n    \"project-admin-project-values-priorities\": \"/project/:project/admin/project-values/priorities\",\n    \"project-admin-project-values-severities\": \"/project/:project/admin/project-values/severities\",\n    \"project-admin-project-values-types\": \"/project/:project/admin/project-values/types\",\n    \"project-admin-project-values-custom-fields\": \"/project/:project/admin/project-values/custom-fields\",\n    \"project-admin-project-values-tags\": \"/project/:project/admin/project-values/tags\",\n    \"project-admin-memberships\": \"/project/:project/admin/memberships\",\n    \"project-admin-roles\": \"/project/:project/admin/roles\",\n    \"project-admin-third-parties-webhooks\": \"/project/:project/admin/third-parties/webhooks\",\n    \"project-admin-third-parties-github\": \"/project/:project/admin/third-parties/github\",\n    \"project-admin-third-parties-gitlab\": \"/project/:project/admin/third-parties/gitlab\",\n    \"project-admin-third-parties-bitbucket\": \"/project/:project/admin/third-parties/bitbucket\",\n    \"project-admin-third-parties-gogs\": \"/project/:project/admin/third-parties/gogs\",\n    \"project-admin-contrib\": \"/project/:project/admin/contrib/:plugin\",\n    \"user-settings-user-profile\": \"/user-settings/user-profile\",\n    \"user-settings-user-change-password\": \"/user-settings/user-change-password\",\n    \"user-settings-user-avatar\": \"/user-settings/user-avatar\",\n    \"user-settings-mail-notifications\": \"/user-settings/mail-notifications\",\n    \"user-settings-contrib\": \"/user-settings/contrib/:plugin\"\n  };\n\n  init = function($log, $navurls) {\n    $log.debug(\"Initialize navigation urls\");\n    return $navurls.update(urls);\n  };\n\n  module.run([\"$log\", \"$tgNavUrls\", init]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common.coffee\n */\n\n(function() {\n  var AnimationFrame, Autofocus, Capslock, CheckPermissionDirective, ClassPermissionDirective, DataPickerConfig, LightboxClose, ProjectUrl, Qqueue, QueueModelTransformation, SelectedText, Svg, Template, ToggleCommentDirective, module, taiga,\n    slice = [].slice,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\", []);\n\n  DataPickerConfig = function($translate) {\n    return {\n      get: function() {\n        return {\n          i18n: {\n            previousMonth: $translate.instant(\"COMMON.PICKERDATE.PREV_MONTH\"),\n            nextMonth: $translate.instant(\"COMMON.PICKERDATE.NEXT_MONTH\"),\n            months: [$translate.instant(\"COMMON.PICKERDATE.MONTHS.JAN\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.FEB\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.MAR\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.APR\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.MAY\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.JUN\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.JUL\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.AUG\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.SEP\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.OCT\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.NOV\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.DEC\")],\n            weekdays: [$translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.SUN\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.MON\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.TUE\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.WED\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.THU\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.FRI\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.SAT\")],\n            weekdaysShort: [$translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.SUN\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.MON\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.TUE\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.WED\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.THU\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.FRI\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.SAT\")]\n          },\n          isRTL: $translate.instant(\"COMMON.PICKERDATE.IS_RTL\") === \"true\",\n          firstDay: parseInt($translate.instant(\"COMMON.PICKERDATE.FIRST_DAY_OF_WEEK\"), 10),\n          format: $translate.instant(\"COMMON.PICKERDATE.FORMAT\")\n        };\n      }\n    };\n  };\n\n  module.factory(\"tgDatePickerConfigService\", [\"$translate\", DataPickerConfig]);\n\n  SelectedText = function($window, $document) {\n    var get;\n    get = function() {\n      if ($window.getSelection) {\n        return $window.getSelection().toString();\n      } else if ($document.selection) {\n        return $document.selection.createRange().text;\n      }\n      return \"\";\n    };\n    return {\n      get: get\n    };\n  };\n\n  module.factory(\"$selectedText\", [\"$window\", \"$document\", SelectedText]);\n\n  CheckPermissionDirective = function(projectService) {\n    var link, render;\n    render = function($el, project, permission) {\n      if (project && permission) {\n        if (project.get('my_permissions').indexOf(permission) > -1) {\n          return $el.removeClass('hidden');\n        }\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var permission, unObserve, unwatch;\n      $el.addClass('hidden');\n      permission = $attrs.tgCheckPermission;\n      unwatch = $scope.$watch(function() {\n        return projectService.project;\n      }, function() {\n        if (!projectService.project) {\n          return;\n        }\n        render($el, projectService.project, permission);\n        return unwatch();\n      });\n      unObserve = $attrs.$observe(\"tgCheckPermission\", function(permission) {\n        if (!permission) {\n          return;\n        }\n        render($el, projectService.project, permission);\n        return unObserve();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CheckPermissionDirective.$inject = [\"tgProjectService\"];\n\n  module.directive(\"tgCheckPermission\", CheckPermissionDirective);\n\n  ClassPermissionDirective = function() {\n    var link, name;\n    name = \"tgClassPermission\";\n    link = function($scope, $el, $attrs) {\n      var checkPermissions, tgClassPermissionWatchAction, unbindWatcher;\n      checkPermissions = function(project, className, permission) {\n        var negation;\n        negation = permission[0] === \"!\";\n        if (negation) {\n          permission = permission.slice(1);\n        }\n        if (negation && project.my_permissions.indexOf(permission) === -1) {\n          return $el.addClass(className);\n        } else if (!negation && project.my_permissions.indexOf(permission) !== -1) {\n          return $el.addClass(className);\n        } else {\n          return $el.removeClass(className);\n        }\n      };\n      tgClassPermissionWatchAction = function(project) {\n        var className, classes, permission, results;\n        if (project) {\n          unbindWatcher();\n          classes = $scope.$eval($attrs[name]);\n          results = [];\n          for (className in classes) {\n            permission = classes[className];\n            results.push(checkPermissions(project, className, permission));\n          }\n          return results;\n        }\n      };\n      return unbindWatcher = $scope.$watch(\"project\", tgClassPermissionWatchAction);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgClassPermission\", ClassPermissionDirective);\n\n  AnimationFrame = function() {\n    var add, animationFrame, performAnimation, tail;\n    animationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame;\n    performAnimation = (function(_this) {\n      return function(time) {\n        var fn;\n        fn = tail.shift();\n        fn();\n        if (tail.length) {\n          return animationFrame(performAnimation);\n        }\n      };\n    })(this);\n    tail = [];\n    add = function() {\n      var fn, i, len, results;\n      results = [];\n      for (i = 0, len = arguments.length; i < len; i++) {\n        fn = arguments[i];\n        tail.push(fn);\n        if (tail.length === 1) {\n          results.push(animationFrame(performAnimation));\n        } else {\n          results.push(void 0);\n        }\n      }\n      return results;\n    };\n    return {\n      add: add\n    };\n  };\n\n  module.factory(\"animationFrame\", AnimationFrame);\n\n  ToggleCommentDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.find(\"textarea\").on(\"focus\", function() {\n        return $el.addClass(\"active\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgToggleComment\", ToggleCommentDirective);\n\n  ProjectUrl = function($navurls) {\n    var get;\n    get = function(project) {\n      var ctx;\n      ctx = {\n        project: project.slug\n      };\n      if (project.is_backlog_activated && project.my_permissions.indexOf(\"view_us\") > -1) {\n        return $navurls.resolve(\"project-backlog\", ctx);\n      }\n      if (project.is_kanban_activated && project.my_permissions.indexOf(\"view_us\") > -1) {\n        return $navurls.resolve(\"project-kanban\", ctx);\n      }\n      if (project.is_wiki_activated && project.my_permissions.indexOf(\"view_wiki_pages\") > -1) {\n        return $navurls.resolve(\"project-wiki\", ctx);\n      }\n      if (project.is_issues_activated && project.my_permissions.indexOf(\"view_issues\") > -1) {\n        return $navurls.resolve(\"project-issues\", ctx);\n      }\n      return $navurls.resolve(\"project\", ctx);\n    };\n    return {\n      get: get\n    };\n  };\n\n  module.factory(\"$projectUrl\", [\"$tgNavUrls\", ProjectUrl]);\n\n  Qqueue = function($q) {\n    var deferred, lastPromise, qqueue;\n    deferred = $q.defer();\n    deferred.resolve();\n    lastPromise = deferred.promise;\n    qqueue = {\n      bindAdd: (function(_this) {\n        return function(fn) {\n          return function() {\n            var args;\n            args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n            return lastPromise = lastPromise.then(function() {\n              return fn.apply(_this, args);\n            });\n          };\n          return qqueue;\n        };\n      })(this),\n      add: (function(_this) {\n        return function(fn) {\n          if (!lastPromise) {\n            lastPromise = fn();\n          } else {\n            lastPromise = lastPromise.then(fn);\n          }\n          return qqueue;\n        };\n      })(this)\n    };\n    return qqueue;\n  };\n\n  module.factory(\"$tgQqueue\", [\"$q\", Qqueue]);\n\n  QueueModelTransformation = (function(superClass) {\n    extend(QueueModelTransformation, superClass);\n\n    QueueModelTransformation.$inject = [\"$tgQqueue\", \"$tgRepo\", \"$q\", \"$tgModel\"];\n\n    function QueueModelTransformation(qqueue1, repo, q, model1) {\n      this.qqueue = qqueue1;\n      this.repo = repo;\n      this.q = q;\n      this.model = model1;\n    }\n\n    QueueModelTransformation.prototype.setObject = function(scope1, prop) {\n      this.scope = scope1;\n      this.prop = prop;\n    };\n\n    QueueModelTransformation.prototype.clone = function() {\n      var attrs, model;\n      attrs = _.cloneDeep(this.scope[this.prop]._attrs);\n      model = this.model.make_model(this.scope[this.prop]._name, attrs);\n      return model;\n    };\n\n    QueueModelTransformation.prototype.getObj = function() {\n      return this.scope[this.prop];\n    };\n\n    QueueModelTransformation.prototype.save = function(transformation) {\n      var defered;\n      defered = this.q.defer();\n      this.qqueue.add((function(_this) {\n        return function() {\n          var clone, comment, modified, obj, success;\n          obj = _this.getObj();\n          comment = obj.comment;\n          obj.comment = '';\n          clone = _this.clone();\n          modified = _.omit(obj._modifiedAttrs, ['version']);\n          clone = _.assign(clone, modified);\n          transformation(clone);\n          if (comment.length) {\n            clone.comment = comment;\n          }\n          success = function() {\n            _this.scope[_this.prop] = clone;\n            return defered.resolve.apply(null, arguments);\n          };\n          return _this.repo.save(clone).then(success, defered.reject);\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    return QueueModelTransformation;\n\n  })(taiga.Service);\n\n  module.service(\"$tgQueueModelTransformation\", QueueModelTransformation);\n\n  Template = function($templateCache) {\n    return {\n      get: (function(_this) {\n        return function(name, lodash) {\n          var tmp;\n          if (lodash == null) {\n            lodash = false;\n          }\n          tmp = $templateCache.get(name);\n          if (lodash) {\n            tmp = _.template(tmp);\n          }\n          return tmp;\n        };\n      })(this)\n    };\n  };\n\n  module.factory(\"$tgTemplate\", [\"$templateCache\", Template]);\n\n  Capslock = function() {\n    var template;\n    template = \"<tg-svg class=\\\"capslock\\\" ng-if=\\\"capslockIcon && iscapsLockActivated\\\" svg-icon='icon-capslock' svg-title='COMMON.CAPSLOCK_WARNING'></tg-svg>\";\n    return {\n      template: template\n    };\n  };\n\n  module.directive(\"tgCapslock\", [Capslock]);\n\n  LightboxClose = function() {\n    var template;\n    template = \"<a class=\\\"close\\\" href=\\\"\\\" title=\\\"{{'COMMON.CLOSE' | translate}}\\\">\\n    <tg-svg svg-icon=\\\"icon-close\\\"></tg-svg>\\n</a>\";\n    return {\n      template: template\n    };\n  };\n\n  module.directive(\"tgLightboxClose\", [LightboxClose]);\n\n  Svg = function() {\n    var template;\n    template = \"<svg class=\\\"{{ 'icon ' + svgIcon }}\\\">\\n    <use xlink:href=\\\"\\\" ng-attr-xlink:href=\\\"{{ '#' + svgIcon }}\\\">\\n        <title ng-if=\\\"svgTitle\\\">{{svgTitle}}</title>\\n        <title\\n            ng-if=\\\"svgTitleTranslate\\\"\\n            translate=\\\"{{svgTitleTranslate}}\\\"\\n            translate-values=\\\"{{svgTitleTranslateValues}}\\\"\\n            ></title>\\n    </use>\\n</svg>\";\n    return {\n      scope: {\n        svgIcon: \"@\",\n        svgTitle: \"@\",\n        svgTitleTranslate: \"@\",\n        svgTitleTranslateValues: \"=\"\n      },\n      template: template\n    };\n  };\n\n  module.directive(\"tgSvg\", [Svg]);\n\n  Autofocus = function($timeout) {\n    return {\n      restrict: 'A',\n      link: function($scope, $element) {\n        return $timeout(function() {\n          return $element[0].focus();\n        });\n      }\n    };\n  };\n\n  module.directive('tgAutofocus', ['$timeout', Autofocus]);\n\n  module.directive('tgPreloadImage', function() {\n    var preload, spinner, template;\n    spinner = \"<img class='loading-spinner' src='/\" + window._version + \"/svg/spinner-circle.svg' alt='loading...' />\";\n    template = \"<div>\\n    <ng-transclude></ng-transclude>\\n</div>\";\n    preload = function(src, onLoad) {\n      var image;\n      image = new Image();\n      image.onload = onLoad;\n      image.src = src;\n      return image;\n    };\n    return {\n      template: template,\n      transclude: true,\n      replace: true,\n      link: function(scope, el, attrs) {\n        var image, onLoad, timeout;\n        image = el.find('img:last');\n        timeout = null;\n        onLoad = function() {\n          el.find('.loading-spinner').remove();\n          image.show();\n          if (timeout) {\n            clearTimeout(timeout);\n            return timeout = null;\n          }\n        };\n        return attrs.$observe('preloadSrc', function(src) {\n          if (timeout) {\n            clearTimeout(timeout);\n          }\n          el.find('.loading-spinner').remove();\n          timeout = setTimeout(function() {\n            return el.prepend(spinner);\n          }, 200);\n          image.hide();\n          return preload(src, onLoad);\n        });\n      }\n    };\n  });\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/epics.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaEpics\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/events.coffee\n */\n\n(function() {\n  var EventsProvider, EventsService, bindMethods, module, startswith, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  startswith = this.taiga.startswith;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaEvents\", []);\n\n  EventsService = (function() {\n    function EventsService(win, log, config, auth, liveAnnouncementService1, rootScope) {\n      this.win = win;\n      this.log = log;\n      this.config = config;\n      this.auth = auth;\n      this.liveAnnouncementService = liveAnnouncementService1;\n      this.rootScope = rootScope;\n      this.processMessage = bind(this.processMessage, this);\n      bindMethods(this);\n    }\n\n    EventsService.prototype.initialize = function(sessionId) {\n      this.sessionId = sessionId;\n      this.subscriptions = {};\n      this.connected = false;\n      this.error = false;\n      this.pendingMessages = [];\n      this.missedHeartbeats = 0;\n      this.heartbeatInterval = null;\n      if (this.win.WebSocket === void 0) {\n        return this.log.info(\"WebSockets not supported on your browser\");\n      }\n    };\n\n    EventsService.prototype.setupConnection = function() {\n      var loc, path, scheme, url;\n      this.stopExistingConnection();\n      url = this.config.get(\"eventsUrl\");\n      if (!url) {\n        return;\n      }\n      if (!startswith(url, \"ws:\") && !startswith(url, \"wss:\")) {\n        loc = this.win.location;\n        scheme = loc.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n        path = _.trimStart(url, \"/\");\n        url = scheme + \"//\" + loc.host + \"/\" + path;\n      }\n      this.ws = new this.win.WebSocket(url);\n      this.ws.addEventListener(\"open\", this.onOpen);\n      this.ws.addEventListener(\"message\", this.onMessage);\n      this.ws.addEventListener(\"error\", this.onError);\n      return this.ws.addEventListener(\"close\", this.onClose);\n    };\n\n    EventsService.prototype.stopExistingConnection = function() {\n      if (this.ws === void 0) {\n        return;\n      }\n      this.ws.removeEventListener(\"open\", this.onOpen);\n      this.ws.removeEventListener(\"close\", this.onClose);\n      this.ws.removeEventListener(\"error\", this.onError);\n      this.ws.removeEventListener(\"message\", this.onMessage);\n      this.stopHeartBeatMessages();\n      this.ws.close();\n      return delete this.ws;\n    };\n\n    EventsService.prototype.notifications = function() {\n      return this.subscribe(null, 'notifications', (function(_this) {\n        return function(data) {\n          _this.liveAnnouncementService.show(data.title, data.desc);\n          return _this.rootScope.$digest();\n        };\n      })(this));\n    };\n\n    EventsService.prototype.startHeartBeatMessages = function() {\n      var heartbeatIntervalTime, maxMissedHeartbeats, reconnectTryInterval;\n      if (this.heartbeatInterval) {\n        return;\n      }\n      maxMissedHeartbeats = this.config.get(\"eventsMaxMissedHeartbeats\", 5);\n      heartbeatIntervalTime = this.config.get(\"eventsHeartbeatIntervalTime\", 60000);\n      reconnectTryInterval = this.config.get(\"eventsReconnectTryInterval\", 10000);\n      this.missedHeartbeats = 0;\n      this.heartbeatInterval = setInterval((function(_this) {\n        return function() {\n          var e;\n          try {\n            if (_this.missedHeartbeats >= maxMissedHeartbeats) {\n              throw new Error(\"Too many missed heartbeats PINGs.\");\n            }\n            _this.missedHeartbeats++;\n            _this.sendMessage({\n              cmd: \"ping\"\n            });\n            return _this.log.debug(\"HeartBeat send PING\");\n          } catch (error1) {\n            e = error1;\n            _this.log.error(\"HeartBeat error: \" + e.message);\n            return _this.setupConnection();\n          }\n        };\n      })(this), heartbeatIntervalTime);\n      return this.log.debug(\"HeartBeat enabled\");\n    };\n\n    EventsService.prototype.stopHeartBeatMessages = function() {\n      if (!this.heartbeatInterval) {\n        return;\n      }\n      clearInterval(this.heartbeatInterval);\n      this.heartbeatInterval = null;\n      return this.log.debug(\"HeartBeat disabled\");\n    };\n\n    EventsService.prototype.processHeartBeatPongMessage = function(data) {\n      this.missedHeartbeats = 0;\n      return this.log.debug(\"HeartBeat recived PONG\");\n    };\n\n    EventsService.prototype.serialize = function(message) {\n      if (_.isObject(message)) {\n        return JSON.stringify(message);\n      }\n      return message;\n    };\n\n    EventsService.prototype.sendMessage = function(message) {\n      var i, len, messages, msg, results;\n      this.pendingMessages.push(message);\n      if (!this.connected) {\n        return;\n      }\n      messages = _.map(this.pendingMessages, this.serialize);\n      this.pendingMessages = [];\n      results = [];\n      for (i = 0, len = messages.length; i < len; i++) {\n        msg = messages[i];\n        results.push(this.ws.send(msg));\n      }\n      return results;\n    };\n\n    EventsService.prototype.processMessage = function(data) {\n      var routingKey, subscription;\n      routingKey = data.routing_key;\n      if (this.subscriptions[routingKey] == null) {\n        return;\n      }\n      subscription = this.subscriptions[routingKey];\n      if (subscription.scope) {\n        return subscription.scope.$apply(function() {\n          return subscription.callback(data.data);\n        });\n      } else {\n        return subscription.callback(data.data);\n      }\n    };\n\n    EventsService.prototype.subscribe = function(scope, routingKey, callback) {\n      var message, subscription;\n      if (this.error) {\n        return;\n      }\n      this.log.debug(\"Subscribe to: \" + routingKey);\n      subscription = {\n        scope: scope,\n        routingKey: routingKey,\n        callback: _.debounce(callback, 500, {\n          \"leading\": true,\n          \"trailing\": false\n        })\n      };\n      message = {\n        \"cmd\": \"subscribe\",\n        \"routing_key\": routingKey\n      };\n      this.subscriptions[routingKey] = subscription;\n      this.sendMessage(message);\n      if (scope) {\n        return scope.$on(\"$destroy\", (function(_this) {\n          return function() {\n            return _this.unsubscribe(routingKey);\n          };\n        })(this));\n      }\n    };\n\n    EventsService.prototype.unsubscribe = function(routingKey) {\n      var message;\n      if (this.error) {\n        return;\n      }\n      this.log.debug(\"Unsubscribe from: \" + routingKey);\n      message = {\n        \"cmd\": \"unsubscribe\",\n        \"routing_key\": routingKey\n      };\n      return this.sendMessage(message);\n    };\n\n    EventsService.prototype.onOpen = function() {\n      var message, token;\n      this.connected = true;\n      this.startHeartBeatMessages();\n      this.notifications();\n      this.log.debug(\"WebSocket connection opened\");\n      token = this.auth.getToken();\n      message = {\n        cmd: \"auth\",\n        data: {\n          token: token,\n          sessionId: this.sessionId\n        }\n      };\n      return this.sendMessage(message);\n    };\n\n    EventsService.prototype.onMessage = function(event) {\n      var data;\n      this.log.debug(\"WebSocket message received: \" + event.data);\n      data = JSON.parse(event.data);\n      if (data.cmd === \"pong\") {\n        return this.processHeartBeatPongMessage(data);\n      } else {\n        return this.processMessage(data);\n      }\n    };\n\n    EventsService.prototype.onError = function(error) {\n      this.log.error(\"WebSocket error: \" + error);\n      this.error = true;\n      return setTimeout(this.setupConnection, this.reconnectTryInterval);\n    };\n\n    EventsService.prototype.onClose = function() {\n      this.log.debug(\"WebSocket closed.\");\n      this.connected = false;\n      this.stopHeartBeatMessages();\n      return setTimeout(this.setupConnection, this.reconnectTryInterval);\n    };\n\n    return EventsService;\n\n  })();\n\n  EventsProvider = (function() {\n    function EventsProvider() {}\n\n    EventsProvider.prototype.setSessionId = function(sessionId) {\n      return this.sessionId = sessionId;\n    };\n\n    EventsProvider.prototype.$get = function($win, $log, $conf, $auth, liveAnnouncementService, $rootScope) {\n      var service;\n      service = new EventsService($win, $log, $conf, $auth, liveAnnouncementService, $rootScope);\n      service.initialize(this.sessionId);\n      return service;\n    };\n\n    EventsProvider.prototype.$get.$inject = [\"$window\", \"$log\", \"$tgConfig\", \"$tgAuth\", \"tgLiveAnnouncementService\", \"$rootScope\"];\n\n    return EventsProvider;\n\n  })();\n\n  module.provider(\"$tgEvents\", EventsProvider);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/feedback.coffee\n */\n\n(function() {\n  var FeedbackDirective, bindOnce, debounce, groupBy, mixOf, module, taiga, trim;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  mixOf = this.taiga.mixOf;\n\n  debounce = this.taiga.debounce;\n\n  trim = this.taiga.trim;\n\n  module = angular.module(\"taigaFeedback\", []);\n\n  FeedbackDirective = function($lightboxService, $repo, $confirm, $loading, feedbackService) {\n    var directive, link;\n    link = function($scope, $el, $attrs) {\n      var form, openLightbox, submit, submitButton;\n      form = $el.find(\"form\").checksley();\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"feedback\", $scope.feedback);\n          promise.then(function(data) {\n            currentLoading.finish();\n            $lightboxService.close($el);\n            return $confirm.notify(\"success\", \"\\\\o/ we'll be happy to read your\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      openLightbox = function() {\n        $scope.feedback = {};\n        $lightboxService.open($el);\n        return $el.find(\"textarea\").focus();\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return openLightbox();\n    };\n    directive = {\n      link: link,\n      templateUrl: \"common/lightbox-feedback.html\",\n      scope: {}\n    };\n    return directive;\n  };\n\n  module.directive(\"tgLbFeedback\", [\"lightboxService\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"tgFeedbackService\", FeedbackDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/integrations.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaIntegrations\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaIssues\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaKanban\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaPlugins\", [\"ngRoute\"]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/projects.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaProject\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/related-tasks.coffee\n */\n\n(function() {\n  var RelatedTaskAssignedToInlineEditionDirective, RelatedTaskCreateButtonDirective, RelatedTaskCreateFormDirective, RelatedTaskRowDirective, RelatedTasksDirective, debounce, module, taiga, trim;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaRelatedTasks\", []);\n\n  RelatedTaskRowDirective = function($repo, $compile, $confirm, $rootscope, $loading, $template, $translate) {\n    var link, templateEdit, templateView;\n    templateView = $template.get(\"task/related-task-row.html\", true);\n    templateEdit = $template.get(\"task/related-task-row-edit.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var renderEdit, renderView, saveTask;\n      saveTask = debounce(2000, function(task) {\n        var currentLoading, promise;\n        task.subject = $el.find('input').val();\n        currentLoading = $loading().target($el.find('.task-name')).start();\n        promise = $repo.save(task);\n        promise.then((function(_this) {\n          return function() {\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"related-tasks:update\");\n          };\n        })(this));\n        promise.then(null, (function(_this) {\n          return function() {\n            currentLoading.finish();\n            $el.find('input').val(task.subject);\n            return $confirm.notify(\"error\");\n          };\n        })(this));\n        return promise;\n      });\n      renderEdit = function(task) {\n        $el.html($compile(templateEdit({\n          task: task\n        }))($scope));\n        $el.find(\".task-name input\").val(task.subject);\n        $el.on(\"keyup\", \"input\", function(event) {\n          if (event.keyCode === 13) {\n            return saveTask($model.$modelValue).then(function() {\n              return renderView($model.$modelValue);\n            });\n          } else if (event.keyCode === 27) {\n            return renderView($model.$modelValue);\n          }\n        });\n        $el.on(\"click\", \".save-task\", function(event) {\n          return saveTask($model.$modelValue).then(function() {\n            return renderView($model.$modelValue);\n          });\n        });\n        return $el.on(\"click\", \".cancel-edit\", function(event) {\n          return renderView($model.$modelValue);\n        });\n      };\n      renderView = function(task) {\n        var perms;\n        $el.off();\n        perms = {\n          modify_task: $scope.project.my_permissions.indexOf(\"modify_task\") !== -1,\n          delete_task: $scope.project.my_permissions.indexOf(\"delete_task\") !== -1\n        };\n        $el.html($compile(templateView({\n          task: task,\n          perms: perms\n        }))($scope));\n        $el.on(\"click\", \".edit-task\", function() {\n          renderEdit($model.$modelValue);\n          return $el.find('input').focus().select();\n        });\n        return $el.on(\"click\", \".delete-task\", function(event) {\n          var message, title;\n          title = $translate.instant(\"TASK.TITLE_DELETE_ACTION\");\n          task = $model.$modelValue;\n          message = task.subject;\n          return $confirm.askOnDelete(title, message).then(function(askResponse) {\n            var promise;\n            promise = $repo.remove(task);\n            promise.then(function() {\n              askResponse.finish();\n              return $scope.$emit(\"related-tasks:delete\");\n            });\n            return promise.then(null, function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            });\n          });\n        });\n      };\n      $scope.$watch($attrs.ngModel, function(val) {\n        if (!val) {\n          return;\n        }\n        return renderView(val);\n      });\n      $scope.$on(\"related-tasks:assigned-to-changed\", function() {\n        return $rootscope.$broadcast(\"related-tasks:update\");\n      });\n      $scope.$on(\"related-tasks:status-changed\", function() {\n        return $rootscope.$broadcast(\"related-tasks:update\");\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgRelatedTaskRow\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$rootScope\", \"$tgLoading\", \"$tgTemplate\", \"$translate\", RelatedTaskRowDirective]);\n\n  RelatedTaskCreateFormDirective = function($repo, $compile, $confirm, $tgmodel, $loading, $analytics) {\n    var link, newTask;\n    newTask = {\n      subject: \"\",\n      assigned_to: null\n    };\n    link = function($scope, $el, $attrs) {\n      var close, createTask, render, reset;\n      createTask = function(task) {\n        var currentLoading, promise;\n        task.subject = $el.find('input').val();\n        task.assigned_to = $scope.newTask.assigned_to;\n        task.status = $scope.newTask.status;\n        $scope.newTask.status = $scope.project.default_task_status;\n        $scope.newTask.assigned_to = null;\n        currentLoading = $loading().target($el.find('.task-name')).start();\n        promise = $repo.create(\"tasks\", task);\n        promise.then(function() {\n          $analytics.trackEvent(\"task\", \"create\", \"create task on userstory\", 1);\n          currentLoading.finish();\n          return $scope.$emit(\"related-tasks:add\");\n        });\n        promise.then(null, function() {\n          $el.find('input').val(task.subject);\n          currentLoading.finish();\n          return $confirm.notify(\"error\");\n        });\n        return promise;\n      };\n      close = function() {\n        $el.off();\n        return $scope.openNewRelatedTask = false;\n      };\n      reset = function() {\n        newTask = {\n          subject: \"\",\n          assigned_to: null\n        };\n        newTask[\"status\"] = $scope.project.default_task_status;\n        newTask[\"project\"] = $scope.project.id;\n        newTask[\"user_story\"] = $scope.us.id;\n        return $scope.newTask = $tgmodel.make_model(\"tasks\", newTask);\n      };\n      render = function() {\n        if ($scope.openNewRelatedTask) {\n          return;\n        }\n        $scope.openNewRelatedTask = true;\n        return $el.on(\"keyup\", \"input\", function(event) {\n          if (event.keyCode === 13) {\n            return createTask(newTask).then(function() {\n              reset();\n              return $el.find('input').focus();\n            });\n          } else if (event.keyCode === 27) {\n            return $scope.$apply(function() {\n              return close();\n            });\n          }\n        });\n      };\n      $scope.save = function() {\n        return createTask(newTask).then(function() {\n          return close();\n        });\n      };\n      taiga.bindOnce($scope, \"us\", reset);\n      $scope.$on(\"related-tasks:show-form\", function() {\n        return $scope.$apply(render);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      scope: true,\n      link: link,\n      templateUrl: 'task/related-task-create-form.html'\n    };\n  };\n\n  module.directive(\"tgRelatedTaskCreateForm\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$tgModel\", \"$tgLoading\", \"$tgAnalytics\", RelatedTaskCreateFormDirective]);\n\n  RelatedTaskCreateButtonDirective = function($repo, $compile, $confirm, $tgmodel, $template) {\n    var link, template;\n    template = $template.get(\"common/components/add-button.html\", true);\n    link = function($scope, $el, $attrs) {\n      $scope.$watch(\"project\", function(val) {\n        if (!val) {\n          return;\n        }\n        $el.off();\n        if ($scope.project.my_permissions.indexOf(\"add_task\") !== -1) {\n          $el.html($compile(template())($scope));\n        } else {\n          $el.html(\"\");\n        }\n        return $el.on(\"click\", \".add-button\", function(event) {\n          return $scope.$emit(\"related-tasks:add-new-clicked\");\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskCreateButton\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$tgModel\", \"$tgTemplate\", RelatedTaskCreateButtonDirective]);\n\n  RelatedTasksDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var _isEditable, _isVisible, loadTasks;\n      loadTasks = function() {\n        return $rs.tasks.list($scope.projectId, null, $scope.usId).then((function(_this) {\n          return function(tasks) {\n            $scope.tasks = _.sortBy(tasks, function(x) {\n              return [x.us_order, x.ref];\n            });\n            return tasks;\n          };\n        })(this));\n      };\n      _isVisible = function() {\n        if ($scope.project) {\n          return $scope.project.my_permissions.indexOf(\"view_tasks\") !== -1;\n        }\n        return false;\n      };\n      _isEditable = function() {\n        if ($scope.project) {\n          return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n        }\n        return false;\n      };\n      $scope.showRelatedTasks = function() {\n        var ref;\n        return _isVisible() && (_isEditable() || ((ref = $scope.tasks) != null ? ref.length : void 0));\n      };\n      $scope.$on(\"related-tasks:add\", function() {\n        return loadTasks().then(function() {\n          return $rootscope.$broadcast(\"related-tasks:update\");\n        });\n      });\n      $scope.$on(\"related-tasks:delete\", function() {\n        return loadTasks().then(function() {\n          return $rootscope.$broadcast(\"related-tasks:update\");\n        });\n      });\n      $scope.$on(\"related-tasks:add-new-clicked\", function() {\n        return $scope.$broadcast(\"related-tasks:show-form\");\n      });\n      taiga.bindOnce($scope, \"us\", function(val) {\n        return loadTasks();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTasks\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", RelatedTasksDirective]);\n\n  RelatedTaskAssignedToInlineEditionDirective = function($repo, $rootscope, $translate, avatarService) {\n    var link, template;\n    template = _.template(\"<img style=\\\"background-color: <%- bg %>\\\" src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\"/>\\n<figcaption><%- name %></figcaption>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, autoSave, notAutoSave, task, updateRelatedTask;\n      updateRelatedTask = function(task) {\n        var avatar, ctx, member;\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\")\n        };\n        member = $scope.usersById[task.assigned_to];\n        avatar = avatarService.getAvatar(member);\n        ctx.imgurl = avatar.url;\n        ctx.bg = avatar.bg;\n        if (member) {\n          ctx.name = member.full_name_display;\n        }\n        $el.find(\".avatar\").html(template(ctx));\n        return $el.find(\".task-assignedto\").attr('title', ctx.name);\n      };\n      $ctrl = $el.controller();\n      task = $scope.$eval($attrs.tgRelatedTaskAssignedToInlineEdition);\n      notAutoSave = $scope.$eval($attrs.notAutoSave);\n      autoSave = !notAutoSave;\n      $scope.$watch($attrs.tgRelatedTaskAssignedToInlineEdition, function() {\n        task = $scope.$eval($attrs.tgRelatedTaskAssignedToInlineEdition);\n        return updateRelatedTask(task);\n      });\n      updateRelatedTask(task);\n      $el.on(\"click\", \".task-assignedto\", function(event) {\n        return $rootscope.$broadcast(\"assigned-to:add\", task);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_task\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"assigned-to:added\", debounce(2000, (function(_this) {\n        return function(ctx, userId, updatedRelatedTask) {\n          if (updatedRelatedTask.id === task.id) {\n            updatedRelatedTask.assigned_to = userId;\n            if (autoSave) {\n              $repo.save(updatedRelatedTask).then(function() {\n                return $scope.$emit(\"related-tasks:assigned-to-changed\");\n              });\n            }\n            return updateRelatedTask(updatedRelatedTask);\n          }\n        };\n      })(this)));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskAssignedToInlineEdition\", [\"$tgRepo\", \"$rootScope\", \"$translate\", \"tgAvatarService\", RelatedTaskAssignedToInlineEditionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources.coffee\n */\n\n(function() {\n  var ResourcesService, initResources, initUrls, module, taiga, urls,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ResourcesService = (function(superClass) {\n    extend(ResourcesService, superClass);\n\n    function ResourcesService() {\n      return ResourcesService.__super__.constructor.apply(this, arguments);\n    }\n\n    return ResourcesService;\n\n  })(taiga.Service);\n\n  urls = {\n    \"auth\": \"/auth\",\n    \"auth-register\": \"/auth/register\",\n    \"invitations\": \"/invitations\",\n    \"users\": \"/users\",\n    \"by_username\": \"/users/by_username\",\n    \"users-password-recovery\": \"/users/password_recovery\",\n    \"users-change-password-from-recovery\": \"/users/change_password_from_recovery\",\n    \"users-change-password\": \"/users/change_password\",\n    \"users-change-email\": \"/users/change_email\",\n    \"users-cancel-account\": \"/users/cancel\",\n    \"user-stats\": \"/users/%s/stats\",\n    \"user-liked\": \"/users/%s/liked\",\n    \"user-voted\": \"/users/%s/voted\",\n    \"user-watched\": \"/users/%s/watched\",\n    \"user-contacts\": \"/users/%s/contacts\",\n    \"user-me\": \"/users/me\",\n    \"permissions\": \"/permissions\",\n    \"notify-policies\": \"/notify-policies\",\n    \"user-storage\": \"/user-storage\",\n    \"memberships\": \"/memberships\",\n    \"bulk-create-memberships\": \"/memberships/bulk_create\",\n    \"roles\": \"/roles\",\n    \"permissions\": \"/permissions\",\n    \"resolver\": \"/resolver\",\n    \"projects\": \"/projects\",\n    \"project-templates\": \"/project-templates\",\n    \"project-modules\": \"/projects/%s/modules\",\n    \"bulk-update-projects-order\": \"/projects/bulk_update_order\",\n    \"project-like\": \"/projects/%s/like\",\n    \"project-unlike\": \"/projects/%s/unlike\",\n    \"project-watch\": \"/projects/%s/watch\",\n    \"project-unwatch\": \"/projects/%s/unwatch\",\n    \"project-transfer-validate-token\": \"/projects/%s/transfer_validate_token\",\n    \"project-transfer-accept\": \"/projects/%s/transfer_accept\",\n    \"project-transfer-reject\": \"/projects/%s/transfer_reject\",\n    \"project-transfer-request\": \"/projects/%s/transfer_request\",\n    \"project-transfer-start\": \"/projects/%s/transfer_start\",\n    \"epic-statuses\": \"/epic-statuses\",\n    \"userstory-statuses\": \"/userstory-statuses\",\n    \"points\": \"/points\",\n    \"task-statuses\": \"/task-statuses\",\n    \"issue-statuses\": \"/issue-statuses\",\n    \"issue-types\": \"/issue-types\",\n    \"priorities\": \"/priorities\",\n    \"severities\": \"/severities\",\n    \"milestones\": \"/milestones\",\n    \"epics\": \"/epics\",\n    \"epic-upvote\": \"/epics/%s/upvote\",\n    \"epic-downvote\": \"/epics/%s/downvote\",\n    \"epic-watch\": \"/epics/%s/watch\",\n    \"epic-unwatch\": \"/epics/%s/unwatch\",\n    \"epic-related-userstories\": \"/epics/%s/related_userstories\",\n    \"epic-related-userstories-bulk-create\": \"/epics/%s/related_userstories/bulk_create\",\n    \"userstories\": \"/userstories\",\n    \"bulk-create-us\": \"/userstories/bulk_create\",\n    \"bulk-update-us-backlog-order\": \"/userstories/bulk_update_backlog_order\",\n    \"bulk-update-us-milestone\": \"/userstories/bulk_update_milestone\",\n    \"bulk-update-us-miles-order\": \"/userstories/bulk_update_sprint_order\",\n    \"bulk-update-us-kanban-order\": \"/userstories/bulk_update_kanban_order\",\n    \"userstories-filters\": \"/userstories/filters_data\",\n    \"userstory-upvote\": \"/userstories/%s/upvote\",\n    \"userstory-downvote\": \"/userstories/%s/downvote\",\n    \"userstory-watch\": \"/userstories/%s/watch\",\n    \"userstory-unwatch\": \"/userstories/%s/unwatch\",\n    \"tasks\": \"/tasks\",\n    \"bulk-create-tasks\": \"/tasks/bulk_create\",\n    \"bulk-update-task-taskboard-order\": \"/tasks/bulk_update_taskboard_order\",\n    \"task-upvote\": \"/tasks/%s/upvote\",\n    \"task-downvote\": \"/tasks/%s/downvote\",\n    \"task-watch\": \"/tasks/%s/watch\",\n    \"task-unwatch\": \"/tasks/%s/unwatch\",\n    \"task-filters\": \"/tasks/filters_data\",\n    \"issues\": \"/issues\",\n    \"bulk-create-issues\": \"/issues/bulk_create\",\n    \"issues-filters\": \"/issues/filters_data\",\n    \"issue-upvote\": \"/issues/%s/upvote\",\n    \"issue-downvote\": \"/issues/%s/downvote\",\n    \"issue-watch\": \"/issues/%s/watch\",\n    \"issue-unwatch\": \"/issues/%s/unwatch\",\n    \"wiki\": \"/wiki\",\n    \"wiki-restore\": \"/wiki/%s/restore\",\n    \"wiki-links\": \"/wiki-links\",\n    \"history/epic\": \"/history/epic\",\n    \"history/us\": \"/history/userstory\",\n    \"history/issue\": \"/history/issue\",\n    \"history/task\": \"/history/task\",\n    \"history/wiki\": \"/history/wiki/%s\",\n    \"attachments/epic\": \"/epics/attachments\",\n    \"attachments/us\": \"/userstories/attachments\",\n    \"attachments/issue\": \"/issues/attachments\",\n    \"attachments/task\": \"/tasks/attachments\",\n    \"attachments/wiki_page\": \"/wiki/attachments\",\n    \"custom-attributes/epic\": \"/epic-custom-attributes\",\n    \"custom-attributes/userstory\": \"/userstory-custom-attributes\",\n    \"custom-attributes/task\": \"/task-custom-attributes\",\n    \"custom-attributes/issue\": \"/issue-custom-attributes\",\n    \"custom-attributes-values/epic\": \"/epics/custom-attributes-values\",\n    \"custom-attributes-values/userstory\": \"/userstories/custom-attributes-values\",\n    \"custom-attributes-values/task\": \"/tasks/custom-attributes-values\",\n    \"custom-attributes-values/issue\": \"/issues/custom-attributes-values\",\n    \"webhooks\": \"/webhooks\",\n    \"webhooks-test\": \"/webhooks/%s/test\",\n    \"webhooklogs\": \"/webhooklogs\",\n    \"webhooklogs-resend\": \"/webhooklogs/%s/resend\",\n    \"epics-csv\": \"/epics/csv?uuid=%s\",\n    \"userstories-csv\": \"/userstories/csv?uuid=%s\",\n    \"tasks-csv\": \"/tasks/csv?uuid=%s\",\n    \"issues-csv\": \"/issues/csv?uuid=%s\",\n    \"timeline-profile\": \"/timeline/profile\",\n    \"timeline-user\": \"/timeline/user\",\n    \"timeline-project\": \"/timeline/project\",\n    \"search\": \"/search\",\n    \"exporter\": \"/exporter\",\n    \"importer\": \"/importer/load_dump\",\n    \"feedback\": \"/feedback\",\n    \"locales\": \"/locales\",\n    \"applications\": \"/applications\",\n    \"application-tokens\": \"/application-tokens\",\n    \"stats-discover\": \"/stats/discover\"\n  };\n\n  initUrls = function($log, $urls) {\n    $log.debug(\"Initialize api urls\");\n    return $urls.update(urls);\n  };\n\n  initResources = function($log, $rs) {\n    var i, len, provider, providers, results;\n    $log.debug(\"Initialize resources\");\n    providers = _.toArray(arguments).slice(2);\n    results = [];\n    for (i = 0, len = providers.length; i < len; i++) {\n      provider = providers[i];\n      results.push(provider($rs));\n    }\n    return results;\n  };\n\n  module = angular.module(\"taigaResources\", [\"taigaBase\"]);\n\n  module.service(\"$tgResources\", ResourcesService);\n\n  module.run([\"$log\", \"$tgUrls\", initUrls]);\n\n  module.run([\"$log\", \"$tgResources\", \"$tgProjectsResourcesProvider\", \"$tgCustomAttributesResourcesProvider\", \"$tgCustomAttributesValuesResourcesProvider\", \"$tgMembershipsResourcesProvider\", \"$tgNotifyPoliciesResourcesProvider\", \"$tgInvitationsResourcesProvider\", \"$tgRolesResourcesProvider\", \"$tgUserSettingsResourcesProvider\", \"$tgSprintsResourcesProvider\", \"$tgEpicsResourcesProvider\", \"$tgUserstoriesResourcesProvider\", \"$tgTasksResourcesProvider\", \"$tgIssuesResourcesProvider\", \"$tgWikiResourcesProvider\", \"$tgSearchResourcesProvider\", \"$tgMdRenderResourcesProvider\", \"$tgHistoryResourcesProvider\", \"$tgKanbanResourcesProvider\", \"$tgModulesResourcesProvider\", \"$tgWebhooksResourcesProvider\", \"$tgWebhookLogsResourcesProvider\", \"$tgLocalesResourcesProvider\", \"$tgUsersResourcesProvider\", initResources]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/search.coffee\n */\n\n(function() {\n  var SearchBoxDirective, SearchController, SearchDirective, bindOnce, debounce, debounceLeading, groupBy, mixOf, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  mixOf = this.taiga.mixOf;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  trim = this.taiga.trim;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaSearch\", []);\n\n  SearchController = (function(superClass) {\n    extend(SearchController, superClass);\n\n    SearchController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$translate\", \"tgErrorHandlingService\"];\n\n    function SearchController(scope1, repo, rs, params, q, location, appMetaService, navUrls, translate, errorHandlingService) {\n      var loadSearchData, promise;\n      this.scope = scope1;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      this.scope.sectionName = \"Search\";\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"SEARCH.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"SEARCH.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.searchTerm = null;\n      loadSearchData = debounceLeading(100, (function(_this) {\n        return function(t) {\n          return _this.loadSearchData(t);\n        };\n      })(this));\n      bindOnce(this.scope, \"projectId\", (function(_this) {\n        return function(projectId) {\n          if (!_this.scope.searchResults && _this.scope.searchTerm) {\n            return _this.loadSearchData();\n          }\n        };\n      })(this));\n      this.scope.$watch(\"searchTerm\", (function(_this) {\n        return function(term) {\n          if (term !== void 0 && _this.scope.projectId) {\n            return _this.loadSearchData(term);\n          }\n        };\n      })(this));\n    }\n\n    SearchController.prototype.loadFilters = function() {\n      var defered;\n      defered = this.q.defer();\n      defered.resolve();\n      return defered.promise;\n    };\n\n    SearchController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.epicStatusById = groupBy(project.epic_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.issueStatusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.taskStatusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    SearchController.prototype.loadSearchData = function(term) {\n      if (term == null) {\n        term = \"\";\n      }\n      this.scope.loading = true;\n      return this._loadSearchData(term).then((function(_this) {\n        return function(data) {\n          _this.scope.searchResults = data;\n          return _this.scope.loading = false;\n        };\n      })(this));\n    };\n\n    SearchController.prototype._loadSearchData = function(term) {\n      if (term == null) {\n        term = \"\";\n      }\n      if (this._promise) {\n        this._promise.abort();\n      }\n      this._promise = this.rs.search[\"do\"](this.scope.projectId, term);\n      return this._promise;\n    };\n\n    SearchController.prototype.loadInitialData = function() {\n      return this.loadProject().then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          return _this.fillUsersAndRoles(project.members, project.roles);\n        };\n      })(this));\n    };\n\n    return SearchController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"SearchController\", SearchController);\n\n  SearchBoxDirective = function(projectService, $lightboxService, $navurls, $location, $route) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var openLightbox, project, submit;\n      project = null;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var form, text, url;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          text = $el.find(\"#search-text\").val();\n          url = $navurls.resolve(\"project-search\", {\n            project: project.get(\"slug\")\n          });\n          return $scope.$apply(function() {\n            $lightboxService.close($el);\n            $location.path(url);\n            $location.search(\"text\", text).path(url);\n            return $route.reload();\n          });\n        };\n      })(this));\n      openLightbox = function() {\n        project = projectService.project;\n        return $lightboxService.open($el).then(function() {\n          return $el.find(\"#search-text\").focus();\n        });\n      };\n      $el.on(\"submit\", \"form\", submit);\n      return openLightbox();\n    };\n    return {\n      templateUrl: \"search/lightbox-search.html\",\n      link: link\n    };\n  };\n\n  SearchBoxDirective.$inject = [\"tgProjectService\", \"lightboxService\", \"$tgNavUrls\", \"$tgLocation\", \"$route\"];\n\n  module.directive(\"tgSearchBox\", SearchBoxDirective);\n\n  SearchDirective = function($log, $compile, $templatecache, $routeparams, $location) {\n    var link, linkTable;\n    linkTable = function($scope, $el, $attrs, $ctrl) {\n      var activeSectionName, applyAutoTab, getActiveSection, lastSearchResults, markSectionTabActive, renderFilterTabs, renderTableContent, tabsDom, templates;\n      applyAutoTab = true;\n      activeSectionName = \"userstories\";\n      tabsDom = $el.find(\".search-filter\");\n      lastSearchResults = null;\n      getActiveSection = function(data) {\n        var i, len, maxVal, name, ref, selectedSection, value;\n        maxVal = 0;\n        selectedSection = {};\n        selectedSection.name = \"userstories\";\n        selectedSection.value = [];\n        if (!applyAutoTab) {\n          selectedSection.name = activeSectionName;\n          selectedSection.value = data[activeSectionName];\n          return selectedSection;\n        }\n        if (data) {\n          ref = [\"userstories\", \"epics\", \"issues\", \"tasks\", \"wikipages\"];\n          for (i = 0, len = ref.length; i < len; i++) {\n            name = ref[i];\n            value = data[name];\n            if (value.length > maxVal) {\n              maxVal = value.length;\n              selectedSection.name = name;\n              selectedSection.value = value;\n              break;\n            }\n          }\n        }\n        if (maxVal === 0) {\n          return selectedSection;\n        }\n        return selectedSection;\n      };\n      renderFilterTabs = function(data) {\n        var name, results, value;\n        results = [];\n        for (name in data) {\n          value = data[name];\n          tabsDom.find(\"li.\" + name).show();\n          results.push(tabsDom.find(\"li.\" + name + \" .num\").html(value.length));\n        }\n        return results;\n      };\n      markSectionTabActive = function(section) {\n        tabsDom.find(\"a.active\").removeClass(\"active\");\n        tabsDom.find(\"li.\" + section.name + \" a\").addClass(\"active\");\n        applyAutoTab = false;\n        return activeSectionName = section.name;\n      };\n      templates = {\n        epics: $templatecache.get(\"search-epics\"),\n        issues: $templatecache.get(\"search-issues\"),\n        tasks: $templatecache.get(\"search-tasks\"),\n        userstories: $templatecache.get(\"search-userstories\"),\n        wikipages: $templatecache.get(\"search-wikipages\")\n      };\n      renderTableContent = function(section) {\n        var element, oldElements, oldScope, scope, template;\n        oldElements = $el.find(\".search-result-table\").children();\n        oldScope = oldElements.scope();\n        if (oldScope) {\n          oldScope.$destroy();\n          oldElements.remove();\n        }\n        scope = $scope.$new();\n        scope[section.name] = section.value;\n        template = angular.element.parseHTML(trim(templates[section.name]));\n        element = $compile(template)(scope);\n        return $el.find(\".search-result-table\").html(element);\n      };\n      $scope.$watch(\"searchResults\", function(data) {\n        var activeSection;\n        lastSearchResults = data;\n        if (!lastSearchResults) {\n          return;\n        }\n        activeSection = getActiveSection(data);\n        renderFilterTabs(data);\n        renderTableContent(activeSection);\n        return markSectionTabActive(activeSection);\n      });\n      $scope.$watch(\"searchTerm\", function(searchTerm) {\n        if (searchTerm !== void 0) {\n          return $location.search(\"text\", searchTerm);\n        }\n      });\n      return $el.on(\"click\", \".search-filter li > a\", function(event) {\n        var section, sectionData, sectionName, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        sectionName = target.parent().data(\"name\");\n        sectionData = !lastSearchResults ? [] : lastSearchResults[sectionName];\n        section = {\n          name: sectionName,\n          value: sectionData\n        };\n        return $scope.$apply(function() {\n          renderTableContent(section);\n          return markSectionTabActive(section);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, searchText;\n      $ctrl = $el.controller();\n      linkTable($scope, $el, $attrs, $ctrl);\n      searchText = $routeparams.text;\n      return $scope.$watch(\"projectId\", function(projectId) {\n        if (projectId != null) {\n          return $scope.searchTerm = searchText;\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSearch\", [\"$log\", \"$compile\", \"$templateCache\", \"$routeParams\", \"$tgLocation\", SearchDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTaskboard\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/tasks.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTasks\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/team.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTeam\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUserSettings\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/userstories.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUserStories\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaWiki\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/analytics.coffee\n */\n\n(function() {\n  var AnalyticsService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  AnalyticsService = (function(superClass) {\n    extend(AnalyticsService, superClass);\n\n    AnalyticsService.$inject = [\"$rootScope\", \"$log\", \"$tgConfig\", \"$window\", \"$document\", \"$location\"];\n\n    function AnalyticsService(rootscope, log, config, win, doc, location) {\n      var conf;\n      this.rootscope = rootscope;\n      this.log = log;\n      this.config = config;\n      this.win = win;\n      this.doc = doc;\n      this.location = location;\n      this.initialized = false;\n      conf = this.config.get(\"analytics\", {});\n      this.accountId = conf.accountId;\n      this.pageEvent = conf.pageEvent || \"$routeChangeSuccess\";\n      this.trackRoutes = conf.trackRoutes || true;\n      this.ignoreFirstPageLoad = conf.ignoreFirstPageLoad || false;\n    }\n\n    AnalyticsService.prototype.initialize = function() {\n      if (!this.accountId) {\n        this.log.debug(\"Analytics: no acount id provided. Disabling.\");\n        return;\n      }\n      this.injectAnalytics();\n      this.win.ga(\"create\", this.accountId, \"auto\");\n      this.win.ga(\"require\", \"displayfeatures\");\n      if (this.trackRoutes && (!this.ignoreFirstPageLoad)) {\n        this.win.ga(\"send\", \"pageview\", this.getUrl());\n      }\n      if (this.trackRoutes) {\n        this.rootscope.$on(this.pageEvent, (function(_this) {\n          return function() {\n            return _this.trackPage(_this.getUrl(), \"Taiga\");\n          };\n        })(this));\n      }\n      return this.initialized = true;\n    };\n\n    AnalyticsService.prototype.getUrl = function() {\n      return this.location.path();\n    };\n\n    AnalyticsService.prototype.injectAnalytics = function() {\n      var fn;\n      fn = (function(i,s,o,g,r,a,m){i[\"GoogleAnalyticsObject\"]=r;i[r]=i[r]||function(){\n              (i[r].q=i[r].q||[]).push(arguments);},i[r].l=1*new Date();a=s.createElement(o),\n              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);});\n      return fn(window, document, \"script\", \"//www.google-analytics.com/analytics.js\", \"ga\");\n    };\n\n    AnalyticsService.prototype.trackPage = function(url, title) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      title = title || this.doc[0].title;\n      return this.win.ga(\"send\", \"pageview\", {\n        \"page\": url,\n        \"title\": title\n      });\n    };\n\n    AnalyticsService.prototype.trackEvent = function(category, action, label, value) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      return this.win.ga(\"send\", \"event\", category, action, label, value);\n    };\n\n    return AnalyticsService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgAnalytics\", AnalyticsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: bind-scope.coffee\n */\n\n(function() {\n  var BindScope, module;\n\n  module = angular.module(\"taigaCommon\");\n\n  BindScope = function(config) {\n    var link;\n    if (!config.debugInfo) {\n      jQuery.fn.scope = function() {\n        return this.data('scope');\n      };\n    }\n    link = function($scope, $el) {\n      if (!config.debugInfo) {\n        return $el.data('scope', $scope).addClass('tg-scope');\n      }\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBindScope\", [\"$tgConfig\", BindScope]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: compile-html.directive.coffee\n */\n\n(function() {\n  var CompileHtmlDirective;\n\n  CompileHtmlDirective = function($compile) {\n    var link;\n    link = function(scope, element, attrs) {\n      return scope.$watch(attrs.tgCompileHtml, function(newValue, oldValue) {\n        element.html(newValue);\n        return $compile(element.contents())(scope);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CompileHtmlDirective.$inject = [\"$compile\"];\n\n  angular.module(\"taigaCommon\").directive(\"tgCompileHtml\", CompileHtmlDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/components.coffee\n */\n\n(function() {\n  var AssignedToDirective, BlockButtonDirective, CreatedByDisplayDirective, DateRangeDirective, DateSelectorDirective, DeleteButtonDirective, EditableDescriptionDirective, EditableWysiwyg, ListItemAssignedtoDirective, ListItemEpicStatusDirective, ListItemIssueStatusDirective, ListItemPriorityDirective, ListItemSeverityDirective, ListItemTaskStatusDirective, ListItemTypeDirective, ListItemUsStatusDirective, SprintProgressBarDirective, TgMainTitleDirective, TgProgressBarDirective, UserDisplayDirective, WatchersDirective, bindOnce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  DateRangeDirective = function($translate) {\n    var link, renderRange;\n    renderRange = function($el, first, second) {\n      var endDate, initDate, prettyDate;\n      prettyDate = $translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      initDate = moment(first).format(prettyDate);\n      endDate = moment(second).format(prettyDate);\n      return $el.html(initDate + \"-\" + endDate);\n    };\n    link = function($scope, $el, $attrs) {\n      var first, ref, second;\n      ref = $attrs.tgDateRange.split(\",\"), first = ref[0], second = ref[1];\n      return bindOnce($scope, first, function(valFirst) {\n        return bindOnce($scope, second, function(valSecond) {\n          return renderRange($el, valFirst, valSecond);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgDateRange\", [\"$translate\", DateRangeDirective]);\n\n  DateSelectorDirective = function($rootscope, datePickerConfigService) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var initialize, selectedDate, unbind;\n      selectedDate = null;\n      initialize = function() {\n        var datePickerConfig;\n        datePickerConfig = datePickerConfigService.get();\n        _.merge(datePickerConfig, {\n          field: $el[0],\n          onSelect: (function(_this) {\n            return function(date) {\n              return selectedDate = date;\n            };\n          })(this),\n          onOpen: (function(_this) {\n            return function() {\n              if (selectedDate != null) {\n                return $el.picker.setDate(selectedDate);\n              }\n            };\n          })(this)\n        });\n        return $el.picker = new Pikaday(datePickerConfig);\n      };\n      unbind = $rootscope.$on(\"$translateChangeEnd\", (function(_this) {\n        return function(ctx) {\n          return initialize();\n        };\n      })(this));\n      $scope.$watch($attrs.ngModel, function(val) {\n        if ((val != null) && !$el.picker) {\n          initialize();\n        }\n        if (val != null) {\n          return $el.picker.setDate(val);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return unbind();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgDateSelector\", [\"$rootScope\", \"tgDatePickerConfigService\", DateSelectorDirective]);\n\n  SprintProgressBarDirective = function() {\n    var link, renderProgress;\n    renderProgress = function($el, percentage, visual_percentage) {\n      if ($el.hasClass(\".current-progress\")) {\n        return $el.css(\"width\", percentage + \"%\");\n      } else {\n        $el.find(\".current-progress\").css(\"width\", visual_percentage + \"%\");\n        return $el.find(\".number\").html(percentage + \" %\");\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, $attrs.tgSprintProgressbar, function(sprint) {\n        var closedPoints, percentage, totalPoints, visual_percentage;\n        closedPoints = sprint.closed_points;\n        totalPoints = sprint.total_points;\n        percentage = 0;\n        if (totalPoints !== 0) {\n          percentage = Math.round(100 * (closedPoints / totalPoints));\n        }\n        visual_percentage = 0;\n        if (totalPoints !== 0) {\n          visual_percentage = Math.round(98 * (closedPoints / totalPoints));\n        }\n        return renderProgress($el, percentage, visual_percentage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSprintProgressbar\", SprintProgressBarDirective);\n\n  CreatedByDisplayDirective = function($template, $compile, $translate, $navUrls, avatarService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, $attrs.ngModel, function(model) {\n        var avatar, ref;\n        if (model != null) {\n          avatar = avatarService.getAvatar(model.owner_extra_info);\n          $scope.owner = model.owner_extra_info || {\n            full_name_display: $translate.instant(\"COMMON.EXTERNAL_USER\")\n          };\n          $scope.owner.avatar = avatar.url;\n          $scope.owner.bg = avatar.bg;\n          $scope.url = ((ref = $scope.owner) != null ? ref.is_active : void 0) ? $navUrls.resolve(\"user-profile\", {\n            username: $scope.owner.username\n          }) : \"\";\n          return $scope.date = moment(model.created_date).format($translate.instant(\"COMMON.DATETIME\"));\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      scope: true,\n      templateUrl: \"common/components/created-by.html\"\n    };\n  };\n\n  module.directive(\"tgCreatedByDisplay\", [\"$tgTemplate\", \"$compile\", \"$translate\", \"$tgNavUrls\", \"tgAvatarService\", CreatedByDisplayDirective]);\n\n  UserDisplayDirective = function($template, $compile, $translate, $navUrls, avatarService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var avatar, id;\n      id = $attrs.tgUserId;\n      $scope.user = $scope.usersById[id] || {\n        full_name_display: $translate.instant(\"COMMON.EXTERNAL_USER\")\n      };\n      avatar = avatarService.getAvatar($scope.usersById[id] || null);\n      $scope.user.avatar = avatar.url;\n      $scope.user.bg = avatar.bg;\n      $scope.url = $scope.user.is_active ? $navUrls.resolve(\"user-profile\", {\n        username: $scope.user.username\n      }) : \"\";\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      scope: true,\n      templateUrl: \"common/components/user-display.html\"\n    };\n  };\n\n  module.directive(\"tgUserDisplay\", [\"$tgTemplate\", \"$compile\", \"$translate\", \"$tgNavUrls\", \"tgAvatarService\", UserDisplayDirective]);\n\n  WatchersDirective = function($rootscope, $confirm, $repo, $modelTransform, $template, $compile, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var deleteWatcher, isEditable, renderWatchers, save;\n      isEditable = function() {\n        var ref, ref1;\n        return ((ref = $scope.project) != null ? (ref1 = ref.my_permissions) != null ? ref1.indexOf($attrs.requiredPerm) : void 0 : void 0) !== -1;\n      };\n      save = function(watchers) {\n        var transform;\n        transform = $modelTransform.save(function(item) {\n          item.watchers = watchers;\n          return item;\n        });\n        transform.then(function() {\n          watchers = _.map(watchers, function(watcherId) {\n            return $scope.usersById[watcherId];\n          });\n          renderWatchers(watchers);\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        return transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n      };\n      deleteWatcher = function(watcherIds) {\n        var transform;\n        transform = $modelTransform.save(function(item) {\n          item.watchers = watcherIds;\n          return item;\n        });\n        transform.then(function() {\n          var item, watchers;\n          item = $modelTransform.getObj();\n          watchers = _.map(item.watchers, function(watcherId) {\n            return $scope.usersById[watcherId];\n          });\n          renderWatchers(watchers);\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        return transform.then(null, function() {\n          item.revert();\n          return $confirm.notify(\"error\");\n        });\n      };\n      renderWatchers = function(watchers) {\n        $scope.watchers = watchers;\n        return $scope.isEditable = isEditable();\n      };\n      $el.on(\"click\", \".js-delete-watcher\", function(event) {\n        var message, target, title, watcherId;\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        watcherId = target.data(\"watcher-id\");\n        title = $translate.instant(\"COMMON.WATCHERS.TITLE_LIGHTBOX_DELETE_WARTCHER\");\n        message = $scope.usersById[watcherId].full_name_display;\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var watcherIds;\n            askResponse.finish();\n            watcherIds = _.clone($model.$modelValue.watchers, false);\n            watcherIds = _.pull(watcherIds, watcherId);\n            return deleteWatcher(watcherIds);\n          };\n        })(this));\n      });\n      $scope.$on(\"watcher:added\", function(ctx, watcherId) {\n        var watchers;\n        watchers = _.clone($model.$modelValue.watchers, false);\n        watchers.push(watcherId);\n        watchers = _.uniq(watchers);\n        return save(watchers);\n      });\n      $scope.$watch($attrs.ngModel, function(item) {\n        var watchers;\n        if (item == null) {\n          return;\n        }\n        watchers = _.map(item.watchers, function(watcherId) {\n          return $scope.usersById[watcherId];\n        });\n        watchers = _.filter(watchers, function(it) {\n          return !!it;\n        });\n        return renderWatchers(watchers);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      scope: true,\n      templateUrl: \"common/components/watchers.html\",\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgWatchers\", [\"$rootScope\", \"$tgConfirm\", \"$tgRepo\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", \"$translate\", WatchersDirective]);\n\n  AssignedToDirective = function($rootscope, $confirm, $repo, $loading, $modelTransform, $template, $translate, $compile, $currentUserService, avatarService) {\n    var link, template;\n    template = $template.get(\"common/components/assigned-to.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, renderAssignedTo, save;\n      isEditable = function() {\n        var ref, ref1;\n        return ((ref = $scope.project) != null ? (ref1 = ref.my_permissions) != null ? ref1.indexOf($attrs.requiredPerm) : void 0 : void 0) !== -1;\n      };\n      save = function(userId) {\n        var currentLoading, item, transform;\n        item = $model.$modelValue.clone();\n        item.assigned_to = userId;\n        currentLoading = $loading().target($el).start();\n        transform = $modelTransform.save(function(item) {\n          item.assigned_to = userId;\n          return item;\n        });\n        transform.then(function() {\n          currentLoading.finish();\n          renderAssignedTo($modelTransform.getObj());\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        transform.then(null, function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        });\n        return transform;\n      };\n      renderAssignedTo = function(assignedObject) {\n        var avatar, bg, ctx, fullName, html, isIocaine, isUnassigned;\n        avatar = avatarService.getAvatar(assignedObject != null ? assignedObject.assigned_to_extra_info : void 0);\n        bg = null;\n        if ((assignedObject != null ? assignedObject.assigned_to : void 0) != null) {\n          fullName = assignedObject.assigned_to_extra_info.full_name_display;\n          isUnassigned = false;\n          bg = avatar.bg;\n        } else {\n          fullName = $translate.instant(\"COMMON.ASSIGNED_TO.ASSIGN\");\n          isUnassigned = true;\n        }\n        isIocaine = assignedObject != null ? assignedObject.is_iocaine : void 0;\n        ctx = {\n          fullName: fullName,\n          avatar: avatar.url,\n          bg: bg,\n          isUnassigned: isUnassigned,\n          isEditable: isEditable(),\n          isIocaine: isIocaine,\n          fullNameVisible: !(isUnassigned && !$currentUserService.isAuthenticated())\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \".user-assigned\", function(event) {\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        return $scope.$apply(function() {\n          return $rootscope.$broadcast(\"assigned-to:add\", $model.$modelValue);\n        });\n      });\n      $el.on(\"click\", \".assign-to-me\", function(event) {\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        $model.$modelValue.assigned_to = $currentUserService.getUser().get('id');\n        return save($currentUserService.getUser().get('id'));\n      });\n      $el.on(\"click\", \".remove-user\", function(event) {\n        var title;\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        title = $translate.instant(\"COMMON.ASSIGNED_TO.CONFIRM_UNASSIGNED\");\n        return $confirm.ask(title).then((function(_this) {\n          return function(response) {\n            response.finish();\n            $model.$modelValue.assigned_to = null;\n            return save(null);\n          };\n        })(this));\n      });\n      $scope.$on(\"assigned-to:added\", function(ctx, userId, item) {\n        if (item.id !== $model.$modelValue.id) {\n          return;\n        }\n        return save(userId);\n      });\n      $scope.$watch($attrs.ngModel, function(instance) {\n        return renderAssignedTo(instance);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgAssignedTo\", [\"$rootScope\", \"$tgConfirm\", \"$tgRepo\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$translate\", \"$compile\", \"tgCurrentUserService\", \"tgAvatarService\", AssignedToDirective]);\n\n  BlockButtonDirective = function($rootscope, $loading, $template) {\n    var link, template;\n    template = $template.get(\"common/components/block-button.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      $scope.$watch($attrs.ngModel, function(item) {\n        if (!item) {\n          return;\n        }\n        if (isEditable()) {\n          $el.find('.item-block').addClass('editable');\n        }\n        if (item.is_blocked) {\n          $el.find('.item-block').removeClass('is-active');\n          return $el.find('.item-unblock').addClass('is-active');\n        } else {\n          $el.find('.item-block').addClass('is-active');\n          return $el.find('.item-unblock').removeClass('is-active');\n        }\n      });\n      $el.on(\"click\", \".item-block\", function(event) {\n        event.preventDefault();\n        return $rootscope.$broadcast(\"block\", $model.$modelValue);\n      });\n      $el.on(\"click\", \".item-unblock\", function(event) {\n        var currentLoading, finish;\n        event.preventDefault();\n        currentLoading = $loading().target($el.find(\".item-unblock\")).start();\n        finish = function() {\n          return currentLoading.finish();\n        };\n        return $rootscope.$broadcast(\"unblock\", $model.$modelValue, finish);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgBlockButton\", [\"$rootScope\", \"$tgLoading\", \"$tgTemplate\", BlockButtonDirective]);\n\n  DeleteButtonDirective = function($log, $repo, $confirm, $location, $template) {\n    var link, template;\n    template = $template.get(\"common/components/delete-button.html\");\n    link = function($scope, $el, $attrs, $model) {\n      if (!$attrs.onDeleteGoToUrl) {\n        return $log.error(\"DeleteButtonDirective requires on-delete-go-to-url set in scope.\");\n      }\n      if (!$attrs.onDeleteTitle) {\n        return $log.error(\"DeleteButtonDirective requires on-delete-title set in scope.\");\n      }\n      $el.on(\"click\", \".button-delete\", function(event) {\n        var subtitle, title;\n        title = $attrs.onDeleteTitle;\n        subtitle = $model.$modelValue.subject;\n        return $confirm.askOnDelete(title, subtitle).then((function(_this) {\n          return function(askResponse) {\n            var promise;\n            promise = $repo.remove($model.$modelValue);\n            promise.then(function() {\n              var url;\n              askResponse.finish();\n              url = $scope.$eval($attrs.onDeleteGoToUrl);\n              return $location.path(url);\n            });\n            return promise.then(null, function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            });\n          };\n        })(this));\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgDeleteButton\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"$tgTemplate\", DeleteButtonDirective]);\n\n  EditableDescriptionDirective = function($rootscope, $repo, $confirm, $compile, $loading, $selectedText, $modelTransform, $template, $translate) {\n    var link, noDescriptionMegEditMode, noDescriptionMegReadMode, template;\n    template = $template.get(\"common/components/editable-description.html\");\n    noDescriptionMegEditMode = $template.get(\"common/components/editable-description-msg-edit-mode.html\");\n    noDescriptionMegReadMode = $template.get(\"common/components/editable-description-msg-read-mode.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var cancelEdition, isEditable, save;\n      $el.find('.edit-description').hide();\n      $el.find('.view-description .edit').hide();\n      $scope.$on(\"object:updated\", function() {\n        $el.find('.edit-description').hide();\n        return $el.find('.view-description').show();\n      });\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n      };\n      save = function(description) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find('.save-container')).start();\n        transform = $modelTransform.save(function(item) {\n          item.description = description;\n          return item;\n        });\n        transform.then(function() {\n          $confirm.notify(\"success\");\n          $rootscope.$broadcast(\"object:updated\");\n          $el.find('.edit-description').hide();\n          return $el.find('.view-description').show();\n        });\n        transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n        return transform[\"finally\"](function() {\n          return currentLoading.finish();\n        });\n      };\n      cancelEdition = function() {\n        $scope.item.revert();\n        $el.find('.edit-description').hide();\n        return $el.find('.view-description').show();\n      };\n      $el.on(\"mouseup\", \".view-description\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (!isEditable()) {\n          return;\n        }\n        if (target.is('a')) {\n          return;\n        }\n        if ($selectedText.get().length) {\n          return;\n        }\n        $el.find('.edit-description').show();\n        $el.find('.view-description').hide();\n        return $el.find('textarea').focus();\n      });\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.target);\n        href = target.attr('href');\n        if (href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"click\", \".save\", function(e) {\n        var description;\n        e.preventDefault();\n        description = $scope.item.description;\n        return save(description);\n      });\n      $el.on(\"keydown\", \"textarea\", function(event) {\n        if (event.keyCode !== 27) {\n          return;\n        }\n        return $scope.$applyAsync(function() {\n          var message, title;\n          title = $translate.instant(\"COMMON.CONFIRM_CLOSE_EDIT_MODE_TITLE\");\n          message = $translate.instant(\"COMMON.CONFIRM_CLOSE_EDIT_MODE_MESSAGE\");\n          return $confirm.ask(title, null, message).then(function(askResponse) {\n            cancelEdition();\n            return askResponse.finish();\n          });\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(value) {\n        if (!value) {\n          return;\n        }\n        $scope.item = value;\n        if (isEditable()) {\n          $el.find('.view-description .edit').show();\n          $el.find('.view-description .us-content').addClass('editable');\n          return $scope.noDescriptionMsg = $compile(noDescriptionMegEditMode)($scope);\n        } else {\n          return $scope.noDescriptionMsg = $compile(noDescriptionMegReadMode)($scope);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgEditableDescription\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$compile\", \"$tgLoading\", \"$selectedText\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$translate\", EditableDescriptionDirective]);\n\n  EditableWysiwyg = function(attachmentsService, attachmentsFullService) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var isInEditMode, uploadFile;\n      isInEditMode = function() {\n        return $el.find('textarea').is(':visible') && $model.$modelValue.id;\n      };\n      uploadFile = function(file, type) {\n        if (!attachmentsService.validate(file)) {\n          return;\n        }\n        return attachmentsFullService.addAttachment($model.$modelValue.project, $model.$modelValue.id, type, file).then(function(result) {\n          if (taiga.isImage(result.getIn(['file', 'name']))) {\n            return '![' + result.getIn(['file', 'name']) + '](' + result.getIn(['file', 'url']) + ')';\n          } else {\n            return '[' + result.getIn(['file', 'name']) + '](' + result.getIn(['file', 'url']) + ')';\n          }\n        });\n      };\n      $el.on('dragover', function(e) {\n        var textarea;\n        textarea = $el.find('textarea').focus();\n        return false;\n      });\n      return $el.on('drop', function(e) {\n        var dataTransfer, promises, textarea, type;\n        e.stopPropagation();\n        e.preventDefault();\n        if (isInEditMode()) {\n          dataTransfer = e.dataTransfer || (e.originalEvent && e.originalEvent.dataTransfer);\n          textarea = $el.find('textarea');\n          textarea.addClass('in-progress');\n          type = $model.$modelValue['_name'];\n          if (type === \"userstories\") {\n            type = \"us\";\n          } else if (type === \"tasks\") {\n            type = \"task\";\n          } else if (type === \"issues\") {\n            type = \"issue\";\n          } else if (type === \"wiki\") {\n            type = \"wiki_page\";\n          }\n          promises = _.map(dataTransfer.files, function(file) {\n            return uploadFile(file, type);\n          });\n          return Promise.all(promises).then(function(result) {\n            textarea = $el.find('textarea');\n            $.markItUp({\n              replaceWith: result.join(' ')\n            });\n            return textarea.removeClass('in-progress');\n          });\n        }\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgEditableWysiwyg\", [\"tgAttachmentsService\", \"tgAttachmentsFullService\", EditableWysiwyg]);\n\n  ListItemEpicStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var epic;\n      epic = $scope.$eval($attrs.tgListitemEpicStatus);\n      return bindOnce($scope, \"epicStatusById\", function(epicStatusById) {\n        return $el.html(epicStatusById[epic.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemEpicStatus\", ListItemEpicStatusDirective);\n\n  ListItemUsStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var us;\n      us = $scope.$eval($attrs.tgListitemUsStatus);\n      return bindOnce($scope, \"usStatusById\", function(usStatusById) {\n        return $el.html(usStatusById[us.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemUsStatus\", ListItemUsStatusDirective);\n\n  ListItemTaskStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var task;\n      task = $scope.$eval($attrs.tgListitemTaskStatus);\n      return bindOnce($scope, \"taskStatusById\", function(taskStatusById) {\n        return $el.html(taskStatusById[task.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemTaskStatus\", ListItemTaskStatusDirective);\n\n  ListItemAssignedtoDirective = function($template, $translate, avatarService) {\n    var link, template;\n    template = $template.get(\"common/components/list-item-assigned-to-avatar.html\", true);\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"usersById\", function(usersById) {\n        var avatar, ctx, item, member;\n        item = $scope.$eval($attrs.tgListitemAssignedto);\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\")\n        };\n        member = usersById[item.assigned_to];\n        avatar = avatarService.getAvatar(member);\n        ctx.imgurl = avatar.url;\n        ctx.bg = avatar.bg;\n        if (member) {\n          ctx.name = member.full_name_display;\n        }\n        return $el.html(template(ctx));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemAssignedto\", [\"$tgTemplate\", \"$translate\", \"tgAvatarService\", ListItemAssignedtoDirective]);\n\n  ListItemIssueStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var issue;\n      issue = $scope.$eval($attrs.tgListitemIssueStatus);\n      return bindOnce($scope, \"issueStatusById\", function(issueStatusById) {\n        return $el.html(issueStatusById[issue.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemIssueStatus\", ListItemIssueStatusDirective);\n\n  ListItemTypeDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(issueTypeById, issue) {\n        var domNode, type;\n        type = issueTypeById[issue.type];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", type.color);\n        return domNode.attr(\"title\", type.name);\n      };\n      bindOnce($scope, \"issueTypeById\", function(issueTypeById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemType);\n        return render(issueTypeById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemType, function(issue) {\n        return render($scope.issueTypeById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemType\", ListItemTypeDirective);\n\n  ListItemPriorityDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(priorityById, issue) {\n        var domNode, priority;\n        priority = priorityById[issue.priority];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", priority.color);\n        return domNode.attr(\"title\", priority.name);\n      };\n      bindOnce($scope, \"priorityById\", function(priorityById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemPriority);\n        return render(priorityById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemPriority, function(issue) {\n        return render($scope.priorityById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemPriority\", ListItemPriorityDirective);\n\n  ListItemSeverityDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(severityById, issue) {\n        var domNode, severity;\n        severity = severityById[issue.severity];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", severity.color);\n        return domNode.attr(\"title\", severity.name);\n      };\n      bindOnce($scope, \"severityById\", function(severityById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemSeverity);\n        return render(severityById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemSeverity, function(issue) {\n        return render($scope.severityById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemSeverity\", ListItemSeverityDirective);\n\n  TgProgressBarDirective = function($template) {\n    var link, render, template;\n    template = $template.get(\"common/components/progress-bar.html\", true);\n    render = function(el, percentage) {\n      return el.html(template({\n        percentage: percentage\n      }));\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch($attrs.tgProgressBar, function(percentage) {\n        percentage = _.max([0, percentage]);\n        percentage = _.min([100, percentage]);\n        return render($el, percentage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProgressBar\", [\"$tgTemplate\", TgProgressBarDirective]);\n\n  TgMainTitleDirective = function($translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      $attrs.$observe(\"i18nSectionName\", function(i18nSectionName) {\n        return $scope.sectionName = i18nSectionName;\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/main-title.html\",\n      scope: {\n        projectName: \"=projectName\"\n      }\n    };\n  };\n\n  module.directive(\"tgMainTitle\", [\"$translate\", TgMainTitleDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/confirm.coffee\n */\n\n(function() {\n  var ConfirmService, NOTIFICATION_MSG, bindMethods, cancelTimeout, debounce, module, taiga, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  timeout = this.taiga.timeout;\n\n  cancelTimeout = this.taiga.cancelTimeout;\n\n  debounce = this.taiga.debounce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  NOTIFICATION_MSG = {\n    \"success\": {\n      title: \"NOTIFICATION.OK\",\n      message: \"NOTIFICATION.SAVED\"\n    },\n    \"error\": {\n      title: \"NOTIFICATION.WARNING\",\n      message: \"NOTIFICATION.WARNING_TEXT\"\n    },\n    \"light-error\": {\n      title: \"NOTIFICATION.WARNING\",\n      message: \"NOTIFICATION.WARNING_TEXT\"\n    }\n  };\n\n  ConfirmService = (function(superClass) {\n    extend(ConfirmService, superClass);\n\n    ConfirmService.$inject = [\"$q\", \"lightboxService\", \"$tgLoading\", \"$translate\"];\n\n    function ConfirmService(q, lightboxService, loading, translate) {\n      this.q = q;\n      this.lightboxService = lightboxService;\n      this.loading = loading;\n      this.translate = translate;\n      bindMethods(this);\n    }\n\n    ConfirmService.prototype.hide = function(el) {\n      if (el) {\n        this.lightboxService.close(el);\n        return el.off(\".confirm-dialog\");\n      }\n    };\n\n    ConfirmService.prototype.ask = function(title, subtitle, message, lightboxSelector) {\n      var defered, el;\n      if (lightboxSelector == null) {\n        lightboxSelector = \".lightbox-generic-ask\";\n      }\n      defered = this.q.defer();\n      el = angular.element(lightboxSelector);\n      if (title) {\n        el.find(\".title\").text(title);\n      }\n      if (subtitle) {\n        el.find(\".subtitle\").text(subtitle);\n      }\n      if (message) {\n        el.find(\".message\").text(message);\n      }\n      el.on(\"click.confirm-dialog\", \".button-green\", debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          currentLoading = _this.loading().target(target).start();\n          return defered.resolve({\n            finish: function(ok) {\n              if (ok == null) {\n                ok = true;\n              }\n              currentLoading.finish();\n              if (ok) {\n                return _this.hide(el);\n              }\n            }\n          });\n        };\n      })(this)));\n      el.on(\"click.confirm-dialog\", \".button-red\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.reject();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.askOnDelete = function(title, message) {\n      return this.ask(title, this.translate.instant(\"NOTIFICATION.ASK_DELETE\"), message);\n    };\n\n    ConfirmService.prototype.askChoice = function(title, subtitle, choices, replacement, warning, lightboxSelector) {\n      var choicesField, defered, el;\n      if (lightboxSelector == null) {\n        lightboxSelector = \".lightbox-ask-choice\";\n      }\n      defered = this.q.defer();\n      el = angular.element(lightboxSelector);\n      el.find(\".title\").text(title);\n      el.find(\".subtitle\").text(subtitle);\n      if (replacement) {\n        el.find(\".replacement\").text(replacement);\n      } else {\n        el.find(\".replacement\").remove();\n      }\n      if (warning) {\n        el.find(\".warning\").text(warning);\n      } else {\n        el.find(\".warning\").remove();\n      }\n      choicesField = el.find(\".choices\");\n      choicesField.html('');\n      _.each(choices, function(value, key) {\n        value = _.escape(value);\n        return choicesField.append(angular.element(\"<option value='\" + key + \"'>\" + value + \"</option>\"));\n      });\n      el.on(\"click.confirm-dialog\", \"a.button-green\", debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          currentLoading = _this.loading().target(target).start();\n          return defered.resolve({\n            selected: choicesField.val(),\n            finish: function(ok) {\n              if (ok == null) {\n                ok = true;\n              }\n              currentLoading.finish();\n              if (ok) {\n                return _this.hide(el);\n              }\n            }\n          });\n        };\n      })(this)));\n      el.on(\"click.confirm-dialog\", \".button-red\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.reject();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.error = function(message) {\n      var defered, el;\n      defered = this.q.defer();\n      el = angular.element(\".lightbox-generic-error\");\n      el.find(\".title\").html(message);\n      el.on(\"click.confirm-dialog\", \".button-green\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      el.on(\"click.confirm-dialog\", \".close\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.success = function(title, message, icon) {\n      var defered, detailImage, el, svgContainer, useSVG;\n      defered = this.q.defer();\n      el = angular.element(\".lightbox-generic-success\");\n      el.find(\"img\").remove();\n      el.find(\"svg\").remove();\n      if (icon) {\n        if (icon.type === \"img\") {\n          detailImage = $('<img>').addClass('lb-icon').attr('src', icon.name);\n        } else if (icon.type === \"svg\") {\n          detailImage = document.createElement(\"div\");\n          taiga.addClass(detailImage, \"icon\");\n          taiga.addClass(detailImage, icon.name);\n          taiga.addClass(detailImage, \"lb-icon\");\n          svgContainer = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n          useSVG = document.createElementNS('http://www.w3.org/2000/svg', 'use');\n          useSVG.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '#' + icon.name);\n          detailImage.appendChild(svgContainer).appendChild(useSVG);\n        }\n        if (detailImage) {\n          el.find('section').prepend(detailImage);\n        }\n      }\n      if (title) {\n        el.find(\".title\").html(title);\n      }\n      if (message) {\n        el.find(\".message\").html(message);\n      }\n      el.on(\"click.confirm-dialog\", \".button-green\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      el.on(\"click.confirm-dialog\", \".close\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.loader = function(title, message) {\n      var el;\n      el = angular.element(\".lightbox-generic-loading\");\n      if (title) {\n        el.find(\".title\").html(title);\n      }\n      if (message) {\n        el.find(\".message\").html(message);\n      }\n      return {\n        start: (function(_this) {\n          return function() {\n            return _this.lightboxService.open(el);\n          };\n        })(this),\n        stop: (function(_this) {\n          return function() {\n            return _this.lightboxService.close(el);\n          };\n        })(this),\n        update: (function(_this) {\n          return function(status, title, message, percent) {\n            if (title) {\n              el.find(\".title\").html(title);\n            }\n            if (message) {\n              el.find(\".message\").html(message);\n            }\n            if (percent) {\n              el.find(\".spin\").addClass(\"hidden\");\n              el.find(\".progress-bar-wrapper\").removeClass(\"hidden\");\n              el.find(\".progress-bar-wrapper > .bar\").width(percent + '%');\n              return el.find(\".progress-bar-wrapper > span\").html(percent + '%').css('left', (percent - 9) + '%');\n            } else {\n              el.find(\".spin\").removeClass(\"hidden\");\n              return el.find(\".progress-bar-wrapper\").addClass(\"hidden\");\n            }\n          };\n        })(this)\n      };\n    };\n\n    ConfirmService.prototype.notify = function(type, message, title, time) {\n      var body, el, selector;\n      selector = \".notification-message-\" + type;\n      el = angular.element(selector);\n      if (el.hasClass(\"active\")) {\n        return;\n      }\n      if (title) {\n        el.find(\"h4\").html(title);\n      } else {\n        el.find(\"h4\").html(this.translate.instant(NOTIFICATION_MSG[type].title));\n      }\n      if (message) {\n        el.find(\"p\").html(message);\n      } else {\n        el.find(\"p\").html(this.translate.instant(NOTIFICATION_MSG[type].message));\n      }\n      body = angular.element(\"body\");\n      body.find(\".notification-message .notification-light\").removeClass('active').addClass('inactive');\n      body.find(selector).removeClass('inactive').addClass('active');\n      if (this.tsem) {\n        cancelTimeout(this.tsem);\n      }\n      if (!time) {\n        time = type === 'error' || type === 'light-error' ? 3500 : 1500;\n      }\n      this.tsem = timeout(time, (function(_this) {\n        return function() {\n          body.find(selector).removeClass('active').addClass('inactive').one('animationend', function() {\n            return $(this).removeClass('inactive');\n          });\n          return delete _this.tsem;\n        };\n      })(this));\n      return el.on(\"click\", \".icon-close, .close\", (function(_this) {\n        return function(event) {\n          return body.find(selector).removeClass('active').addClass('inactive');\n        };\n      })(this));\n    };\n\n    return ConfirmService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaCommon\");\n\n  module.service(\"$tgConfirm\", ConfirmService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/custom-field-values.coffee\n */\n\n(function() {\n  var CustomAttributeValueDirective, CustomAttributesValuesController, CustomAttributesValuesDirective, DATE_TYPE, MULTILINE_TYPE, TEXT_TYPE, TYPE_CHOICES, URL_TYPE, bindMethods, bindOnce, debounce, generateHash, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  bindMethods = this.taiga.bindMethods;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  generateHash = taiga.generateHash;\n\n  module = angular.module(\"taigaCommon\");\n\n  TEXT_TYPE = \"text\";\n\n  MULTILINE_TYPE = \"multiline\";\n\n  DATE_TYPE = \"date\";\n\n  URL_TYPE = \"url\";\n\n  TYPE_CHOICES = [\n    {\n      key: TEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT\"\n    }, {\n      key: MULTILINE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI\"\n    }, {\n      key: DATE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE\"\n    }, {\n      key: URL_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_URL\"\n    }\n  ];\n\n  CustomAttributesValuesController = (function(superClass) {\n    extend(CustomAttributesValuesController, superClass);\n\n    CustomAttributesValuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$q\"];\n\n    function CustomAttributesValuesController(scope, rootscope, repo, rs, confirm, q) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.q = q;\n      bindMethods(this);\n      this.type = null;\n      this.objectId = null;\n      this.projectId = null;\n      this.customAttributes = [];\n      this.customAttributesValues = null;\n    }\n\n    CustomAttributesValuesController.prototype.initialize = function(type, objectId) {\n      this.project = this.scope.project;\n      this.type = type;\n      this.objectId = objectId;\n      return this.projectId = this.scope.projectId;\n    };\n\n    CustomAttributesValuesController.prototype.loadCustomAttributesValues = function() {\n      if (!this.objectId) {\n        return this.customAttributesValues;\n      }\n      return this.rs.customAttributesValues[this.type].get(this.objectId).then((function(_this) {\n        return function(customAttributesValues) {\n          _this.customAttributes = _this.project[_this.type + \"_custom_attributes\"];\n          _this.customAttributesValues = customAttributesValues;\n          return customAttributesValues;\n        };\n      })(this));\n    };\n\n    CustomAttributesValuesController.prototype.getAttributeValue = function(attribute) {\n      var attributeValue;\n      attributeValue = _.clone(attribute, false);\n      attributeValue.value = this.customAttributesValues.attributes_values[attribute.id];\n      return attributeValue;\n    };\n\n    CustomAttributesValuesController.prototype.updateAttributeValue = function(attributeValue) {\n      var attributesValues, onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"custom-attributes-values:edit\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function(response) {\n          _this.confirm.notify(\"error\");\n          return _this.q.reject();\n        };\n      })(this);\n      attributesValues = _.clone(this.customAttributesValues.attributes_values, true);\n      attributesValues[attributeValue.id] = attributeValue.value;\n      this.customAttributesValues.attributes_values = attributesValues;\n      this.customAttributesValues.id = this.objectId;\n      return this.repo.save(this.customAttributesValues).then(onSuccess, onError);\n    };\n\n    return CustomAttributesValuesController;\n\n  })(taiga.Controller);\n\n  CustomAttributesValuesDirective = function($templates, $storage) {\n    var collapsedHash, link, template, templateFn;\n    template = $templates.get(\"custom-attributes/custom-attributes-values.html\", true);\n    collapsedHash = function(type) {\n      return generateHash([\"custom-attributes-collapsed\", type]);\n    };\n    link = function($scope, $el, $attrs, $ctrls) {\n      var $ctrl, $model, hash;\n      $ctrl = $ctrls[0];\n      $model = $ctrls[1];\n      hash = collapsedHash($attrs.type);\n      $scope.collapsed = $storage.get(hash) || false;\n      bindOnce($scope, $attrs.ngModel, function(value) {\n        $ctrl.initialize($attrs.type, value.id);\n        return $ctrl.loadCustomAttributesValues();\n      });\n      $scope.toggleCollapse = function() {\n        $scope.collapsed = !$scope.collapsed;\n        return $storage.set(hash, $scope.collapsed);\n      };\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    templateFn = function($el, $attrs) {\n      return template({\n        requiredEditionPerm: $attrs.requiredEditionPerm\n      });\n    };\n    return {\n      require: [\"tgCustomAttributesValues\", \"ngModel\"],\n      controller: CustomAttributesValuesController,\n      controllerAs: \"ctrl\",\n      restrict: \"AE\",\n      scope: true,\n      link: link,\n      template: templateFn\n    };\n  };\n\n  module.directive(\"tgCustomAttributesValues\", [\"$tgTemplate\", \"$tgStorage\", \"$translate\", CustomAttributesValuesDirective]);\n\n  CustomAttributeValueDirective = function($template, $selectedText, $compile, $translate, datePickerConfigService) {\n    var link, template, templateEdit;\n    template = $template.get(\"custom-attributes/custom-attribute-value.html\", true);\n    templateEdit = $template.get(\"custom-attributes/custom-attribute-value-edit.html\", true);\n    link = function($scope, $el, $attrs, $ctrl) {\n      var attributeValue, isEditable, prettyDate, render, setFocusAndSelectOnInputField, submit;\n      prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n      render = function(attributeValue, edit) {\n        var ctx, datePickerConfig, editable, html, value;\n        if (edit == null) {\n          edit = false;\n        }\n        if (attributeValue.type === DATE_TYPE && attributeValue.value) {\n          value = moment(attributeValue.value, \"YYYY-MM-DD\").format(prettyDate);\n        } else {\n          value = attributeValue.value;\n        }\n        editable = isEditable();\n        ctx = {\n          id: attributeValue.id,\n          name: attributeValue.name,\n          description: attributeValue.description,\n          value: value,\n          isEditable: editable,\n          type: attributeValue.type\n        };\n        if (editable && (edit || !value)) {\n          html = templateEdit(ctx);\n          html = $compile(html)($scope);\n          $el.html(html);\n          if (attributeValue.type === DATE_TYPE) {\n            datePickerConfig = datePickerConfigService.get();\n            _.merge(datePickerConfig, {\n              field: $el.find(\"input[name=value]\")[0],\n              onSelect: (function(_this) {\n                return function(date) {\n                  var selectedDate;\n                  return selectedDate = date;\n                };\n              })(this),\n              onOpen: (function(_this) {\n                return function() {\n                  if (typeof selectedDate !== \"undefined\" && selectedDate !== null) {\n                    return $el.picker.setDate(selectedDate);\n                  }\n                };\n              })(this)\n            });\n            return $el.picker = new Pikaday(datePickerConfig);\n          }\n        } else {\n          html = template(ctx);\n          html = $compile(html)($scope);\n          return $el.html(html);\n        }\n      };\n      isEditable = function() {\n        var permissions, requiredEditionPerm;\n        permissions = $scope.project.my_permissions;\n        requiredEditionPerm = $attrs.requiredEditionPerm;\n        return permissions.indexOf(requiredEditionPerm) > -1;\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var form, input;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          input = $el.find(\"input[name=value], textarea[name='value']\");\n          attributeValue.value = input.val();\n          if (attributeValue.type === DATE_TYPE) {\n            if (moment(attributeValue.value, prettyDate).isValid()) {\n              attributeValue.value = moment(attributeValue.value, prettyDate).format(\"YYYY-MM-DD\");\n            }\n          }\n          return $scope.$apply(function() {\n            return $ctrl.updateAttributeValue(attributeValue).then(function() {\n              return render(attributeValue, false);\n            });\n          });\n        };\n      })(this));\n      setFocusAndSelectOnInputField = function() {\n        return $el.find(\"input[name='value'], textarea[name='value']\").focus().select();\n      };\n      attributeValue = $scope.$eval($attrs.tgCustomAttributeValue);\n      render(attributeValue);\n      $el.on(\"click\", \".js-value-view-mode span a\", function(event) {\n        return event.stopPropagation();\n      });\n      $el.on(\"click\", \".js-value-view-mode\", function() {\n        if (!isEditable()) {\n          return;\n        }\n        if ($selectedText.get().length) {\n          return;\n        }\n        render(attributeValue, true);\n        return setFocusAndSelectOnInputField();\n      });\n      $el.on(\"click\", \".js-edit-description\", function(event) {\n        event.preventDefault();\n        render(attributeValue, true);\n        return setFocusAndSelectOnInputField();\n      });\n      $el.on(\"keyup\", \"input[name=value], textarea[name='value']\", function(event) {\n        if (event.keyCode === 13 && event.currentTarget.type !== \"textarea\") {\n          return submit(event);\n        } else if (event.keyCode === 27) {\n          return render(attributeValue, false);\n        }\n      });\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".js-save-description\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"^tgCustomAttributesValues\",\n      restrict: \"AE\"\n    };\n  };\n\n  module.directive(\"tgCustomAttributeValue\", [\"$tgTemplate\", \"$selectedText\", \"$compile\", \"$translate\", \"tgDatePickerConfigService\", CustomAttributeValueDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/estimation.coffee\n */\n\n(function() {\n  var EstimationsService, LbUsEstimationDirective, UsEstimationDirective, groupBy, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaCommon\");\n\n  LbUsEstimationDirective = function($tgEstimationsService, $rootScope, $repo, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch($attrs.ngModel, function(us) {\n        var estimationProcess;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId, points) {\n            us.points = points;\n            estimationProcess.render();\n            return $scope.$apply(function() {\n              return $model.$setViewValue(us);\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, template;\n            ctx = {\n              totalPoints: this.calculateTotalPoints(),\n              roles: this.calculateRoles(),\n              editable: this.isEditable,\n              loading: false\n            };\n            mainTemplate = \"common/estimation/us-estimation-points-per-role.html\";\n            template = $template.get(mainTemplate, true);\n            html = template(ctx);\n            html = $compile(html)($scope);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgLbUsEstimation\", [\"$tgEstimationsService\", \"$rootScope\", \"$tgRepo\", \"$tgTemplate\", \"$compile\", LbUsEstimationDirective]);\n\n  UsEstimationDirective = function($tgEstimationsService, $rootScope, $repo, $template, $compile, $modelTransform, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var save;\n      save = function(points) {\n        var onError, transform;\n        transform = $modelTransform.save((function(_this) {\n          return function(us) {\n            us.points = points;\n            return us;\n          };\n        })(this));\n        onError = (function(_this) {\n          return function() {\n            return $confirm.notify(\"error\");\n          };\n        })(this);\n        return transform.then(null, onError);\n      };\n      $scope.$watchCollection(function() {\n        return $model.$modelValue && $model.$modelValue.points;\n      }, function() {\n        var estimationProcess, us;\n        us = $model.$modelValue;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId, points) {\n            estimationProcess.loading = roleId;\n            estimationProcess.render();\n            return save(points).then(function() {\n              estimationProcess.loading = false;\n              $rootScope.$broadcast(\"object:updated\");\n              return estimationProcess.render();\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, template;\n            ctx = {\n              totalPoints: this.calculateTotalPoints(),\n              roles: this.calculateRoles(),\n              editable: this.isEditable,\n              loading: estimationProcess.loading\n            };\n            mainTemplate = \"common/estimation/us-estimation-points-per-role.html\";\n            template = $template.get(mainTemplate, true);\n            html = template(ctx);\n            html = $compile(html)($scope);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsEstimation\", [\"$tgEstimationsService\", \"$rootScope\", \"$tgRepo\", \"$tgTemplate\", \"$compile\", \"$tgQueueModelTransformation\", \"$tgConfirm\", UsEstimationDirective]);\n\n  EstimationsService = function($template, $repo, $confirm, $q, $qqueue) {\n    var EstimationProcess, create, pointsTemplate;\n    pointsTemplate = $template.get(\"common/estimation/us-estimation-points.html\", true);\n    EstimationProcess = (function() {\n      function EstimationProcess($el1, us1, project1) {\n        this.$el = $el1;\n        this.us = us1;\n        this.project = project1;\n        this.bindClickEvents = bind(this.bindClickEvents, this);\n        this.isEditable = this.project.my_permissions.indexOf(\"modify_us\") !== -1;\n        this.roles = this.project.roles;\n        this.points = this.project.points;\n        this.loading = false;\n        this.pointsById = groupBy(this.points, function(x) {\n          return x.id;\n        });\n        this.onSelectedPointForRole = function(roleId, pointId) {};\n        this.render = function() {};\n      }\n\n      EstimationProcess.prototype.save = function(roleId, pointId) {\n        var deferred;\n        deferred = $q.defer();\n        $qqueue.add((function(_this) {\n          return function() {\n            var onError, onSuccess;\n            onSuccess = function() {\n              deferred.resolve();\n              return _this.render();\n            };\n            onError = function() {\n              $confirm.notify(\"error\");\n              _this.us.revert();\n              _this.render();\n              return deferred.reject();\n            };\n            return $repo.save(_this.us).then(onSuccess, onError);\n          };\n        })(this));\n        return deferred.promise;\n      };\n\n      EstimationProcess.prototype.calculateTotalPoints = function() {\n        var notNullValues, values;\n        values = _.map(this.us.points, (function(_this) {\n          return function(v, k) {\n            var ref;\n            return (ref = _this.pointsById[v]) != null ? ref.value : void 0;\n          };\n        })(this));\n        if (values.length === 0) {\n          return \"?\";\n        }\n        notNullValues = _.filter(values, function(v) {\n          return v != null;\n        });\n        if (notNullValues.length === 0) {\n          return \"?\";\n        }\n        return _.reduce(notNullValues, function(acc, num) {\n          return acc + num;\n        });\n      };\n\n      EstimationProcess.prototype.calculateRoles = function() {\n        var computableRoles, roles;\n        computableRoles = _.filter(this.project.roles, \"computable\");\n        roles = _.map(computableRoles, (function(_this) {\n          return function(role) {\n            var pointId, pointObj;\n            pointId = _this.us.points[role.id];\n            pointObj = _this.pointsById[pointId];\n            role = _.clone(role, true);\n            role.points = (pointObj != null) && (pointObj.name != null) ? pointObj.name : \"?\";\n            return role;\n          };\n        })(this));\n        return roles;\n      };\n\n      EstimationProcess.prototype.bindClickEvents = function() {\n        this.$el.on(\"click\", \".total.clickable\", (function(_this) {\n          return function(event) {\n            var roleId, target;\n            event.preventDefault();\n            event.stopPropagation();\n            target = angular.element(event.currentTarget);\n            roleId = target.data(\"role-id\");\n            _this.renderPointsSelector(roleId, target);\n            target.siblings().removeClass('active');\n            return target.addClass('active');\n          };\n        })(this));\n        return this.$el.on(\"click\", \".point\", (function(_this) {\n          return function(event) {\n            var pointId, points, roleId, target;\n            event.preventDefault();\n            event.stopPropagation();\n            target = angular.element(event.currentTarget);\n            roleId = target.data(\"role-id\");\n            pointId = target.data(\"point-id\");\n            _this.$el.find(\".popover\").popover().close();\n            points = _.clone(_this.us.points, true);\n            points[roleId] = pointId;\n            return _this.onSelectedPointForRole(roleId, pointId, points);\n          };\n        })(this));\n      };\n\n      EstimationProcess.prototype.renderPointsSelector = function(roleId, target) {\n        var horizontalList, html, maxPointLength, points, pop;\n        points = _.map(this.points, (function(_this) {\n          return function(point) {\n            point = _.clone(point, true);\n            point.selected = _this.us.points[roleId] === point.id ? false : true;\n            return point;\n          };\n        })(this));\n        maxPointLength = 5;\n        horizontalList = _.some(points, (function(_this) {\n          return function(point) {\n            return point.name.length > maxPointLength;\n          };\n        })(this));\n        html = pointsTemplate({\n          \"points\": points,\n          roleId: roleId,\n          horizontal: horizontalList\n        });\n        this.$el.find(\".popover\").popover().close();\n        this.$el.find(\".pop-points-open\").remove();\n        if (target != null) {\n          this.$el.find(target).append(html);\n        } else {\n          this.$el.append(html);\n        }\n        this.$el.find(\".pop-points-open\").popover().open(function() {\n          return $(this).removeClass(\"active\").closest(\"li\").removeClass(\"active\");\n        });\n        this.$el.find(\".pop-points-open\").show();\n        pop = this.$el.find(\".pop-points-open\");\n        if (pop.offset().top + pop.height() > document.body.clientHeight) {\n          return pop.addClass('pop-bottom');\n        }\n      };\n\n      return EstimationProcess;\n\n    })();\n    create = function($el, us, project) {\n      var estimationProcess;\n      $el.unbind(\"click\");\n      estimationProcess = new EstimationProcess($el, us, project);\n      if (estimationProcess.isEditable) {\n        estimationProcess.bindClickEvents();\n      }\n      return estimationProcess;\n    };\n    return {\n      create: create\n    };\n  };\n\n  module.factory(\"$tgEstimationsService\", [\"$tgTemplate\", \"$tgRepo\", \"$tgConfirm\", \"$q\", \"$tgQqueue\", EstimationsService]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/filters.coffee\n */\n\n(function() {\n  var byRefFilter, darkerFilter, defaultFilter, module, momentFormat, momentFromNow, sizeFormat, taiga, toMutableFilter, unslugify, yesNoFilter;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  defaultFilter = function() {\n    return function(value, defaultValue) {\n      if (value === [null, void 0]) {\n        return defaultValue;\n      }\n      return value;\n    };\n  };\n\n  module.filter(\"default\", defaultFilter);\n\n  yesNoFilter = function($translate) {\n    return function(value) {\n      if (value) {\n        return $translate.instant(\"COMMON.YES\");\n      }\n      return $translate.instant(\"COMMON.NO\");\n    };\n  };\n\n  module.filter(\"yesNo\", [\"$translate\", yesNoFilter]);\n\n  unslugify = function() {\n    return taiga.unslugify;\n  };\n\n  module.filter(\"unslugify\", unslugify);\n\n  momentFormat = function() {\n    return function(input, format) {\n      if (input) {\n        return moment(input).format(format);\n      }\n      return \"\";\n    };\n  };\n\n  module.filter(\"momentFormat\", momentFormat);\n\n  momentFromNow = function() {\n    return function(input, without_suffix) {\n      if (input) {\n        return moment(input).fromNow(without_suffix || false);\n      }\n      return \"\";\n    };\n  };\n\n  module.filter(\"momentFromNow\", momentFromNow);\n\n  sizeFormat = (function(_this) {\n    return function() {\n      return _this.taiga.sizeFormat;\n    };\n  })(this);\n\n  module.filter(\"sizeFormat\", sizeFormat);\n\n  toMutableFilter = function() {\n    var memoizedMutable, toMutable;\n    toMutable = function(js) {\n      return js.toJS();\n    };\n    memoizedMutable = _.memoize(toMutable);\n    return function(input) {\n      if (input instanceof Immutable.List) {\n        return memoizedMutable(input);\n      }\n      return input;\n    };\n  };\n\n  module.filter(\"toMutable\", toMutableFilter);\n\n  byRefFilter = function($filterFilter) {\n    return function(userstories, filter) {\n      var cleanRef;\n      if (filter != null ? filter.startsWith(\"#\") : void 0) {\n        cleanRef = filter.substr(1);\n        return _.filter(userstories, (function(_this) {\n          return function(us) {\n            return String(us.ref).startsWith(cleanRef);\n          };\n        })(this));\n      }\n      return $filterFilter(userstories, filter);\n    };\n  };\n\n  module.filter(\"byRef\", [\"filterFilter\", byRefFilter]);\n\n  darkerFilter = function() {\n    return function(color, luminosity) {\n      var black, c, i, j, len, newColor, ref, white;\n      color = new String(color).replace(/[^0-9a-f]/gi, '');\n      if (color.length < 6) {\n        color = color[0] + color[0] + color[1] + color[1] + color[2] + color[2];\n      }\n      luminosity = luminosity || 0;\n      newColor = \"#\";\n      c = 0;\n      i = 0;\n      black = 0;\n      white = 255;\n      ref = [0, 1, 2];\n      for (j = 0, len = ref.length; j < len; j++) {\n        i = ref[j];\n        c = parseInt(color.substr(i * 2, 2), 16);\n        c = Math.round(Math.min(Math.max(black, c + (luminosity * white)), white)).toString(16);\n        newColor += (\"00\" + c).substr(c.length);\n      }\n      return newColor;\n    };\n  };\n\n  module.filter(\"darker\", darkerFilter);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/importer.coffee\n */\n\n(function() {\n  var ImportProjectButtonDirective, LbImportErrorDirective, module;\n\n  module = angular.module(\"taigaCommon\");\n\n  ImportProjectButtonDirective = function($rs, $confirm, $location, $navUrls, $translate, $lightboxFactory, currentUserService, $tgAuth) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var getRestrictionError;\n      getRestrictionError = function(result) {\n        var errorKey, maxMemberships, membersError, privateError, publicError, user;\n        if (result.headers) {\n          errorKey = '';\n          user = currentUserService.getUser();\n          maxMemberships = 0;\n          if (result.headers.isPrivate) {\n            privateError = !currentUserService.canCreatePrivateProjects().valid;\n            maxMemberships = null;\n            if (user.get('max_memberships_private_projects') !== null && result.headers.memberships >= user.get('max_memberships_private_projects')) {\n              membersError = true;\n            } else {\n              membersError = false;\n            }\n            if (privateError && membersError) {\n              errorKey = 'private-space-members';\n              maxMemberships = user.get('max_memberships_private_projects');\n            } else if (privateError) {\n              errorKey = 'private-space';\n            } else if (membersError) {\n              errorKey = 'private-members';\n              maxMemberships = user.get('max_memberships_private_projects');\n            }\n          } else {\n            publicError = !currentUserService.canCreatePublicProjects().valid;\n            if (user.get('max_memberships_public_projects') !== null && result.headers.memberships >= user.get('max_memberships_public_projects')) {\n              membersError = true;\n            } else {\n              membersError = false;\n            }\n            if (publicError && membersError) {\n              errorKey = 'public-space-members';\n              maxMemberships = user.get('max_memberships_public_projects');\n            } else if (publicError) {\n              errorKey = 'public-space';\n            } else if (membersError) {\n              errorKey = 'public-members';\n              maxMemberships = user.get('max_memberships_public_projects');\n            }\n          }\n          return {\n            key: errorKey,\n            values: {\n              max_memberships: maxMemberships,\n              members: result.headers.memberships\n            }\n          };\n        } else {\n          return false;\n        }\n      };\n      $el.on(\"click\", \".import-project-button\", function(event) {\n        event.preventDefault();\n        $el.find(\"input.import-file\").val(\"\");\n        return $el.find(\"input.import-file\").trigger(\"click\");\n      });\n      return $el.on(\"change\", \"input.import-file\", function(event) {\n        var file, loader, onError, onSuccess;\n        event.preventDefault();\n        file = event.target.files[0];\n        if (!file) {\n          return;\n        }\n        loader = $confirm.loader($translate.instant(\"PROJECT.IMPORT.UPLOADING_FILE\"));\n        onSuccess = function(result) {\n          return currentUserService.loadProjects().then(function() {\n            var ctx, message, msg, title;\n            loader.stop();\n            if (result.status === 202) {\n              title = $translate.instant(\"PROJECT.IMPORT.ASYNC_IN_PROGRESS_TITLE\");\n              message = $translate.instant(\"PROJECT.IMPORT.ASYNC_IN_PROGRESS_MESSAGE\");\n              return $confirm.success(title, message);\n            } else {\n              ctx = {\n                project: result.data.slug\n              };\n              $location.path($navUrls.resolve(\"project-admin-project-profile-details\", ctx));\n              msg = $translate.instant(\"PROJECT.IMPORT.SYNC_SUCCESS\");\n              return $confirm.notify(\"success\", msg);\n            }\n          });\n        };\n        onError = function(result) {\n          return $tgAuth.refresh().then(function() {\n            var errorMsg, ref, restrictionError;\n            restrictionError = getRestrictionError(result);\n            loader.stop();\n            if (restrictionError) {\n              return $lightboxFactory.create('tg-lb-import-error', {\n                \"class\": 'lightbox lightbox-import-error'\n              }, restrictionError);\n            } else {\n              errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR\");\n              if (result.status === 429) {\n                errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_TOO_MANY_REQUEST\");\n              } else if ((ref = result.data) != null ? ref._error_message : void 0) {\n                errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_MESSAGE\", {\n                  error_message: result.data._error_message\n                });\n              }\n              return $confirm.notify(\"error\", errorMsg);\n            }\n          });\n        };\n        loader.start();\n        return $rs.projects[\"import\"](file, loader.update).then(onSuccess, onError);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgImportProjectButton\", [\"$tgResources\", \"$tgConfirm\", \"$location\", \"$tgNavUrls\", \"$translate\", \"tgLightboxFactory\", \"tgCurrentUserService\", \"$tgAuth\", ImportProjectButtonDirective]);\n\n  LbImportErrorDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el, attrs) {\n      lightboxService.open(el);\n      return scope.close = function() {\n        lightboxService.close(el);\n      };\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-import-error.html\",\n      link: link\n    };\n  };\n\n  LbImportErrorDirective.$inject = [\"lightboxService\"];\n\n  module.directive(\"tgLbImportError\", LbImportErrorDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/lightboxes.coffee\n */\n\n(function() {\n  var AssignedToLightboxDirective, BlockLightboxDirective, BlockingMessageInputDirective, CreateBulkUserstoriesDirective, CreateEditUserstoryDirective, LightboxDirective, LightboxKeyboardNavigationService, LightboxLeaveProjectWarningDirective, LightboxService, WatchersLightboxDirective, bindOnce, debounce, module, sizeFormat, timeout, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  module = angular.module(\"taigaCommon\");\n\n  bindOnce = this.taiga.bindOnce;\n\n  timeout = this.taiga.timeout;\n\n  debounce = this.taiga.debounce;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  trim = this.taiga.trim;\n\n  LightboxService = (function(superClass) {\n    extend(LightboxService, superClass);\n\n    function LightboxService(animationFrame, q, rootScope) {\n      this.animationFrame = animationFrame;\n      this.q = q;\n      this.rootScope = rootScope;\n    }\n\n    LightboxService.prototype.open = function($el, onClose) {\n      var defered, docEl, lightboxContent;\n      this.onClose = onClose;\n      if (_.isString($el)) {\n        $el = $($el);\n      }\n      defered = this.q.defer();\n      lightboxContent = $el.children().not(\".close\");\n      lightboxContent.hide();\n      this.animationFrame.add(function() {\n        return $el.css('display', 'flex');\n      });\n      this.animationFrame.add(function() {\n        $el.addClass(\"open\");\n        return $el.one(\"transitionend\", (function(_this) {\n          return function() {\n            var firstField;\n            firstField = $el.find('input,textarea').first();\n            if (firstField.length) {\n              return $el.find('input,textarea').first().focus();\n            } else if (document.activeElement) {\n              return $(document.activeElement).blur();\n            }\n          };\n        })(this));\n      });\n      this.animationFrame.add((function(_this) {\n        return function() {\n          lightboxContent.show();\n          return defered.resolve();\n        };\n      })(this));\n      docEl = angular.element(document);\n      docEl.on(\"keydown.lightbox\", (function(_this) {\n        return function(e) {\n          var code;\n          code = e.keyCode ? e.keyCode : e.which;\n          if (code === 27) {\n            return _this.close($el);\n          }\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    LightboxService.prototype.close = function($el) {\n      return new Promise((function(_this) {\n        return function(resolve) {\n          var docEl, scope;\n          if (_.isString($el)) {\n            $el = $($el);\n          }\n          docEl = angular.element(document);\n          docEl.off(\".lightbox\");\n          docEl.off(\".keyboard-navigation\");\n          _this.animationFrame.add(function() {\n            $el.addClass('close');\n            return $el.one(\"transitionend\", function() {\n              $el.removeAttr('style');\n              $el.removeClass(\"open\").removeClass('close');\n              if (_this.onClose) {\n                _this.rootScope.$apply(_this.onClose);\n              }\n              return resolve();\n            });\n          });\n          if ($el.hasClass(\"remove-on-close\")) {\n            scope = $el.data(\"scope\");\n            if (scope) {\n              scope.$destroy();\n            }\n            return $el.remove();\n          }\n        };\n      })(this));\n    };\n\n    LightboxService.prototype.closeAll = function() {\n      var docEl, i, len, lightboxEl, ref, results;\n      docEl = angular.element(document);\n      ref = docEl.find(\".lightbox.open\");\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        lightboxEl = ref[i];\n        results.push(this.close($(lightboxEl)));\n      }\n      return results;\n    };\n\n    return LightboxService;\n\n  })(taiga.Service);\n\n  module.service(\"lightboxService\", [\"animationFrame\", \"$q\", \"$rootScope\", LightboxService]);\n\n  LightboxKeyboardNavigationService = (function(superClass) {\n    extend(LightboxKeyboardNavigationService, superClass);\n\n    function LightboxKeyboardNavigationService() {\n      return LightboxKeyboardNavigationService.__super__.constructor.apply(this, arguments);\n    }\n\n    LightboxKeyboardNavigationService.prototype.stop = function() {\n      var docEl;\n      docEl = angular.element(document);\n      return docEl.off(\".keyboard-navigation\");\n    };\n\n    LightboxKeyboardNavigationService.prototype.dispatch = function($el, code) {\n      var activeElement, next, prev;\n      activeElement = $el.find(\".selected\");\n      if (code === 13) {\n        if ($el.find(\".user-list-single\").length === 1) {\n          return $el.find('.user-list-single:first').trigger(\"click\");\n        } else {\n          return activeElement.trigger(\"click\");\n        }\n      } else if (code === 40) {\n        if (!activeElement.length) {\n          return $el.find('.user-list-single:not(\".is-active\"):first').addClass('selected');\n        } else {\n          next = activeElement.next('.user-list-single');\n          if (next.length) {\n            activeElement.removeClass('selected');\n            return next.addClass('selected');\n          }\n        }\n      } else if (code === 38) {\n        if (!activeElement.length) {\n          return $el.find('.user-list-single:last').addClass('selected');\n        } else {\n          prev = activeElement.prev('.user-list-single:not(\".is-active\")');\n          if (prev.length) {\n            activeElement.removeClass('selected');\n            return prev.addClass('selected');\n          }\n        }\n      }\n    };\n\n    LightboxKeyboardNavigationService.prototype.init = function($el) {\n      var docEl;\n      this.stop();\n      docEl = angular.element(document);\n      return docEl.on(\"keydown.keyboard-navigation\", (function(_this) {\n        return function(event) {\n          var code;\n          code = event.keyCode ? event.keyCode : event.which;\n          if (code === 40 || code === 38 || code === 13) {\n            event.preventDefault();\n            return _this.dispatch($el, code);\n          }\n        };\n      })(this));\n    };\n\n    return LightboxKeyboardNavigationService;\n\n  })(taiga.Service);\n\n  module.service(\"lightboxKeyboardNavigationService\", LightboxKeyboardNavigationService);\n\n  LightboxDirective = function(lightboxService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n    };\n    return {\n      restrict: \"C\",\n      link: link\n    };\n  };\n\n  module.directive(\"lightbox\", [\"lightboxService\", LightboxDirective]);\n\n  BlockLightboxDirective = function($rootscope, $tgrepo, $confirm, lightboxService, $loading, $modelTransform, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var block, title, unblock;\n      title = $translate.instant($attrs.title);\n      $el.find(\"h2.title\").text(title);\n      unblock = (function(_this) {\n        return function(finishCallback) {\n          var transform;\n          transform = $modelTransform.save(function(item) {\n            item.is_blocked = false;\n            item.blocked_note = \"\";\n            return item;\n          });\n          transform.then(function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            return finishCallback();\n          });\n          transform.then(null, function() {\n            $confirm.notify(\"error\");\n            return item.revert();\n          });\n          transform[\"finally\"](function() {\n            return finishCallback();\n          });\n          return transform;\n        };\n      })(this);\n      block = function() {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find(\".button-green\")).start();\n        transform = $modelTransform.save(function(item) {\n          item.is_blocked = true;\n          item.blocked_note = $el.find(\".reason\").val();\n          return item;\n        });\n        transform.then(function() {\n          $confirm.notify(\"success\");\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n        return transform[\"finally\"](function() {\n          currentLoading.finish();\n          return lightboxService.close($el);\n        });\n      };\n      $scope.$on(\"block\", function() {\n        $el.find(\".reason\").val($model.$modelValue.blocked_note);\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"unblock\", (function(_this) {\n        return function(event, model, finishCallback) {\n          return unblock(finishCallback);\n        };\n      })(this));\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return block();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-block.html\",\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgLbBlock\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"lightboxService\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$translate\", BlockLightboxDirective]);\n\n  BlockingMessageInputDirective = function($log, $template, $compile) {\n    var link, template, templateFn;\n    template = $template.get(\"common/lightbox/lightbox-blocking-message-input.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      if (!$attrs.watch) {\n        return $log.error(\"No watch attribute on tg-blocking-message-input directive\");\n      }\n      return $scope.$watch($attrs.watch, function(value) {\n        if (value === !void 0 && value === true) {\n          return $el.find(\".blocked-note\").removeClass(\"hidden\");\n        } else {\n          return $el.find(\".blocked-note\").addClass(\"hidden\");\n        }\n      });\n    };\n    templateFn = function($el, $attrs) {\n      return template({\n        ngmodel: $attrs.ngModel\n      });\n    };\n    return {\n      template: templateFn,\n      link: link,\n      require: \"ngModel\",\n      restrict: \"EA\"\n    };\n  };\n\n  module.directive(\"tgBlockingMessageInput\", [\"$log\", \"$tgTemplate\", \"$compile\", BlockingMessageInputDirective]);\n\n  CreateEditUserstoryDirective = function($repo, $model, $rs, $rootScope, lightboxService, $loading, $translate, $confirm, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var attachmentsToAdd, attachmentsToDelete, createAttachments, deleteAttachments, form, resetAttachments, submit, submitButton;\n      form = null;\n      $scope.createEditUs = {};\n      $scope.isNew = true;\n      attachmentsToAdd = Immutable.List();\n      attachmentsToDelete = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return attachmentsToDelete = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      $scope.deleteAttachment = function(attachment) {\n        if (attachment.get(\"id\")) {\n          return attachmentsToDelete = attachmentsToDelete.push(attachment);\n        }\n      };\n      $scope.addTag = function(tag, color) {\n        var inserted, itemtags, projectTags, tags, value;\n        value = trim(tag.toLowerCase());\n        tags = $scope.project.tags;\n        projectTags = $scope.project.tags_colors;\n        if (tags == null) {\n          tags = [];\n        }\n        if (projectTags == null) {\n          projectTags = {};\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        projectTags[tag] = color || null;\n        $scope.project.tags = tags;\n        itemtags = _.clone($scope.us.tags);\n        inserted = _.find(itemtags, function(it) {\n          return it[0] === value;\n        });\n        if (!inserted) {\n          itemtags.push([tag, color]);\n          return $scope.us.tags = itemtags;\n        }\n      };\n      $scope.deleteTag = function(tag) {\n        var itemtags, tags, value;\n        value = trim(tag[0].toLowerCase());\n        tags = $scope.project.tags;\n        itemtags = _.clone($scope.us.tags);\n        _.remove(itemtags, function(tag) {\n          return tag[0] === value;\n        });\n        $scope.us.tags = itemtags;\n        return _.pull($scope.us.tags, value);\n      };\n      $scope.$on(\"usform:new\", function(ctx, projectId, status, statusList) {\n        if (form) {\n          form.reset();\n        }\n        $scope.isNew = true;\n        $scope.usStatusList = statusList;\n        $scope.attachments = Immutable.List();\n        resetAttachments();\n        $scope.us = $model.make_model(\"userstories\", {\n          project: projectId,\n          points: {},\n          status: status,\n          is_archived: false,\n          tags: []\n        });\n        $el.find(\".button-green\").html($translate.instant(\"COMMON.CREATE\"));\n        $el.find(\".title\").html($translate.instant(\"LIGHTBOX.CREATE_EDIT_US.NEW_US\"));\n        $el.find(\".tag-input\").val(\"\");\n        $el.find(\".blocked-note\").addClass(\"hidden\");\n        $el.find(\"label.blocked\").removeClass(\"selected\");\n        $el.find(\"label.team-requirement\").removeClass(\"selected\");\n        $el.find(\"label.client-requirement\").removeClass(\"selected\");\n        $scope.createEditUsOpen = true;\n        return lightboxService.open($el, function() {\n          return $scope.createEditUsOpen = false;\n        });\n      });\n      $scope.$on(\"usform:edit\", function(ctx, us, attachments) {\n        if (form) {\n          form.reset();\n        }\n        $scope.us = us;\n        $scope.attachments = Immutable.fromJS(attachments);\n        $scope.isNew = false;\n        resetAttachments();\n        $el.find(\".button-green\").html($translate.instant(\"COMMON.SAVE\"));\n        $el.find(\".title\").html($translate.instant(\"LIGHTBOX.CREATE_EDIT_US.EDIT_US\"));\n        $el.find(\".tag-input\").val(\"\");\n        if (us.is_blocked) {\n          $el.find(\".blocked-note\").removeClass(\"hidden\");\n          $el.find(\"label.blocked\").addClass(\"selected\");\n        } else {\n          $el.find(\".blocked-note\").addClass(\"hidden\");\n          $el.find(\"label.blocked\").removeClass(\"selected\");\n        }\n        if (us.team_requirement) {\n          $el.find(\"label.team-requirement\").addClass(\"selected\");\n        } else {\n          $el.find(\"label.team-requirement\").removeClass(\"selected\");\n        }\n        if (us.client_requirement) {\n          $el.find(\"label.client-requirement\").addClass(\"selected\");\n        } else {\n          $el.find(\"label.client-requirement\").removeClass(\"selected\");\n        }\n        $scope.createEditUsOpen = true;\n        return lightboxService.open($el, function() {\n          return $scope.createEditUsOpen = false;\n        });\n      });\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.us.project, 'us');\n        });\n        return $q.all(promises);\n      };\n      deleteAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToDelete.toJS(), function(attachment) {\n          return attachmentsService[\"delete\"](\"us\", attachment.id);\n        });\n        return $q.all(promises);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, params, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          params = {\n            include_attachments: true,\n            include_tasks: true\n          };\n          if ($scope.isNew) {\n            promise = $repo.create(\"userstories\", $scope.us);\n            broadcastEvent = \"usform:new:success\";\n          } else {\n            promise = $repo.save($scope.us, true);\n            broadcastEvent = \"usform:edit:success\";\n          }\n          promise.then(function(data) {\n            return deleteAttachments(data).then((function(_this) {\n              return function() {\n                return createAttachments(data);\n              };\n            })(this)).then((function(_this) {\n              return function() {\n                currentLoading.finish();\n                lightboxService.close($el);\n                return $rs.userstories.getByRef(data.project, data.ref, params).then(function(us) {\n                  return $rootScope.$broadcast(broadcastEvent, us);\n                });\n              };\n            })(this));\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        $scope.$apply(function() {\n          return $scope.us.revert();\n        });\n        return lightboxService.close($el);\n      });\n      $el.keydown(function(event) {\n        var code;\n        code = event.keyCode ? event.keyCode : event.which;\n        if (code === 27) {\n          lightboxService.close($el);\n          return $scope.$apply(function() {\n            return $scope.us.revert();\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateEditUserstory\", [\"$tgRepo\", \"$tgModel\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$translate\", \"$tgConfirm\", \"$q\", \"tgAttachmentsService\", CreateEditUserstoryDirective]);\n\n  CreateBulkUserstoriesDirective = function($repo, $rs, $rootscope, lightboxService, $loading, $model) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var form, submit, submitButton;\n      form = null;\n      $scope.$on(\"usform:bulk\", function(ctx, projectId, status) {\n        if (form) {\n          form.reset();\n        }\n        $scope[\"new\"] = {\n          projectId: projectId,\n          statusId: status,\n          bulk: \"\"\n        };\n        return lightboxService.open($el);\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley({\n            onlyOneErrorElement: true\n          });\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $rs.userstories.bulkCreate($scope[\"new\"].projectId, $scope[\"new\"].statusId, $scope[\"new\"].bulk);\n          promise.then(function(result) {\n            result = _.map(result.data, (function(_this) {\n              return function(x) {\n                return $model.make_model('userstories', x);\n              };\n            })(this));\n            currentLoading.finish();\n            $rootscope.$broadcast(\"usform:bulk:success\", result);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateBulkUserstories\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$tgModel\", CreateBulkUserstoriesDirective]);\n\n  AssignedToLightboxDirective = function(lightboxService, lightboxKeyboardNavigationService, $template, $compile, avatarService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var closeLightbox, filterUsers, normalizeString, render, selectedItem, selectedUser, usersTemplate;\n      selectedUser = null;\n      selectedItem = null;\n      usersTemplate = $template.get(\"common/lightbox/lightbox-assigned-to-users.html\", true);\n      normalizeString = function(string) {\n        var normalizedString;\n        normalizedString = string;\n        normalizedString = normalizedString.replace(\"Á\", \"A\").replace(\"Ä\", \"A\").replace(\"À\", \"A\");\n        normalizedString = normalizedString.replace(\"É\", \"E\").replace(\"Ë\", \"E\").replace(\"È\", \"E\");\n        normalizedString = normalizedString.replace(\"Í\", \"I\").replace(\"Ï\", \"I\").replace(\"Ì\", \"I\");\n        normalizedString = normalizedString.replace(\"Ó\", \"O\").replace(\"Ö\", \"O\").replace(\"Ò\", \"O\");\n        normalizedString = normalizedString.replace(\"Ú\", \"U\").replace(\"Ü\", \"U\").replace(\"Ù\", \"U\");\n        return normalizedString;\n      };\n      filterUsers = function(text, user) {\n        var username;\n        username = user.full_name_display.toUpperCase();\n        username = normalizeString(username);\n        text = text.toUpperCase();\n        text = normalizeString(text);\n        return _.includes(username, text);\n      };\n      render = function(selected, text) {\n        var ctx, html, users, visibleUsers;\n        users = _.clone($scope.activeUsers, true);\n        if (selected != null) {\n          users = _.reject(users, {\n            \"id\": selected.id\n          });\n        }\n        users = _.sortBy(users, function(o) {\n          if (o.id === $scope.user.id) {\n            return 0;\n          } else {\n            return o.id;\n          }\n        });\n        if (text != null) {\n          users = _.filter(users, _.partial(filterUsers, text));\n        }\n        visibleUsers = _.slice(users, 0, 5);\n        visibleUsers = _.map(visibleUsers, function(user) {\n          return user.avatar = avatarService.getAvatar(user);\n        });\n        if (selected) {\n          if (selected) {\n            selected.avatar = avatarService.getAvatar(selected);\n          }\n        }\n        ctx = {\n          selected: selected,\n          users: _.slice(users, 0, 5),\n          showMore: visibleUsers\n        };\n        html = usersTemplate(ctx);\n        html = $compile(html)($scope);\n        return $el.find(\".assigned-to-list\").html(html);\n      };\n      closeLightbox = function() {\n        lightboxKeyboardNavigationService.stop();\n        return lightboxService.close($el);\n      };\n      $scope.$on(\"assigned-to:add\", function(ctx, item) {\n        var assignedToId;\n        selectedItem = item;\n        assignedToId = item.assigned_to;\n        selectedUser = $scope.usersById[assignedToId];\n        render(selectedUser);\n        return lightboxService.open($el).then(function() {\n          $el.find('input').focus();\n          return lightboxKeyboardNavigationService.init($el);\n        });\n      });\n      $scope.$watch(\"usersSearch\", function(searchingText) {\n        if (searchingText != null) {\n          render(selectedUser, searchingText);\n          return $el.find('input').focus();\n        }\n      });\n      $el.on(\"click\", \".user-list-single\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        closeLightbox();\n        return $scope.$apply(function() {\n          $scope.$broadcast(\"assigned-to:added\", target.data(\"user-id\"), selectedItem);\n          return $scope.usersSearch = null;\n        });\n      });\n      $el.on(\"click\", \".remove-assigned-to\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        closeLightbox();\n        return $scope.$apply(function() {\n          $scope.usersSearch = null;\n          return $scope.$broadcast(\"assigned-to:added\", null, selectedItem);\n        });\n      });\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        closeLightbox();\n        return $scope.$apply(function() {\n          return $scope.usersSearch = null;\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-assigned-to.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbAssignedto\", [\"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", \"tgAvatarService\", AssignedToLightboxDirective]);\n\n  WatchersLightboxDirective = function($repo, lightboxService, lightboxKeyboardNavigationService, $template, $compile, avatarService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var closeLightbox, getFilteredUsers, render, selectedItem, usersTemplate;\n      selectedItem = null;\n      usersTemplate = $template.get(\"common/lightbox/lightbox-assigned-to-users.html\", true);\n      getFilteredUsers = function(text) {\n        var _filterUsers, users;\n        if (text == null) {\n          text = \"\";\n        }\n        _filterUsers = function(text, user) {\n          var username;\n          if (selectedItem && _.find(selectedItem.watchers, function(x) {\n            return x === user.id;\n          })) {\n            return false;\n          }\n          username = user.full_name_display.toUpperCase();\n          text = text.toUpperCase();\n          return _.includes(username, text);\n        };\n        users = _.clone($scope.activeUsers, true);\n        users = _.filter(users, _.partial(_filterUsers, text));\n        return users;\n      };\n      render = function(users) {\n        var ctx, html, visibleUsers;\n        visibleUsers = _.slice(users, 0, 5);\n        visibleUsers = _.map(visibleUsers, function(user) {\n          user.avatar = avatarService.getAvatar(user);\n          return user;\n        });\n        ctx = {\n          selected: false,\n          users: visibleUsers,\n          showMore: users.length > 5\n        };\n        html = usersTemplate(ctx);\n        html = $compile(html)($scope);\n        return $el.find(\".ticket-watchers\").html(html);\n      };\n      closeLightbox = function() {\n        lightboxKeyboardNavigationService.stop();\n        return lightboxService.close($el);\n      };\n      $scope.$on(\"watcher:add\", function(ctx, item) {\n        var users;\n        selectedItem = item;\n        users = getFilteredUsers();\n        render(users);\n        return lightboxService.open($el).then(function() {\n          $el.find(\"input\").focus();\n          return lightboxKeyboardNavigationService.init($el);\n        });\n      });\n      $scope.$watch(\"usersSearch\", function(searchingText) {\n        var users;\n        if (searchingText == null) {\n          return;\n        }\n        users = getFilteredUsers(searchingText);\n        render(users);\n        return $el.find(\"input\").focus();\n      });\n      $el.on(\"click\", \".user-list-single\", debounce(200, function(event) {\n        var target;\n        closeLightbox();\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return $scope.$apply(function() {\n          $scope.usersSearch = null;\n          return $scope.$broadcast(\"watcher:added\", target.data(\"user-id\"));\n        });\n      }));\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        closeLightbox();\n        return $scope.$apply(function() {\n          return $scope.usersSearch = null;\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-users.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbWatchers\", [\"$tgRepo\", \"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", \"tgAvatarService\", WatchersLightboxDirective]);\n\n  LightboxLeaveProjectWarningDirective = function(lightboxService, $template, $compile) {\n    var link;\n    link = function($scope, $el, attrs) {\n      return lightboxService.open($el);\n    };\n    return {\n      templateUrl: 'common/lightbox/lightbox-leave-project-warning.html',\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgLightboxLeaveProjectWarning\", [\"lightboxService\", LightboxLeaveProjectWarningDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/loader.coffee\n */\n\n(function() {\n  var Loader, LoaderDirective, module, sizeFormat, taiga, timeout;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaCommon\");\n\n  LoaderDirective = function(tgLoader, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      tgLoader.onStart(function() {\n        $(document.body).addClass(\"loader-active\");\n        return $el.addClass(\"active\");\n      });\n      return tgLoader.onEnd(function() {\n        $(document.body).removeClass(\"loader-active\");\n        return $el.removeClass(\"active\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLoader\", [\"tgLoader\", \"$rootScope\", LoaderDirective]);\n\n  Loader = function($rootscope) {\n    var autoClose, config, lastResponseDate, open, pageLoaded, requestCount, start, startLoadTime;\n    config = {\n      minTime: 300\n    };\n    open = false;\n    startLoadTime = 0;\n    requestCount = 0;\n    lastResponseDate = 0;\n    pageLoaded = function(force) {\n      var diff, endTime, timeoutValue;\n      if (force == null) {\n        force = false;\n      }\n      if (startLoadTime) {\n        timeoutValue = 0;\n        if (!force) {\n          endTime = new Date().getTime();\n          diff = endTime - startLoadTime;\n          if (diff < config.minTime) {\n            timeoutValue = config.minTime - diff;\n          }\n        }\n        timeout(timeoutValue, function() {\n          $rootscope.$broadcast(\"loader:end\");\n          open = false;\n          return window.prerenderReady = true;\n        });\n      }\n      startLoadTime = 0;\n      requestCount = 0;\n      return lastResponseDate = 0;\n    };\n    autoClose = function() {\n      var intervalAuto;\n      return intervalAuto = setInterval((function() {\n        if (lastResponseDate && requestCount === 0) {\n          pageLoaded();\n          return clearInterval(intervalAuto);\n        }\n      }), 50);\n    };\n    start = function() {\n      startLoadTime = new Date().getTime();\n      $rootscope.$broadcast(\"loader:start\");\n      return open = true;\n    };\n    return {\n      pageLoaded: pageLoaded,\n      start: function(auto) {\n        if (auto == null) {\n          auto = false;\n        }\n        if (!open) {\n          start();\n          if (auto) {\n            return autoClose();\n          }\n        }\n      },\n      onStart: function(fn) {\n        return $rootscope.$on(\"loader:start\", fn);\n      },\n      onEnd: function(fn) {\n        return $rootscope.$on(\"loader:end\", fn);\n      },\n      logRequest: function() {\n        return requestCount++;\n      },\n      logResponse: function() {\n        requestCount--;\n        return lastResponseDate = new Date().getTime();\n      }\n    };\n  };\n\n  Loader.$inject = [\"$rootScope\"];\n\n  module.factory(\"tgLoader\", Loader);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/lightboxes.coffee\n */\n\n(function() {\n  var LoadingDirective, TgLoadingService, module,\n    slice = [].slice;\n\n  module = angular.module(\"taigaCommon\");\n\n  TgLoadingService = function($compile) {\n    var spinner;\n    spinner = \"<img class='loading-spinner' src='/\" + window._version + \"/svg/spinner-circle.svg' alt='loading...' />\";\n    return function() {\n      var service;\n      service = {\n        settings: {\n          target: null,\n          scope: null,\n          classes: [],\n          timeout: 0,\n          template: null\n        },\n        target: function(target) {\n          service.settings.target = target;\n          return service;\n        },\n        scope: function(scope) {\n          service.settings.scope = scope;\n          return service;\n        },\n        template: function(template) {\n          service.settings.template = template;\n          return service;\n        },\n        removeClasses: function() {\n          var classess;\n          classess = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n          service.settings.classes = classess;\n          return service;\n        },\n        timeout: function(timeout) {\n          service.settings.timeout = timeout;\n          return service;\n        },\n        start: function() {\n          var target, timeoutId;\n          target = service.settings.target;\n          service.settings.classes.map(function(className) {\n            return target.removeClass(className);\n          });\n          if (!target.hasClass('loading') && !service.settings.template) {\n            service.settings.template = target.html();\n          }\n          timeoutId = setTimeout((function() {\n            if (!target.hasClass('loading')) {\n              target.addClass('loading');\n              return target.html(spinner);\n            }\n          }), service.settings.timeout);\n          service.settings.timeoutId = timeoutId;\n          return service;\n        },\n        finish: function() {\n          var removeClasses, target, timeoutId;\n          target = service.settings.target;\n          timeoutId = service.settings.timeoutId;\n          if (timeoutId) {\n            clearTimeout(timeoutId);\n            removeClasses = service.settings.classes;\n            removeClasses.map(function(className) {\n              return service.settings.target.addClass(className);\n            });\n            target.html(service.settings.template);\n            target.removeClass('loading');\n            if (service.settings.scope) {\n              $compile(target.contents())(service.settings.scope);\n            }\n          }\n          return service;\n        }\n      };\n      return service;\n    };\n  };\n\n  TgLoadingService.$inject = [\"$compile\"];\n\n  module.factory(\"$tgLoading\", TgLoadingService);\n\n  LoadingDirective = function($loading) {\n    var link;\n    link = function($scope, $el, attr) {\n      var currentLoading, template;\n      currentLoading = null;\n      template = $el.html();\n      return $scope.$watch(attr.tgLoading, (function(_this) {\n        return function(showLoading) {\n          if (showLoading) {\n            return currentLoading = $loading().target($el).timeout(100).template(template).scope($scope).start();\n          } else if (currentLoading) {\n            return currentLoading.finish();\n          }\n        };\n      })(this));\n    };\n    return {\n      priority: 99999,\n      link: link\n    };\n  };\n\n  module.directive(\"tgLoading\", [\"$tgLoading\", LoadingDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/popovers.coffee\n */\n\n(function() {\n  var RelatedTaskStatusDirective, UsStatusDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaCommon\");\n\n  UsStatusDirective = function($repo, $template) {\n\n    /*\n    Print the status of a US and a popover to change it.\n    - tg-us-status: The user story\n    - on-update: Method call after US is updated\n    \n    Example:\n    \n      div.status(tg-us-status=\"us\" on-update=\"ctrl.loadSprintState()\")\n        a.us-status(href=\"\", title=\"Status Name\")\n    \n    NOTE: This directive need 'usStatusById' and 'project'.\n     */\n    var link, template;\n    template = $template.get(\"common/popover/popover-us-status.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, render, us;\n      $ctrl = $el.controller();\n      render = function(us) {\n        var usStatusById, usStatusDom, usStatusDomParent;\n        usStatusDomParent = $el.find(\".us-status\");\n        usStatusDom = $el.find(\".us-status .us-status-bind\");\n        usStatusById = $scope.usStatusById;\n        if (usStatusById[us.status]) {\n          usStatusDom.text(usStatusById[us.status].name);\n          return usStatusDomParent.css(\"color\", usStatusById[us.status].color);\n        }\n      };\n      $el.on(\"click\", \".us-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", debounce(2000, function(event) {\n        var target, us;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        us = $scope.$eval($attrs.tgUsStatus);\n        us.status = target.data(\"status-id\");\n        render(us);\n        $el.find(\".pop-status\").popover().close();\n        return $scope.$apply(function() {\n          return $repo.save(us).then(function() {\n            return $scope.$eval($attrs.onUpdate);\n          });\n        });\n      }));\n      $scope.$on(\"userstories:loaded\", function() {\n        return render($scope.$eval($attrs.tgUsStatus));\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      us = $scope.$eval($attrs.tgUsStatus);\n      render(us);\n      return bindOnce($scope, \"project\", function(project) {\n        var html;\n        html = template({\n          \"statuses\": project.us_statuses\n        });\n        $el.append(html);\n        if ($scope.project.my_permissions.indexOf(\"modify_us\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUsStatus\", [\"$tgRepo\", \"$tgTemplate\", UsStatusDirective]);\n\n  RelatedTaskStatusDirective = function($repo, $template) {\n\n    /*\n    Print the status of a related task and a popover to change it.\n    - tg-related-task-status: The related task\n    - on-update: Method call after US is updated\n    \n    Example:\n    \n      div.status(tg-related-task-status=\"task\" on-update=\"ctrl.loadSprintState()\")\n        a.task-status(href=\"\", title=\"Status Name\")\n    \n    NOTE: This directive need 'taskStatusById' and 'project'.\n     */\n    var link, selectionTemplate, updateTaskStatus;\n    selectionTemplate = $template.get(\"common/popover/popover-related-task-status.html\", true);\n    updateTaskStatus = function($el, task, taskStatusById) {\n      var taskStatusDom, taskStatusDomParent;\n      taskStatusDomParent = $el.find(\".us-status\");\n      taskStatusDom = $el.find(\".task-status .task-status-bind\");\n      if (taskStatusById[task.status]) {\n        taskStatusDom.text(taskStatusById[task.status].name);\n        return taskStatusDomParent.css('color', taskStatusById[task.status].color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, autoSave, notAutoSave, task;\n      $ctrl = $el.controller();\n      task = $scope.$eval($attrs.tgRelatedTaskStatus);\n      notAutoSave = $scope.$eval($attrs.notAutoSave);\n      autoSave = !notAutoSave;\n      $el.on(\"click\", \".task-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        task.status = target.data(\"status-id\");\n        $el.find(\".pop-status\").popover().close();\n        updateTaskStatus($el, task, $scope.taskStatusById);\n        if (autoSave) {\n          return $scope.$apply(function() {\n            return $repo.save(task).then(function() {\n              $scope.$eval($attrs.onUpdate);\n              return $scope.$emit(\"related-tasks:status-changed\");\n            });\n          });\n        }\n      }));\n      $scope.$watch($attrs.tgRelatedTaskStatus, function() {\n        task = $scope.$eval($attrs.tgRelatedTaskStatus);\n        return updateTaskStatus($el, task, $scope.taskStatusById);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'statuses': project.task_statuses\n        }));\n        updateTaskStatus($el, task, $scope.taskStatusById);\n        if (project.my_permissions.indexOf(\"modify_task\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskStatus\", [\"$tgRepo\", \"$tgTemplate\", RelatedTaskStatusDirective]);\n\n  $.fn.popover = function() {\n    var $el, close, closeAll, closePopover, isVisible, open;\n    $el = this;\n    isVisible = (function(_this) {\n      return function() {\n        var docViewBottom, docViewLeft, docViewRight, docViewTop, docViewWidth, elemBottom, elemLeft, elemRight, elemTop, elemWidth;\n        $el.css({\n          \"display\": \"block\",\n          \"visibility\": \"hidden\"\n        });\n        docViewTop = $(window).scrollTop();\n        docViewBottom = docViewTop + $(window).height();\n        docViewWidth = $(window).width();\n        docViewRight = docViewWidth;\n        docViewLeft = 0;\n        elemTop = $el.offset().top;\n        elemBottom = elemTop + $el.height();\n        elemWidth = $el.width();\n        elemLeft = $el.offset().left;\n        elemRight = $el.offset().left + elemWidth;\n        $el.css({\n          \"display\": \"none\",\n          \"visibility\": \"visible\"\n        });\n        return (elemBottom <= docViewBottom) && (elemTop >= docViewTop) && (elemLeft >= docViewLeft) && (elemRight <= docViewRight);\n      };\n    })(this);\n    closePopover = (function(_this) {\n      return function(onClose) {\n        if (onClose) {\n          onClose.call($el);\n        }\n        $el.fadeOut(function() {\n          return $el.removeClass(\"active\").removeClass(\"fix\");\n        });\n        return $el.off(\"popup:close\");\n      };\n    })(this);\n    closeAll = (function(_this) {\n      return function() {\n        return $(\".popover.active\").each(function() {\n          return $(this).trigger(\"popup:close\");\n        });\n      };\n    })(this);\n    open = (function(_this) {\n      return function(onClose) {\n        if ($el.hasClass(\"active\")) {\n          return close();\n        } else {\n          closeAll();\n          if (!isVisible()) {\n            $el.addClass(\"fix\");\n          }\n          $el.fadeIn(function() {\n            $el.addClass(\"active\");\n            $(document.body).off(\"popover\");\n            return $(document.body).one(\"click.popover\", function() {\n              return closeAll();\n            });\n          });\n          return $el.on(\"popup:close\", function(e) {\n            return closePopover(onClose);\n          });\n        }\n      };\n    })(this);\n    close = (function(_this) {\n      return function() {\n        return $el.trigger(\"popup:close\");\n      };\n    })(this);\n    return {\n      open: open,\n      close: close,\n      closeAll: closeAll\n    };\n  };\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/raven-logger.coffee\n */\n\n(function() {\n  var ExceptionHandlerFactory, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  ExceptionHandlerFactory = function($log, config) {\n    var ravenConfig;\n    this.config = config;\n    ravenConfig = this.config.get(\"ravenConfig\", null);\n    if (ravenConfig) {\n      $log.debug(\"Using the RavenJS exception handler.\");\n      Raven.config(ravenConfig).install();\n      return function(exception, cause) {\n        $log.error.apply($log, arguments);\n        return Raven.captureException(exception);\n      };\n    } else {\n      $log.debug(\"Using the default logging exception handler.\");\n      return function(exception, cause) {\n        return $log.error.apply($log, arguments);\n      };\n    }\n  };\n\n  module.factory(\"$exceptionHandler\", [\"$log\", \"$tgConfig\", ExceptionHandlerFactory]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/tags.coffee\n */\n\n(function() {\n  var ColorizeTagsDirective, LbTagLineDirective, TagsDirective, bindOnce, module, taiga, trim,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  TagsDirective = function() {\n    var formatter, link, parser;\n    formatter = function(v) {\n      if (_.isArray(v)) {\n        return v.join(\", \");\n      }\n      return \"\";\n    };\n    parser = function(v) {\n      var result;\n      if (!v) {\n        return [];\n      }\n      result = _(v.split(\",\")).map(function(x) {\n        return _.trim(x);\n      });\n      return result.value();\n    };\n    link = function($scope, $el, $attrs, $ctrl) {\n      $ctrl.$formatters.push(formatter);\n      $ctrl.$parsers.push(parser);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      require: \"ngModel\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgTags\", TagsDirective);\n\n  ColorizeTagsDirective = function() {\n    var link, templates;\n    templates = {\n      backlog: _.template(\"<% _.each(tags, function(tag) { %>\\n    <span class=\\\"tag\\\"\\n        <% if (tag[1] !== null) { %>\\n            style=\\\"border-left: 5px solid <%- tag[1] %>\\\"\\n        <% } %>\\n        title=\\\"<%- tag[0] %>\\\"><%- tag[0] %></span>\\n<% }) %>\"),\n      kanban: _.template(\"<% _.each(tags, function(tag) { %>\\n    <a class=\\\"kanban-tag\\\"\\n        href=\\\"\\\"\\n        <% if (tag[1] !== null) { %>\\n            style=\\\"border-color: <%- tag[1] %>\\\"\\n        <% } %>\\n        title=\\\"<%- tag[0] %>\\\" />\\n<% }) %>\"),\n      taskboard: _.template(\"<% _.each(tags, function(tag) { %>\\n    <a class=\\\"taskboard-tag\\\"\\n        href=\\\"\\\"\\n        <% if (tag[1] !== null) { %>\\n            style=\\\"border-color: <%- tag[1] %>\\\"\\n        <% } %>\\n        title=\\\"<%- tag[0] %>\\\" />\\n<% }) %>\")\n    };\n    link = function($scope, $el, $attrs, $ctrl) {\n      var render;\n      render = function(tags) {\n        var html, template;\n        template = templates[$attrs.tgColorizeTagsType];\n        html = template({\n          tags: tags\n        });\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.tgColorizeTags, function(tags) {\n        if (tags != null) {\n          return render(tags);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgColorizeTags\", ColorizeTagsDirective);\n\n  LbTagLineDirective = function($rs, $template, $compile) {\n    var COMMA_KEY, ENTER_KEY, autocomplete, link, templateTags;\n    ENTER_KEY = 13;\n    COMMA_KEY = 188;\n    templateTags = $template.get(\"common/tag/lb-tag-line-tags.html\", true);\n    autocomplete = null;\n    link = function($scope, $el, $attrs, $model) {\n      var addValue, deleteValue, hideSaveButton, renderTags, resetInput, saveInputTag, showSaveButton, withoutColors;\n      withoutColors = _.has($attrs, \"withoutColors\");\n      renderTags = function(tags, tagsColors) {\n        var color, ctx, html;\n        if (tagsColors == null) {\n          tagsColors = [];\n        }\n        color = !withoutColors ? tagsColors[t] : null;\n        ctx = {\n          tags: _.map(tags, function(t) {\n            return {\n              name: t,\n              style: color ? \"border-left: 5px solid \" + color : \"\"\n            };\n          })\n        };\n        html = $compile(templateTags(ctx))($scope);\n        return $el.find(\".tags-container\").html(html);\n      };\n      showSaveButton = function() {\n        return $el.find(\".save\").removeClass(\"hidden\");\n      };\n      hideSaveButton = function() {\n        return $el.find(\".save\").addClass(\"hidden\");\n      };\n      resetInput = function() {\n        $el.find(\"input\").val(\"\");\n        return autocomplete.close();\n      };\n      addValue = function(value) {\n        var tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue, false);\n        if (tags == null) {\n          tags = [];\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        $scope.$apply(function() {\n          return $model.$setViewValue(tags);\n        });\n        return hideSaveButton();\n      };\n      deleteValue = function(value) {\n        var tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue, false);\n        tags = _.pull(tags, value);\n        return $scope.$apply(function() {\n          return $model.$setViewValue(tags);\n        });\n      };\n      saveInputTag = function() {\n        var value;\n        value = $el.find(\"input\").val();\n        addValue(value);\n        return resetInput();\n      };\n      $el.on(\"keypress\", \"input\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if (event.keyCode === ENTER_KEY) {\n          event.preventDefault();\n          return saveInputTag();\n        } else if (String.fromCharCode(event.keyCode) === ',') {\n          event.preventDefault();\n          return saveInputTag();\n        } else {\n          if (target.val().length) {\n            return showSaveButton();\n          } else {\n            return hideSaveButton();\n          }\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return saveInputTag();\n      });\n      $el.on(\"click\", \".remove-tag\", function(event) {\n        var target, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        value = target.siblings(\".tag-name\").text();\n        return deleteValue(value);\n      });\n      bindOnce($scope, \"project\", function(project) {\n        var input;\n        input = $el.find(\"input\");\n        autocomplete = new Awesomplete(input[0], {\n          list: _.keys(project.tags_colors)\n        });\n        return input.on(\"awesomplete-selectcomplete\", function() {\n          addValue(input.val());\n          return input.val(\"\");\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(tags) {\n        var ref, tagsColors;\n        tagsColors = ((ref = $scope.project) != null ? ref.tags_colors : void 0) || [];\n        return renderTags(tags, tagsColors);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\",\n      templateUrl: \"common/tag/lb-tag-line.html\"\n    };\n  };\n\n  module.directive(\"tgLbTagLine\", [\"$tgResources\", \"$tgTemplate\", \"$compile\", LbTagLineDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/wisiwyg.coffee\n */\n\n(function() {\n  var MarkitupDirective, bindOnce, module, taiga,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  MarkitupDirective = function($rootscope, $rs, $selectedText, $template, $compile, $translate) {\n    var link, previewTemplate;\n    previewTemplate = $template.get(\"common/wysiwyg/wysiwyg-markitup-preview.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var addLine, cancelablePromise, closePreviewMode, element, markdownTitle, prepareUrlFormatting, preview, previewDomNode, previewInProgress, renderMarkItUp, setCaretPosition, unbind, urlFormatting;\n      element = angular.element($el);\n      previewDomNode = $(\"<div/>\", {\n        \"class\": \"preview\"\n      });\n      closePreviewMode = function() {\n        element.parents(\".markdown\").find(\".preview\").remove();\n        return element.parents(\".markItUp\").show();\n      };\n      $scope.$on(\"markdown-editor:submit\", function() {\n        return closePreviewMode();\n      });\n      cancelablePromise = null;\n      previewInProgress = false;\n      preview = function() {\n        var markItUpDomNode, markdownDomNode;\n        if (previewInProgress) {\n          return;\n        }\n        previewInProgress = true;\n        markdownDomNode = element.parents(\".markdown\");\n        markItUpDomNode = element.parents(\".markItUp\");\n        return $rs.mdrender.render($scope.projectId || $scope.vm.projectId, $model.$modelValue).then(function(data) {\n          var html, markdown;\n          html = previewTemplate({\n            data: data.data\n          });\n          html = $compile(html)($scope);\n          markdownDomNode.append(html);\n          markItUpDomNode.hide();\n          previewInProgress = false;\n          markdown = element.closest(\".markdown\");\n          return markdown.on(\"mouseup.preview\", \".preview\", function(event) {\n            var target;\n            event.preventDefault();\n            target = angular.element(event.target);\n            if (!target.is('a') && $selectedText.get().length) {\n              return;\n            }\n            markdown.off(\".preview\");\n            return closePreviewMode();\n          });\n        });\n      };\n      setCaretPosition = function(textarea, caretPosition) {\n        var line, range, scrollRelation, totalLines;\n        if (textarea.createTextRange) {\n          range = textarea.createTextRange();\n          range.move(\"character\", caretPosition);\n          range.select();\n        } else if (textarea.selectionStart) {\n          textarea.focus();\n          textarea.setSelectionRange(caretPosition, caretPosition);\n        }\n        totalLines = textarea.value.split(\"\\n\").length;\n        line = textarea.value.slice(0, +(caretPosition - 1) + 1 || 9e9).split(\"\\n\").length;\n        scrollRelation = line / totalLines;\n        return $el.scrollTop((scrollRelation * $el[0].scrollHeight) - ($el.height() / 2));\n      };\n      addLine = function(textarea, nline, replace) {\n        var cursorPosition, j, key, len, line, lines;\n        lines = textarea.value.split(\"\\n\");\n        if (replace) {\n          lines[nline] = replace + lines[nline];\n        } else {\n          lines[nline] = \"\";\n        }\n        cursorPosition = 0;\n        for (key = j = 0, len = lines.length; j < len; key = ++j) {\n          line = lines[key];\n          cursorPosition += line.length + 1 || 1;\n          if (key === nline) {\n            break;\n          }\n        }\n        textarea.value = lines.join(\"\\n\");\n        if (replace) {\n          return cursorPosition - lines[nline].length + replace.length - 1;\n        } else {\n          return cursorPosition;\n        }\n      };\n      prepareUrlFormatting = function(markItUp) {\n        var indices, regex, result;\n        regex = /(<<<|>>>)/gi;\n        result = 0;\n        indices = [];\n        while ((result = regex.exec(markItUp.textarea.value))) {\n          indices.push(result.index);\n        }\n        return markItUp.donotparse = indices;\n      };\n      urlFormatting = function(markItUp) {\n        var endIndex, ref, ref1, regex, result, startIndex, url, value;\n        regex = /<<</gi;\n        result = 0;\n        startIndex = 0;\n        while (true) {\n          result = regex.exec(markItUp.textarea.value);\n          if (!result) {\n            break;\n          }\n          if (ref = result.index, indexOf.call(markItUp.donotparse, ref) < 0) {\n            startIndex = result.index;\n            break;\n          }\n        }\n        if (!result) {\n          return;\n        }\n        regex = />>>/gi;\n        endIndex = 0;\n        while (true) {\n          result = regex.exec(markItUp.textarea.value);\n          if (!result) {\n            break;\n          }\n          if (ref1 = result.index, indexOf.call(markItUp.donotparse, ref1) < 0) {\n            endIndex = result.index;\n            break;\n          }\n        }\n        value = markItUp.textarea.value;\n        url = value.substring(startIndex, endIndex).replace('<<<', '').replace('>>>', '');\n        url = url.replace('(', '%28').replace(')', '%29');\n        url = url.replace('[', '%5B').replace(']', '%5D');\n        value = value.substring(0, startIndex) + url + value.substring(endIndex + 3, value.length);\n        markItUp.textarea.value = value;\n        return markItUp.donotparse = void 0;\n      };\n      markdownTitle = function(markItUp, char) {\n        var heading, i, j, n, ref;\n        heading = \"\";\n        n = $.trim(markItUp.selection || markItUp.placeHolder).length;\n        for (i = j = 0, ref = n - 1; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {\n          heading += char;\n        }\n        return \"\\n\" + heading + \"\\n\";\n      };\n      renderMarkItUp = function() {\n        var markdownSettings;\n        markdownSettings = {\n          nameSpace: \"markdown\",\n          onShiftEnter: {\n            keepDefault: false,\n            openWith: \"\\n\\n\"\n          },\n          onEnter: {\n            keepDefault: false,\n            replaceWith: function() {\n              if (!$('.textcomplete-dropdown').is(':visible')) {\n                return \"\\n\";\n              }\n            },\n            afterInsert: function(data) {\n              var cursorLine, emptyListItem, lastLine, lines, markdownCaretPositon, match, newLineContent, nline, replace;\n              lines = data.textarea.value.split(\"\\n\");\n              if (data.caretPosition > 0) {\n                cursorLine = data.textarea.value.slice(0, +(data.caretPosition - 1) + 1 || 9e9).split(\"\\n\").length;\n              } else {\n                cursorLine = 1;\n              }\n              newLineContent = data.textarea.value.slice(data.caretPosition).split(\"\\n\")[0];\n              lastLine = lines[cursorLine - 1];\n              match = lastLine.match(/^(\\s*- ).*/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*)\\-\\s$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = \"\" + match[1];\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              match = lastLine.match(/^(\\s*\\* ).*/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*\\* )$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = \"\" + match[1];\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              match = lastLine.match(/^(\\s*)(\\d+)\\.\\s/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*)(\\d+)\\.\\s$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = (match[1] + (parseInt(match[2], 10) + 1)) + \". \";\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              if (markdownCaretPositon) {\n                return setCaretPosition(data.textarea, markdownCaretPositon);\n              }\n            }\n          },\n          markupSet: [\n            {\n              name: $translate.instant(\"COMMON.WYSIWYG.H1_BUTTON\"),\n              key: \"1\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H1_SAMPLE_TEXT\"),\n              closeWith: function(markItUp) {\n                return markdownTitle(markItUp, \"=\");\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.H2_BUTTON\"),\n              key: \"2\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H2_SAMPLE_TEXT\"),\n              closeWith: function(markItUp) {\n                return markdownTitle(markItUp, \"-\");\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.H3_BUTTON\"),\n              key: \"3\",\n              openWith: \"### \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H3_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.BOLD_BUTTON\"),\n              key: \"B\",\n              openWith: \"**\",\n              closeWith: \"**\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.BOLD_BUTTON_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT\"),\n              key: \"I\",\n              openWith: \"_\",\n              closeWith: \"_\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.STRIKE_BUTTON\"),\n              key: \"S\",\n              openWith: \"~~\",\n              closeWith: \"~~\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.STRIKE_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.BULLETED_LIST_BUTTON\"),\n              openWith: \"- \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.BULLETED_LIST_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.NUMERIC_LIST_BUTTON\"),\n              openWith: function(markItUp) {\n                return markItUp.line + \". \";\n              },\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.NUMERIC_LIST_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.PICTURE_BUTTON\"),\n              key: \"P\",\n              openWith: \"![\",\n              closeWith: '](<<<[![Url:!:http://]!]>>> \"[![Title]!]\")',\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.PICTURE_SAMPLE_TEXT\"),\n              beforeInsert: function(markItUp) {\n                return prepareUrlFormatting(markItUp);\n              },\n              afterInsert: function(markItUp) {\n                return urlFormatting(markItUp);\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.LINK_BUTTON\"),\n              key: \"L\",\n              openWith: \"[\",\n              closeWith: '](<<<[![Url:!:http://]!]>>> \"[![Title]!]\")',\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.LINK_SAMPLE_TEXT\"),\n              beforeInsert: function(markItUp) {\n                return prepareUrlFormatting(markItUp);\n              },\n              afterInsert: function(markItUp) {\n                return urlFormatting(markItUp);\n              }\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.QUOTE_BLOCK_BUTTON\"),\n              openWith: \"> \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.QUOTE_BLOCK_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.CODE_BLOCK_BUTTON\"),\n              openWith: \"```\\n\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.CODE_BLOCK_SAMPLE_TEXT\"),\n              closeWith: \"\\n```\"\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.PREVIEW_BUTTON\"),\n              call: preview,\n              className: \"preview-icon\"\n            }\n          ],\n          afterInsert: function(event) {\n            var target;\n            target = angular.element(event.textarea);\n            return $model.$setViewValue(target.val());\n          }\n        };\n        return element.markItUpRemove().markItUp(markdownSettings).textcomplete([\n          {\n            cache: true,\n            match: /(^|\\s)#([a-z0-9]+)$/i,\n            search: function(term, callback) {\n              var filter, searchProps, searchTypes;\n              term = taiga.slugify(term);\n              searchTypes = ['issues', 'tasks', 'userstories', 'epics'];\n              searchProps = ['ref', 'subject'];\n              filter = (function(_this) {\n                return function(item) {\n                  var j, len, prop;\n                  for (j = 0, len = searchProps.length; j < len; j++) {\n                    prop = searchProps[j];\n                    if (taiga.slugify(item[prop]).indexOf(term) >= 0) {\n                      return true;\n                    }\n                  }\n                  return false;\n                };\n              })(this);\n              if (cancelablePromise) {\n                cancelablePromise.abort();\n              }\n              cancelablePromise = $rs.search[\"do\"]($scope.projectId || $scope.vm.projectId, term);\n              cancelablePromise.then((function(_this) {\n                return function(res) {\n                  var j, len, results, type;\n                  if (res.count < 1 || res.count === res.wikipages.length) {\n                    return callback([]);\n                  } else {\n                    results = [];\n                    for (j = 0, len = searchTypes.length; j < len; j++) {\n                      type = searchTypes[j];\n                      if (res[type] && res[type].length > 0) {\n                        results.push(callback(res[type].filter(filter), true));\n                      } else {\n                        results.push(void 0);\n                      }\n                    }\n                    return results;\n                  }\n                };\n              })(this));\n              return callback([]);\n            },\n            replace: function(res) {\n              return \"$1\\#\" + res.ref + \" \";\n            },\n            template: function(res, term) {\n              return \"\\#\" + res.ref + \" - \" + res.subject;\n            }\n          }, {\n            cache: true,\n            match: /(^|\\s)@([a-z0-9\\-\\._]{2,})$/i,\n            search: function(term, callback) {\n              var searchProps, username;\n              username = taiga.slugify(term);\n              searchProps = ['username', 'full_name', 'full_name_display'];\n              if ($scope.project.members.length < 1) {\n                return callback([]);\n              } else {\n                return callback($scope.project.members.filter((function(_this) {\n                  return function(user) {\n                    var j, len, prop;\n                    for (j = 0, len = searchProps.length; j < len; j++) {\n                      prop = searchProps[j];\n                      if (taiga.slugify(user[prop]).indexOf(username) >= 0) {\n                        return true;\n                      }\n                    }\n                    return false;\n                  };\n                })(this)));\n              }\n            },\n            replace: function(user) {\n              return \"$1@\" + user.username + \" \";\n            },\n            template: function(user) {\n              return user.username + \" - \" + user.full_name_display;\n            }\n          }, {\n            cache: true,\n            match: /(^|\\s)\\[\\[([a-z0-9\\-]+)$/i,\n            search: function(term, callback) {\n              term = taiga.slugify(term);\n              return $rs.search[\"do\"]($scope.projectId || $scope.vm.projectId, term).then((function(_this) {\n                return function(res) {\n                  if (res.count < 1) {\n                    callback([]);\n                  }\n                  if (res.count < 1 || !res.wikipages || res.wikipages.length <= 0) {\n                    callback([]);\n                  } else {\n                    callback(res.wikipages.filter(function(page) {\n                      return taiga.slugify(page['slug']).indexOf(term) >= 0;\n                    }), true);\n                  }\n                  return callback([]);\n                };\n              })(this));\n            },\n            replace: function(res) {\n              return \"$1[[\" + res.slug + \"]]\";\n            },\n            template: function(res, term) {\n              return res.slug;\n            }\n          }\n        ], {\n          debounce: 200\n        });\n      };\n      renderMarkItUp();\n      unbind = $rootscope.$on(\"$translateChangeEnd\", renderMarkItUp);\n      element.on(\"keypress\", function(event) {\n        return $scope.$apply();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return unbind();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgMarkitup\", [\"$rootScope\", \"$tgResources\", \"$selectedText\", \"$tgTemplate\", \"$compile\", \"$translate\", MarkitupDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/lightboxes.coffee\n */\n\n(function() {\n  var CreateEditSprint, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaBacklog\");\n\n  CreateEditSprint = function($repo, $confirm, $rs, $rootscope, lightboxService, $loading, $translate) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var createSprint, form, getLastSprint, hasErrors, remove, resetSprint, submit;\n      hasErrors = false;\n      createSprint = true;\n      form = null;\n      resetSprint = function() {\n        if (form) {\n          form.reset();\n        }\n        return $scope.sprint = {\n          project: null,\n          name: null,\n          estimated_start: null,\n          estimated_finish: null\n        };\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, newSprint, prettyDate, promise, submitButton, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n          submitButton = $el.find(\".submit-button\");\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            hasErrors = true;\n            $el.find(\".last-sprint-name\").addClass(\"disappear\");\n            return;\n          }\n          hasErrors = false;\n          newSprint = angular.copy($scope.sprint);\n          broadcastEvent = null;\n          if (createSprint) {\n            newSprint.estimated_start = moment(newSprint.estimated_start, prettyDate).format(\"YYYY-MM-DD\");\n            newSprint.estimated_finish = moment(newSprint.estimated_finish, prettyDate).format(\"YYYY-MM-DD\");\n            promise = $repo.create(\"milestones\", newSprint);\n            broadcastEvent = \"sprintform:create:success\";\n          } else {\n            newSprint.setAttr(\"estimated_start\", moment(newSprint.estimated_start, prettyDate).format(\"YYYY-MM-DD\"));\n            newSprint.setAttr(\"estimated_finish\", moment(newSprint.estimated_finish, prettyDate).format(\"YYYY-MM-DD\"));\n            promise = $repo.save(newSprint);\n            broadcastEvent = \"sprintform:edit:success\";\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise.then(function(data) {\n            currentLoading.finish();\n            if (createSprint) {\n              $scope.sprintsCounter += 1;\n            }\n            $rootscope.$broadcast(broadcastEvent, data);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"light-error\", data._error_message);\n            } else if (data.__all__) {\n              return $confirm.notify(\"light-error\", data.__all__[0]);\n            }\n          });\n        };\n      })(this));\n      remove = function() {\n        var message, title;\n        title = $translate.instant(\"LIGHTBOX.DELETE_SPRINT.TITLE\");\n        message = $scope.sprint.name;\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var onError, onSuccess;\n            onSuccess = function() {\n              askResponse.finish();\n              $scope.milestonesCounter -= 1;\n              lightboxService.close($el);\n              return $rootscope.$broadcast(\"sprintform:remove:success\", $scope.sprint);\n            };\n            onError = function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            };\n            return $repo.remove($scope.sprint).then(onSuccess, onError);\n          };\n        })(this));\n      };\n      getLastSprint = function() {\n        var openSprints, sortedSprints;\n        openSprints = _.filter($scope.sprints, function(sprint) {\n          return !sprint.closed;\n        });\n        sortedSprints = _.sortBy(openSprints, function(sprint) {\n          return moment(sprint.estimated_finish, 'YYYY-MM-DD').format('X');\n        });\n        return sortedSprints[sortedSprints.length - 1];\n      };\n      $scope.$on(\"sprintform:create\", function(event, projectId) {\n        var estimatedFinish, estimatedStart, lastSprint, lastSprintNameDom, prettyDate, text;\n        resetSprint();\n        form = $el.find(\"form\").checksley();\n        form.reset();\n        createSprint = true;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        $scope.sprint.project = projectId;\n        $scope.sprint.name = null;\n        $scope.sprint.slug = null;\n        lastSprint = getLastSprint();\n        estimatedStart = moment();\n        if (lastSprint) {\n          estimatedStart = moment(lastSprint.estimated_finish);\n        } else if ($scope.sprint.estimated_start) {\n          estimatedStart = moment($scope.sprint.estimated_start);\n        }\n        $scope.sprint.estimated_start = estimatedStart.format(prettyDate);\n        estimatedFinish = moment().add(2, \"weeks\");\n        if (lastSprint) {\n          estimatedFinish = moment(lastSprint.estimated_finish).add(2, \"weeks\");\n        } else if ($scope.sprint.estimated_finish) {\n          estimatedFinish = moment($scope.sprint.estimated_finish);\n        }\n        $scope.sprint.estimated_finish = estimatedFinish.format(prettyDate);\n        lastSprintNameDom = $el.find(\".last-sprint-name\");\n        if ((lastSprint != null ? lastSprint.name : void 0) != null) {\n          text = $translate.instant(\"LIGHTBOX.ADD_EDIT_SPRINT.LAST_SPRINT_NAME\", {\n            lastSprint: lastSprint.name\n          });\n          lastSprintNameDom.html(text);\n        }\n        $el.find(\".delete-sprint\").addClass(\"hidden\");\n        text = $translate.instant(\"LIGHTBOX.ADD_EDIT_SPRINT.TITLE\");\n        $el.find(\".title\").text(text);\n        text = $translate.instant(\"COMMON.CREATE\");\n        $el.find(\".button-green\").text(text);\n        lightboxService.open($el);\n        $el.find(\".sprint-name\").focus();\n        return $el.find(\".last-sprint-name\").removeClass(\"disappear\");\n      });\n      $scope.$on(\"sprintform:edit\", function(ctx, sprint) {\n        var editSprint, prettyDate, save;\n        resetSprint();\n        createSprint = false;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        $scope.$apply(function() {\n          $scope.sprint = sprint;\n          $scope.sprint.estimated_start = moment($scope.sprint.estimated_start).format(prettyDate);\n          return $scope.sprint.estimated_finish = moment($scope.sprint.estimated_finish).format(prettyDate);\n        });\n        $el.find(\".delete-sprint\").removeClass(\"hidden\");\n        editSprint = $translate.instant(\"BACKLOG.EDIT_SPRINT\");\n        $el.find(\".title\").text(editSprint);\n        save = $translate.instant(\"COMMON.SAVE\");\n        $el.find(\".button-green\").text(save);\n        lightboxService.open($el);\n        $el.find(\".sprint-name\").focus().select();\n        return $el.find(\".last-sprint-name\").addClass(\"disappear\");\n      });\n      $el.on(\"keyup\", \".sprint-name\", function(event) {\n        if ($el.find(\".sprint-name\").val().length > 0 || hasErrors) {\n          return $el.find(\".last-sprint-name\").addClass(\"disappear\");\n        } else {\n          return $el.find(\".last-sprint-name\").removeClass(\"disappear\");\n        }\n      });\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".delete-sprint\", function(event) {\n        event.preventDefault();\n        return remove();\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return resetSprint();\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateEditSprint\", [\"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$translate\", CreateEditSprint]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/main.coffee\n */\n\n(function() {\n  var BacklogController, BacklogDirective, BurndownBacklogGraphDirective, TgBacklogProgressBarDirective, ToggleBurndownVisibility, UsPointsDirective, UsRolePointsSelectorDirective, bindMethods, bindOnce, generateHash, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  generateHash = this.taiga.generateHash;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogController = (function(superClass) {\n    extend(BacklogController, superClass);\n\n    BacklogController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"$tgLoading\", \"tgResources\", \"$tgQueueModelTransformation\", \"tgErrorHandlingService\", \"$tgStorage\", \"tgFilterRemoteStorageService\"];\n\n    BacklogController.prototype.storeCustomFiltersName = 'backlog-custom-filters';\n\n    BacklogController.prototype.storeFiltersName = 'backlog-filters';\n\n    BacklogController.prototype.backlogOrder = {};\n\n    BacklogController.prototype.milestonesOrder = {};\n\n    function BacklogController(scope1, rootscope, repo, confirm, rs, params1, q, location, appMetaService, navUrls, events, analytics, translate, loading, rs2, modelTransform, errorHandlingService, storage, filterRemoteStorageService) {\n      var promise;\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params1;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.loading = loading;\n      this.rs2 = rs2;\n      this.modelTransform = modelTransform;\n      this.errorHandlingService = errorHandlingService;\n      this.storage = storage;\n      this.filterRemoteStorageService = filterRemoteStorageService;\n      bindMethods(this);\n      this.backlogOrder = {};\n      this.milestonesOrder = {};\n      this.page = 1;\n      this.disablePagination = false;\n      this.firstLoadComplete = false;\n      this.scope.userstories = [];\n      if (this.applyStoredFilters(this.params.pslug, \"backlog-filters\")) {\n        return;\n      }\n      this.scope.sectionName = this.translate.instant(\"BACKLOG.SECTION_NAME\");\n      this.showTags = false;\n      this.activeFilters = false;\n      this.scope.showGraphPlaceholder = null;\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          _this.firstLoadComplete = true;\n          title = _this.translate.instant(\"BACKLOG.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"BACKLOG.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          _this.appMetaService.setAll(title, description);\n          if (_this.rs.userstories.getShowTags(_this.scope.projectId)) {\n            _this.showTags = true;\n            return _this.scope.$broadcast(\"showTags\", _this.showTags);\n          }\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    BacklogController.prototype.filtersReloadContent = function() {\n      return this.loadUserstories(true);\n    };\n\n    BacklogController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"usform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories(true);\n          _this.loadProjectStats();\n          _this.confirm.notify(\"success\");\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"bulk create userstory on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"sprintform:create:success\", (function(_this) {\n        return function() {\n          _this.loadSprints();\n          _this.loadProjectStats();\n          _this.confirm.notify(\"success\");\n          return _this.analytics.trackEvent(\"sprint\", \"create\", \"create sprint on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:new:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories(true);\n          _this.loadProjectStats();\n          _this.rootscope.$broadcast(\"filters:update\");\n          _this.confirm.notify(\"success\");\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"create userstory on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"sprintform:edit:success\", (function(_this) {\n        return function() {\n          return _this.loadProjectStats();\n        };\n      })(this));\n      this.scope.$on(\"sprintform:remove:success\", (function(_this) {\n        return function(event, sprint) {\n          _this.loadSprints();\n          _this.loadProjectStats();\n          _this.loadUserstories(true);\n          if (sprint.closed) {\n            _this.loadClosedSprints();\n          }\n          return _this.rootscope.$broadcast(\"filters:update\");\n        };\n      })(this));\n      this.scope.$on(\"usform:edit:success\", (function(_this) {\n        return function(event, data) {\n          var index;\n          index = _.findIndex(_this.scope.userstories, function(us) {\n            return us.id === data.id;\n          });\n          _this.scope.userstories[index] = data;\n          return _this.rootscope.$broadcast(\"filters:update\");\n        };\n      })(this));\n      this.scope.$on(\"sprint:us:move\", this.moveUs);\n      this.scope.$on(\"sprint:us:moved\", (function(_this) {\n        return function() {\n          _this.loadSprints();\n          return _this.loadProjectStats();\n        };\n      })(this));\n      this.scope.$on(\"backlog:load-closed-sprints\", this.loadClosedSprints);\n      return this.scope.$on(\"backlog:unload-closed-sprints\", this.unloadClosedSprints);\n    };\n\n    BacklogController.prototype.initializeSubscription = function() {\n      var routingKey1, routingKey2;\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          _this.loadAllPaginatedUserstories();\n          return _this.loadSprints();\n        };\n      })(this));\n      routingKey2 = \"changes.project.\" + this.scope.projectId + \".milestones\";\n      return this.events.subscribe(this.scope, routingKey2, (function(_this) {\n        return function(message) {\n          return _this.loadSprints();\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.toggleShowTags = function() {\n      return this.scope.$apply((function(_this) {\n        return function() {\n          _this.showTags = !_this.showTags;\n          return _this.rs.userstories.storeShowTags(_this.scope.projectId, _this.showTags);\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.toggleActiveFilters = function() {\n      return this.activeFilters = !this.activeFilters;\n    };\n\n    BacklogController.prototype.loadProjectStats = function() {\n      return this.rs.projects.stats(this.scope.projectId).then((function(_this) {\n        return function(stats) {\n          var totalPoints;\n          _this.scope.stats = stats;\n          totalPoints = stats.total_points ? stats.total_points : stats.defined_points;\n          if (totalPoints) {\n            _this.scope.stats.completedPercentage = Math.round(100 * stats.closed_points / totalPoints);\n          } else {\n            _this.scope.stats.completedPercentage = 0;\n          }\n          _this.scope.showGraphPlaceholder = !((stats.total_points != null) && (stats.total_milestones != null));\n          return stats;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.setMilestonesOrder = function(sprints) {\n      var it, j, len, results, sprint;\n      results = [];\n      for (j = 0, len = sprints.length; j < len; j++) {\n        sprint = sprints[j];\n        this.milestonesOrder[sprint.id] = {};\n        results.push((function() {\n          var l, len1, ref1, results1;\n          ref1 = sprint.user_stories;\n          results1 = [];\n          for (l = 0, len1 = ref1.length; l < len1; l++) {\n            it = ref1[l];\n            results1.push(this.milestonesOrder[sprint.id][it.id] = it.sprint_order);\n          }\n          return results1;\n        }).call(this));\n      }\n      return results;\n    };\n\n    BacklogController.prototype.unloadClosedSprints = function() {\n      return this.scope.$apply((function(_this) {\n        return function() {\n          _this.scope.closedSprints = [];\n          return _this.rootscope.$broadcast(\"closed-sprints:reloaded\", []);\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadClosedSprints = function() {\n      var params;\n      params = {\n        closed: true\n      };\n      return this.rs.sprints.list(this.scope.projectId, params).then((function(_this) {\n        return function(result) {\n          var j, len, sprint, sprints;\n          sprints = result.milestones;\n          _this.setMilestonesOrder(sprints);\n          _this.scope.totalClosedMilestones = result.closed;\n          for (j = 0, len = sprints.length; j < len; j++) {\n            sprint = sprints[j];\n            sprint.user_stories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          }\n          _this.scope.closedSprints = sprints;\n          _this.scope.closedSprintsById = groupBy(sprints, function(x) {\n            return x.id;\n          });\n          _this.rootscope.$broadcast(\"closed-sprints:reloaded\", sprints);\n          return sprints;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadSprints = function() {\n      var params;\n      params = {\n        closed: false\n      };\n      return this.rs.sprints.list(this.scope.projectId, params).then((function(_this) {\n        return function(result) {\n          var j, len, sprint, sprints;\n          sprints = result.milestones;\n          _this.setMilestonesOrder(sprints);\n          _this.scope.totalMilestones = sprints;\n          _this.scope.totalClosedMilestones = result.closed;\n          _this.scope.totalOpenMilestones = result.open;\n          _this.scope.totalMilestones = _this.scope.totalOpenMilestones + _this.scope.totalClosedMilestones;\n          for (j = 0, len = sprints.length; j < len; j++) {\n            sprint = sprints[j];\n            sprint.user_stories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          }\n          _this.scope.sprints = sprints;\n          _this.scope.openSprints = _.filter(sprints, function(sprint) {\n            return !sprint.closed;\n          }).reverse();\n          if (!_this.scope.closedSprints) {\n            _this.scope.closedSprints = [];\n          }\n          _this.scope.sprintsCounter = sprints.length;\n          _this.scope.sprintsById = groupBy(sprints, function(x) {\n            return x.id;\n          });\n          _this.rootscope.$broadcast(\"sprints:loaded\", sprints);\n          _this.scope.currentSprint = _this.findCurrentSprint();\n          return sprints;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadAllPaginatedUserstories = function() {\n      var page;\n      page = this.page;\n      return this.loadUserstories(true, this.scope.userstories.length).then((function(_this) {\n        return function() {\n          return _this.page = page;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadUserstories = function(resetPagination, pageSize) {\n      var params, promise;\n      if (resetPagination == null) {\n        resetPagination = false;\n      }\n      if (!this.scope.projectId) {\n        return null;\n      }\n      this.loadingUserstories = true;\n      this.disablePagination = true;\n      params = _.clone(this.location.search());\n      this.rs.userstories.storeQueryParams(this.scope.projectId, params);\n      if (resetPagination) {\n        this.page = 1;\n      }\n      params.page = this.page;\n      promise = this.rs.userstories.listUnassigned(this.scope.projectId, params, pageSize);\n      return promise.then((function(_this) {\n        return function(result) {\n          var header, it, j, len, ref1, userstories;\n          userstories = result[0];\n          header = result[1];\n          if (resetPagination) {\n            _this.scope.userstories = [];\n          }\n          _this.scope.userstories = _this.scope.userstories.concat(_.sortBy(userstories, \"backlog_order\"));\n          ref1 = _this.scope.userstories;\n          for (j = 0, len = ref1.length; j < len; j++) {\n            it = ref1[j];\n            _this.backlogOrder[it.id] = it.backlog_order;\n          }\n          _this.loadingUserstories = false;\n          if (header('x-pagination-next')) {\n            _this.disablePagination = false;\n            _this.page++;\n          }\n          scopeDefer(_this.scope, function() {\n            return _this.scope.$broadcast(\"userstories:loaded\");\n          });\n          return userstories;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadBacklog = function() {\n      return this.q.all([this.loadProjectStats(), this.loadSprints(), this.loadUserstories()]);\n    };\n\n    BacklogController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_backlog_activated) {\n            _this.errorHandlingService.permissionDenied();\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.closedMilestones = !!project.total_closed_milestones;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.points = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"id\");\n          return project;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.initializeSubscription();\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function() {\n          return _this.loadBacklog();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.generateFilters();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.scope.$emit(\"backlog:loaded\");\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.prepareBulkUpdateData = function(uses, field) {\n      if (field == null) {\n        field = \"backlog_order\";\n      }\n      return _.map(uses, function(x) {\n        return {\n          \"us_id\": x.id,\n          \"order\": x[field]\n        };\n      });\n    };\n\n    BacklogController.prototype.moveUs = function(ctx, usList, newUsIndex, newSprintId) {\n      var afterDestination, beforeDestination, currentSprintId, data, it, j, key, l, len, len1, len2, len3, len4, len5, len6, list, m, modifiedUs, n, newSprint, o, oldSprintId, options, orderField, orderList, p, previous, previousWithTheSameOrder, project, promise, q, ref1, ref2, setOrders, setPreviousOrders, sprint, startIndex, us;\n      oldSprintId = usList[0].milestone;\n      project = usList[0].project;\n      if (oldSprintId) {\n        sprint = this.scope.sprintsById[oldSprintId] || this.scope.closedSprintsById[oldSprintId];\n      }\n      if (newSprintId) {\n        newSprint = this.scope.sprintsById[newSprintId] || this.scope.closedSprintsById[newSprintId];\n      }\n      currentSprintId = newSprintId !== oldSprintId ? newSprintId : oldSprintId;\n      orderList = null;\n      orderField = \"\";\n      if (newSprintId !== oldSprintId) {\n        if (newSprintId === null) {\n          for (key = j = 0, len = usList.length; j < len; key = ++j) {\n            us = usList[key];\n            _.remove(sprint.user_stories, function(it) {\n              return it.id === us.id;\n            });\n          }\n          orderField = \"backlog_order\";\n          orderList = this.backlogOrder;\n          beforeDestination = _.slice(this.scope.userstories, 0, newUsIndex);\n          afterDestination = _.slice(this.scope.userstories, newUsIndex);\n          this.scope.userstories = this.scope.userstories.concat(usList);\n        } else {\n          for (l = 0, len1 = usList.length; l < len1; l++) {\n            us = usList[l];\n            _.remove(this.scope.userstories, function(it) {\n              return it.id === us.id;\n            });\n          }\n          orderField = \"sprint_order\";\n          orderList = this.milestonesOrder[newSprint.id];\n          beforeDestination = _.slice(newSprint.user_stories, 0, newUsIndex);\n          afterDestination = _.slice(newSprint.user_stories, newUsIndex);\n          newSprint.user_stories = newSprint.user_stories.concat(usList);\n        }\n      } else {\n        if (oldSprintId === null) {\n          orderField = \"backlog_order\";\n          orderList = this.backlogOrder;\n          list = _.filter(this.scope.userstories, function(listIt) {\n            return !_.find(usList, function(moveIt) {\n              return listIt.id === moveIt.id;\n            });\n          });\n          beforeDestination = _.slice(list, 0, newUsIndex);\n          afterDestination = _.slice(list, newUsIndex);\n        } else {\n          orderField = \"sprint_order\";\n          orderList = this.milestonesOrder[sprint.id];\n          list = _.filter(newSprint.user_stories, function(listIt) {\n            return !_.find(usList, function(moveIt) {\n              return listIt.id === moveIt.id;\n            });\n          });\n          beforeDestination = _.slice(list, 0, newUsIndex);\n          afterDestination = _.slice(list, newUsIndex);\n        }\n      }\n      previous = beforeDestination[beforeDestination.length - 1];\n      setPreviousOrders = [];\n      if (!previous) {\n        startIndex = 0;\n      } else if (previous) {\n        startIndex = orderList[previous.id] + 1;\n        previousWithTheSameOrder = _.filter(beforeDestination, function(it) {\n          return it[orderField] === orderList[previous.id];\n        });\n        if (previousWithTheSameOrder.length > 1) {\n          setPreviousOrders = _.map(previousWithTheSameOrder, function(it) {\n            return {\n              us_id: it.id,\n              order: orderList[it.id]\n            };\n          });\n        }\n      }\n      modifiedUs = [];\n      for (key = m = 0, len2 = usList.length; m < len2; key = ++m) {\n        us = usList[key];\n        us.milestone = currentSprintId;\n        us[orderField] = startIndex + key;\n        orderList[us.id] = us[orderField];\n        modifiedUs.push({\n          us_id: us.id,\n          order: us[orderField]\n        });\n      }\n      startIndex = orderList[usList[usList.length - 1].id];\n      for (key = n = 0, len3 = afterDestination.length; n < len3; key = ++n) {\n        it = afterDestination[key];\n        orderList[it.id] = startIndex + key + 1;\n      }\n      this.scope.userstories = _.sortBy(this.scope.userstories, (function(_this) {\n        return function(it) {\n          return _this.backlogOrder[it.id];\n        };\n      })(this));\n      ref1 = this.scope.sprints;\n      for (o = 0, len4 = ref1.length; o < len4; o++) {\n        sprint = ref1[o];\n        sprint.user_stories = _.sortBy(sprint.user_stories, (function(_this) {\n          return function(it) {\n            return _this.milestonesOrder[sprint.id][it.id];\n          };\n        })(this));\n      }\n      ref2 = this.scope.closedSprints;\n      for (p = 0, len5 = ref2.length; p < len5; p++) {\n        sprint = ref2[p];\n        sprint.user_stories = _.sortBy(sprint.user_stories, (function(_this) {\n          return function(it) {\n            return _this.milestonesOrder[sprint.id][it.id];\n          };\n        })(this));\n      }\n      if (usList.length > 1 && (newSprintId !== oldSprintId)) {\n        data = modifiedUs.concat(setPreviousOrders);\n        promise = this.rs.userstories.bulkUpdateMilestone(project, newSprintId, data);\n      } else if (usList.length > 1) {\n        data = modifiedUs.concat(setPreviousOrders);\n        promise = this.rs.userstories.bulkUpdateBacklogOrder(project, data);\n      } else {\n        setOrders = {};\n        for (q = 0, len6 = setPreviousOrders.length; q < len6; q++) {\n          it = setPreviousOrders[q];\n          setOrders[it.us_id] = it.order;\n        }\n        options = {\n          headers: {\n            \"set-orders\": JSON.stringify(setOrders)\n          }\n        };\n        promise = this.repo.save(usList[0], true, {}, options, true);\n      }\n      promise.then((function(_this) {\n        return function() {\n          _this.rootscope.$broadcast(\"sprint:us:moved\");\n          if (_this.scope.closedSprintsById && _this.scope.closedSprintsById[oldSprintId]) {\n            return _this.rootscope.$broadcast(\"backlog:load-closed-sprints\");\n          }\n        };\n      })(this));\n      return promise;\n    };\n\n    BacklogController.prototype.updateUserStoryStatus = function() {\n      return this.generateFilters().then((function(_this) {\n        return function() {\n          _this.rootscope.$broadcast(\"filters:update\");\n          return _this.loadProjectStats();\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.editUserStory = function(projectId, ref, $event) {\n      var currentLoading, target;\n      target = $($event.target);\n      currentLoading = this.loading().target(target).removeClasses(\"edit-story\").timeout(200).start();\n      return this.rs.userstories.getByRef(projectId, ref).then((function(_this) {\n        return function(us) {\n          return _this.rs2.attachments.list(\"us\", us.id, projectId).then(function(attachments) {\n            _this.rootscope.$broadcast(\"usform:edit\", us, attachments.toJS());\n            return currentLoading.finish();\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.deleteUserStory = function(us) {\n      var message, title;\n      title = this.translate.instant(\"US.TITLE_DELETE_ACTION\");\n      message = us.subject;\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var promise;\n          _this.scope.userstories = _.without(_this.scope.userstories, us);\n          promise = _this.repo.remove(us);\n          promise.then(function() {\n            askResponse.finish();\n            return _this.q.all([_this.loadProjectStats(), _this.loadSprints()]);\n          });\n          return promise.then(null, function() {\n            askResponse.finish(false);\n            return _this.confirm.notify(\"error\");\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.addNewUs = function(type) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"usform:new\", this.scope.projectId, this.scope.project.default_us_status, this.scope.usStatusList);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"usform:bulk\", this.scope.projectId, this.scope.project.default_us_status);\n      }\n    };\n\n    BacklogController.prototype.addNewSprint = function() {\n      return this.rootscope.$broadcast(\"sprintform:create\", this.scope.projectId);\n    };\n\n    BacklogController.prototype.findCurrentSprint = function() {\n      var currentDate;\n      currentDate = new Date().getTime();\n      return _.find(this.scope.sprints, function(sprint) {\n        var end, start;\n        start = moment(sprint.estimated_start, 'YYYY-MM-DD').format('x');\n        end = moment(sprint.estimated_finish, 'YYYY-MM-DD').format('x');\n        return currentDate >= start && currentDate <= end;\n      });\n    };\n\n    return BacklogController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin, taiga.UsFiltersMixin));\n\n  module.controller(\"BacklogController\", BacklogController);\n\n  BacklogDirective = function($repo, $rootscope, $translate) {\n    var doomLineTemplate, link, linkDoomLine, linkFilters, linkToolbar, openFilterInit, showHideFilter, showHideTags;\n    doomLineTemplate = _.template(\"<div class=\\\"doom-line\\\"><span><%- text %></span></div>\");\n    linkDoomLine = function($scope, $el, $attrs, $ctrl) {\n      var addDoomLineDom, getUsItems, reloadDoomLine, removeDoomlineDom;\n      reloadDoomLine = function() {\n        var current_sum, domElement, i, j, len, ref1, results, stats, total_points, us;\n        if (($scope.stats != null) && ($scope.stats.total_points != null) && $scope.stats.total_points !== 0) {\n          removeDoomlineDom();\n          stats = $scope.stats;\n          total_points = stats.total_points;\n          current_sum = stats.assigned_points;\n          if (!$scope.userstories) {\n            return;\n          }\n          ref1 = $scope.userstories;\n          results = [];\n          for (i = j = 0, len = ref1.length; j < len; i = ++j) {\n            us = ref1[i];\n            current_sum += us.total_points;\n            if (current_sum > total_points) {\n              domElement = $el.find('.backlog-table-body .us-item-row')[i];\n              addDoomLineDom(domElement);\n              break;\n            } else {\n              results.push(void 0);\n            }\n          }\n          return results;\n        }\n      };\n      removeDoomlineDom = function() {\n        return $el.find(\".doom-line\").remove();\n      };\n      addDoomLineDom = function(element) {\n        var text;\n        text = $translate.instant(\"BACKLOG.DOOMLINE\");\n        return $(element).before(doomLineTemplate({\n          \"text\": text\n        }));\n      };\n      getUsItems = function() {\n        var rowElements;\n        rowElements = $el.find('.backlog-table-body .us-item-row');\n        return _.map(rowElements, function(x) {\n          return angular.element(x);\n        });\n      };\n      $scope.$on(\"userstories:loaded\", reloadDoomLine);\n      return $scope.$watch(\"stats\", reloadDoomLine);\n    };\n    linkToolbar = function($scope, $el, $attrs, $ctrl) {\n      var checkSelected, getUsToMove, lastChecked, moveToCurrentSprint, moveToLatestSprint, moveUssToSprint, shiftPressed;\n      getUsToMove = function() {\n        var ussDom;\n        ussDom = $el.find(\".backlog-table-body input:checkbox:checked\");\n        return _.map(ussDom, function(item) {\n          var itemScope;\n          item = $(item).closest('.tg-scope');\n          itemScope = item.scope();\n          itemScope.us.milestone = $scope.sprints[0].id;\n          return itemScope.us;\n        });\n      };\n      moveUssToSprint = function(selectedUss, sprint) {\n        var extraPoints, totalExtraPoints, ussCurrent;\n        ussCurrent = _($scope.userstories);\n        $scope.userstories = ussCurrent.without.apply(ussCurrent, selectedUss).value();\n        extraPoints = _.map(selectedUss, function(v, k) {\n          return v.total_points;\n        });\n        totalExtraPoints = _.reduce(extraPoints, function(acc, num) {\n          return acc + num;\n        });\n        sprint.user_stories = _.union(sprint.user_stories, selectedUss);\n        sprint.total_points += totalExtraPoints;\n        $repo.saveAll(selectedUss).then(function() {\n          $ctrl.loadSprints();\n          return $ctrl.loadProjectStats();\n        });\n        return $el.find(\".move-to-sprint\").hide();\n      };\n      moveToCurrentSprint = function(selectedUss) {\n        return moveUssToSprint(selectedUss, $scope.currentSprint);\n      };\n      moveToLatestSprint = function(selectedUss) {\n        return moveUssToSprint(selectedUss, $scope.sprints[0]);\n      };\n      shiftPressed = false;\n      lastChecked = null;\n      checkSelected = function(target) {\n        var moveToSprintDom, selectedUsDom;\n        lastChecked = target.closest(\".us-item-row\");\n        target.closest('.us-item-row').toggleClass('ui-multisortable-multiple');\n        moveToSprintDom = $el.find(\".move-to-sprint\");\n        selectedUsDom = $el.find(\".backlog-table-body input:checkbox:checked\");\n        if (selectedUsDom.length > 0 && $scope.sprints.length > 0) {\n          return moveToSprintDom.show();\n        } else {\n          return moveToSprintDom.hide();\n        }\n      };\n      $(window).on(\"keydown.shift-pressed keyup.shift-pressed\", function(event) {\n        shiftPressed = !!event.shiftKey;\n        return true;\n      });\n      $el.on(\"change\", \".backlog-table-body input:checkbox\", function(event) {\n        var current, elements, nextAll, prevAll, target;\n        if (lastChecked && shiftPressed) {\n          elements = [];\n          current = $(event.currentTarget).closest(\".us-item-row\");\n          nextAll = lastChecked.nextAll();\n          prevAll = lastChecked.prevAll();\n          if (_.some(nextAll, function(next) {\n            return next === current[0];\n          })) {\n            elements = lastChecked.nextUntil(current);\n          } else if (_.some(prevAll, function(prev) {\n            return prev === current[0];\n          })) {\n            elements = lastChecked.prevUntil(current);\n          }\n          _.map(elements, function(elm) {\n            var input;\n            input = $(elm).find(\"input:checkbox\");\n            input.prop('checked', true);\n            return checkSelected(input);\n          });\n        }\n        target = angular.element(event.currentTarget);\n        target.closest(\".us-item-row\").toggleClass('is-checked');\n        return checkSelected(target);\n      });\n      $el.on(\"click\", \"#move-to-latest-sprint\", (function(_this) {\n        return function(event) {\n          var ussToMove;\n          ussToMove = getUsToMove();\n          return $scope.$apply(_.partial(moveToLatestSprint, ussToMove));\n        };\n      })(this));\n      $el.on(\"click\", \"#move-to-current-sprint\", (function(_this) {\n        return function(event) {\n          var ussToMove;\n          ussToMove = getUsToMove();\n          return $scope.$apply(_.partial(moveToCurrentSprint, ussToMove));\n        };\n      })(this));\n      return $el.on(\"click\", \"#show-tags\", function(event) {\n        event.preventDefault();\n        $ctrl.toggleShowTags();\n        return showHideTags($ctrl);\n      });\n    };\n    showHideTags = function($ctrl) {\n      var elm, text;\n      elm = angular.element(\"#show-tags\");\n      if ($ctrl.showTags) {\n        elm.addClass(\"active\");\n        text = $translate.instant(\"BACKLOG.TAGS.HIDE\");\n        return elm.text(text);\n      } else {\n        elm.removeClass(\"active\");\n        text = $translate.instant(\"BACKLOG.TAGS.SHOW\");\n        return elm.text(text);\n      }\n    };\n    openFilterInit = function($scope, $el, $ctrl) {\n      var sidebar;\n      sidebar = $el.find(\"sidebar.backlog-filter\");\n      sidebar.addClass(\"active\");\n      return $ctrl.activeFilters = true;\n    };\n    showHideFilter = function($scope, $el, $ctrl) {\n      var hideText, showText, sidebar, target;\n      sidebar = $el.find(\"sidebar.backlog-filter\");\n      sidebar.one(\"transitionend\", function() {\n        return timeout(150, function() {\n          $rootscope.$broadcast(\"resize\");\n          return $('.burndown').css(\"visibility\", \"visible\");\n        });\n      });\n      target = angular.element(\"#show-filters-button\");\n      $('.burndown').css(\"visibility\", \"hidden\");\n      sidebar.toggleClass(\"active\");\n      target.toggleClass(\"active\");\n      hideText = $translate.instant(\"BACKLOG.FILTERS.HIDE\");\n      showText = $translate.instant(\"BACKLOG.FILTERS.SHOW\");\n      toggleText(target, [hideText, showText]);\n      return $ctrl.toggleActiveFilters();\n    };\n    linkFilters = function($scope, $el, $attrs, $ctrl) {\n      $scope.filtersSearch = {};\n      return $el.on(\"click\", \"#show-filters-button\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          return showHideFilter($scope, $el, $ctrl);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs, $rootscope) {\n      var $ctrl, filters;\n      $ctrl = $el.controller();\n      linkToolbar($scope, $el, $attrs, $ctrl);\n      linkFilters($scope, $el, $attrs, $ctrl);\n      linkDoomLine($scope, $el, $attrs, $ctrl);\n      filters = $ctrl.location.search();\n      if (filters.status || filters.tags || filters.q || filters.assigned_to || filters.owner) {\n        openFilterInit($scope, $el, $ctrl);\n      }\n      $scope.$on(\"showTags\", function() {\n        return showHideTags($ctrl);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return $(window).off(\".shift-pressed\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklog\", [\"$tgRepo\", \"$rootScope\", \"$translate\", BacklogDirective]);\n\n  UsRolePointsSelectorDirective = function($rootscope, $template, $compile, $translate) {\n    var link, selectionTemplate;\n    selectionTemplate = $template.get(\"backlog/us-role-points-popover.html\", true);\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, \"project\", function(project) {\n        var numberOfRoles, roles;\n        roles = _.filter(project.roles, \"computable\");\n        numberOfRoles = _.size(roles);\n        if (numberOfRoles > 1) {\n          return $el.append($compile(selectionTemplate({\n            \"roles\": roles\n          }))($scope));\n        } else {\n          $el.find(\".icon-arrow-down\").remove();\n          return $el.find(\".header-points\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"uspoints:select\", function(ctx, roleId, roleName) {\n        $el.find(\".popover\").popover().close();\n        return $el.find(\".header-points\").html(roleName + \"/<span>Total</span>\");\n      });\n      $scope.$on(\"uspoints:clear-selection\", function(ctx, roleId) {\n        var text;\n        $el.find(\".popover\").popover().close();\n        text = $translate.instant(\"COMMON.FIELDS.POINTS\");\n        return $el.find(\".header-points\").text(text);\n      });\n      $el.on(\"click\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (target.is(\"span\") || target.is(\"div\")) {\n          event.stopPropagation();\n        }\n        return $el.find(\".popover\").popover().open();\n      });\n      $el.on(\"click\", \".clear-selection\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $rootscope.$broadcast(\"uspoints:clear-selection\");\n      });\n      $el.on(\"click\", \".role\", function(event) {\n        var rolScope, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        rolScope = target.scope();\n        return $rootscope.$broadcast(\"uspoints:select\", target.data(\"role-id\"), target.text());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUsRolePointsSelector\", [\"$rootScope\", \"$tgTemplate\", \"$compile\", \"$translate\", UsRolePointsSelectorDirective]);\n\n  UsPointsDirective = function($tgEstimationsService, $repo, $tgTemplate) {\n    var link, rolesTemplate;\n    rolesTemplate = $tgTemplate.get(\"common/estimation/us-points-roles-popover.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, bindClickElements, estimationProcess, filteringRoleId, renderRolesSelector, selectedRoleId, updatingSelectedRoleId;\n      $ctrl = $el.controller();\n      updatingSelectedRoleId = null;\n      selectedRoleId = null;\n      filteringRoleId = null;\n      estimationProcess = null;\n      $scope.$on(\"uspoints:select\", function(ctx, roleId, roleName) {\n        var us;\n        us = $scope.$eval($attrs.tgBacklogUsPoints);\n        selectedRoleId = roleId;\n        return estimationProcess.render();\n      });\n      $scope.$on(\"uspoints:clear-selection\", function(ctx) {\n        var us;\n        us = $scope.$eval($attrs.tgBacklogUsPoints);\n        selectedRoleId = null;\n        return estimationProcess.render();\n      });\n      $scope.$watch($attrs.tgBacklogUsPoints, function(us) {\n        var roles;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          roles = estimationProcess.calculateRoles();\n          if (roles.length === 0) {\n            $el.find(\".icon-arrow-bottom\").remove();\n            $el.find(\"a.us-points\").addClass(\"not-clickable\");\n          } else if (roles.length === 1) {\n            selectedRoleId = _.keys(us.points)[0];\n          }\n          if (estimationProcess.isEditable) {\n            bindClickElements();\n          }\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId, points) {\n            us.points = points;\n            estimationProcess.render();\n            return this.save(roleId, pointId).then(function() {\n              return $ctrl.loadProjectStats();\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, pointId, pointObj, template, text, title, totalPoints;\n            totalPoints = this.calculateTotalPoints();\n            if ((selectedRoleId == null) || roles.length === 1) {\n              text = totalPoints;\n              title = totalPoints;\n            } else {\n              pointId = this.us.points[selectedRoleId];\n              pointObj = this.pointsById[pointId];\n              text = pointObj.name + \" / <span>\" + totalPoints + \"</span>\";\n              title = pointObj.name + \" / \" + totalPoints;\n            }\n            ctx = {\n              totalPoints: totalPoints,\n              roles: this.calculateRoles(),\n              editable: this.isEditable,\n              text: text,\n              title: title\n            };\n            mainTemplate = \"common/estimation/us-estimation-total.html\";\n            template = $tgTemplate.get(mainTemplate, true);\n            html = template(ctx);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      renderRolesSelector = function() {\n        var html, roles;\n        roles = estimationProcess.calculateRoles();\n        html = rolesTemplate({\n          \"roles\": roles\n        });\n        $el.append(html);\n        return $el.find(\".pop-role\").popover().open(function() {\n          return $(this).remove();\n        });\n      };\n      bindClickElements = function() {\n        $el.on(\"click\", \"a.us-points\", function(event) {\n          var us;\n          event.preventDefault();\n          event.stopPropagation();\n          us = $scope.$eval($attrs.tgBacklogUsPoints);\n          updatingSelectedRoleId = selectedRoleId;\n          if (selectedRoleId != null) {\n            return estimationProcess.renderPointsSelector(selectedRoleId);\n          } else {\n            return renderRolesSelector();\n          }\n        });\n        return $el.on(\"click\", \".role\", function(event) {\n          var popRolesDom, target, us;\n          event.preventDefault();\n          event.stopPropagation();\n          target = angular.element(event.currentTarget);\n          us = $scope.$eval($attrs.tgBacklogUsPoints);\n          updatingSelectedRoleId = target.data(\"role-id\");\n          popRolesDom = $el.find(\".pop-role\");\n          popRolesDom.find(\"a\").removeClass(\"active\");\n          popRolesDom.find(\"a[data-role-id='\" + updatingSelectedRoleId + \"']\").addClass(\"active\");\n          return estimationProcess.renderPointsSelector(updatingSelectedRoleId);\n        });\n      };\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogUsPoints\", [\"$tgEstimationsService\", \"$tgRepo\", \"$tgTemplate\", UsPointsDirective]);\n\n  ToggleBurndownVisibility = function($storage) {\n    var hide, link, show;\n    hide = function() {\n      $(\".js-burndown-graph\").removeClass(\"shown\");\n      $(\".js-toggle-burndown-visibility-button\").removeClass(\"active\");\n      return $(\".js-burndown-graph\").removeClass(\"open\");\n    };\n    show = function(firstLoad) {\n      $(\".js-toggle-burndown-visibility-button\").addClass(\"active\");\n      if (firstLoad) {\n        return $(\".js-burndown-graph\").addClass(\"shown\");\n      } else {\n        return $(\".js-burndown-graph\").addClass(\"open\");\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var firstLoad, hash, toggleGraph;\n      firstLoad = true;\n      hash = generateHash([\"is-burndown-grpahs-collapsed\"]);\n      $scope.isBurndownGraphCollapsed = $storage.get(hash) || false;\n      toggleGraph = function() {\n        if ($scope.isBurndownGraphCollapsed) {\n          hide(firstLoad);\n        } else {\n          show(firstLoad);\n        }\n        return firstLoad = false;\n      };\n      $scope.$watch(\"showGraphPlaceholder\", function() {\n        if ($scope.showGraphPlaceholder != null) {\n          $scope.isBurndownGraphCollapsed = $scope.isBurndownGraphCollapsed || $scope.showGraphPlaceholder;\n          return toggleGraph();\n        }\n      });\n      $el.on(\"click\", \".js-toggle-burndown-visibility-button\", function() {\n        $scope.isBurndownGraphCollapsed = !$scope.isBurndownGraphCollapsed;\n        $storage.set(hash, $scope.isBurndownGraphCollapsed);\n        return toggleGraph();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgToggleBurndownVisibility\", [\"$tgStorage\", ToggleBurndownVisibility]);\n\n  BurndownBacklogGraphDirective = function($translate) {\n    var link, redrawChart;\n    redrawChart = function(element, dataToDraw) {\n      var client_increment_line, colors, data, evolution_line, j, milestonesRange, optimal_line, options, ref1, results, team_increment_line, width, zero_line;\n      width = element.width();\n      element.height(width / 6);\n      milestonesRange = (function() {\n        results = [];\n        for (var j = 0, ref1 = dataToDraw.milestones.length - 1; 0 <= ref1 ? j <= ref1 : j >= ref1; 0 <= ref1 ? j++ : j--){ results.push(j); }\n        return results;\n      }).apply(this);\n      data = [];\n      zero_line = _.map(dataToDraw.milestones, function(ml) {\n        return 0;\n      });\n      data.push({\n        data: _.zip(milestonesRange, zero_line),\n        lines: {\n          fillColor: \"rgba(0,0,0,0)\"\n        },\n        points: {\n          show: false\n        }\n      });\n      optimal_line = _.map(dataToDraw.milestones, function(ml) {\n        return ml.optimal;\n      });\n      data.push({\n        data: _.zip(milestonesRange, optimal_line),\n        lines: {\n          fillColor: \"rgba(120,120,120,0.2)\"\n        }\n      });\n      evolution_line = _.filter(_.map(dataToDraw.milestones, function(ml) {\n        return ml.evolution;\n      }), function(evolution) {\n        return evolution != null;\n      });\n      data.push({\n        data: _.zip(milestonesRange, evolution_line),\n        lines: {\n          fillColor: \"rgba(102,153,51,0.3)\"\n        }\n      });\n      client_increment_line = _.map(dataToDraw.milestones, function(ml) {\n        return -ml[\"team-increment\"] - ml[\"client-increment\"];\n      });\n      data.push({\n        data: _.zip(milestonesRange, client_increment_line),\n        lines: {\n          fillColor: \"rgba(255,51,51,0.3)\"\n        }\n      });\n      team_increment_line = _.map(dataToDraw.milestones, function(ml) {\n        return -ml[\"team-increment\"];\n      });\n      data.push({\n        data: _.zip(milestonesRange, team_increment_line),\n        lines: {\n          fillColor: \"rgba(153,51,51,0.3)\"\n        }\n      });\n      colors = [\"rgba(0,0,0,1)\", \"rgba(120,120,120,0.2)\", \"rgba(102,153,51,1)\", \"rgba(153,51,51,1)\", \"rgba(255,51,51,1)\"];\n      options = {\n        grid: {\n          borderWidth: {\n            top: 0,\n            right: 1,\n            left: 0,\n            bottom: 0\n          },\n          borderColor: \"#ccc\",\n          hoverable: true\n        },\n        xaxis: {\n          ticks: dataToDraw.milestones.length,\n          axisLabel: $translate.instant(\"BACKLOG.CHART.XAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: \"Verdana, Arial, Helvetica, Tahoma, sans-serif\",\n          axisLabelPadding: 5,\n          tickFormatter: function(val, axis) {\n            return \"\";\n          }\n        },\n        yaxis: {\n          axisLabel: $translate.instant(\"BACKLOG.CHART.YAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: \"Verdana, Arial, Helvetica, Tahoma, sans-serif\",\n          axisLabelPadding: 5\n        },\n        series: {\n          shadowSize: 0,\n          lines: {\n            show: true,\n            fill: true\n          },\n          points: {\n            show: true,\n            fill: true,\n            radius: 4,\n            lineWidth: 2\n          }\n        },\n        colors: colors,\n        tooltip: true,\n        tooltipOpts: {\n          content: function(label, xval, yval, flotItem) {\n            var ctx;\n            if (flotItem.seriesIndex === 1) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.OPTIMAL\", ctx);\n            } else if (flotItem.seriesIndex === 2) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.REAL\", ctx);\n            } else if (flotItem.seriesIndex === 3) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.INCREMENT_CLIENT\", ctx);\n            } else {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.INCREMENT_TEAM\", ctx);\n            }\n          }\n        }\n      };\n      element.empty();\n      return element.plot(data, options).data(\"plot\");\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch(\"stats\", function(value) {\n        if ($scope.stats != null) {\n          redrawChart(element, $scope.stats);\n          return $scope.$on(\"resize\", function() {\n            return redrawChart(element, $scope.stats);\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBurndownBacklogGraph\", [\"$translate\", BurndownBacklogGraphDirective]);\n\n  TgBacklogProgressBarDirective = function($template, $compile) {\n    var adjustPercentaje, link, render, template;\n    template = $template.get(\"backlog/progress-bar.html\", true);\n    render = function(scope, el, projectPointsPercentaje, closedPointsPercentaje) {\n      var html;\n      html = template({\n        projectPointsPercentaje: projectPointsPercentaje,\n        closedPointsPercentaje: closedPointsPercentaje\n      });\n      html = $compile(html)(scope);\n      return el.html(html);\n    };\n    adjustPercentaje = function(percentage) {\n      var adjusted;\n      adjusted = _.max([0, percentage]);\n      adjusted = _.min([100, adjusted]);\n      return Math.round(adjusted);\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch($attrs.tgBacklogProgressBar, function(stats) {\n        var closedPoints, closedPointsPercentaje, definedPoints, projectPointsPercentaje, totalPoints;\n        if (stats != null) {\n          totalPoints = stats.total_points ? stats.total_points : stats.defined_points;\n          definedPoints = stats.defined_points;\n          closedPoints = stats.closed_points;\n          if (definedPoints > totalPoints) {\n            projectPointsPercentaje = totalPoints * 100 / definedPoints;\n            closedPointsPercentaje = closedPoints * 100 / definedPoints;\n          } else {\n            projectPointsPercentaje = 100;\n            closedPointsPercentaje = closedPoints * 100 / totalPoints;\n          }\n          projectPointsPercentaje = adjustPercentaje(projectPointsPercentaje - 3);\n          closedPointsPercentaje = adjustPercentaje(closedPointsPercentaje - 3);\n          return render($scope, $el, projectPointsPercentaje, closedPointsPercentaje);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogProgressBar\", [\"$tgTemplate\", \"$compile\", TgBacklogProgressBarDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/sortable.coffee\n */\n\n(function() {\n  var BacklogSortableDirective, bindOnce, deleteElement, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBacklog\");\n\n  deleteElement = function(el) {\n    $(el).scope().$destroy();\n    $(el).off();\n    return $(el).remove();\n  };\n\n  BacklogSortableDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"project\", function(project) {\n        var drake, initIsBacklog, scroll;\n        if (!(project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        initIsBacklog = false;\n        drake = dragula([$el[0], $('.empty-backlog')[0]], {\n          copySortSource: false,\n          copy: false,\n          isContainer: function(el) {\n            return el.classList.contains('sprint-table');\n          },\n          moves: function(item) {\n            if (!$(item).hasClass('row')) {\n              return false;\n            }\n            return true;\n          }\n        });\n        drake.on('drag', function(item, container) {\n          var isChecked, parent;\n          parent = $(item).parent();\n          initIsBacklog = parent.hasClass('backlog-table-body');\n          $(document.body).addClass(\"drag-active\");\n          isChecked = $(item).find(\"input[type='checkbox']\").is(\":checked\");\n          return window.dragMultiple.start(item, container);\n        });\n        drake.on('cloned', function(item) {\n          return $(item).addClass('backlog-us-mirror');\n        });\n        drake.on('dragend', function(item) {\n          var dragMultipleItems, firstElement, index, isBacklog, parent, sameContainer, sprint, usList;\n          parent = $(item).parent();\n          $('.doom-line').remove();\n          parent = $(item).parent();\n          isBacklog = parent.hasClass('backlog-table-body') || parent.hasClass('empty-backlog');\n          if (initIsBacklog || isBacklog) {\n            sameContainer = initIsBacklog === isBacklog;\n          } else {\n            sameContainer = $(item).scope().sprint.id === parent.scope().sprint.id;\n          }\n          dragMultipleItems = window.dragMultiple.stop();\n          $(document.body).removeClass(\"drag-active\");\n          sprint = null;\n          firstElement = dragMultipleItems.length ? dragMultipleItems[0] : item;\n          if (isBacklog) {\n            index = $(firstElement).index(\".backlog-table-body .row\");\n          } else {\n            index = $(firstElement).index();\n            sprint = parent.scope().sprint.id;\n          }\n          if (!sameContainer) {\n            if (dragMultipleItems.length) {\n              usList = _.map(dragMultipleItems, function(item) {\n                return item = $(item).scope().us;\n              });\n            } else {\n              usList = [$(item).scope().us];\n            }\n            if (dragMultipleItems.length) {\n              _.each(dragMultipleItems, function(item) {\n                return deleteElement(item);\n              });\n            } else {\n              deleteElement(item);\n            }\n          } else {\n            if (dragMultipleItems.length) {\n              usList = _.map(dragMultipleItems, function(item) {\n                return item = $(item).scope().us;\n              });\n            } else {\n              usList = [$(item).scope().us];\n            }\n          }\n          return $scope.$emit(\"sprint:us:move\", usList, index, sprint);\n        });\n        scroll = autoScroll([window], {\n          margin: 20,\n          pixels: 30,\n          scrollWhenOutside: true,\n          autoScroll: function() {\n            return this.down && drake.dragging;\n          }\n        });\n        return $scope.$on(\"$destroy\", function() {\n          $el.off();\n          return drake.destroy();\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogSortable\", BacklogSortableDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/sprints.coffee\n */\n\n(function() {\n  var BacklogSprintDirective, BacklogSprintHeaderDirective, ToggleExcludeClosedSprintsVisualization, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogSprintDirective = function($repo, $rootscope) {\n    var link, slideOptions, sprintTableMinHeight, toggleSprint;\n    sprintTableMinHeight = 50;\n    slideOptions = {\n      duration: 500,\n      easing: 'linear'\n    };\n    toggleSprint = (function(_this) {\n      return function($el) {\n        var sprintArrow, sprintTable;\n        sprintTable = $el.find(\".sprint-table\");\n        sprintArrow = $el.find(\".compact-sprint\");\n        sprintArrow.toggleClass('active');\n        return sprintTable.toggleClass('open');\n      };\n    })(this);\n    link = function($scope, $el, $attrs) {\n      $scope.$watch($attrs.tgBacklogSprint, function(sprint) {\n        sprint = $scope.$eval($attrs.tgBacklogSprint);\n        if (sprint.closed) {\n          return $el.addClass(\"sprint-closed\");\n        } else {\n          return toggleSprint($el);\n        }\n      });\n      $el.on(\"click\", \".sprint-name > .compact-sprint\", function(event) {\n        event.preventDefault();\n        toggleSprint($el);\n        return $el.find(\".sprint-table\").slideToggle(slideOptions);\n      });\n      $el.on(\"click\", \".edit-sprint\", function(event) {\n        var sprint;\n        event.preventDefault();\n        sprint = $scope.$eval($attrs.tgBacklogSprint);\n        return $rootscope.$broadcast(\"sprintform:edit\", sprint);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogSprint\", [\"$tgRepo\", \"$rootScope\", BacklogSprintDirective]);\n\n  BacklogSprintHeaderDirective = function($navUrls, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"backlog/sprint-header.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, isVisible, prettyDate, render;\n      prettyDate = $translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_milestone\") !== -1;\n      };\n      isVisible = function() {\n        return $scope.project.my_permissions.indexOf(\"view_milestones\") !== -1;\n      };\n      render = function(sprint) {\n        var compiledTemplate, ctx, estimatedDateRange, finish, start, taskboardUrl, templateScope;\n        taskboardUrl = $navUrls.resolve(\"project-taskboard\", {\n          project: $scope.project.slug,\n          sprint: sprint.slug\n        });\n        start = moment(sprint.estimated_start).format(prettyDate);\n        finish = moment(sprint.estimated_finish).format(prettyDate);\n        estimatedDateRange = start + \"-\" + finish;\n        ctx = {\n          name: sprint.name,\n          taskboardUrl: taskboardUrl,\n          estimatedDateRange: estimatedDateRange,\n          closedPoints: sprint.closed_points || 0,\n          totalPoints: sprint.total_points || 0,\n          isVisible: isVisible(),\n          isEditable: isEditable()\n        };\n        templateScope = $scope.$new();\n        _.assign(templateScope, ctx);\n        compiledTemplate = $compile(template)(templateScope);\n        return $el.html(compiledTemplate);\n      };\n      $scope.$watch($attrs.ngModel, function(sprint) {\n        return render(sprint);\n      });\n      $scope.$on(\"sprintform:edit:success\", function() {\n        return render($model.$modelValue);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgBacklogSprintHeader\", [\"$tgNavUrls\", \"$tgTemplate\", \"$compile\", \"$translate\", BacklogSprintHeaderDirective]);\n\n  ToggleExcludeClosedSprintsVisualization = function($rootscope, $loading, $translate) {\n    var excludeClosedSprints, link;\n    excludeClosedSprints = true;\n    link = function($scope, $el, $attrs) {\n      var currentLoading, loadingElm;\n      loadingElm = $(\"<div>\");\n      $el.after(loadingElm);\n      currentLoading = null;\n      $el.on(\"click\", function(event) {\n        event.preventDefault();\n        excludeClosedSprints = !excludeClosedSprints;\n        currentLoading = $loading().target(loadingElm).start();\n        if (excludeClosedSprints) {\n          return $rootscope.$broadcast(\"backlog:unload-closed-sprints\");\n        } else {\n          return $rootscope.$broadcast(\"backlog:load-closed-sprints\");\n        }\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $scope.$on(\"closed-sprints:reloaded\", (function(_this) {\n        return function(ctx, sprints) {\n          var key, text;\n          currentLoading.finish();\n          if (sprints.length > 0) {\n            key = \"BACKLOG.SPRINTS.ACTION_HIDE_CLOSED_SPRINTS\";\n          } else {\n            key = \"BACKLOG.SPRINTS.ACTION_SHOW_CLOSED_SPRINTS\";\n          }\n          text = $translate.instant(key);\n          return $el.find(\".text\").text(text);\n        };\n      })(this));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogToggleClosedSprintsVisualization\", [\"$rootScope\", \"$tgLoading\", \"$translate\", ToggleExcludeClosedSprintsVisualization]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/charts.coffee\n */\n\n(function() {\n  var SprintGraphDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaTaskboard\");\n\n  SprintGraphDirective = function($translate) {\n    var link, redrawChart;\n    redrawChart = function(element, dataToDraw) {\n      var data, days, options, width;\n      width = element.width();\n      element.height(240);\n      days = _.map(dataToDraw, function(x) {\n        return moment(x.day);\n      });\n      data = [];\n      data.unshift({\n        data: _.zip(days, _.map(dataToDraw, function(d) {\n          return d.optimal_points;\n        })),\n        lines: {\n          fillColor: \"rgba(120,120,120,0.2)\"\n        }\n      });\n      data.unshift({\n        data: _.zip(days, _.map(dataToDraw, function(d) {\n          return d.open_points;\n        })),\n        lines: {\n          fillColor: \"rgba(102,153,51,0.3)\"\n        }\n      });\n      options = {\n        grid: {\n          borderWidth: {\n            top: 0,\n            right: 1,\n            left: 0,\n            bottom: 0\n          },\n          borderColor: '#ccc',\n          hoverable: true\n        },\n        xaxis: {\n          tickSize: [1, \"day\"],\n          min: days[0],\n          max: _.last(days),\n          mode: \"time\",\n          daysNames: days,\n          axisLabel: $translate.instant(\"TASKBOARD.CHARTS.XAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',\n          axisLabelPadding: 5\n        },\n        yaxis: {\n          min: 0,\n          axisLabel: $translate.instant(\"TASKBOARD.CHARTS.YAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',\n          axisLabelPadding: 5\n        },\n        series: {\n          shadowSize: 0,\n          lines: {\n            show: true,\n            fill: true\n          },\n          points: {\n            show: true,\n            fill: true,\n            radius: 4,\n            lineWidth: 2\n          }\n        },\n        colors: [\"rgba(102,153,51,1)\", \"rgba(120,120,120,0.2)\"],\n        tooltip: true,\n        tooltipOpts: {\n          content: function(label, xval, yval, flotItem) {\n            var formattedDate, roundedValue;\n            formattedDate = moment(xval).format($translate.instant(\"TASKBOARD.CHARTS.DATE\"));\n            roundedValue = Math.round(yval);\n            if (flotItem.seriesIndex === 1) {\n              return $translate.instant(\"TASKBOARD.CHARTS.OPTIMAL\", {\n                formattedDate: formattedDate,\n                roundedValue: roundedValue\n              });\n            } else {\n              return $translate.instant(\"TASKBOARD.CHARTS.REAL\", {\n                formattedDate: formattedDate,\n                roundedValue: roundedValue\n              });\n            }\n          }\n        }\n      };\n      element.empty();\n      return element.plot(data, options).data(\"plot\");\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$on(\"resize\", function() {\n        if ($scope.stats) {\n          return redrawChart(element, $scope.stats.days);\n        }\n      });\n      $scope.$on(\"taskboard:graph:toggle-visibility\", function() {\n        $el.parent().toggleClass('open');\n        return timeout(100, function() {\n          if ($scope.stats) {\n            return redrawChart(element, $scope.stats.days);\n          }\n        });\n      });\n      $scope.$watch('stats', function(value) {\n        if ($scope.stats == null) {\n          return;\n        }\n        return redrawChart(element, $scope.stats.days);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSprintGraph\", [\"$translate\", SprintGraphDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/lightboxes.coffee\n */\n\n(function() {\n  var CreateBulkTasksDirective, CreateEditTaskDirective, bindOnce, debounce, module, taiga, trim,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  trim = this.taiga.trim;\n\n  CreateEditTaskDirective = function($repo, $model, $rs, $rootscope, $loading, lightboxService, $translate, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var attachmentsToAdd, attachmentsToDelete, createAttachments, deleteAttachments, resetAttachments, submit, submitButton, tagsToAdd;\n      $scope.isNew = true;\n      attachmentsToAdd = Immutable.List();\n      attachmentsToDelete = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return attachmentsToDelete = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      $scope.deleteAttachment = function(attachment) {\n        if (attachment.get(\"id\")) {\n          return attachmentsToDelete = attachmentsToDelete.push(attachment);\n        }\n      };\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.task.project, 'task');\n        });\n        return $q.all(promises);\n      };\n      deleteAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToDelete.toJS(), function(attachment) {\n          return attachmentsService[\"delete\"](\"task\", attachment.id);\n        });\n        return $q.all(promises);\n      };\n      tagsToAdd = [];\n      $scope.addTag = function(tag, color) {\n        var inserted, itemtags, projectTags, tags, value;\n        value = trim(tag.toLowerCase());\n        tags = $scope.project.tags;\n        projectTags = $scope.project.tags_colors;\n        if (tags == null) {\n          tags = [];\n        }\n        if (projectTags == null) {\n          projectTags = {};\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        projectTags[tag] = color || null;\n        $scope.project.tags = tags;\n        itemtags = _.clone($scope.task.tags);\n        inserted = _.find(itemtags, function(it) {\n          return it[0] === value;\n        });\n        if (!inserted) {\n          itemtags.push([tag, color]);\n          return $scope.task.tags = itemtags;\n        }\n      };\n      $scope.deleteTag = function(tag) {\n        var itemtags, tags, value;\n        value = trim(tag[0].toLowerCase());\n        tags = $scope.project.tags;\n        itemtags = _.clone($scope.task.tags);\n        _.remove(itemtags, function(tag) {\n          return tag[0] === value;\n        });\n        $scope.task.tags = itemtags;\n        return _.pull($scope.task.tags, value);\n      };\n      $scope.$on(\"taskform:new\", function(ctx, sprintId, usId) {\n        var create, newTask;\n        $scope.task = {\n          project: $scope.projectId,\n          milestone: sprintId,\n          user_story: usId,\n          is_archived: false,\n          status: $scope.project.default_task_status,\n          assigned_to: null,\n          tags: []\n        };\n        $scope.isNew = true;\n        $scope.attachments = Immutable.List();\n        resetAttachments();\n        create = $translate.instant(\"COMMON.CREATE\");\n        $el.find(\".button-green\").html(create);\n        newTask = $translate.instant(\"LIGHTBOX.CREATE_EDIT_TASK.TITLE\");\n        $el.find(\".title\").html(newTask + \"  \");\n        $el.find(\".tag-input\").val(\"\");\n        lightboxService.open($el, function() {\n          return $scope.createEditTaskOpen = false;\n        });\n        return $scope.createEditTaskOpen = true;\n      });\n      $scope.$on(\"taskform:edit\", function(ctx, task, attachments) {\n        var edit, save;\n        $scope.task = task;\n        $scope.isNew = false;\n        $scope.attachments = Immutable.fromJS(attachments);\n        resetAttachments();\n        save = $translate.instant(\"COMMON.SAVE\");\n        edit = $translate.instant(\"LIGHTBOX.CREATE_EDIT_TASK.ACTION_EDIT\");\n        $el.find(\".button-green\").html(save);\n        $el.find(\".title\").html(edit + \"  \");\n        $el.find(\".tag-input\").val(\"\");\n        lightboxService.open($el, function() {\n          return $scope.createEditTaskOpen = false;\n        });\n        return $scope.createEditTaskOpen = true;\n      });\n      submitButton = $el.find(\".submit-button\");\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, form, params, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          params = {\n            include_attachments: true,\n            include_tasks: true\n          };\n          if ($scope.isNew) {\n            promise = $repo.create(\"tasks\", $scope.task);\n            broadcastEvent = \"taskform:new:success\";\n          } else {\n            promise = $repo.save($scope.task);\n            broadcastEvent = \"taskform:edit:success\";\n          }\n          promise.then(function(data) {\n            return deleteAttachments(data).then((function(_this) {\n              return function() {\n                return createAttachments(data);\n              };\n            })(this)).then((function(_this) {\n              return function() {\n                currentLoading.finish();\n                lightboxService.close($el);\n                return $rs.tasks.getByRef(data.project, data.ref, params).then(function(task) {\n                  return $rootscope.$broadcast(broadcastEvent, task);\n                });\n              };\n            })(this));\n          });\n          currentLoading = $loading().target(submitButton).start();\n          return promise.then(function(data) {\n            currentLoading.finish();\n            return lightboxService.close($el);\n          });\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CreateBulkTasksDirective = function($repo, $rs, $rootscope, $loading, lightboxService, $model) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var submit, submitButton;\n      $scope.form = {\n        data: \"\",\n        usId: null\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, data, form, projectId, promise, sprintId, usId;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          data = $scope.form.data;\n          projectId = $scope.projectId;\n          sprintId = $scope.form.sprintId;\n          usId = $scope.form.usId;\n          promise = $rs.tasks.bulkCreate(projectId, sprintId, usId, data);\n          promise.then(function(result) {\n            result = _.map(result, (function(_this) {\n              return function(x) {\n                return $model.make_model('userstories', x);\n              };\n            })(this));\n            currentLoading.finish();\n            $rootscope.$broadcast(\"taskform:bulk:success\", result);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return console.log(\"FAIL\");\n          });\n        };\n      })(this));\n      $scope.$on(\"taskform:bulk\", function(ctx, sprintId, usId) {\n        lightboxService.open($el);\n        return $scope.form = {\n          data: \"\",\n          sprintId: sprintId,\n          usId: usId\n        };\n      });\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaTaskboard\");\n\n  module.directive(\"tgLbCreateEditTask\", [\"$tgRepo\", \"$tgModel\", \"$tgResources\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", \"$translate\", \"$q\", \"tgAttachmentsService\", CreateEditTaskDirective]);\n\n  module.directive(\"tgLbCreateBulkTasks\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", \"$tgModel\", CreateBulkTasksDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard.coffee\n */\n\n(function() {\n  var TaskboardController, TaskboardDirective, TaskboardSquishColumnDirective, bindMethods, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  toggleText = this.taiga.toggleText;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaTaskboard\");\n\n  TaskboardController = (function(superClass) {\n    extend(TaskboardController, superClass);\n\n    TaskboardController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"tgResources\", \"$routeParams\", \"$q\", \"tgAppMetaService\", \"$tgLocation\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"tgErrorHandlingService\", \"tgTaskboardTasks\", \"$tgStorage\", \"tgFilterRemoteStorageService\"];\n\n    function TaskboardController(scope, rootscope, repo, confirm, rs1, rs2, params1, q1, appMetaService, location, navUrls, events, analytics, translate, errorHandlingService, taskboardTasksService, storage, filterRemoteStorageService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.rs2 = rs2;\n      this.params = params1;\n      this.q = q1;\n      this.appMetaService = appMetaService;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      this.taskboardTasksService = taskboardTasksService;\n      this.storage = storage;\n      this.filterRemoteStorageService = filterRemoteStorageService;\n      bindMethods(this);\n      this.taskboardTasksService.reset();\n      this.scope.userstories = [];\n      this.openFilter = false;\n      if (this.applyStoredFilters(this.params.pslug, \"tasks-filters\")) {\n        return;\n      }\n      this.scope.sectionName = this.translate.instant(\"TASKBOARD.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          return _this._setMeta();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      taiga.defineImmutableProperty(this.scope, \"usTasks\", (function(_this) {\n        return function() {\n          return _this.taskboardTasksService.usTasks;\n        };\n      })(this));\n    }\n\n    TaskboardController.prototype.setZoom = function(zoomLevel, zoom) {\n      if (this.zoomLevel !== zoomLevel) {\n        this.taskboardTasksService.resetFolds();\n      }\n      this.zoomLevel = zoomLevel;\n      this.zoom = zoom;\n      if (this.zoomLevel === '0') {\n        return this.rootscope.$broadcast(\"sprint:zoom0\");\n      }\n    };\n\n    TaskboardController.prototype.changeQ = function(q) {\n      this.replaceFilter(\"q\", q);\n      this.loadTasks();\n      return this.generateFilters();\n    };\n\n    TaskboardController.prototype.removeFilter = function(filter) {\n      this.unselectFilter(filter.dataType, filter.id);\n      this.loadTasks();\n      return this.generateFilters();\n    };\n\n    TaskboardController.prototype.addFilter = function(newFilter) {\n      this.selectFilter(newFilter.category.dataType, newFilter.filter.id);\n      this.loadTasks();\n      return this.generateFilters();\n    };\n\n    TaskboardController.prototype.selectCustomFilter = function(customFilter) {\n      this.replaceAllFilters(customFilter.filter);\n      this.loadTasks();\n      return this.generateFilters();\n    };\n\n    TaskboardController.prototype.removeCustomFilter = function(customFilter) {\n      return this.filterRemoteStorageService.getFilters(this.scope.projectId, 'tasks-custom-filters').then((function(_this) {\n        return function(userFilters) {\n          delete userFilters[customFilter.id];\n          return _this.filterRemoteStorageService.storeFilters(_this.scope.projectId, userFilters, 'tasks-custom-filters').then(_this.generateFilters);\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.saveCustomFilter = function(name) {\n      var filters, urlfilters;\n      filters = {};\n      urlfilters = this.location.search();\n      filters.tags = urlfilters.tags;\n      filters.status = urlfilters.status;\n      filters.assigned_to = urlfilters.assigned_to;\n      filters.owner = urlfilters.owner;\n      return this.filterRemoteStorageService.getFilters(this.scope.projectId, 'tasks-custom-filters').then((function(_this) {\n        return function(userFilters) {\n          userFilters[name] = filters;\n          return _this.filterRemoteStorageService.storeFilters(_this.scope.projectId, userFilters, 'tasks-custom-filters').then(_this.generateFilters);\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.generateFilters = function() {\n      var loadFilters, urlfilters;\n      this.storeFilters(this.params.pslug, this.location.search(), \"tasks-filters\");\n      urlfilters = this.location.search();\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.milestone = this.scope.sprintId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.assigned_to = urlfilters.assigned_to;\n      loadFilters.owner = urlfilters.owner;\n      loadFilters.q = urlfilters.q;\n      return this.q.all([this.rs.tasks.filtersData(loadFilters), this.filterRemoteStorageService.getFilters(this.scope.projectId, 'tasks-custom-filters')]).then((function(_this) {\n        return function(result) {\n          var assignedTo, customFiltersRaw, data, owner, selected, statuses, tags, tagsWithAtLeastOneElement;\n          data = result[0];\n          customFiltersRaw = result[1];\n          statuses = _.map(data.statuses, function(it) {\n            it.id = it.id.toString();\n            return it;\n          });\n          tags = _.map(data.tags, function(it) {\n            it.id = it.name;\n            return it;\n          });\n          tagsWithAtLeastOneElement = _.filter(tags, function(tag) {\n            return tag.count > 0;\n          });\n          assignedTo = _.map(data.assigned_to, function(it) {\n            if (it.id) {\n              it.id = it.id.toString();\n            } else {\n              it.id = \"null\";\n            }\n            it.name = it.full_name || \"Unassigned\";\n            return it;\n          });\n          owner = _.map(data.owners, function(it) {\n            it.id = it.id.toString();\n            it.name = it.full_name;\n            return it;\n          });\n          _this.selectedFilters = [];\n          if (loadFilters.status) {\n            selected = _this.formatSelectedFilters(\"status\", statuses, loadFilters.status);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.tags) {\n            selected = _this.formatSelectedFilters(\"tags\", tags, loadFilters.tags);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.assigned_to) {\n            selected = _this.formatSelectedFilters(\"assigned_to\", assignedTo, loadFilters.assigned_to);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.owner) {\n            selected = _this.formatSelectedFilters(\"owner\", owner, loadFilters.owner);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          _this.filterQ = loadFilters.q;\n          _this.filters = [\n            {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.STATUS\"),\n              dataType: \"status\",\n              content: statuses\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.TAGS\"),\n              dataType: \"tags\",\n              content: tags,\n              hideEmpty: true,\n              totalTaggedElements: tagsWithAtLeastOneElement.length\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.ASSIGNED_TO\"),\n              dataType: \"assigned_to\",\n              content: assignedTo\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.CREATED_BY\"),\n              dataType: \"owner\",\n              content: owner\n            }\n          ];\n          _this.customFilters = [];\n          return _.forOwn(customFiltersRaw, function(value, key) {\n            return _this.customFilters.push({\n              id: key,\n              name: key,\n              filter: value\n            });\n          });\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype._setMeta = function() {\n      var description, prettyDate, title;\n      prettyDate = this.translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      title = this.translate.instant(\"TASKBOARD.PAGE_TITLE\", {\n        projectName: this.scope.project.name,\n        sprintName: this.scope.sprint.name\n      });\n      description = this.translate.instant(\"TASKBOARD.PAGE_DESCRIPTION\", {\n        projectName: this.scope.project.name,\n        sprintName: this.scope.sprint.name,\n        startDate: moment(this.scope.sprint.estimated_start).format(prettyDate),\n        endDate: moment(this.scope.sprint.estimated_finish).format(prettyDate),\n        completedPercentage: this.scope.stats.completedPercentage || \"0\",\n        completedPoints: this.scope.stats.completedPointsSum || \"--\",\n        totalPoints: this.scope.stats.totalPointsSum || \"--\",\n        openTasks: this.scope.stats.openTasks || \"--\",\n        totalTasks: this.scope.stats.total_tasks || \"--\"\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    TaskboardController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"taskform:bulk:success\", (function(_this) {\n        return function(event, tasks) {\n          _this.refreshTagsColors().then(function() {\n            return _this.taskboardTasksService.add(tasks);\n          });\n          return _this.analytics.trackEvent(\"task\", \"create\", \"bulk create task on taskboard\", 1);\n        };\n      })(this));\n      this.scope.$on(\"taskform:new:success\", (function(_this) {\n        return function(event, task) {\n          _this.refreshTagsColors().then(function() {\n            return _this.taskboardTasksService.add(task);\n          });\n          return _this.analytics.trackEvent(\"task\", \"create\", \"create task on taskboard\", 1);\n        };\n      })(this));\n      this.scope.$on(\"taskform:edit:success\", (function(_this) {\n        return function(event, task) {\n          return _this.refreshTagsColors().then(function() {\n            return _this.taskboardTasksService.replaceModel(task);\n          });\n        };\n      })(this));\n      this.scope.$on(\"taskboard:task:move\", this.taskMove);\n      return this.scope.$on(\"assigned-to:added\", this.onAssignedToChanged);\n    };\n\n    TaskboardController.prototype.onAssignedToChanged = function(ctx, userid, taskModel) {\n      var promise;\n      taskModel.assigned_to = userid;\n      this.taskboardTasksService.replaceModel(taskModel);\n      promise = this.repo.save(taskModel);\n      return promise.then(null, function() {\n        return console.log(\"FAIL\");\n      });\n    };\n\n    TaskboardController.prototype.initializeSubscription = function() {\n      var routingKey, routingKey1;\n      routingKey = \"changes.project.\" + this.scope.projectId + \".tasks\";\n      this.events.subscribe(this.scope, routingKey, (function(_this) {\n        return function(message) {\n          return _this.loadTaskboard();\n        };\n      })(this));\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      return this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          _this.refreshTagsColors();\n          _this.loadSprintStats();\n          return _this.loadSprint();\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadProject = function() {\n      return this.rs.projects.get(this.scope.projectId).then((function(_this) {\n        return function(project) {\n          if (!project.is_backlog_activated) {\n            _this.errorHandlingService.permissionDenied();\n          }\n          _this.scope.project = project;\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(e) {\n            return e.id;\n          });\n          _this.scope.roleById = groupBy(project.roles, function(e) {\n            return e.id;\n          });\n          _this.scope.taskStatusList = _.sortBy(project.task_statuses, \"order\");\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(e) {\n            return e.id;\n          });\n          _this.scope.$emit('project:loaded', project);\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return project;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadSprintStats = function() {\n      return this.rs.sprints.stats(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(stats) {\n          var completedPointsSum, remainingPointsSum, remainingTasks, totalPointsSum;\n          totalPointsSum = _.reduce(_.values(stats.total_points), (function(res, n) {\n            return res + n;\n          }), 0);\n          completedPointsSum = _.reduce(_.values(stats.completed_points), (function(res, n) {\n            return res + n;\n          }), 0);\n          remainingPointsSum = totalPointsSum - completedPointsSum;\n          remainingTasks = stats.total_tasks - stats.completed_tasks;\n          _this.scope.stats = stats;\n          _this.scope.stats.totalPointsSum = totalPointsSum;\n          _this.scope.stats.completedPointsSum = completedPointsSum;\n          _this.scope.stats.remainingPointsSum = remainingPointsSum;\n          _this.scope.stats.remainingTasks = remainingTasks;\n          if (stats.totalPointsSum) {\n            _this.scope.stats.completedPercentage = Math.round(100 * stats.completedPointsSum / stats.totalPointsSum);\n          } else {\n            _this.scope.stats.completedPercentage = 0;\n          }\n          _this.scope.stats.openTasks = stats.total_tasks - stats.completed_tasks;\n          return stats;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.refreshTagsColors = function() {\n      return this.rs.projects.tagsColors(this.scope.projectId).then((function(_this) {\n        return function(tags_colors) {\n          return _this.scope.project.tags_colors = tags_colors._attrs;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadSprint = function() {\n      return this.rs.sprints.get(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(sprint) {\n          _this.scope.sprint = sprint;\n          _this.scope.userstories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          _this.taskboardTasksService.setUserstories(_this.scope.userstories);\n          return sprint;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadTasks = function() {\n      var params;\n      params = {\n        include_attachments: true\n      };\n      params = _.merge(params, this.location.search());\n      return this.rs.tasks.list(this.scope.projectId, this.scope.sprintId, null, params).then((function(_this) {\n        return function(tasks) {\n          _this.taskboardTasksService.init(_this.scope.project, _this.scope.usersById);\n          return _this.taskboardTasksService.set(tasks);\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadTaskboard = function() {\n      return this.q.all([\n        this.refreshTagsColors(), this.loadSprintStats(), this.loadSprint().then((function(_this) {\n          return function() {\n            return _this.loadTasks();\n          };\n        })(this))\n      ]);\n    };\n\n    TaskboardController.prototype.loadInitialData = function() {\n      var params, promise;\n      params = {\n        pslug: this.params.pslug,\n        sslug: this.params.sslug\n      };\n      promise = this.repo.resolve(params).then((function(_this) {\n        return function(data) {\n          _this.scope.projectId = data.project;\n          _this.scope.sprintId = data.milestone;\n          _this.initializeSubscription();\n          return data;\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function() {\n          return _this.loadProject();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          _this.generateFilters();\n          return _this.loadTaskboard().then(function() {\n            return _this.setRolePoints();\n          });\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.showPlaceHolder = function(statusId, usId) {\n      if (!this.taskboardTasksService.tasksRaw.length) {\n        if (this.scope.taskStatusList[0].id === statusId && (!this.scope.userstories.length || this.scope.userstories[0].id === usId)) {\n          return true;\n        }\n      }\n      return false;\n    };\n\n    TaskboardController.prototype.editTask = function(id) {\n      var task;\n      task = this.taskboardTasksService.getTask(id);\n      task = task.set('loading', true);\n      this.taskboardTasksService.replace(task);\n      return this.rs.tasks.getByRef(task.getIn(['model', 'project']), task.getIn(['model', 'ref'])).then((function(_this) {\n        return function(editingTask) {\n          return _this.rs2.attachments.list(\"task\", task.get('id'), task.getIn(['model', 'project'])).then(function(attachments) {\n            _this.rootscope.$broadcast(\"taskform:edit\", editingTask, attachments.toJS());\n            task = task.set('loading', false);\n            return _this.taskboardTasksService.replace(task);\n          });\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.taskMove = function(ctx, task, oldStatusId, usId, statusId, order) {\n      var moveUpdateData, options, params, promise;\n      task = this.taskboardTasksService.getTaskModel(task.get('id'));\n      moveUpdateData = this.taskboardTasksService.move(task.id, usId, statusId, order);\n      params = {\n        status__is_archived: false,\n        include_attachments: true\n      };\n      options = {\n        headers: {\n          \"set-orders\": JSON.stringify(moveUpdateData.set_orders)\n        }\n      };\n      return promise = this.repo.save(task, true, params, options, true).then((function(_this) {\n        return function(result) {\n          var headers;\n          headers = result[1];\n          if (headers && headers['taiga-info-order-updated']) {\n            order = JSON.parse(headers['taiga-info-order-updated']);\n            _this.taskboardTasksService.assignOrders(order);\n          }\n          return _this.loadSprintStats();\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.addNewTask = function(type, us) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"taskform:new\", this.scope.sprintId, us != null ? us.id : void 0);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"taskform:bulk\", this.scope.sprintId, us != null ? us.id : void 0);\n      }\n    };\n\n    TaskboardController.prototype.toggleFold = function(id) {\n      return this.taskboardTasksService.toggleFold(id);\n    };\n\n    TaskboardController.prototype.changeTaskAssignedTo = function(id) {\n      var task;\n      task = this.taskboardTasksService.getTaskModel(id);\n      return this.rootscope.$broadcast(\"assigned-to:add\", task);\n    };\n\n    TaskboardController.prototype.setRolePoints = function() {\n      var computableRoles, getPoint, getRole, pointsByRole;\n      computableRoles = _.filter(this.scope.project.roles, \"computable\");\n      getRole = (function(_this) {\n        return function(roleId) {\n          roleId = parseInt(roleId, 10);\n          return _.find(computableRoles, function(role) {\n            return role.id === roleId;\n          });\n        };\n      })(this);\n      getPoint = (function(_this) {\n        return function(pointId) {\n          var poitnId;\n          poitnId = parseInt(pointId, 10);\n          return _.find(_this.scope.project.points, function(point) {\n            return point.id === pointId;\n          });\n        };\n      })(this);\n      pointsByRole = _.reduce(this.scope.userstories, (function(_this) {\n        return function(result, us, key) {\n          _.forOwn(us.points, function(pointId, roleId) {\n            var point, role;\n            role = getRole(roleId);\n            point = getPoint(pointId);\n            if (!result[role.id]) {\n              result[role.id] = role;\n              result[role.id].points = 0;\n            }\n            return result[role.id].points += point.value;\n          });\n          return result;\n        };\n      })(this), {});\n      return this.scope.pointsByRole = Object.keys(pointsByRole).map(function(key) {\n        return pointsByRole[key];\n      });\n    };\n\n    return TaskboardController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"TaskboardController\", TaskboardController);\n\n  TaskboardDirective = function($rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, tableBodyDom;\n      $ctrl = $el.controller();\n      $el.on(\"click\", \".toggle-analytics-visibility\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.toggleClass('active');\n        return $rootscope.$broadcast(\"taskboard:graph:toggle-visibility\");\n      });\n      tableBodyDom = $el.find(\".taskboard-table-body\");\n      tableBodyDom.on(\"scroll\", function(event) {\n        var tableHeaderDom, target;\n        target = angular.element(event.currentTarget);\n        tableHeaderDom = $el.find(\".taskboard-table-header .taskboard-table-inner\");\n        return tableHeaderDom.css(\"left\", -1 * target.scrollLeft());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboard\", [\"$rootScope\", TaskboardDirective]);\n\n  TaskboardSquishColumnDirective = function(rs) {\n    var avatarWidth, link, maxColumnWidth;\n    avatarWidth = 40;\n    maxColumnWidth = 300;\n    link = function($scope, $el, $attrs) {\n      var getCeilWidth, recalculateStatusColumnWidth, recalculateTaskboardWidth, refreshTaskboardTableWidth, setStatusColumnWidth;\n      $scope.$on(\"sprint:zoom0\", (function(_this) {\n        return function() {\n          return recalculateTaskboardWidth();\n        };\n      })(this));\n      $scope.$on(\"sprint:task:moved\", (function(_this) {\n        return function() {\n          return recalculateTaskboardWidth();\n        };\n      })(this));\n      $scope.$watch(\"usTasks\", function() {\n        if ($scope.project) {\n          $scope.statusesFolded = rs.tasks.getStatusColumnModes($scope.project.id);\n          $scope.usFolded = rs.tasks.getUsRowModes($scope.project.id, $scope.sprintId);\n          return recalculateTaskboardWidth();\n        }\n      });\n      $scope.foldStatus = function(status) {\n        $scope.statusesFolded[status.id] = !!!$scope.statusesFolded[status.id];\n        rs.tasks.storeStatusColumnModes($scope.projectId, $scope.statusesFolded);\n        return recalculateTaskboardWidth();\n      };\n      $scope.foldUs = function(us) {\n        if (!us) {\n          $scope.usFolded[null] = !!!$scope.usFolded[null];\n        } else {\n          $scope.usFolded[us.id] = !!!$scope.usFolded[us.id];\n        }\n        rs.tasks.storeUsRowModes($scope.projectId, $scope.sprintId, $scope.usFolded);\n        return recalculateTaskboardWidth();\n      };\n      getCeilWidth = (function(_this) {\n        return function(usId, statusId) {\n          var tasks, tasksMatrixSize, width;\n          if (usId) {\n            tasks = $scope.usTasks.getIn([usId.toString(), statusId.toString()]).size;\n          } else {\n            tasks = $scope.usTasks.getIn(['null', statusId.toString()]).size;\n          }\n          if ($scope.statusesFolded[statusId]) {\n            if (tasks && $scope.usFolded[usId]) {\n              tasksMatrixSize = Math.round(Math.sqrt(tasks));\n              width = avatarWidth * tasksMatrixSize;\n            } else {\n              width = avatarWidth;\n            }\n            return width;\n          }\n          return 0;\n        };\n      })(this);\n      setStatusColumnWidth = (function(_this) {\n        return function(statusId, width) {\n          var column;\n          column = $el.find(\".squish-status-\" + statusId);\n          if (width) {\n            return column.css('max-width', width);\n          } else {\n            if ($scope.ctrl.zoomLevel === '0') {\n              return column.css(\"max-width\", 148);\n            } else {\n              return column.css(\"max-width\", maxColumnWidth);\n            }\n          }\n        };\n      })(this);\n      refreshTaskboardTableWidth = (function(_this) {\n        return function() {\n          var columnWidths, columns, totalWidth;\n          columnWidths = [];\n          columns = $el.find(\".task-colum-name\");\n          columnWidths = _.map(columns, function(column) {\n            return $(column).outerWidth(true);\n          });\n          totalWidth = _.reduce(columnWidths, function(total, width) {\n            return total + width;\n          });\n          return $el.find('.taskboard-table-inner').css(\"width\", totalWidth);\n        };\n      })(this);\n      recalculateStatusColumnWidth = (function(_this) {\n        return function(statusId) {\n          var statusFoldedWidth;\n          statusFoldedWidth = getCeilWidth(null, statusId);\n          _.forEach($scope.userstories, function(us) {\n            var width;\n            width = getCeilWidth(us.id, statusId);\n            if (width > statusFoldedWidth) {\n              return statusFoldedWidth = width;\n            }\n          });\n          return setStatusColumnWidth(statusId, statusFoldedWidth);\n        };\n      })(this);\n      return recalculateTaskboardWidth = (function(_this) {\n        return function() {\n          _.forEach($scope.taskStatusList, function(status) {\n            return recalculateStatusColumnWidth(status.id);\n          });\n          refreshTaskboardTableWidth();\n        };\n      })(this);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardSquishColumn\", [\"$tgResources\", TaskboardSquishColumnDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/sortable.coffee\n */\n\n(function() {\n  var TaskboardSortableDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaBacklog\");\n\n  TaskboardSortableDirective = function($repo, $rs, $rootscope, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var unwatch;\n      return unwatch = $scope.$watch(\"usTasks\", function(usTasks) {\n        var containers, deleteElement, drake, filterError, itemEl, newParentScope, oldParentScope, scroll, tdom;\n        if (!usTasks || !usTasks.size) {\n          return;\n        }\n        unwatch();\n        if (!($scope.project.my_permissions.indexOf(\"modify_task\") > -1)) {\n          return;\n        }\n        oldParentScope = null;\n        newParentScope = null;\n        itemEl = null;\n        tdom = $el;\n        filterError = function() {\n          var text;\n          text = $translate.instant(\"BACKLOG.SORTABLE_FILTER_ERROR\");\n          return $tgConfirm.notify(\"error\", text);\n        };\n        deleteElement = function(itemEl) {\n          itemEl.scope().$destroy();\n          itemEl.off();\n          return itemEl.remove();\n        };\n        containers = _.map($el.find('.task-column'), function(item) {\n          return item;\n        });\n        drake = dragula(containers, {\n          copySortSource: false,\n          copy: false,\n          mirrorContainer: $el[0],\n          accepts: function(el, target) {\n            return !$(target).hasClass('taskboard-userstory-box');\n          },\n          moves: function(item) {\n            return $(item).is('tg-card');\n          }\n        });\n        drake.on('drag', function(item) {\n          oldParentScope = $(item).parent().scope();\n          if ($el.hasClass(\"active-filters\")) {\n            filterError();\n            setTimeout((function() {\n              return drake.cancel(true);\n            }), 0);\n            return false;\n          }\n        });\n        drake.on('dragend', function(item) {\n          var itemIndex, itemTask, newStatusId, newUsId, oldStatusId, oldUsId, parentEl;\n          parentEl = $(item).parent();\n          itemEl = $(item);\n          itemTask = itemEl.scope().task;\n          itemIndex = itemEl.index();\n          newParentScope = parentEl.scope();\n          oldUsId = oldParentScope.us ? oldParentScope.us.id : null;\n          oldStatusId = oldParentScope.st.id;\n          newUsId = newParentScope.us ? newParentScope.us.id : null;\n          newStatusId = newParentScope.st.id;\n          if (newStatusId !== oldStatusId || newUsId !== oldUsId) {\n            deleteElement(itemEl);\n          }\n          return $scope.$apply(function() {\n            return $rootscope.$broadcast(\"taskboard:task:move\", itemTask, itemTask.getIn(['model', 'status']), newUsId, newStatusId, itemIndex);\n          });\n        });\n        scroll = autoScroll([$('.taskboard-table-body')[0]], {\n          margin: 100,\n          pixels: 30,\n          scrollWhenOutside: true,\n          autoScroll: function() {\n            return this.down && drake.dragging;\n          }\n        });\n        return $scope.$on(\"$destroy\", function() {\n          $el.off();\n          return drake.destroy();\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"$translate\", TaskboardSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.service.coffee\n */\n\n(function() {\n  var TaskboardTasksService, groupBy,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  groupBy = this.taiga.groupBy;\n\n  TaskboardTasksService = (function(superClass) {\n    extend(TaskboardTasksService, superClass);\n\n    TaskboardTasksService.$inject = [];\n\n    function TaskboardTasksService() {\n      this.reset();\n    }\n\n    TaskboardTasksService.prototype.reset = function() {\n      this.tasksRaw = [];\n      this.foldStatusChanged = {};\n      return this.usTasks = Immutable.Map();\n    };\n\n    TaskboardTasksService.prototype.init = function(project, usersById) {\n      this.project = project;\n      return this.usersById = usersById;\n    };\n\n    TaskboardTasksService.prototype.resetFolds = function() {\n      this.foldStatusChanged = {};\n      return this.refresh();\n    };\n\n    TaskboardTasksService.prototype.toggleFold = function(taskId) {\n      this.foldStatusChanged[taskId] = !this.foldStatusChanged[taskId];\n      return this.refresh();\n    };\n\n    TaskboardTasksService.prototype.add = function(task) {\n      this.tasksRaw = this.tasksRaw.concat(task);\n      return this.refresh();\n    };\n\n    TaskboardTasksService.prototype.set = function(tasks) {\n      this.tasksRaw = tasks;\n      this.refreshRawOrder();\n      return this.refresh();\n    };\n\n    TaskboardTasksService.prototype.setUserstories = function(userstories) {\n      return this.userstories = userstories;\n    };\n\n    TaskboardTasksService.prototype.refreshRawOrder = function() {\n      var i, len, ref, results, task;\n      this.order = {};\n      ref = this.tasksRaw;\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        task = ref[i];\n        results.push(this.order[task.id] = task.taskboard_order);\n      }\n      return results;\n    };\n\n    TaskboardTasksService.prototype.assignOrders = function(order) {\n      order = _.invert(order);\n      this.order = _.assign(this.order, order);\n      return this.refresh();\n    };\n\n    TaskboardTasksService.prototype.getTask = function(id) {\n      var findedTask;\n      findedTask = null;\n      this.usTasks.forEach(function(us) {\n        us.forEach(function(status) {\n          findedTask = status.find(function(task) {\n            return task.get('id') === id;\n          });\n          if (findedTask) {\n            return false;\n          }\n        });\n        if (findedTask) {\n          return false;\n        }\n      });\n      return findedTask;\n    };\n\n    TaskboardTasksService.prototype.replace = function(task) {\n      return this.usTasks = this.usTasks.map(function(us) {\n        return us.map(function(status) {\n          var findedIndex;\n          findedIndex = status.findIndex(function(usItem) {\n            return usItem.get('id') === us.get('id');\n          });\n          if (findedIndex !== -1) {\n            status = status.set(findedIndex, task);\n          }\n          return status;\n        });\n      });\n    };\n\n    TaskboardTasksService.prototype.getTaskModel = function(id) {\n      return _.find(this.tasksRaw, function(task) {\n        return task.id === id;\n      });\n    };\n\n    TaskboardTasksService.prototype.replaceModel = function(task) {\n      this.tasksRaw = _.map(this.tasksRaw, function(it) {\n        if (task.id === it.id) {\n          return task;\n        } else {\n          return it;\n        }\n      });\n      return this.refresh();\n    };\n\n    TaskboardTasksService.prototype.move = function(id, usId, statusId, index) {\n      var afterDestination, beforeDestination, i, it, j, key, len, len1, previous, previousWithTheSameOrder, setOrders, taksWithoutMoved, task, taskByUsStatus;\n      task = this.getTaskModel(id);\n      taskByUsStatus = _.filter(this.tasksRaw, (function(_this) {\n        return function(task) {\n          return task.status === statusId && task.user_story === usId;\n        };\n      })(this));\n      taskByUsStatus = _.sortBy(taskByUsStatus, (function(_this) {\n        return function(it) {\n          return _this.order[it.id];\n        };\n      })(this));\n      taksWithoutMoved = _.filter(taskByUsStatus, (function(_this) {\n        return function(it) {\n          return it.id !== id;\n        };\n      })(this));\n      beforeDestination = _.slice(taksWithoutMoved, 0, index);\n      afterDestination = _.slice(taksWithoutMoved, index);\n      setOrders = {};\n      previous = beforeDestination[beforeDestination.length - 1];\n      previousWithTheSameOrder = _.filter(beforeDestination, (function(_this) {\n        return function(it) {\n          return _this.order[it.id] === _this.order[previous.id];\n        };\n      })(this));\n      if (previousWithTheSameOrder.length > 1) {\n        for (i = 0, len = previousWithTheSameOrder.length; i < len; i++) {\n          it = previousWithTheSameOrder[i];\n          setOrders[it.id] = this.order[it.id];\n        }\n      }\n      if (!previous) {\n        this.order[task.id] = 0;\n      } else if (previous) {\n        this.order[task.id] = this.order[previous.id] + 1;\n      }\n      for (key = j = 0, len1 = afterDestination.length; j < len1; key = ++j) {\n        it = afterDestination[key];\n        this.order[it.id] = this.order[task.id] + key + 1;\n      }\n      task.status = statusId;\n      task.user_story = usId;\n      task.taskboard_order = this.order[task.id];\n      this.refresh();\n      return {\n        \"task_id\": task.id,\n        \"order\": this.order[task.id],\n        \"set_orders\": setOrders\n      };\n    };\n\n    TaskboardTasksService.prototype.refresh = function() {\n      var i, j, k, len, len1, len2, ref, status, task, taskModel, taskStatusList, tasks, us, usTasks;\n      this.tasksRaw = _.sortBy(this.tasksRaw, (function(_this) {\n        return function(it) {\n          return _this.order[it.id];\n        };\n      })(this));\n      tasks = this.tasksRaw;\n      taskStatusList = _.sortBy(this.project.task_statuses, \"order\");\n      usTasks = {};\n      ref = _.union(this.userstories, [\n        {\n          id: null\n        }\n      ]);\n      for (i = 0, len = ref.length; i < len; i++) {\n        us = ref[i];\n        usTasks[us.id] = {};\n        for (j = 0, len1 = taskStatusList.length; j < len1; j++) {\n          status = taskStatusList[j];\n          usTasks[us.id][status.id] = [];\n        }\n      }\n      for (k = 0, len2 = tasks.length; k < len2; k++) {\n        taskModel = tasks[k];\n        if ((usTasks[taskModel.user_story] != null) && (usTasks[taskModel.user_story][taskModel.status] != null)) {\n          task = {};\n          task.foldStatusChanged = this.foldStatusChanged[taskModel.id];\n          task.model = taskModel.getAttrs();\n          task.images = _.filter(taskModel.attachments, function(it) {\n            return !!it.thumbnail_card_url;\n          });\n          task.id = taskModel.id;\n          task.assigned_to = this.usersById[taskModel.assigned_to];\n          task.colorized_tags = _.map(task.model.tags, (function(_this) {\n            return function(tag) {\n              return {\n                name: tag[0],\n                color: tag[1]\n              };\n            };\n          })(this));\n          usTasks[taskModel.user_story][taskModel.status].push(task);\n        }\n      }\n      return this.usTasks = Immutable.fromJS(usTasks);\n    };\n\n    return TaskboardTasksService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaKanban\").service(\"tgTaskboardTasks\", TaskboardTasksService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: kanban-userstories.service.coffee\n */\n\n(function() {\n  var KanbanUserstoriesService, groupBy,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  groupBy = this.taiga.groupBy;\n\n  KanbanUserstoriesService = (function(superClass) {\n    extend(KanbanUserstoriesService, superClass);\n\n    KanbanUserstoriesService.$inject = [];\n\n    function KanbanUserstoriesService() {\n      this.reset();\n    }\n\n    KanbanUserstoriesService.prototype.reset = function() {\n      this.userstoriesRaw = [];\n      this.archivedStatus = [];\n      this.statusHide = [];\n      this.foldStatusChanged = {};\n      return this.usByStatus = Immutable.Map();\n    };\n\n    KanbanUserstoriesService.prototype.init = function(project, usersById) {\n      this.project = project;\n      return this.usersById = usersById;\n    };\n\n    KanbanUserstoriesService.prototype.resetFolds = function() {\n      this.foldStatusChanged = {};\n      return this.refresh();\n    };\n\n    KanbanUserstoriesService.prototype.toggleFold = function(usId) {\n      this.foldStatusChanged[usId] = !this.foldStatusChanged[usId];\n      return this.refresh();\n    };\n\n    KanbanUserstoriesService.prototype.set = function(userstories) {\n      this.userstoriesRaw = userstories;\n      this.refreshRawOrder();\n      return this.refresh();\n    };\n\n    KanbanUserstoriesService.prototype.add = function(us) {\n      this.userstoriesRaw = this.userstoriesRaw.concat(us);\n      this.refreshRawOrder();\n      return this.refresh();\n    };\n\n    KanbanUserstoriesService.prototype.addArchivedStatus = function(statusId) {\n      return this.archivedStatus.push(statusId);\n    };\n\n    KanbanUserstoriesService.prototype.isUsInArchivedHiddenStatus = function(usId) {\n      var us;\n      us = this.getUsModel(usId);\n      return this.archivedStatus.indexOf(us.status) !== -1 && this.statusHide.indexOf(us.status) !== -1;\n    };\n\n    KanbanUserstoriesService.prototype.hideStatus = function(statusId) {\n      this.deleteStatus(statusId);\n      return this.statusHide.push(statusId);\n    };\n\n    KanbanUserstoriesService.prototype.showStatus = function(statusId) {\n      return _.remove(this.statusHide, function(it) {\n        return it === statusId;\n      });\n    };\n\n    KanbanUserstoriesService.prototype.getStatus = function(statusId) {\n      return _.filter(this.userstoriesRaw, function(us) {\n        return us.status === statusId;\n      });\n    };\n\n    KanbanUserstoriesService.prototype.deleteStatus = function(statusId) {\n      var toDelete;\n      toDelete = _.filter(this.userstoriesRaw, function(us) {\n        return us.status === statusId;\n      });\n      toDelete = _.map(function(it) {\n        return it.id;\n      });\n      this.archived = _.difference(this.archived, toDelete);\n      this.userstoriesRaw = _.filter(this.userstoriesRaw, function(us) {\n        return us.status !== statusId;\n      });\n      return this.refresh();\n    };\n\n    KanbanUserstoriesService.prototype.refreshRawOrder = function() {\n      var i, it, len, ref, results;\n      this.order = {};\n      ref = this.userstoriesRaw;\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        it = ref[i];\n        results.push(this.order[it.id] = it.kanban_order);\n      }\n      return results;\n    };\n\n    KanbanUserstoriesService.prototype.assignOrders = function(order) {\n      order = _.invert(order);\n      this.order = _.assign(this.order, order);\n      return this.refresh();\n    };\n\n    KanbanUserstoriesService.prototype.move = function(id, statusId, index) {\n      var afterDestination, beforeDestination, i, it, j, key, len, len1, previous, previousWithTheSameOrder, setOrders, us, usByStatus, usByStatusWithoutMoved;\n      us = this.getUsModel(id);\n      usByStatus = _.filter(this.userstoriesRaw, (function(_this) {\n        return function(it) {\n          return it.status === statusId;\n        };\n      })(this));\n      usByStatus = _.sortBy(usByStatus, (function(_this) {\n        return function(it) {\n          return _this.order[it.id];\n        };\n      })(this));\n      usByStatusWithoutMoved = _.filter(usByStatus, (function(_this) {\n        return function(it) {\n          return it.id !== id;\n        };\n      })(this));\n      beforeDestination = _.slice(usByStatusWithoutMoved, 0, index);\n      afterDestination = _.slice(usByStatusWithoutMoved, index);\n      setOrders = {};\n      previous = beforeDestination[beforeDestination.length - 1];\n      previousWithTheSameOrder = _.filter(beforeDestination, (function(_this) {\n        return function(it) {\n          return _this.order[it.id] === _this.order[previous.id];\n        };\n      })(this));\n      if (previousWithTheSameOrder.length > 1) {\n        for (i = 0, len = previousWithTheSameOrder.length; i < len; i++) {\n          it = previousWithTheSameOrder[i];\n          setOrders[it.id] = this.order[it.id];\n        }\n      }\n      if (!previous) {\n        this.order[us.id] = 0;\n      } else if (previous) {\n        this.order[us.id] = this.order[previous.id] + 1;\n      }\n      for (key = j = 0, len1 = afterDestination.length; j < len1; key = ++j) {\n        it = afterDestination[key];\n        this.order[it.id] = this.order[us.id] + key + 1;\n      }\n      us.status = statusId;\n      us.kanban_order = this.order[us.id];\n      this.refresh();\n      return {\n        \"us_id\": us.id,\n        \"order\": this.order[us.id],\n        \"set_orders\": setOrders\n      };\n    };\n\n    KanbanUserstoriesService.prototype.replace = function(us) {\n      return this.usByStatus = this.usByStatus.map(function(status) {\n        var findedIndex;\n        findedIndex = status.findIndex(function(usItem) {\n          return usItem.get('id') === us.get('id');\n        });\n        if (findedIndex !== -1) {\n          status = status.set(findedIndex, us);\n        }\n        return status;\n      });\n    };\n\n    KanbanUserstoriesService.prototype.replaceModel = function(us) {\n      this.userstoriesRaw = _.map(this.userstoriesRaw, function(usItem) {\n        if (us.id === usItem.id) {\n          return us;\n        } else {\n          return usItem;\n        }\n      });\n      return this.refresh();\n    };\n\n    KanbanUserstoriesService.prototype.getUs = function(id) {\n      var findedUs;\n      findedUs = null;\n      this.usByStatus.forEach(function(status) {\n        findedUs = status.find(function(us) {\n          return us.get('id') === id;\n        });\n        if (findedUs) {\n          return false;\n        }\n      });\n      return findedUs;\n    };\n\n    KanbanUserstoriesService.prototype.getUsModel = function(id) {\n      return _.find(this.userstoriesRaw, function(us) {\n        return us.id === id;\n      });\n    };\n\n    KanbanUserstoriesService.prototype.refresh = function() {\n      var usByStatus, userstories;\n      this.userstoriesRaw = _.sortBy(this.userstoriesRaw, (function(_this) {\n        return function(it) {\n          return _this.order[it.id];\n        };\n      })(this));\n      userstories = this.userstoriesRaw;\n      userstories = _.map(userstories, (function(_this) {\n        return function(usModel) {\n          var us;\n          us = {};\n          us.foldStatusChanged = _this.foldStatusChanged[usModel.id];\n          us.model = usModel.getAttrs();\n          us.images = _.filter(usModel.attachments, function(it) {\n            return !!it.thumbnail_card_url;\n          });\n          us.id = usModel.id;\n          us.assigned_to = _this.usersById[usModel.assigned_to];\n          us.colorized_tags = _.map(us.model.tags, function(tag) {\n            return {\n              name: tag[0],\n              color: tag[1]\n            };\n          });\n          return us;\n        };\n      })(this));\n      usByStatus = _.groupBy(userstories, function(us) {\n        return us.model.status;\n      });\n      return this.usByStatus = Immutable.fromJS(usByStatus);\n    };\n\n    return KanbanUserstoriesService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaKanban\").service(\"tgKanbanUserstories\", KanbanUserstoriesService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban/main.coffee\n */\n\n(function() {\n  var KanbanArchivedStatusHeaderDirective, KanbanArchivedStatusIntroDirective, KanbanController, KanbanDirective, KanbanSquishColumnDirective, KanbanWipLimitDirective, bindMethods, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaKanban\");\n\n  KanbanController = (function(superClass) {\n    extend(KanbanController, superClass);\n\n    KanbanController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"tgErrorHandlingService\", \"$tgModel\", \"tgKanbanUserstories\", \"$tgStorage\", \"tgFilterRemoteStorageService\"];\n\n    KanbanController.prototype.storeCustomFiltersName = 'kanban-custom-filters';\n\n    KanbanController.prototype.storeFiltersName = 'kanban-filters';\n\n    function KanbanController(scope, rootscope, repo, confirm, rs1, rs2, params1, q, location, appMetaService, navUrls, events, analytics, translate, errorHandlingService, model, kanbanUserstoriesService1, storage, filterRemoteStorageService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.rs2 = rs2;\n      this.params = params1;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      this.model = model;\n      this.kanbanUserstoriesService = kanbanUserstoriesService1;\n      this.storage = storage;\n      this.filterRemoteStorageService = filterRemoteStorageService;\n      bindMethods(this);\n      this.kanbanUserstoriesService.reset();\n      this.openFilter = false;\n      if (this.applyStoredFilters(this.params.pslug, \"kanban-filters\")) {\n        return;\n      }\n      this.scope.sectionName = this.translate.instant(\"KANBAN.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"KANBAN.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"KANBAN.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      taiga.defineImmutableProperty(this.scope, \"usByStatus\", (function(_this) {\n        return function() {\n          return _this.kanbanUserstoriesService.usByStatus;\n        };\n      })(this));\n    }\n\n    KanbanController.prototype.setZoom = function(zoomLevel, zoom) {\n      if (this.zoomLevel !== zoomLevel) {\n        this.kanbanUserstoriesService.resetFolds();\n      }\n      this.zoomLevel = zoomLevel;\n      return this.zoom = zoom;\n    };\n\n    KanbanController.prototype.filtersReloadContent = function() {\n      return this.loadUserstories().then((function(_this) {\n        return function() {\n          var i, len, openArchived, results, statusId;\n          openArchived = _.difference(_this.kanbanUserstoriesService.archivedStatus, _this.kanbanUserstoriesService.statusHide);\n          if (openArchived.length) {\n            results = [];\n            for (i = 0, len = openArchived.length; i < len; i++) {\n              statusId = openArchived[i];\n              results.push(_this.loadUserStoriesForStatus({}, statusId));\n            }\n            return results;\n          }\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"usform:new:success\", (function(_this) {\n        return function(event, us) {\n          _this.refreshTagsColors().then(function() {\n            return _this.kanbanUserstoriesService.add(us);\n          });\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"create userstory on kanban\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:bulk:success\", (function(_this) {\n        return function(event, uss) {\n          _this.refreshTagsColors().then(function() {\n            return _this.kanbanUserstoriesService.add(uss);\n          });\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"bulk create userstory on kanban\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:edit:success\", (function(_this) {\n        return function(event, us) {\n          return _this.refreshTagsColors().then(function() {\n            return _this.kanbanUserstoriesService.replaceModel(us);\n          });\n        };\n      })(this));\n      this.scope.$on(\"assigned-to:added\", this.onAssignedToChanged);\n      this.scope.$on(\"kanban:us:move\", this.moveUs);\n      this.scope.$on(\"kanban:show-userstories-for-status\", this.loadUserStoriesForStatus);\n      return this.scope.$on(\"kanban:hide-userstories-for-status\", this.hideUserStoriesForStatus);\n    };\n\n    KanbanController.prototype.addNewUs = function(type, statusId) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"usform:new\", this.scope.projectId, statusId, this.scope.usStatusList);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"usform:bulk\", this.scope.projectId, statusId);\n      }\n    };\n\n    KanbanController.prototype.editUs = function(id) {\n      var us;\n      us = this.kanbanUserstoriesService.getUs(id);\n      us = us.set('loading', true);\n      this.kanbanUserstoriesService.replace(us);\n      return this.rs.userstories.getByRef(us.getIn(['model', 'project']), us.getIn(['model', 'ref'])).then((function(_this) {\n        return function(editingUserStory) {\n          return _this.rs2.attachments.list(\"us\", us.get('id'), us.getIn(['model', 'project'])).then(function(attachments) {\n            _this.rootscope.$broadcast(\"usform:edit\", editingUserStory, attachments.toJS());\n            us = us.set('loading', false);\n            return _this.kanbanUserstoriesService.replace(us);\n          });\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.showPlaceHolder = function(statusId) {\n      if (this.scope.usStatusList[0].id === statusId && !this.kanbanUserstoriesService.userstoriesRaw.length) {\n        return true;\n      }\n      return false;\n    };\n\n    KanbanController.prototype.toggleFold = function(id) {\n      return this.kanbanUserstoriesService.toggleFold(id);\n    };\n\n    KanbanController.prototype.isUsInArchivedHiddenStatus = function(usId) {\n      return this.kanbanUserstoriesService.isUsInArchivedHiddenStatus(usId);\n    };\n\n    KanbanController.prototype.changeUsAssignedTo = function(id) {\n      var us;\n      us = this.kanbanUserstoriesService.getUsModel(id);\n      return this.rootscope.$broadcast(\"assigned-to:add\", us);\n    };\n\n    KanbanController.prototype.onAssignedToChanged = function(ctx, userid, usModel) {\n      var promise;\n      usModel.assigned_to = userid;\n      this.kanbanUserstoriesService.replaceModel(usModel);\n      promise = this.repo.save(usModel);\n      return promise.then(null, function() {\n        return console.log(\"FAIL\");\n      });\n    };\n\n    KanbanController.prototype.refreshTagsColors = function() {\n      return this.rs.projects.tagsColors(this.scope.projectId).then((function(_this) {\n        return function(tags_colors) {\n          return _this.scope.project.tags_colors = tags_colors._attrs;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.loadUserstories = function() {\n      var params, promise;\n      params = {\n        status__is_archived: false,\n        include_attachments: true,\n        include_tasks: true\n      };\n      params = _.merge(params, this.location.search());\n      promise = this.rs.userstories.listAll(this.scope.projectId, params).then((function(_this) {\n        return function(userstories) {\n          _this.kanbanUserstoriesService.init(_this.scope.project, _this.scope.usersById);\n          _this.kanbanUserstoriesService.set(userstories);\n          scopeDefer(_this.scope, function() {\n            return _this.scope.$broadcast(\"userstories:loaded\", userstories);\n          });\n          return userstories;\n        };\n      })(this));\n      promise.then((function(_this) {\n        return function() {\n          return _this.scope.$broadcast(\"redraw:wip\");\n        };\n      })(this));\n      return promise;\n    };\n\n    KanbanController.prototype.loadUserStoriesForStatus = function(ctx, statusId) {\n      var filteredStatus, params;\n      filteredStatus = this.location.search().status;\n      if (filteredStatus) {\n        filteredStatus = filteredStatus.split(\",\").map(function(it) {\n          return parseInt(it, 10);\n        });\n        if (filteredStatus.indexOf(statusId) === -1) {\n          return;\n        }\n      }\n      params = {\n        status: statusId,\n        include_attachments: true,\n        include_tasks: true\n      };\n      params = _.merge(params, this.location.search());\n      return this.rs.userstories.listAll(this.scope.projectId, params).then((function(_this) {\n        return function(userstories) {\n          _this.scope.$broadcast(\"kanban:shown-userstories-for-status\", statusId, userstories);\n          return userstories;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.hideUserStoriesForStatus = function(ctx, statusId) {\n      return this.scope.$broadcast(\"kanban:hidden-userstories-for-status\", statusId);\n    };\n\n    KanbanController.prototype.loadKanban = function() {\n      return this.q.all([this.refreshTagsColors(), this.loadUserstories()]);\n    };\n\n    KanbanController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_kanban_activated) {\n            _this.errorHandlingService.permissionDenied();\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.projectId = project.id;\n          _this.scope.points = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.scope.$emit(\"project:loaded\", project);\n          return project;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.initializeSubscription = function() {\n      var routingKey1;\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      return this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          return _this.loadUserstories();\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.initializeSubscription();\n          _this.loadKanban();\n          return _this.generateFilters();\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.prepareBulkUpdateData = function(uses, field) {\n      if (field == null) {\n        field = \"kanban_order\";\n      }\n      return _.map(uses, function(x) {\n        return {\n          \"us_id\": x.id,\n          \"order\": x[field]\n        };\n      });\n    };\n\n    KanbanController.prototype.moveUs = function(ctx, us, oldStatusId, newStatusId, index) {\n      var moveUpdateData, options, params, promise;\n      us = this.kanbanUserstoriesService.getUsModel(us.get('id'));\n      moveUpdateData = this.kanbanUserstoriesService.move(us.id, newStatusId, index);\n      params = {\n        include_attachments: true,\n        include_tasks: true\n      };\n      options = {\n        headers: {\n          \"set-orders\": JSON.stringify(moveUpdateData.set_orders)\n        }\n      };\n      promise = this.repo.save(us, true, params, options, true);\n      promise = promise.then((function(_this) {\n        return function(result) {\n          var headers, order;\n          headers = result[1];\n          if (headers && headers['taiga-info-order-updated']) {\n            order = JSON.parse(headers['taiga-info-order-updated']);\n            return _this.kanbanUserstoriesService.assignOrders(order);\n          }\n        };\n      })(this));\n      return promise;\n    };\n\n    return KanbanController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin, taiga.UsFiltersMixin));\n\n  module.controller(\"KanbanController\", KanbanController);\n\n  KanbanDirective = function($repo, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var tableBodyDom;\n      tableBodyDom = $el.find(\".kanban-table-body\");\n      tableBodyDom.on(\"scroll\", function(event) {\n        var tableHeaderDom, target;\n        target = angular.element(event.currentTarget);\n        tableHeaderDom = $el.find(\".kanban-table-header .kanban-table-inner\");\n        return tableHeaderDom.css(\"left\", -1 * target.scrollLeft());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanban\", [\"$tgRepo\", \"$rootScope\", KanbanDirective]);\n\n  KanbanArchivedStatusHeaderDirective = function($rootscope, $translate, kanbanUserstoriesService) {\n    var hideArchivedText, link, showArchivedText;\n    showArchivedText = $translate.instant(\"KANBAN.ACTION_SHOW_ARCHIVED\");\n    hideArchivedText = $translate.instant(\"KANBAN.ACTION_HIDE_ARCHIVED\");\n    link = function($scope, $el, $attrs) {\n      var hidden, status;\n      status = $scope.$eval($attrs.tgKanbanArchivedStatusHeader);\n      hidden = true;\n      kanbanUserstoriesService.addArchivedStatus(status.id);\n      kanbanUserstoriesService.hideStatus(status.id);\n      $scope[\"class\"] = \"icon-watch\";\n      $scope.title = showArchivedText;\n      $el.on(\"click\", function(event) {\n        hidden = !hidden;\n        return $scope.$apply(function() {\n          if (hidden) {\n            $scope[\"class\"] = \"icon-watch\";\n            $scope.title = showArchivedText;\n            $rootscope.$broadcast(\"kanban:hide-userstories-for-status\", status.id);\n            return kanbanUserstoriesService.hideStatus(status.id);\n          } else {\n            $scope[\"class\"] = \"icon-unwatch\";\n            $scope.title = hideArchivedText;\n            $rootscope.$broadcast(\"kanban:show-userstories-for-status\", status.id);\n            return kanbanUserstoriesService.showStatus(status.id);\n          }\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanArchivedStatusHeader\", [\"$rootScope\", \"$translate\", \"tgKanbanUserstories\", KanbanArchivedStatusHeaderDirective]);\n\n  KanbanArchivedStatusIntroDirective = function($translate, kanbanUserstoriesService) {\n    var link, userStories;\n    userStories = [];\n    link = function($scope, $el, $attrs) {\n      var hiddenUserStoriexText, status, updateIntroText;\n      hiddenUserStoriexText = $translate.instant(\"KANBAN.HIDDEN_USER_STORIES\");\n      status = $scope.$eval($attrs.tgKanbanArchivedStatusIntro);\n      $el.text(hiddenUserStoriexText);\n      updateIntroText = function(hasArchived) {\n        if (hasArchived) {\n          return $el.text(\"\");\n        } else {\n          return $el.text(hiddenUserStoriexText);\n        }\n      };\n      $scope.$on(\"kanban:us:move\", function(ctx, itemUs, oldStatusId, newStatusId, itemIndex) {\n        var hasArchived;\n        hasArchived = !!kanbanUserstoriesService.getStatus(newStatusId).length;\n        return updateIntroText(hasArchived);\n      });\n      $scope.$on(\"kanban:shown-userstories-for-status\", function(ctx, statusId, userStoriesLoaded) {\n        var hasArchived;\n        if (statusId === status.id) {\n          kanbanUserstoriesService.deleteStatus(statusId);\n          kanbanUserstoriesService.add(userStoriesLoaded);\n          hasArchived = !!kanbanUserstoriesService.getStatus(statusId).length;\n          return updateIntroText(hasArchived);\n        }\n      });\n      $scope.$on(\"kanban:hidden-userstories-for-status\", function(ctx, statusId) {\n        if (statusId === status.id) {\n          return updateIntroText(false);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanArchivedStatusIntro\", [\"$translate\", \"tgKanbanUserstories\", KanbanArchivedStatusIntroDirective]);\n\n  KanbanSquishColumnDirective = function(rs) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var updateTableWidth;\n      $scope.$on(\"project:loaded\", function(event, project) {\n        $scope.folds = rs.kanban.getStatusColumnModes(project.id);\n        return updateTableWidth();\n      });\n      $scope.foldStatus = function(status) {\n        $scope.folds[status.id] = !!!$scope.folds[status.id];\n        rs.kanban.storeStatusColumnModes($scope.projectId, $scope.folds);\n        updateTableWidth();\n      };\n      return updateTableWidth = function() {\n        var columnWidths, totalWidth;\n        columnWidths = _.map($scope.usStatusList, function(status) {\n          if ($scope.folds[status.id]) {\n            return 40;\n          } else {\n            return 310;\n          }\n        });\n        totalWidth = _.reduce(columnWidths, function(total, width) {\n          return total + width;\n        });\n        return $el.find('.kanban-table-inner').css(\"width\", totalWidth);\n      };\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanSquishColumn\", [\"$tgResources\", KanbanSquishColumnDirective]);\n\n  KanbanWipLimitDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var redrawWipLimit, status;\n      status = $scope.$eval($attrs.tgKanbanWipLimit);\n      redrawWipLimit = (function(_this) {\n        return function() {\n          $el.find(\".kanban-wip-limit\").remove();\n          return timeout(200, function() {\n            var element;\n            element = $el.find(\"tg-card\")[status.wip_limit];\n            if (element) {\n              return angular.element(element).before(\"<div class='kanban-wip-limit'></div>\");\n            }\n          });\n        };\n      })(this);\n      if (status && !status.is_archived) {\n        $scope.$on(\"redraw:wip\", redrawWipLimit);\n        $scope.$on(\"kanban:us:move\", redrawWipLimit);\n        $scope.$on(\"usform:new:success\", redrawWipLimit);\n        $scope.$on(\"usform:bulk:success\", redrawWipLimit);\n      }\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanWipLimit\", KanbanWipLimitDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban/sortable.coffee\n */\n\n(function() {\n  var KanbanSortableDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaKanban\");\n\n  KanbanSortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var unwatch;\n      return unwatch = $scope.$watch(\"usByStatus\", function(usByStatus) {\n        var containers, deleteElement, drake, itemEl, newParentScope, oldParentScope, scroll, tdom;\n        if (!usByStatus || !usByStatus.size) {\n          return;\n        }\n        unwatch();\n        if (!($scope.project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        oldParentScope = null;\n        newParentScope = null;\n        itemEl = null;\n        tdom = $el;\n        deleteElement = function(itemEl) {\n          itemEl.scope().$destroy();\n          itemEl.off();\n          return itemEl.remove();\n        };\n        containers = _.map($el.find('.task-column'), function(item) {\n          return item;\n        });\n        drake = dragula(containers, {\n          copySortSource: false,\n          copy: false,\n          mirrorContainer: tdom[0],\n          moves: function(item) {\n            return $(item).is('tg-card');\n          }\n        });\n        drake.on('drag', function(item) {\n          return oldParentScope = $(item).parent().scope();\n        });\n        drake.on('dragend', function(item) {\n          var itemIndex, itemUs, newStatusId, oldStatusId, parentEl;\n          parentEl = $(item).parent();\n          itemEl = $(item);\n          itemUs = itemEl.scope().us;\n          itemIndex = itemEl.index();\n          newParentScope = parentEl.scope();\n          newStatusId = newParentScope.s.id;\n          oldStatusId = oldParentScope.s.id;\n          if (newStatusId !== oldStatusId) {\n            deleteElement(itemEl);\n          }\n          return $scope.$apply(function() {\n            return $rootscope.$broadcast(\"kanban:us:move\", itemUs, itemUs.getIn(['model', 'status']), newStatusId, itemIndex);\n          });\n        });\n        scroll = autoScroll(containers, {\n          margin: 100,\n          pixels: 30,\n          scrollWhenOutside: true,\n          autoScroll: function() {\n            return this.down && drake.dragging;\n          }\n        });\n        return $scope.$on(\"$destroy\", function() {\n          $el.off();\n          return drake.destroy();\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", KanbanSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/epics/detail.coffee\n */\n\n(function() {\n  var EpicDetailController, EpicStatusButtonDirective, EpicStatusDisplayDirective, bindMethods, bindOnce, groupBy, joinStr, mixOf, module, taiga, toString,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaEpics\");\n\n  EpicDetailController = (function(superClass) {\n    extend(EpicDetailController, superClass);\n\n    EpicDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgAnalytics\", \"$tgNavUrls\", \"$translate\", \"$tgQueueModelTransformation\", \"tgErrorHandlingService\"];\n\n    function EpicDetailController(scope, rootscope, repo, confirm, rs, rs2, params, q, location, log, appMetaService, analytics, navUrls, translate, modelTransform, errorHandlingService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.rs2 = rs2;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.analytics = analytics;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.modelTransform = modelTransform;\n      this.errorHandlingService = errorHandlingService;\n      bindMethods(this);\n      this.scope.epicRef = this.params.epicref;\n      this.scope.sectionName = this.translate.instant(\"EPIC.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    EpicDetailController.prototype._setMeta = function() {\n      var description, ref, title;\n      title = this.translate.instant(\"EPIC.PAGE_TITLE\", {\n        epicRef: \"#\" + this.scope.epic.ref,\n        epicSubject: this.scope.epic.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"EPIC.PAGE_DESCRIPTION\", {\n        epicStatus: ((ref = this.scope.statusById[this.scope.epic.status]) != null ? ref.name : void 0) || \"--\",\n        epicDescription: angular.element(this.scope.epic.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    EpicDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on epic\", 1);\n        };\n      })(this));\n      this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadEpic();\n        };\n      })(this));\n      return this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n    };\n\n    EpicDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-epics\", ctx);\n    };\n\n    EpicDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.immutableProject = Immutable.fromJS(project._attrs);\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.epic_statuses;\n          _this.scope.statusById = groupBy(project.epic_statuses, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    EpicDetailController.prototype.loadEpic = function() {\n      return this.rs.epics.getByRef(this.scope.projectId, this.params.epicref).then((function(_this) {\n        return function(epic) {\n          var ctx, ref, ref1;\n          _this.scope.epic = epic;\n          _this.scope.immutableEpic = Immutable.fromJS(epic._attrs);\n          _this.scope.epicId = epic.id;\n          _this.scope.commentModel = epic;\n          _this.modelTransform.setObject(_this.scope, 'epic');\n          if (((ref = _this.scope.epic.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.epic.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-epics-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.epic.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.epic.neighbors.next.ref\n            };\n            return _this.scope.nextUrl = _this.navUrls.resolve(\"project-epics-detail\", ctx);\n          }\n        };\n      })(this));\n    };\n\n    EpicDetailController.prototype.loadUserstories = function() {\n      return this.rs2.userstories.listInEpic(this.scope.epicId).then((function(_this) {\n        return function(data) {\n          return _this.scope.userstories = data;\n        };\n      })(this));\n    };\n\n    EpicDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadEpic().then(function() {\n            return _this.loadUserstories();\n          });\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    EpicDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadEpic();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.epics.upvote(this.scope.epicId).then(onSuccess, onError);\n    };\n\n    EpicDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadEpic();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.epics.downvote(this.scope.epicId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    EpicDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadEpic();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.epics.watch(this.scope.epicId).then(onSuccess, onError);\n    };\n\n    EpicDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadEpic();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.epics.unwatch(this.scope.epicId).then(onSuccess, onError);\n    };\n\n    EpicDetailController.prototype.onSelectColor = function(color) {\n      var onSelectColorError, onSelectColorSuccess, transform;\n      onSelectColorSuccess = (function(_this) {\n        return function() {\n          _this.rootscope.$broadcast(\"object:updated\");\n          return _this.confirm.notify('success');\n        };\n      })(this);\n      onSelectColorError = (function(_this) {\n        return function() {\n          return _this.confirm.notify('error');\n        };\n      })(this);\n      transform = this.modelTransform.save(function(epic) {\n        epic.color = color;\n        return epic;\n      });\n      return transform.then(onSelectColorSuccess, onSelectColorError);\n    };\n\n    return EpicDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"EpicDetailController\", EpicDetailController);\n\n  EpicStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(epic) {\n        var html, status;\n        status = $scope.statusById[epic.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(epic) {\n        if (epic != null) {\n          return render(epic);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgEpicStatusDisplay\", [\"$tgTemplate\", \"$compile\", EpicStatusDisplayDirective]);\n\n  EpicStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $compile, $translate, $template) {\n    var link, template;\n    template = $template.get(\"common/components/status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_epic\") !== -1;\n      };\n      render = (function(_this) {\n        return function(epic) {\n          var html, status;\n          status = $scope.statusById[epic.status];\n          html = $compile(template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          }))($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(status) {\n        var currentLoading, onError, onSuccess, transform;\n        currentLoading = $loading().target($el).start();\n        transform = $modelTransform.save(function(epic) {\n          epic.status = status;\n          return epic;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        $.fn.popover().closeAll();\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.status : void 0;\n      }, function() {\n        var epic;\n        epic = $model.$modelValue;\n        if (epic) {\n          return render(epic);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgEpicStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$compile\", \"$translate\", \"$tgTemplate\", EpicStatusButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/detail.coffee\n */\n\n(function() {\n  var IssueDetailController, IssueDueDateSelectDirective, IssuePriorityButtonDirective, IssueSeverityButtonDirective, IssueStatusButtonDirective, IssueStatusDisplayDirective, IssueTypeButtonDirective, PromoteIssueToUsButtonDirective, bindMethods, bindOnce, groupBy, joinStr, mixOf, module, taiga, toString,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaIssues\");\n\n  IssueDetailController = (function(superClass) {\n    extend(IssueDetailController, superClass);\n\n    IssueDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgAnalytics\", \"$tgNavUrls\", \"$translate\", \"$tgQueueModelTransformation\", \"tgErrorHandlingService\"];\n\n    function IssueDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, analytics, navUrls, translate, modelTransform, errorHandlingService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.analytics = analytics;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.modelTransform = modelTransform;\n      this.errorHandlingService = errorHandlingService;\n      bindMethods(this);\n      this.scope.issueRef = this.params.issueref;\n      this.scope.sectionName = this.translate.instant(\"ISSUES.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    IssueDetailController.prototype._setMeta = function() {\n      var description, ref, ref1, ref2, ref3, title;\n      title = this.translate.instant(\"ISSUE.PAGE_TITLE\", {\n        issueRef: \"#\" + this.scope.issue.ref,\n        issueSubject: this.scope.issue.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"ISSUE.PAGE_DESCRIPTION\", {\n        issueStatus: ((ref = this.scope.statusById[this.scope.issue.status]) != null ? ref.name : void 0) || \"--\",\n        issueType: ((ref1 = this.scope.typeById[this.scope.issue.type]) != null ? ref1.name : void 0) || \"--\",\n        issueSeverity: ((ref2 = this.scope.severityById[this.scope.issue.severity]) != null ? ref2.name : void 0) || \"--\",\n        issuePriority: ((ref3 = this.scope.priorityById[this.scope.issue.priority]) != null ? ref3.name : void 0) || \"--\",\n        issueDescription: angular.element(this.scope.issue.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    IssueDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on issue\", 1);\n        };\n      })(this));\n      this.scope.$on(\"promote-issue-to-us:success\", (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"issue\", \"promoteToUserstory\", \"promote issue to userstory\", 1);\n          _this.rootscope.$broadcast(\"object:updated\");\n          return _this.loadIssue();\n        };\n      })(this));\n      this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadIssue();\n        };\n      })(this));\n      return this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      if (this.scope.project.is_issues_activated) {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-issues\", ctx);\n      } else {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      }\n    };\n\n    IssueDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.issue_statuses;\n          _this.scope.statusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.typeById = groupBy(project.issue_types, function(x) {\n            return x.id;\n          });\n          _this.scope.typeList = _.sortBy(project.issue_types, \"order\");\n          _this.scope.severityList = project.severities;\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityList = project.priorities;\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.loadIssue = function() {\n      return this.rs.issues.getByRef(this.scope.projectId, this.params.issueref).then((function(_this) {\n        return function(issue) {\n          var ctx, ref, ref1;\n          _this.scope.issue = issue;\n          _this.scope.issueId = issue.id;\n          _this.scope.commentModel = issue;\n          _this.modelTransform.setObject(_this.scope, 'issue');\n          if (((ref = _this.scope.issue.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.issue.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-issues-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.issue.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.issue.neighbors.next.ref\n            };\n            return _this.scope.nextUrl = _this.navUrls.resolve(\"project-issues-detail\", ctx);\n          }\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadIssue();\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    IssueDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.upvote(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    IssueDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.downvote(this.scope.issueId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    IssueDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.watch(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    IssueDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.unwatch(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    return IssueDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"IssueDetailController\", IssueDetailController);\n\n  IssueStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(issue) {\n        var html, status;\n        status = $scope.statusById[issue.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue != null) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueStatusDisplay\", [\"$tgTemplate\", \"$compile\", IssueStatusDisplayDirective]);\n\n  IssueStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, status;\n          status = $scope.statusById[issue.status];\n          html = template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(statusId) {\n        var currentLoading, onError, onSuccess, transform;\n        $.fn.popover().closeAll();\n        currentLoading = $loading().target($el).start();\n        transform = $modelTransform.save(function(issue) {\n          issue.status = statusId;\n          return issue;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.status : void 0;\n      }, function() {\n        var issue;\n        issue = $model.$modelValue;\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", IssueStatusButtonDirective]);\n\n  IssueTypeButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-type-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, type;\n          type = $scope.typeById[issue.type];\n          html = template({\n            type: type,\n            typees: $scope.typeList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(type) {\n        var currentLoading, onError, onSuccess, transform;\n        $.fn.popover().closeAll();\n        currentLoading = $loading().target($el.find(\".level-name\")).start();\n        transform = $modelTransform.save(function(issue) {\n          issue.type = type;\n          return issue;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".type-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-type\").popover().open();\n      });\n      $el.on(\"click\", \".type\", function(event) {\n        var target, type;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        type = target.data(\"type-id\");\n        return save(type);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.type : void 0;\n      }, function() {\n        var issue;\n        issue = $model.$modelValue;\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueTypeButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", IssueTypeButtonDirective]);\n\n  IssueSeverityButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-severity-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, severity;\n          severity = $scope.severityById[issue.severity];\n          html = template({\n            severity: severity,\n            severityes: $scope.severityList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(severity) {\n        var currentLoading, onError, onSuccess, transform;\n        $.fn.popover().closeAll();\n        currentLoading = $loading().target($el.find(\".level-name\")).start();\n        transform = $modelTransform.save(function(issue) {\n          issue.severity = severity;\n          return issue;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".severity-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-severity\").popover().open();\n      });\n      $el.on(\"click\", \".severity\", function(event) {\n        var severity, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        severity = target.data(\"severity-id\");\n        return save(severity);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.severity : void 0;\n      }, function() {\n        var issue;\n        issue = $model.$modelValue;\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueSeverityButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", IssueSeverityButtonDirective]);\n\n  IssuePriorityButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-priority-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, priority;\n          priority = $scope.priorityById[issue.priority];\n          html = template({\n            priority: priority,\n            priorityes: $scope.priorityList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(priority) {\n        var currentLoading, onError, onSuccess, transform;\n        $.fn.popover().closeAll();\n        currentLoading = $loading().target($el.find(\".level-name\")).start();\n        transform = $modelTransform.save(function(issue) {\n          issue.priority = priority;\n          return issue;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".priority-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-priority\").popover().open();\n      });\n      $el.on(\"click\", \".priority\", function(event) {\n        var priority, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        priority = target.data(\"priority-id\");\n        return save(priority);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.priority : void 0;\n      }, function() {\n        var issue;\n        issue = $model.$modelValue;\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssuePriorityButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", IssuePriorityButtonDirective]);\n\n  IssueDueDateSelectDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"issue/issue-due-date-select.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var initialDueDate, prettyDate, render, save;\n      prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n      initialDueDate = false;\n      render = (function(_this) {\n        return function(issue) {\n          var html;\n          html = template({});\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(due_date) {\n        var currentLoading, onError, onSuccess, transform;\n        $.fn.popover().closeAll();\n        currentLoading = $loading().target($el.find(\".level-name\")).start();\n        transform = $modelTransform.save(function(issue) {\n          issue.due_date = due_date;\n          return issue;\n        });\n        onSuccess = function() {\n          initialDueDate = due_date;\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.priority : void 0;\n      }, function() {\n        var issue;\n        issue = $model.$modelValue;\n        if (issue) {\n          issue.due_date = issue.due_date || \"\";\n          if (initialDueDate === false) {\n            initialDueDate = issue.due_date;\n          }\n          $scope.due_date = issue.due_date;\n          return render(issue);\n        }\n      });\n      $scope.$watch(\"due_date\", function(due_date) {\n        if (initialDueDate !== false) {\n          if (due_date) {\n            due_date = moment(due_date, prettyDate).format(\"YYYY-MM-DD\");\n          } else {\n            due_date = null;\n          }\n          if (due_date !== initialDueDate) {\n            return save(due_date);\n          }\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueDueDateSelect\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", \"$translate\", IssueDueDateSelectDirective]);\n\n  PromoteIssueToUsButtonDirective = function($rootScope, $repo, $confirm, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var save;\n      save = (function(_this) {\n        return function(issue, askResponse) {\n          var data, onError, onSuccess;\n          data = {\n            generated_from_issue: issue.id,\n            project: issue.project,\n            subject: issue.subject,\n            description: issue.description,\n            tags: issue.tags,\n            is_blocked: issue.is_blocked,\n            blocked_note: issue.blocked_note\n          };\n          onSuccess = function() {\n            askResponse.finish();\n            $confirm.notify(\"success\");\n            return $rootScope.$broadcast(\"promote-issue-to-us:success\");\n          };\n          onError = function() {\n            askResponse.finish();\n            return $confirm.notify(\"error\");\n          };\n          return $repo.create(\"userstories\", data).then(onSuccess, onError);\n        };\n      })(this);\n      $el.on(\"click\", \"a\", function(event) {\n        var issue, message, subtitle, title;\n        event.preventDefault();\n        issue = $model.$modelValue;\n        title = $translate.instant(\"ISSUES.CONFIRM_PROMOTE.TITLE\");\n        message = $translate.instant(\"ISSUES.CONFIRM_PROMOTE.MESSAGE\");\n        subtitle = issue.subject;\n        return $confirm.ask(title, subtitle, message).then((function(_this) {\n          return function(response) {\n            return save(issue, response);\n          };\n        })(this));\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      restrict: \"AE\",\n      require: \"ngModel\",\n      templateUrl: \"issue/promote-issue-to-us-button.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgPromoteIssueToUsButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$translate\", PromoteIssueToUsButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/lightboxes.coffee\n */\n\n(function() {\n  var CreateBulkIssuesDirective, CreateIssueDirective, bindOnce, debounce, module, taiga, trim,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  trim = this.taiga.trim;\n\n  module = angular.module(\"taigaIssues\");\n\n  CreateIssueDirective = function($repo, $confirm, $rootscope, lightboxService, $loading, $q, $translate, attachmentsService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var attachmentsToAdd, createAttachments, form, resetAttachments, submit, submitButton;\n      form = $el.find(\"form\").checksley();\n      $scope.issue = {};\n      $scope.attachments = Immutable.List();\n      $scope.$on(\"issueform:new\", function(ctx, project) {\n        form.reset();\n        resetAttachments();\n        $el.find(\".tag-input\").val(\"\");\n        lightboxService.open($el, function() {\n          return $scope.createIssueOpen = false;\n        });\n        $scope.issue = {\n          project: project.id,\n          subject: \"\",\n          status: project.default_issue_status,\n          type: project.default_issue_type,\n          priority: project.default_priority,\n          severity: project.default_severity,\n          due_date: \"\",\n          tags: []\n        };\n        return $scope.createIssueOpen = true;\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.issue.project, 'issue');\n        });\n        return $q.all(promises);\n      };\n      attachmentsToAdd = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return $scope.attachments = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      $scope.addTag = function(tag, color) {\n        var inserted, itemtags, projectTags, tags, value;\n        value = trim(tag.toLowerCase());\n        tags = $scope.project.tags;\n        projectTags = $scope.project.tags_colors;\n        if (tags == null) {\n          tags = [];\n        }\n        if (projectTags == null) {\n          projectTags = {};\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        projectTags[tag] = color || null;\n        $scope.project.tags = tags;\n        itemtags = _.clone($scope.issue.tags);\n        inserted = _.find(itemtags, function(it) {\n          return it[0] === value;\n        });\n        if (!inserted) {\n          itemtags.push([tag, color]);\n          return $scope.issue.tags = itemtags;\n        }\n      };\n      $scope.deleteTag = function(tag) {\n        var itemtags, tags, value;\n        value = trim(tag[0].toLowerCase());\n        tags = $scope.project.tags;\n        itemtags = _.clone($scope.us.tags);\n        _.remove(itemtags, function(tag) {\n          return tag[0] === value;\n        });\n        $scope.us.tags = itemtags;\n        return _.pull($scope.issue.tags, value);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, prettyDate, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n          $scope.issue.due_date = moment($scope.issue.due_date, prettyDate).format(\"YYYY-MM-DD\");\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"issues\", $scope.issue);\n          promise.then(function(data) {\n            return createAttachments(data);\n          });\n          promise.then(function(data) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"issueform:new:success\", data);\n            lightboxService.close($el);\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateIssue\", [\"$tgRepo\", \"$tgConfirm\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$q\", \"$translate\", \"tgAttachmentsService\", CreateIssueDirective]);\n\n  CreateBulkIssuesDirective = function($repo, $rs, $confirm, $rootscope, $loading, lightboxService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var form, submit, submitButton;\n      form = null;\n      $scope.$on(\"issueform:bulk\", function(ctx, projectId, status) {\n        if (form) {\n          form.reset();\n        }\n        lightboxService.open($el);\n        return $scope[\"new\"] = {\n          projectId: projectId,\n          bulk: \"\"\n        };\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, data, projectId, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          data = $scope[\"new\"].bulk;\n          projectId = $scope[\"new\"].projectId;\n          promise = $rs.issues.bulkCreate(projectId, data);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"issueform:new:success\", result);\n            lightboxService.close($el);\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateBulkIssues\", [\"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", CreateBulkIssuesDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/list.coffee\n */\n\n(function() {\n  var IssueAssignedToInlineEditionDirective, IssueStatusInlineEditionDirective, IssuesController, IssuesDirective, bindMethods, bindOnce, debounceLeading, groupBy, joinStr, mixOf, module, startswith, taiga, toString, trim,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  startswith = this.taiga.startswith;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaIssues\");\n\n  IssuesController = (function(superClass) {\n    extend(IssuesController, superClass);\n\n    IssuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$tgUrls\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"tgErrorHandlingService\", \"$tgStorage\", \"tgFilterRemoteStorageService\"];\n\n    IssuesController.prototype.filtersHashSuffix = \"issues-filters\";\n\n    IssuesController.prototype.myFiltersHashSuffix = \"issues-my-filters\";\n\n    function IssuesController(scope, rootscope, repo, confirm, rs, urls, params1, q1, location, appMetaService, navUrls, events, analytics, translate, errorHandlingService, storage, filterRemoteStorageService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.urls = urls;\n      this.params = params1;\n      this.q = q1;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      this.storage = storage;\n      this.filterRemoteStorageService = filterRemoteStorageService;\n      this.loadIssues = bind(this.loadIssues, this);\n      bindMethods(this);\n      this.scope.sectionName = \"Issues\";\n      this.scope.filters = {};\n      this.voting = false;\n      if (this.applyStoredFilters(this.params.pslug, this.filtersHashSuffix)) {\n        return;\n      }\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ISSUES.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"ISSUES.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"issueform:new:success\", (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"issue\", \"create\", \"create issue on issues list\", 1);\n          return _this.loadIssues();\n        };\n      })(this));\n    }\n\n    IssuesController.prototype.changeQ = function(q) {\n      this.unselectFilter(\"page\");\n      this.replaceFilter(\"q\", q);\n      this.loadIssues();\n      return this.generateFilters();\n    };\n\n    IssuesController.prototype.removeFilter = function(filter) {\n      this.unselectFilter(\"page\");\n      this.unselectFilter(filter.dataType, filter.id);\n      this.loadIssues();\n      return this.generateFilters();\n    };\n\n    IssuesController.prototype.addFilter = function(newFilter) {\n      this.unselectFilter(\"page\");\n      this.selectFilter(newFilter.category.dataType, newFilter.filter.id);\n      this.loadIssues();\n      return this.generateFilters();\n    };\n\n    IssuesController.prototype.selectCustomFilter = function(customFilter) {\n      var orderBy;\n      orderBy = this.location.search().order_by;\n      if (orderBy) {\n        customFilter.filter.order_by = orderBy;\n      }\n      this.unselectFilter(\"page\");\n      this.replaceAllFilters(customFilter.filter);\n      this.loadIssues();\n      return this.generateFilters();\n    };\n\n    IssuesController.prototype.removeCustomFilter = function(customFilter) {\n      console.log(\"oooo\");\n      return this.filterRemoteStorageService.getFilters(this.scope.projectId, this.myFiltersHashSuffix).then((function(_this) {\n        return function(userFilters) {\n          console.log(userFilters[customFilter.id]);\n          delete userFilters[customFilter.id];\n          return _this.filterRemoteStorageService.storeFilters(_this.scope.projectId, userFilters, _this.myFiltersHashSuffix).then(_this.generateFilters);\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.saveCustomFilter = function(name) {\n      var filters, urlfilters;\n      filters = {};\n      urlfilters = this.location.search();\n      filters.tags = urlfilters.tags;\n      filters.status = urlfilters.status;\n      filters.type = urlfilters.type;\n      filters.severity = urlfilters.severity;\n      filters.priority = urlfilters.priority;\n      filters.assigned_to = urlfilters.assigned_to;\n      filters.owner = urlfilters.owner;\n      return this.filterRemoteStorageService.getFilters(this.scope.projectId, this.myFiltersHashSuffix).then((function(_this) {\n        return function(userFilters) {\n          userFilters[name] = filters;\n          return _this.filterRemoteStorageService.storeFilters(_this.scope.projectId, userFilters, _this.myFiltersHashSuffix).then(_this.generateFilters);\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.generateFilters = function() {\n      var loadFilters, urlfilters;\n      this.storeFilters(this.params.pslug, this.location.search(), this.filtersHashSuffix);\n      urlfilters = this.location.search();\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.type = urlfilters.type;\n      loadFilters.severity = urlfilters.severity;\n      loadFilters.priority = urlfilters.priority;\n      loadFilters.assigned_to = urlfilters.assigned_to;\n      loadFilters.owner = urlfilters.owner;\n      loadFilters.q = urlfilters.q;\n      return this.q.all([this.rs.issues.filtersData(loadFilters), this.filterRemoteStorageService.getFilters(this.scope.projectId, this.myFiltersHashSuffix)]).then((function(_this) {\n        return function(result) {\n          var assignedTo, customFiltersRaw, data, owner, priority, selected, severity, statuses, tags, tagsWithAtLeastOneElement, type;\n          data = result[0];\n          customFiltersRaw = result[1];\n          statuses = _.map(data.statuses, function(it) {\n            it.id = it.id.toString();\n            return it;\n          });\n          type = _.map(data.types, function(it) {\n            it.id = it.id.toString();\n            return it;\n          });\n          severity = _.map(data.severities, function(it) {\n            it.id = it.id.toString();\n            return it;\n          });\n          priority = _.map(data.priorities, function(it) {\n            it.id = it.id.toString();\n            return it;\n          });\n          tags = _.map(data.tags, function(it) {\n            it.id = it.name;\n            return it;\n          });\n          tagsWithAtLeastOneElement = _.filter(tags, function(tag) {\n            return tag.count > 0;\n          });\n          assignedTo = _.map(data.assigned_to, function(it) {\n            if (it.id) {\n              it.id = it.id.toString();\n            } else {\n              it.id = \"null\";\n            }\n            it.name = it.full_name || \"Unassigned\";\n            return it;\n          });\n          owner = _.map(data.owners, function(it) {\n            it.id = it.id.toString();\n            it.name = it.full_name;\n            return it;\n          });\n          _this.selectedFilters = [];\n          if (loadFilters.status) {\n            selected = _this.formatSelectedFilters(\"status\", statuses, loadFilters.status);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.tags) {\n            selected = _this.formatSelectedFilters(\"tags\", tags, loadFilters.tags);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.assigned_to) {\n            selected = _this.formatSelectedFilters(\"assigned_to\", assignedTo, loadFilters.assigned_to);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.owner) {\n            selected = _this.formatSelectedFilters(\"owner\", owner, loadFilters.owner);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.type) {\n            selected = _this.formatSelectedFilters(\"type\", type, loadFilters.type);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.severity) {\n            selected = _this.formatSelectedFilters(\"severity\", severity, loadFilters.severity);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.priority) {\n            selected = _this.formatSelectedFilters(\"priority\", priority, loadFilters.priority);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          _this.filterQ = loadFilters.q;\n          _this.filters = [\n            {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.TYPE\"),\n              dataType: \"type\",\n              content: type\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.SEVERITY\"),\n              dataType: \"severity\",\n              content: severity\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.PRIORITIES\"),\n              dataType: \"priority\",\n              content: priority\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.STATUS\"),\n              dataType: \"status\",\n              content: statuses\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.TAGS\"),\n              dataType: \"tags\",\n              content: tags,\n              hideEmpty: true,\n              totalTaggedElements: tagsWithAtLeastOneElement.length\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.ASSIGNED_TO\"),\n              dataType: \"assigned_to\",\n              content: assignedTo\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.CREATED_BY\"),\n              dataType: \"owner\",\n              content: owner\n            }\n          ];\n          _this.customFilters = [];\n          return _.forOwn(customFiltersRaw, function(value, key) {\n            return _this.customFilters.push({\n              id: key,\n              name: key,\n              filter: value\n            });\n          });\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.initializeSubscription = function() {\n      var routingKey;\n      routingKey = \"changes.project.\" + this.scope.projectId + \".issues\";\n      return this.events.subscribe(this.scope, routingKey, (function(_this) {\n        return function(message) {\n          return _this.loadIssues();\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_issues_activated) {\n            _this.errorHandlingService.permissionDenied();\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issueStatusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.issueStatusList = _.sortBy(project.issue_statuses, \"order\");\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.severityList = _.sortBy(project.severities, \"order\");\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityList = _.sortBy(project.priorities, \"order\");\n          _this.scope.issueTypes = _.sortBy(project.issue_types, \"order\");\n          _this.scope.issueTypeById = groupBy(project.issue_types, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.loadIssuesRequests = 0;\n\n    IssuesController.prototype.loadIssues = function() {\n      var params, promise;\n      params = this.location.search();\n      promise = this.rs.issues.list(this.scope.projectId, params);\n      this.loadIssuesRequests += 1;\n      promise.index = this.loadIssuesRequests;\n      promise.then((function(_this) {\n        return function(data) {\n          if (promise.index === _this.loadIssuesRequests) {\n            _this.scope.issues = data.models;\n            _this.scope.page = data.current;\n            _this.scope.count = data.count;\n            _this.scope.paginatedBy = data.paginatedBy;\n          }\n          return data;\n        };\n      })(this));\n      return promise;\n    };\n\n    IssuesController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.initializeSubscription();\n          _this.generateFilters();\n          return _this.loadIssues();\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.addNewIssue = function() {\n      return this.rootscope.$broadcast(\"issueform:new\", this.scope.project);\n    };\n\n    IssuesController.prototype.addIssuesInBulk = function() {\n      return this.rootscope.$broadcast(\"issueform:bulk\", this.scope.projectId);\n    };\n\n    IssuesController.prototype.upVoteIssue = function(issueId) {\n      var onError, onSuccess;\n      this.voting = issueId;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssues();\n          return _this.voting = null;\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"error\");\n          return _this.voting = null;\n        };\n      })(this);\n      return this.rs.issues.upvote(issueId).then(onSuccess, onError);\n    };\n\n    IssuesController.prototype.downVoteIssue = function(issueId) {\n      var onError, onSuccess;\n      this.voting = issueId;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssues();\n          return _this.voting = null;\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"error\");\n          return _this.voting = null;\n        };\n      })(this);\n      return this.rs.issues.downvote(issueId).then(onSuccess, onError);\n    };\n\n    IssuesController.prototype.getOrderBy = function() {\n      if (_.isString(this.location.search().order_by)) {\n        return this.location.search().order_by;\n      } else {\n        return \"created_date\";\n      }\n    };\n\n    return IssuesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"IssuesController\", IssuesController);\n\n  IssuesDirective = function($log, $location, $template, $compile) {\n    var link, linkOrdering, linkPagination, template;\n    template = $template.get(\"issue/issue-paginator.html\", true);\n    linkPagination = function($scope, $el, $attrs, $ctrl) {\n      var $pagEl, afterCurrent, atBegin, atEnd, beforeCurrent, getNumPages, renderPagination;\n      afterCurrent = 2;\n      beforeCurrent = 4;\n      atBegin = 2;\n      atEnd = 2;\n      $pagEl = $el.find(\".issues-paginator\");\n      getNumPages = function() {\n        var numPages;\n        numPages = $scope.count / $scope.paginatedBy;\n        if (parseInt(numPages, 10) < numPages) {\n          numPages = parseInt(numPages, 10) + 1;\n        } else {\n          numPages = parseInt(numPages, 10);\n        }\n        return numPages;\n      };\n      renderPagination = function() {\n        var cpage, html, i, j, numPages, options, pages, ref;\n        numPages = getNumPages();\n        if (numPages <= 1) {\n          $pagEl.hide();\n          return;\n        }\n        $pagEl.show();\n        pages = [];\n        options = {};\n        options.pages = pages;\n        options.showPrevious = $scope.page > 1;\n        options.showNext = !($scope.page === numPages);\n        cpage = $scope.page;\n        for (i = j = 1, ref = numPages; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n          if (i === (cpage + afterCurrent) && numPages > (cpage + afterCurrent + atEnd)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i === (cpage - beforeCurrent) && cpage > (atBegin + beforeCurrent)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i > (cpage + afterCurrent) && i <= (numPages - atEnd)) {\n\n          } else if (i < (cpage - beforeCurrent) && i > atBegin) {\n\n          } else if (i === cpage) {\n            pages.push({\n              classes: \"active\",\n              num: i,\n              type: \"page-active\"\n            });\n          } else {\n            pages.push({\n              classes: \"page\",\n              num: i,\n              type: \"page\"\n            });\n          }\n        }\n        html = template(options);\n        html = $compile(html)($scope);\n        return $pagEl.html(html);\n      };\n      $scope.$watch(\"issues\", function(value) {\n        if (!value) {\n          return;\n        }\n        return renderPagination();\n      });\n      $el.on(\"click\", \".issues-paginator a.next\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page + 1);\n          return $ctrl.loadIssues();\n        });\n      });\n      $el.on(\"click\", \".issues-paginator a.previous\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page - 1);\n          return $ctrl.loadIssues();\n        });\n      });\n      return $el.on(\"click\", \".issues-paginator li.page > a\", function(event) {\n        var pagenum, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        pagenum = target.data(\"pagenum\");\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", pagenum);\n          return $ctrl.loadIssues();\n        });\n      });\n    };\n    linkOrdering = function($scope, $el, $attrs, $ctrl) {\n      var colHeadElement, currentOrder, icon, svg;\n      currentOrder = $ctrl.getOrderBy();\n      if (currentOrder) {\n        icon = startswith(currentOrder, \"-\") ? \"icon-arrow-up\" : \"icon-arrow-down\";\n        colHeadElement = $el.find(\".row.title > div[data-fieldname='\" + (trim(currentOrder, \"-\")) + \"']\");\n        svg = $(\"<tg-svg>\").attr(\"svg-icon\", icon);\n        colHeadElement.append(svg);\n        $compile(colHeadElement.contents())($scope);\n      }\n      return $el.on(\"click\", \".row.title > div\", function(event) {\n        var finalOrder, newOrder, target;\n        target = angular.element(event.currentTarget);\n        currentOrder = $ctrl.getOrderBy();\n        newOrder = target.data(\"fieldname\");\n        finalOrder = currentOrder === newOrder ? \"-\" + newOrder : newOrder;\n        return $scope.$apply(function() {\n          $ctrl.replaceFilter(\"order_by\", finalOrder);\n          $ctrl.storeFilters($ctrl.params.pslug, $location.search(), $ctrl.filtersHashSuffix);\n          return $ctrl.loadIssues().then(function() {\n            $el.find(\".row.title > div > tg-svg\").remove();\n            icon = startswith(finalOrder, \"-\") ? \"icon-arrow-up\" : \"icon-arrow-down\";\n            svg = $(\"<tg-svg>\").attr(\"svg-icon\", icon);\n            target.append(svg);\n            return $compile(target.contents())($scope);\n          });\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      linkOrdering($scope, $el, $attrs, $ctrl);\n      linkPagination($scope, $el, $attrs, $ctrl);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssues\", [\"$log\", \"$tgLocation\", \"$tgTemplate\", \"$compile\", IssuesDirective]);\n\n  IssueStatusInlineEditionDirective = function($repo, $template, $rootscope) {\n\n    /*\n    Print the status of an Issue and a popover to change it.\n    - tg-issue-status-inline-edition: The issue\n    \n    Example:\n    \n      div.status(tg-issue-status-inline-edition=\"issue\")\n        a.issue-status(href=\"\")\n    \n    NOTE: This directive need 'issueStatusById' and 'project'.\n     */\n    var link, selectionTemplate, updateIssueStatus;\n    selectionTemplate = $template.get(\"issue/issue-status-inline-edition-selection.html\", true);\n    updateIssueStatus = function($el, issue, issueStatusById) {\n      var issueStatusDom, issueStatusDomParent, status;\n      issueStatusDomParent = $el.find(\".issue-status\");\n      issueStatusDom = $el.find(\".issue-status .issue-status-bind\");\n      status = issueStatusById[issue.status];\n      if (status) {\n        issueStatusDom.text(status.name);\n        issueStatusDom.prop(\"title\", status.name);\n        return issueStatusDomParent.css('color', status.color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue;\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueStatusInlineEdition);\n      $el.on(\"click\", \".issue-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var filter, j, len, ref, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        ref = $scope.filters.status;\n        for (j = 0, len = ref.length; j < len; j++) {\n          filter = ref[j];\n          if (filter.id === issue.status) {\n            filter.count--;\n          }\n        }\n        issue.status = target.data(\"status-id\");\n        $el.find(\".pop-status\").popover().close();\n        updateIssueStatus($el, issue, $scope.issueStatusById);\n        return $scope.$apply(function() {\n          var k, len1, ref1;\n          $repo.save(issue).then(function() {\n            return $ctrl.loadIssues();\n          });\n          ref1 = $scope.filters.status;\n          for (k = 0, len1 = ref1.length; k < len1; k++) {\n            filter = ref1[k];\n            if (filter.id === issue.status) {\n              filter.count++;\n            }\n          }\n          return $rootscope.$broadcast(\"filters:issueupdate\", $scope.filters);\n        });\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'statuses': project.issue_statuses\n        }));\n        updateIssueStatus($el, issue, $scope.issueStatusById);\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$watch($attrs.tgIssueStatusInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssueStatus($el, val, $scope.issueStatusById);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueStatusInlineEdition\", [\"$tgRepo\", \"$tgTemplate\", \"$rootScope\", IssueStatusInlineEditionDirective]);\n\n  IssueAssignedToInlineEditionDirective = function($repo, $rootscope, $translate, avatarService) {\n    var link, template;\n    template = _.template(\"<img style=\\\"background-color: <%- bg %>\\\" src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\"/>\\n<figcaption><%- name %></figcaption>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue, updateIssue;\n      updateIssue = function(issue) {\n        var avatar, ctx, member;\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = $scope.usersById[issue.assigned_to];\n        avatar = avatarService.getAvatar(member);\n        ctx.imgurl = avatar.url;\n        ctx.bg = null;\n        if (member) {\n          ctx.name = member.full_name_display;\n          ctx.bg = avatar.bg;\n        }\n        $el.find(\".avatar\").html(template(ctx));\n        return $el.find(\".issue-assignedto\").attr('title', ctx.name);\n      };\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueAssignedToInlineEdition);\n      updateIssue(issue);\n      $el.on(\"click\", \".issue-assignedto\", function(event) {\n        return $rootscope.$broadcast(\"assigned-to:add\", issue);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"assigned-to:added\", (function(_this) {\n        return function(ctx, userId, updatedIssue) {\n          if (updatedIssue.id === issue.id) {\n            updatedIssue.assigned_to = userId;\n            $repo.save(updatedIssue);\n            return updateIssue(updatedIssue);\n          }\n        };\n      })(this));\n      $scope.$watch($attrs.tgIssueAssignedToInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssue(val);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueAssignedToInlineEdition\", [\"$tgRepo\", \"$rootScope\", \"$translate\", \"tgAvatarService\", IssueAssignedToInlineEditionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/userstories/detail.coffee\n */\n\n(function() {\n  var UsClientRequirementButtonDirective, UsStatusButtonDirective, UsStatusDisplayDirective, UsTeamRequirementButtonDirective, UserStoryDetailController, bindMethods, bindOnce, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaUserStories\");\n\n  UserStoryDetailController = (function(superClass) {\n    extend(UserStoryDetailController, superClass);\n\n    UserStoryDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", \"$tgQueueModelTransformation\", \"tgErrorHandlingService\", \"$tgConfig\"];\n\n    function UserStoryDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, navUrls, analytics, translate, modelTransform, errorHandlingService, configService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.modelTransform = modelTransform;\n      this.errorHandlingService = errorHandlingService;\n      this.configService = configService;\n      bindMethods(this);\n      this.scope.usRef = this.params.usref;\n      this.scope.sectionName = this.translate.instant(\"US.SECTION_NAME\");\n      this.scope.tribeEnabled = this.configService.config.tribeHost;\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserStoryDetailController.prototype._setMeta = function() {\n      var closedTasks, description, progressPercentage, ref, title, totalTasks;\n      totalTasks = this.scope.tasks.length;\n      closedTasks = _.filter(this.scope.tasks, (function(_this) {\n        return function(t) {\n          return _this.scope.taskStatusById[t.status].is_closed;\n        };\n      })(this)).length;\n      progressPercentage = totalTasks > 0 ? Math.round(100 * closedTasks / totalTasks) : 0;\n      title = this.translate.instant(\"US.PAGE_TITLE\", {\n        userStoryRef: \"#\" + this.scope.us.ref,\n        userStorySubject: this.scope.us.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"US.PAGE_DESCRIPTION\", {\n        userStoryStatus: ((ref = this.scope.statusById[this.scope.us.status]) != null ? ref.name : void 0) || \"--\",\n        userStoryPoints: this.scope.us.total_points,\n        userStoryDescription: angular.element(this.scope.us.description_html || \"\").text(),\n        userStoryClosedTasks: closedTasks,\n        userStoryTotalTasks: totalTasks,\n        userStoryProgressPercentage: progressPercentage\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    UserStoryDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"related-tasks:update\", (function(_this) {\n        return function() {\n          var allClosed;\n          _this.scope.tasks = _.clone(_this.scope.tasks, false);\n          allClosed = _.every(_this.scope.tasks, function(task) {\n            return task.is_closed;\n          });\n          if (_this.scope.us.is_closed !== allClosed) {\n            return _this.loadUs();\n          }\n        };\n      })(this));\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on userstory\", 1);\n        };\n      })(this));\n      return this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadUs();\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      if (this.scope.project.is_backlog_activated) {\n        if (this.scope.us.milestone) {\n          ctx.sprint = this.scope.sprint.slug;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-taskboard\", ctx);\n        } else {\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-backlog\", ctx);\n        }\n      } else if (this.scope.project.is_kanban_activated) {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-kanban\", ctx);\n      }\n    };\n\n    UserStoryDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.us_statuses;\n          _this.scope.statusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.taskStatusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(_this.scope.pointsList, function(e) {\n            return e.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadUs = function() {\n      var httpParams, kanbanStaus, milestone, noMilestone;\n      httpParams = _.pick(this.location.search(), \"milestone\", \"no-milestone\", \"kanban-status\");\n      milestone = httpParams.milestone;\n      if (milestone) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          milestone: milestone,\n          order_by: \"sprint_order\"\n        });\n      }\n      noMilestone = httpParams[\"no-milestone\"];\n      if (noMilestone) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          milestone: \"null\",\n          order_by: \"backlog_order\"\n        });\n      }\n      kanbanStaus = httpParams[\"kanban-status\"];\n      if (kanbanStaus) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          status: kanbanStaus,\n          order_by: \"kanban_order\"\n        });\n      }\n      return this.rs.userstories.getByRef(this.scope.projectId, this.params.usref).then((function(_this) {\n        return function(us) {\n          _this.scope.us = us;\n          _this.scope.usId = us.id;\n          _this.scope.commentModel = us;\n          _this.modelTransform.setObject(_this.scope, 'us');\n          return us;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadSprint = function() {\n      if (this.scope.us.milestone) {\n        return this.rs.sprints.get(this.scope.us.project, this.scope.us.milestone).then((function(_this) {\n          return function(sprint) {\n            _this.scope.sprint = sprint;\n            return sprint;\n          };\n        })(this));\n      }\n    };\n\n    UserStoryDetailController.prototype.loadTasks = function() {\n      return this.rs.tasks.list(this.scope.projectId, null, this.scope.usId).then((function(_this) {\n        return function(tasks) {\n          _this.scope.tasks = tasks;\n          return tasks;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadUs().then(function() {\n            return _this.q.all([_this.loadSprint(), _this.loadTasks()]);\n          });\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    UserStoryDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.upvote(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.downvote(this.scope.usId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    UserStoryDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.watch(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.unwatch(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onTribeInfo = function() {\n      var image, publishDesc, publishTitle, text;\n      publishTitle = this.translate.instant(\"US.TRIBE.PUBLISH_MORE_INFO_TITLE\");\n      image = $('<img />').attr({\n        'src': \"/\" + window._version + \"/images/monster-fight.png\",\n        'alt': this.translate.instant(\"US.TRIBE.PUBLISH_MORE_INFO_TITLE\")\n      });\n      text = this.translate.instant(\"US.TRIBE.PUBLISH_MORE_INFO_TEXT\");\n      publishDesc = $('<div></div>').append(image).append(text);\n      return this.confirm.success(publishTitle, publishDesc);\n    };\n\n    return UserStoryDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserStoryDetailController\", UserStoryDetailController);\n\n  UsStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(us) {\n        var html, status;\n        status = $scope.statusById[us.status];\n        html = template({\n          is_closed: us.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us != null) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsStatusDisplay\", [\"$tgTemplate\", \"$compile\", UsStatusDisplayDirective]);\n\n  UsStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = (function(_this) {\n        return function(us) {\n          var html, status;\n          status = $scope.statusById[us.status];\n          html = template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          });\n          $el.html(html);\n          return $compile($el.contents())($scope);\n        };\n      })(this);\n      save = (function(_this) {\n        return function(status) {\n          var currentLoading, onError, onSuccess, transform;\n          $el.find(\".pop-status\").popover().close();\n          currentLoading = $loading().target($el.find('.js-edit-status')).start();\n          transform = $modelTransform.save(function(us) {\n            us.status = status;\n            return us;\n          });\n          onSuccess = function() {\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return currentLoading.finish();\n          };\n          return transform.then(onSuccess, onError);\n        };\n      })(this);\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var status, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        status = target.data(\"status-id\");\n        return save(status);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.status : void 0;\n      }, function() {\n        var us;\n        us = $model.$modelValue;\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", UsStatusButtonDirective]);\n\n  UsTeamRequirementButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"us/us-team-requirement-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var canEdit, render, save;\n      canEdit = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = function(us) {\n        var ctx, html;\n        ctx = {\n          canEdit: canEdit(),\n          isRequired: us.team_requirement\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      save = function(team_requirement) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find(\"label\")).start();\n        transform = $modelTransform.save(function(us) {\n          us.team_requirement = team_requirement;\n          return us;\n        });\n        transform.then((function(_this) {\n          return function() {\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"object:updated\");\n          };\n        })(this));\n        return transform.then(null, function() {\n          currentLoading.finish();\n          return $confirm.notify(\"error\");\n        });\n      };\n      $el.on(\"click\", \".team-requirement\", function(event) {\n        var team_requirement;\n        if (!canEdit()) {\n          return;\n        }\n        team_requirement = !$model.$modelValue.team_requirement;\n        return save(team_requirement);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.team_requirement : void 0;\n      }, function() {\n        var us;\n        us = $model.$modelValue;\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsTeamRequirementButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", UsTeamRequirementButtonDirective]);\n\n  UsClientRequirementButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"us/us-client-requirement-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var canEdit, render, save;\n      canEdit = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = function(us) {\n        var ctx, html;\n        ctx = {\n          canEdit: canEdit(),\n          isRequired: us.client_requirement\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      save = function(client_requirement) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find(\"label\")).start();\n        transform = $modelTransform.save(function(us) {\n          us.client_requirement = client_requirement;\n          return us;\n        });\n        transform.then((function(_this) {\n          return function() {\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"object:updated\");\n          };\n        })(this));\n        return transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n      };\n      $el.on(\"click\", \".client-requirement\", function(event) {\n        var client_requirement;\n        if (!canEdit()) {\n          return;\n        }\n        client_requirement = !$model.$modelValue.client_requirement;\n        return save(client_requirement);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.client_requirement : void 0;\n      }, function() {\n        var us;\n        us = $model.$modelValue;\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsClientRequirementButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", UsClientRequirementButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/tasks/detail.coffee\n */\n\n(function() {\n  var TaskDetailController, TaskIsIocaineButtonDirective, TaskStatusButtonDirective, TaskStatusDisplayDirective, bindMethods, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaTasks\");\n\n  TaskDetailController = (function(superClass) {\n    extend(TaskDetailController, superClass);\n\n    TaskDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", \"$tgQueueModelTransformation\", \"tgErrorHandlingService\"];\n\n    function TaskDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, navUrls, analytics, translate, modelTransform, errorHandlingService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.modelTransform = modelTransform;\n      this.errorHandlingService = errorHandlingService;\n      bindMethods(this);\n      this.scope.taskRef = this.params.taskref;\n      this.scope.sectionName = this.translate.instant(\"TASK.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TaskDetailController.prototype._setMeta = function() {\n      var description, ref, title;\n      title = this.translate.instant(\"TASK.PAGE_TITLE\", {\n        taskRef: \"#\" + this.scope.task.ref,\n        taskSubject: this.scope.task.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"TASK.PAGE_DESCRIPTION\", {\n        taskStatus: ((ref = this.scope.statusById[this.scope.task.status]) != null ? ref.name : void 0) || \"--\",\n        taskDescription: angular.element(this.scope.task.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    TaskDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on task\", 1);\n        };\n      })(this));\n      this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n      return this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadTask();\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      if (this.scope.project.is_backlog_activated) {\n        if (this.scope.task.milestone) {\n          ctx.sprint = this.scope.sprint.slug;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-taskboard\", ctx);\n        } else if (this.scope.task.us) {\n          ctx.ref = this.scope.us.ref;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-userstories-detail\", ctx);\n        }\n      } else if (this.scope.project.is_kanban_activated) {\n        if (this.scope.us) {\n          ctx.ref = this.scope.us.ref;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-userstories-detail\", ctx);\n        }\n      }\n    };\n\n    TaskDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.task_statuses;\n          _this.scope.statusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.loadTask = function() {\n      return this.rs.tasks.getByRef(this.scope.projectId, this.params.taskref).then((function(_this) {\n        return function(task) {\n          var ctx, ref, ref1;\n          _this.scope.task = task;\n          _this.scope.taskId = task.id;\n          _this.scope.commentModel = task;\n          _this.modelTransform.setObject(_this.scope, 'task');\n          if (((ref = _this.scope.task.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.task.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-tasks-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.task.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.task.neighbors.next.ref\n            };\n            _this.scope.nextUrl = _this.navUrls.resolve(\"project-tasks-detail\", ctx);\n          }\n          return task;\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.loadSprint = function() {\n      if (this.scope.task.milestone) {\n        return this.rs.sprints.get(this.scope.task.project, this.scope.task.milestone).then((function(_this) {\n          return function(sprint) {\n            _this.scope.sprint = sprint;\n            return sprint;\n          };\n        })(this));\n      }\n    };\n\n    TaskDetailController.prototype.loadUserStory = function() {\n      if (this.scope.task.user_story) {\n        return this.rs.userstories.get(this.scope.task.project, this.scope.task.user_story).then((function(_this) {\n          return function(us) {\n            _this.scope.us = us;\n            return us;\n          };\n        })(this));\n      }\n    };\n\n    TaskDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadTask().then(function() {\n            return _this.q.all([_this.loadSprint(), _this.loadUserStory()]);\n          });\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    TaskDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.upvote(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    TaskDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.downvote(this.scope.taskId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    TaskDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.watch(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    TaskDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.unwatch(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    return TaskDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TaskDetailController\", TaskDetailController);\n\n  TaskStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(task) {\n        var html, status;\n        status = $scope.statusById[task.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(task) {\n        if (task != null) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskStatusDisplay\", [\"$tgTemplate\", \"$compile\", TaskStatusDisplayDirective]);\n\n  TaskStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $compile, $translate, $template) {\n    var link, template;\n    template = $template.get(\"common/components/status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n      };\n      render = (function(_this) {\n        return function(task) {\n          var html, status;\n          status = $scope.statusById[task.status];\n          html = $compile(template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          }))($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(status) {\n        var currentLoading, onError, onSuccess, transform;\n        currentLoading = $loading().target($el).start();\n        transform = $modelTransform.save(function(task) {\n          task.status = status;\n          return task;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        $.fn.popover().closeAll();\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.status : void 0;\n      }, function() {\n        var task;\n        task = $model.$modelValue;\n        if (task) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$compile\", \"$translate\", \"$tgTemplate\", TaskStatusButtonDirective]);\n\n  TaskIsIocaineButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $modelTransform, $compile, $template) {\n    var link, template;\n    template = $template.get(\"issue/iocaine-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n      };\n      render = function(task) {\n        var ctx, html;\n        if (!isEditable() && !task.is_iocaine) {\n          $el.html(\"\");\n          return;\n        }\n        ctx = {\n          isIocaine: task.is_iocaine,\n          isEditable: isEditable()\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      save = function(is_iocaine) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find('label')).start();\n        transform = $modelTransform.save(function(task) {\n          task.is_iocaine = is_iocaine;\n          return task;\n        });\n        transform.then(function() {\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n        return transform[\"finally\"](function() {\n          return currentLoading.finish();\n        });\n      };\n      $el.on(\"click\", \".is-iocaine\", function(event) {\n        var is_iocaine;\n        if (!isEditable()) {\n          return;\n        }\n        is_iocaine = !$model.$modelValue.is_iocaine;\n        return save(is_iocaine);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.is_iocaine : void 0;\n      }, function() {\n        var task;\n        task = $model.$modelValue;\n        if (task) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskIsIocaineButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$compile\", \"$tgTemplate\", TaskIsIocaineButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/team/main.coffee\n */\n\n(function() {\n  var LeaveProjectDirective, TeamController, TeamFiltersDirective, TeamMemberCurrentUserDirective, TeamMemberStatsDirective, TeamMembersDirective, membersFilter, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  module = angular.module(\"taigaTeam\");\n\n  TeamController = (function(superClass) {\n    extend(TeamController, superClass);\n\n    TeamController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$location\", \"$tgNavUrls\", \"tgAppMetaService\", \"$tgAuth\", \"$translate\", \"tgProjectService\", \"tgErrorHandlingService\"];\n\n    function TeamController(scope, rootscope, repo, rs, params, q, location, navUrls, appMetaService, auth, translate, projectService, errorHandlingService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.auth = auth;\n      this.translate = translate;\n      this.projectService = projectService;\n      this.errorHandlingService = errorHandlingService;\n      this.scope.sectionName = \"TEAM.SECTION_NAME\";\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"TEAM.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"TEAM.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TeamController.prototype.setRole = function(role) {\n      if (role) {\n        return this.scope.filtersRole = role;\n      } else {\n        return this.scope.filtersRole = null;\n      }\n    };\n\n    TeamController.prototype.loadMembers = function() {\n      var i, len, member, ref, user;\n      user = this.auth.getUser();\n      this.scope.totals = {};\n      ref = this.scope.activeUsers;\n      for (i = 0, len = ref.length; i < len; i++) {\n        member = ref[i];\n        this.scope.totals[member.id] = 0;\n      }\n      console.log(this.scope.activeUsers);\n      this.scope.currentUser = _.find(this.scope.activeUsers, {\n        id: user != null ? user.id : void 0\n      });\n      return this.scope.memberships = _.reject(this.scope.activeUsers, {\n        id: user != null ? user.id : void 0\n      });\n    };\n\n    TeamController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issuesEnabled = project.is_issues_activated;\n          _this.scope.tasksEnabled = project.is_kanban_activated || project.is_backlog_activated;\n          _this.scope.wikiEnabled = project.is_wiki_activated;\n          _this.scope.owner = project.owner.id;\n          return project;\n        };\n      })(this));\n    };\n\n    TeamController.prototype.loadMemberStats = function() {\n      return this.rs.projects.memberStats(this.scope.projectId).then((function(_this) {\n        return function(stats) {\n          var totals;\n          totals = {};\n          _.forEach(_this.scope.totals, function(total, userId) {\n            var vals;\n            vals = _.map(stats, function(memberStats, statsKey) {\n              return memberStats[userId];\n            });\n            total = _.reduce(vals, function(sum, el) {\n              return sum + el;\n            });\n            return _this.scope.totals[userId] = total;\n          });\n          _this.scope.stats = _this._processStats(stats);\n          return _this.scope.stats.totals = _this.scope.totals;\n        };\n      })(this));\n    };\n\n    TeamController.prototype._processStat = function(stat) {\n      var key, max, min, singleStat, value;\n      max = _.max(_.toArray(stat));\n      min = _.min(_.toArray(stat));\n      singleStat = Object();\n      for (key in stat) {\n        if (!hasProp.call(stat, key)) continue;\n        value = stat[key];\n        if (value === min) {\n          singleStat[key] = 0.1;\n        } else if (value === max) {\n          singleStat[key] = 1;\n        } else {\n          singleStat[key] = (value * 0.5) / max;\n        }\n      }\n      return singleStat;\n    };\n\n    TeamController.prototype._processStats = function(stats) {\n      var key, value;\n      for (key in stats) {\n        value = stats[key];\n        stats[key] = this._processStat(value);\n      }\n      return stats;\n    };\n\n    TeamController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          var userRoles;\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.loadMembers();\n          userRoles = _.map(_this.scope.users, function(user) {\n            return user.role;\n          });\n          _this.scope.roles = _.filter(_this.scope.roles, function(role) {\n            return userRoles.indexOf(role.id) !== -1;\n          });\n          return _this.loadMemberStats();\n        };\n      })(this));\n    };\n\n    return TeamController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TeamController\", TeamController);\n\n  TeamFiltersDirective = function() {\n    return {\n      templateUrl: \"team/team-filter.html\"\n    };\n  };\n\n  module.directive(\"tgTeamFilters\", [TeamFiltersDirective]);\n\n  TeamMemberStatsDirective = function() {\n    return {\n      templateUrl: \"team/team-member-stats.html\",\n      scope: {\n        stats: \"=\",\n        userId: \"=user\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamMemberStats\", TeamMemberStatsDirective);\n\n  TeamMemberCurrentUserDirective = function() {\n    return {\n      templateUrl: \"team/team-member-current-user.html\",\n      scope: {\n        project: \"=project\",\n        currentUser: \"=currentuser\",\n        stats: \"=\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\",\n        owner: \"=owner\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamCurrentUser\", TeamMemberCurrentUserDirective);\n\n  TeamMembersDirective = function() {\n    var template;\n    template = \"team/team-members.html\";\n    return {\n      templateUrl: template,\n      scope: {\n        memberships: \"=\",\n        filtersQ: \"=filtersq\",\n        filtersRole: \"=filtersrole\",\n        stats: \"=\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\",\n        owner: \"=owner\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamMembers\", TeamMembersDirective);\n\n  LeaveProjectDirective = function($repo, $confirm, $location, $rs, $navurls, $translate, lightboxFactory, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var leaveConfirm;\n      leaveConfirm = function() {\n        var confirm_leave_project_text, leave_project_text;\n        leave_project_text = $translate.instant(\"TEAM.ACTION_LEAVE_PROJECT\");\n        confirm_leave_project_text = $translate.instant(\"TEAM.CONFIRM_LEAVE_PROJECT\");\n        return $confirm.ask(leave_project_text, confirm_leave_project_text).then((function(_this) {\n          return function(response) {\n            var promise;\n            promise = $rs.projects.leave($scope.project.id);\n            promise.then(function() {\n              return currentUserService.loadProjects().then(function() {\n                response.finish();\n                $confirm.notify(\"success\");\n                return $location.path($navurls.resolve(\"home\"));\n              });\n            });\n            return promise.then(null, function(response) {\n              response.finish();\n              return $confirm.notify('error', response.data._error_message);\n            });\n          };\n        })(this));\n      };\n      return $scope.leave = function() {\n        if ($scope.project.owner.id === $scope.user.id) {\n          return lightboxFactory.create(\"tg-lightbox-leave-project-warning\", {\n            \"class\": \"lightbox lightbox-leave-project-warning\"\n          }, {\n            isCurrentUser: true,\n            project: $scope.project\n          });\n        } else {\n          return leaveConfirm();\n        }\n      };\n    };\n    return {\n      scope: {\n        user: \"=\",\n        project: \"=\"\n      },\n      templateUrl: \"team/leave-project.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLeaveProject\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"$tgResources\", \"$tgNavUrls\", \"$translate\", \"tgLightboxFactory\", \"tgCurrentUserService\", LeaveProjectDirective]);\n\n  membersFilter = function() {\n    return function(members, filtersQ, filtersRole) {\n      return _.filter(members, function(m) {\n        return (!filtersRole || m.role === filtersRole.id) && (!filtersQ || m.full_name.search(new RegExp(filtersQ, \"i\")) >= 0);\n      });\n    };\n  };\n\n  module.filter('membersFilter', membersFilter);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/detail.coffee\n */\n\n(function() {\n  var EditableWikiContentDirective, WikiDetailController, WikiSummaryDirective, bindOnce, debounce, groupBy, mixOf, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiDetailController = (function(superClass) {\n    extend(WikiDetailController, superClass);\n\n    WikiDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgModel\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$filter\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", \"tgErrorHandlingService\"];\n\n    function WikiDetailController(scope, rootscope, repo, model, confirm, rs, params, q, location, filter, log, appMetaService, navUrls, analytics, translate, errorHandlingService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.model = model;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.filter = filter;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      this.moveLink = bind(this.moveLink, this);\n      this.scope.$on(\"wiki:links:move\", this.moveLink);\n      this.scope.projectSlug = this.params.pslug;\n      this.scope.wikiSlug = this.params.slug;\n      this.scope.wikiTitle = this.scope.wikiSlug;\n      this.scope.sectionName = \"Wiki\";\n      this.scope.linksVisible = false;\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          return _this._setMeta();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    WikiDetailController.prototype._setMeta = function() {\n      var description, ref, ref1, ref2, title;\n      title = this.translate.instant(\"WIKI.PAGE_TITLE\", {\n        wikiPageName: this.scope.wikiTitle,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"WIKI.PAGE_DESCRIPTION\", {\n        wikiPageContent: angular.element(((ref = this.scope.wiki) != null ? ref.html : void 0) || \"\").text(),\n        totalEditions: ((ref1 = this.scope.wiki) != null ? ref1.editions : void 0) || 0,\n        lastModifiedDate: moment((ref2 = this.scope.wiki) != null ? ref2.modified_date : void 0).format(this.translate.instant(\"WIKI.DATETIME\"))\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    WikiDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_wiki_activated) {\n            _this.errorHandlingService.permissionDenied();\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadWiki = function() {\n      var promise;\n      promise = this.rs.wiki.getBySlug(this.scope.projectId, this.params.slug);\n      promise.then((function(_this) {\n        return function(wiki) {\n          _this.scope.wiki = wiki;\n          _this.scope.wikiId = wiki.id;\n          return _this.scope.wiki;\n        };\n      })(this));\n      return promise.then(null, (function(_this) {\n        return function(xhr) {\n          var data;\n          _this.scope.wikiId = null;\n          if (_this.scope.project.my_permissions.indexOf(\"add_wiki_page\") === -1) {\n            return null;\n          }\n          data = {\n            project: _this.scope.projectId,\n            slug: _this.scope.wikiSlug,\n            content: \"\"\n          };\n          _this.scope.wiki = _this.model.make_model(\"wiki\", data);\n          return _this.scope.wiki;\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadWikiLinks = function() {\n      return this.rs.wiki.listLinks(this.scope.projectId).then((function(_this) {\n        return function(wikiLinks) {\n          var i, len, link, ref, selectedWikiLink;\n          _this.scope.wikiLinks = wikiLinks;\n          ref = _this.scope.wikiLinks;\n          for (i = 0, len = ref.length; i < len; i++) {\n            link = ref[i];\n            link.url = _this.navUrls.resolve(\"project-wiki-page\", {\n              project: _this.scope.projectSlug,\n              slug: link.href\n            });\n          }\n          selectedWikiLink = _.find(wikiLinks, {\n            href: _this.scope.wikiSlug\n          });\n          if (selectedWikiLink != null) {\n            return _this.scope.wikiTitle = selectedWikiLink.title;\n          }\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.q.all([_this.loadWikiLinks(), _this.loadWiki()]).then(_this.checkLinksPerms.bind(_this));\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.checkLinksPerms = function() {\n      if (this.scope.project.my_permissions.indexOf(\"add_wiki_link\") !== -1 || (this.scope.project.my_permissions.indexOf(\"view_wiki_links\") !== -1 && this.scope.wikiLinks.length)) {\n        return this.scope.linksVisible = true;\n      }\n    };\n\n    WikiDetailController.prototype[\"delete\"] = function() {\n      var message, title;\n      title = this.translate.instant(\"WIKI.DELETE_LIGHTBOX_TITLE\");\n      message = this.scope.wikiTitle;\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            var ctx;\n            askResponse.finish();\n            ctx = {\n              project: _this.scope.projectSlug\n            };\n            _this.location.path(_this.navUrls.resolve(\"project-wiki\", ctx));\n            return _this.confirm.notify(\"success\");\n          };\n          onError = function() {\n            askResponse.finish(false);\n            return _this.confirm.notify(\"error\");\n          };\n          return _this.repo.remove(_this.scope.wiki).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.moveLink = function(ctx, item, itemIndex) {\n      var r, values;\n      values = this.scope.wikiLinks;\n      r = values.indexOf(item);\n      values.splice(r, 1);\n      values.splice(itemIndex, 0, item);\n      _.each(values, function(value, index) {\n        return value.order = index;\n      });\n      return this.repo.saveAll(values);\n    };\n\n    return WikiDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"WikiDetailController\", WikiDetailController);\n\n  WikiSummaryDirective = function($log, $template, $compile, $translate, avatarService) {\n    var link, template;\n    template = $template.get(\"wiki/wiki-summary.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var render;\n      render = function(wiki) {\n        var avatar, ctx, html, user;\n        if ($scope.usersById == null) {\n          $log.error(\"WikiSummaryDirective requires userById set in scope.\");\n        } else {\n          user = $scope.usersById[wiki.last_modifier];\n        }\n        avatar = avatarService.getAvatar(user);\n        if (user === void 0) {\n          user = {\n            name: \"unknown\",\n            avatar: avatar\n          };\n        } else {\n          user = {\n            name: user.full_name_display,\n            avatar: avatar\n          };\n        }\n        ctx = {\n          totalEditions: wiki.editions,\n          lastModifiedDate: moment(wiki.modified_date).format($translate.instant(\"WIKI.DATETIME\")),\n          user: user\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(wikiPage) {\n        if (!wikiPage) {\n          return;\n        }\n        return render(wikiPage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgWikiSummary\", [\"$log\", \"$tgTemplate\", \"$compile\", \"$translate\", \"tgAvatarService\", WikiSummaryDirective]);\n\n  EditableWikiContentDirective = function($window, $document, $repo, $confirm, $loading, $analytics, $qqueue, $translate, $wikiHistoryService) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var cancelEdition, disableEdition, getSelectedText, isEditable, save, switchToEditMode, switchToReadMode;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_wiki_page\") !== -1;\n      };\n      switchToEditMode = function() {\n        $el.find('.edit-wiki-content').show();\n        $el.find('.view-wiki-content').hide();\n        return $el.find('textarea').focus();\n      };\n      switchToReadMode = function() {\n        $el.find('.edit-wiki-content').hide();\n        return $el.find('.view-wiki-content').show();\n      };\n      disableEdition = function() {\n        $el.find(\".view-wiki-content .edit\").remove();\n        return $el.find(\".edit-wiki-content\").remove();\n      };\n      cancelEdition = function() {\n        if (!$model.$modelValue.id) {\n          return;\n        }\n        $model.$modelValue.revert();\n        return switchToReadMode();\n      };\n      getSelectedText = function() {\n        if ($window.getSelection) {\n          return $window.getSelection().toString();\n        } else if ($document.selection) {\n          return $document.selection.createRange().text;\n        }\n        return null;\n      };\n      save = $qqueue.bindAdd(function(wiki) {\n        var currentLoading, onError, onSuccess, promise;\n        onSuccess = function(wikiPage) {\n          if (wiki.id == null) {\n            $analytics.trackEvent(\"wikipage\", \"create\", \"create wiki page\", 1);\n          }\n          $model.$setViewValue(wikiPage.clone());\n          $wikiHistoryService.loadHistoryEntries();\n          $confirm.notify(\"success\");\n          return switchToReadMode();\n        };\n        onError = function() {\n          return $confirm.notify(\"error\");\n        };\n        currentLoading = $loading().target($el.find('.save')).start();\n        if (wiki.id != null) {\n          promise = $repo.save(wiki).then(onSuccess, onError);\n        } else {\n          promise = $repo.create(\"wiki\", wiki).then(onSuccess, onError);\n        }\n        return promise[\"finally\"](function() {\n          return currentLoading.finish();\n        });\n      });\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.currentTarget);\n        href = target.attr('href');\n        if (href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"mousedown\", \".view-wiki-content\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (!isEditable()) {\n          return;\n        }\n        if (event.button === 2) {\n\n        }\n      });\n      $el.on(\"mouseup\", \".view-wiki-content\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (getSelectedText()) {\n          return;\n        }\n        if (!isEditable()) {\n          return;\n        }\n        if (target.is('a')) {\n          return;\n        }\n        if (target.is('pre')) {\n          return;\n        }\n        return switchToEditMode();\n      });\n      $el.on(\"click\", \".save\", debounce(2000, function() {\n        return save($scope.wiki);\n      }));\n      $el.on(\"click\", \".cancel\", function() {\n        return $scope.$apply(cancelEdition);\n      });\n      $el.on(\"keydown\", \"textarea\", function(event) {\n        if (event.keyCode !== 27) {\n          return;\n        }\n        return $scope.$applyAsync(function() {\n          var message, title;\n          title = $translate.instant(\"COMMON.CONFIRM_CLOSE_EDIT_MODE_TITLE\");\n          message = $translate.instant(\"COMMON.CONFIRM_CLOSE_EDIT_MODE_MESSAGE\");\n          return $confirm.ask(title, null, message).then(function(askResponse) {\n            cancelEdition();\n            return askResponse.finish();\n          });\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(wikiPage) {\n        if (!wikiPage) {\n          return;\n        }\n        if (isEditable()) {\n          $el.addClass('editable');\n          if ((wikiPage.id == null) || $.trim(wikiPage.content).length === 0) {\n            return switchToEditMode();\n          }\n        } else {\n          return disableEdition();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      templateUrl: \"wiki/editable-wiki-content.html\"\n    };\n  };\n\n  module.directive(\"tgEditableWikiContent\", [\"$window\", \"$document\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgAnalytics\", \"$tgQqueue\", \"$translate\", \"tgWikiHistoryService\", EditableWikiContentDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/detail.coffee\n */\n\n(function() {\n  var WikiNavDirective, bindOnce, groupBy, mixOf, module, taiga;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiNavDirective = function($tgrepo, $log, $location, $confirm, $analytics, $loading, $template, $compile, $translate) {\n    var link, linkWikiLinks, template;\n    template = $template.get(\"wiki/wiki-nav.html\", true);\n    linkWikiLinks = function($scope, $el, $attrs) {\n      var $ctrl, addWikiLinkPermission, drake, render;\n      $ctrl = $el.controller();\n      if ($attrs.ngModel == null) {\n        return $log.error(\"WikiNavDirective: no ng-model attr is defined\");\n      }\n      addWikiLinkPermission = $scope.project.my_permissions.indexOf(\"add_wiki_link\") > -1;\n      drake = null;\n      render = function(wikiLinks) {\n        var deleteWikiLinkPermission, html, itemEl, scroll, tdom;\n        addWikiLinkPermission = $scope.project.my_permissions.indexOf(\"add_wiki_link\") > -1;\n        deleteWikiLinkPermission = $scope.project.my_permissions.indexOf(\"delete_wiki_link\") > -1;\n        html = template({\n          wikiLinks: wikiLinks,\n          projectSlug: $scope.projectSlug,\n          addWikiLinkPermission: addWikiLinkPermission,\n          deleteWikiLinkPermission: deleteWikiLinkPermission\n        });\n        html = $compile(html)($scope);\n        $el.off();\n        if (addWikiLinkPermission && drake) {\n          drake.destroy();\n        }\n        $el.html(html);\n        if (addWikiLinkPermission) {\n          itemEl = null;\n          tdom = $el.find(\".sortable\");\n          drake = dragula([tdom[0]], {\n            direction: 'vertical',\n            copySortSource: false,\n            copy: false,\n            mirrorContainer: tdom[0],\n            moves: function(item) {\n              return $(item).is('li');\n            }\n          });\n          drake.on('dragend', function(item) {\n            var itemIndex;\n            itemEl = $(item);\n            item = itemEl.scope().link;\n            itemIndex = itemEl.index();\n            return $scope.$emit(\"wiki:links:move\", item, itemIndex);\n          });\n          scroll = autoScroll(window, {\n            margin: 20,\n            pixels: 30,\n            scrollWhenOutside: true,\n            autoScroll: function() {\n              return this.down && drake.dragging;\n            }\n          });\n        }\n        $el.on(\"click\", \".add-button\", function(event) {\n          event.preventDefault();\n          $el.find(\".new\").removeClass(\"hidden\");\n          $el.find(\".new input\").focus();\n          return $el.find(\".add-button\").hide();\n        });\n        $el.on(\"click\", \".js-delete-link\", function(event) {\n          var linkId, message, target, title;\n          event.preventDefault();\n          event.stopPropagation();\n          target = angular.element(event.currentTarget);\n          linkId = target.parents('.wiki-link').data('id');\n          title = $translate.instant(\"WIKI.DELETE_LIGHTBOX_TITLE\");\n          message = $scope.wikiLinks[linkId].title;\n          return $confirm.askOnDelete(title, message).then((function(_this) {\n            return function(askResponse) {\n              var promise;\n              promise = $tgrepo.remove($scope.wikiLinks[linkId]);\n              promise.then(function() {\n                promise = $ctrl.loadWikiLinks();\n                promise.then(function() {\n                  askResponse.finish();\n                  return render($scope.wikiLinks);\n                });\n                return promise.then(null, function() {\n                  return askResponse.finish();\n                });\n              });\n              return promise.then(null, function() {\n                askResponse.finish(false);\n                return $confirm.notify(\"error\");\n              });\n            };\n          })(this));\n        });\n        return $el.on(\"keyup\", \".new input\", function(event) {\n          var currentLoading, newLink, promise, target;\n          event.preventDefault();\n          if (event.keyCode === 13) {\n            target = angular.element(event.currentTarget);\n            newLink = target.val();\n            currentLoading = $loading().target($el.find(\".new\")).start();\n            promise = $tgrepo.create(\"wiki-links\", {\n              project: $scope.projectId,\n              title: newLink\n            });\n            promise.then(function() {\n              var loadPromise;\n              $analytics.trackEvent(\"wikilink\", \"create\", \"create wiki link\", 1);\n              loadPromise = $ctrl.loadWikiLinks();\n              loadPromise.then(function() {\n                currentLoading.finish();\n                $el.find(\".new\").addClass(\"hidden\");\n                $el.find(\".new input\").val('');\n                $el.find(\".add-button\").show();\n                return render($scope.wikiLinks);\n              });\n              return loadPromise.then(null, function() {\n                currentLoading.finish();\n                $el.find(\".new\").addClass(\"hidden\");\n                $el.find(\".new input\").val('');\n                $el.find(\".add-button\").show();\n                return $confirm.notify(\"error\", \"Error loading wiki links\");\n              });\n            });\n            return promise.then(null, function(error) {\n              var ref;\n              currentLoading.finish();\n              $el.find(\".new input\").val(newLink);\n              $el.find(\".new input\").focus().select();\n              if ((error != null ? (ref = error.__all__) != null ? ref[0] : void 0 : void 0) != null) {\n                return $confirm.notify(\"error\", \"The link already exists\");\n              } else {\n                return $confirm.notify(\"error\");\n              }\n            });\n          } else if (event.keyCode === 27) {\n            target = angular.element(event.currentTarget);\n            $el.find(\".new\").addClass(\"hidden\");\n            $el.find(\".new input\").val('');\n            return $el.find(\".add-button\").show();\n          }\n        });\n      };\n      return bindOnce($scope, $attrs.ngModel, render);\n    };\n    link = function($scope, $el, $attrs) {\n      linkWikiLinks($scope, $el, $attrs);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgWikiNav\", [\"$tgRepo\", \"$log\", \"$tgLocation\", \"$tgConfirm\", \"$tgAnalytics\", \"$tgLoading\", \"$tgTemplate\", \"$compile\", \"$translate\", WikiNavDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/pages-list.coffee\n */\n\n(function() {\n  var WikiPagesListController, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiPagesListController = (function(superClass) {\n    extend(WikiPagesListController, superClass);\n\n    WikiPagesListController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgModel\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgNavUrls\", \"tgErrorHandlingService\"];\n\n    function WikiPagesListController(scope, rootscope, repo, model, confirm, rs, params, q, navUrls, errorHandlingService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.model = model;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.navUrls = navUrls;\n      this.errorHandlingService = errorHandlingService;\n      this.scope.projectSlug = this.params.pslug;\n      this.scope.wikiSlug = this.params.slug;\n      this.scope.wikiTitle = this.scope.wikiSlug;\n      this.scope.sectionName = \"Wiki\";\n      this.scope.linksVisible = false;\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    WikiPagesListController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_wiki_activated) {\n            _this.errorHandlingService.permissionDenied();\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    WikiPagesListController.prototype.loadWikiPages = function() {\n      var promise;\n      return promise = this.rs.wiki.list(this.scope.projectId).then((function(_this) {\n        return function(wikipages) {\n          return _this.scope.wikipages = wikipages;\n        };\n      })(this));\n    };\n\n    WikiPagesListController.prototype.loadWikiLinks = function() {\n      return this.rs.wiki.listLinks(this.scope.projectId).then((function(_this) {\n        return function(wikiLinks) {\n          var i, len, link, ref, selectedWikiLink;\n          _this.scope.wikiLinks = wikiLinks;\n          ref = _this.scope.wikiLinks;\n          for (i = 0, len = ref.length; i < len; i++) {\n            link = ref[i];\n            link.url = _this.navUrls.resolve(\"project-wiki-page\", {\n              project: _this.scope.projectSlug,\n              slug: link.href\n            });\n          }\n          selectedWikiLink = _.find(wikiLinks, {\n            href: _this.scope.wikiSlug\n          });\n          if (selectedWikiLink != null) {\n            return _this.scope.wikiTitle = selectedWikiLink.title;\n          }\n        };\n      })(this));\n    };\n\n    WikiPagesListController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.q.all([_this.loadWikiLinks(), _this.loadWikiPages()]).then(_this.checkLinksPerms.bind(_this));\n        };\n      })(this));\n    };\n\n    WikiPagesListController.prototype.checkLinksPerms = function() {\n      if (this.scope.project.my_permissions.indexOf(\"add_wiki_link\") !== -1 || (this.scope.project.my_permissions.indexOf(\"view_wiki_links\") !== -1 && this.scope.wikiLinks.length)) {\n        return this.scope.linksVisible = true;\n      }\n    };\n\n    return WikiPagesListController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"WikiPagesListController\", WikiPagesListController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/lightboxes.coffee\n */\n\n(function() {\n  var ChangeOwnerLightboxController, ChangeOwnerLightboxDirective, LbRequestOwnershipDirective, LightboxAddMembersController, LightboxAddMembersDirective, LightboxAddMembersWarningMessageDirective, TransferProjectStartSuccessDirective, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaKanban\");\n\n  LightboxAddMembersController = (function() {\n    LightboxAddMembersController.$inject = [\"$scope\", \"lightboxService\", \"tgLoader\", \"$tgConfirm\", \"$tgResources\", \"$rootScope\"];\n\n    function LightboxAddMembersController(scope1, lightboxService1, tgLoader, confirm, rs1, rootScope) {\n      var pendingMembersCount;\n      this.scope = scope1;\n      this.lightboxService = lightboxService1;\n      this.tgLoader = tgLoader;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.rootScope = rootScope;\n      this._defaultMaxInvites = 4;\n      this._defaultRole = this.project.roles[0].id;\n      this.form = null;\n      this.submitInvites = false;\n      this.canAddUsers = true;\n      this.memberInvites = [];\n      if (this.project.max_memberships === null) {\n        this.membersLimit = this._defaultMaxInvites;\n      } else {\n        pendingMembersCount = Math.max(this.project.max_memberships - this.project.total_memberships, 0);\n        this.membersLimit = Math.min(pendingMembersCount, this._defaultMaxInvites);\n      }\n      this.addSingleMember();\n    }\n\n    LightboxAddMembersController.prototype.addSingleMember = function() {\n      this.memberInvites.push({\n        email: '',\n        role_id: this._defaultRole\n      });\n      if (this.memberInvites.length >= this.membersLimit) {\n        this.canAddUsers = false;\n      }\n      return this.showWarningMessage = !this.canAddUsers && this.project.total_memberships + this.memberInvites.length === this.project.max_memberships;\n    };\n\n    LightboxAddMembersController.prototype.removeSingleMember = function(index) {\n      this.memberInvites.splice(index, 1);\n      this.canAddUsers = true;\n      return this.showWarningMessage = this.membersLimit === 1;\n    };\n\n    LightboxAddMembersController.prototype.submit = function() {\n      var promise;\n      this.form.initializeFields();\n      this.form.reset();\n      if (!this.form.validate()) {\n        return;\n      }\n      this.memberInvites = _.filter(this.memberInvites, function(invites) {\n        return invites.email !== \"\";\n      });\n      this.submitInvites = true;\n      promise = this.rs.memberships.bulkCreateMemberships(this.project.id, this.memberInvites, this.invitationText);\n      return promise.then(this._onSuccessInvite.bind(this), this._onErrorInvite.bind(this));\n    };\n\n    LightboxAddMembersController.prototype._onSuccessInvite = function() {\n      this.submitInvites = false;\n      this.rootScope.$broadcast(\"membersform:new:success\");\n      this.lightboxService.closeAll();\n      return this.confirm.notify(\"success\");\n    };\n\n    LightboxAddMembersController.prototype._onErrorInvite = function(response) {\n      var errors;\n      this.submitInvites = false;\n      errors = {};\n      _.each(response.data.bulk_memberships, (function(_this) {\n        return function(value, index) {\n          if (value.email) {\n            errors[\"email-\" + index] = value.email[0];\n          }\n          if (value.role) {\n            return errors[\"role-\" + index] = value.role[0];\n          }\n        };\n      })(this));\n      this.form.setErrors(errors);\n      if (response.data._error_message) {\n        return this.confirm.notify(\"error\", response.data._error_message);\n      }\n    };\n\n    return LightboxAddMembersController;\n\n  })();\n\n  module.controller(\"LbAddMembersController\", LightboxAddMembersController);\n\n  LightboxAddMembersDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      lightboxService.open(el);\n      return ctrl.form = el.find(\"form\").checksley();\n    };\n    return {\n      scope: {},\n      bindToController: {\n        project: '='\n      },\n      controller: 'LbAddMembersController',\n      controllerAs: 'vm',\n      templateUrl: 'admin/lightbox-add-members.html',\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbAddMembers\", [\"lightboxService\", LightboxAddMembersDirective]);\n\n  LightboxAddMembersWarningMessageDirective = function() {\n    return {\n      templateUrl: \"admin/memberships-warning-message.html\",\n      scope: {\n        project: \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgLightboxAddMembersWarningMessage\", [LightboxAddMembersWarningMessageDirective]);\n\n  LbRequestOwnershipDirective = function(lightboxService, rs, confirmService, $translate) {\n    return {\n      link: function(scope, el) {\n        lightboxService.open(el);\n        return scope.request = function() {\n          scope.loading = true;\n          return rs.projects.transferRequest(scope.projectId).then(function() {\n            scope.loading = false;\n            lightboxService.close(el);\n            return confirmService.notify(\"success\", $translate.instant(\"ADMIN.PROJECT_PROFILE.REQUEST_OWNERSHIP_SUCCESS\"));\n          });\n        };\n      },\n      templateUrl: \"common/lightbox/lightbox-request-ownership.html\"\n    };\n  };\n\n  module.directive('tgLbRequestOwnership', [\"lightboxService\", \"tgResources\", \"$tgConfirm\", \"$translate\", LbRequestOwnershipDirective]);\n\n  ChangeOwnerLightboxController = (function() {\n    function ChangeOwnerLightboxController(rs1, lightboxService1, confirm, translate) {\n      this.rs = rs1;\n      this.lightboxService = lightboxService1;\n      this.confirm = confirm;\n      this.translate = translate;\n      this.users = [];\n      this.q = \"\";\n      this.commentOpen = false;\n    }\n\n    ChangeOwnerLightboxController.prototype.limit = 3;\n\n    ChangeOwnerLightboxController.prototype.normalizeString = function(normalizedString) {\n      normalizedString = normalizedString.replace(\"Á\", \"A\").replace(\"Ä\", \"A\").replace(\"À\", \"A\");\n      normalizedString = normalizedString.replace(\"É\", \"E\").replace(\"Ë\", \"E\").replace(\"È\", \"E\");\n      normalizedString = normalizedString.replace(\"Í\", \"I\").replace(\"Ï\", \"I\").replace(\"Ì\", \"I\");\n      normalizedString = normalizedString.replace(\"Ó\", \"O\").replace(\"Ö\", \"O\").replace(\"Ò\", \"O\");\n      normalizedString = normalizedString.replace(\"Ú\", \"U\").replace(\"Ü\", \"U\").replace(\"Ù\", \"U\");\n      return normalizedString;\n    };\n\n    ChangeOwnerLightboxController.prototype.filterUsers = function(user) {\n      var text, username;\n      username = user.full_name_display.toUpperCase();\n      username = this.normalizeString(username);\n      text = this.q.toUpperCase();\n      text = this.normalizeString(text);\n      return _.includes(username, text);\n    };\n\n    ChangeOwnerLightboxController.prototype.getUsers = function() {\n      var users;\n      if (!this.users.length && !this.q.length) {\n        users = this.activeUsers;\n      } else {\n        users = this.users;\n      }\n      users = users.slice(0, this.limit);\n      users = _.reject(users, {\n        \"selected\": true\n      });\n      return _.reject(users, {\n        \"id\": this.currentOwnerId\n      });\n    };\n\n    ChangeOwnerLightboxController.prototype.userSearch = function() {\n      this.users = this.activeUsers;\n      this.selected = _.find(this.users, {\n        \"selected\": true\n      });\n      if (this.q) {\n        return this.users = _.filter(this.users, this.filterUsers.bind(this));\n      }\n    };\n\n    ChangeOwnerLightboxController.prototype.selectUser = function(user) {\n      this.activeUsers = _.map(this.activeUsers, function(user) {\n        user.selected = false;\n        return user;\n      });\n      user.selected = true;\n      return this.userSearch();\n    };\n\n    ChangeOwnerLightboxController.prototype.submit = function() {\n      this.loading = true;\n      return this.rs.projects.transferStart(this.projectId, this.selected.id, this.comment).then((function(_this) {\n        return function() {\n          var desc, title;\n          _this.loading = false;\n          _this.lightboxService.closeAll();\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_TITLE\");\n          desc = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_DESC\");\n          return _this.confirm.success(title, desc, {\n            type: \"svg\",\n            name: \"icon-speak-up\"\n          });\n        };\n      })(this));\n    };\n\n    return ChangeOwnerLightboxController;\n\n  })();\n\n  ChangeOwnerLightboxController.$inject = [\"tgResources\", \"lightboxService\", \"$tgConfirm\", \"$translate\"];\n\n  module.controller('ChangeOwnerLightbox', ChangeOwnerLightboxController);\n\n  ChangeOwnerLightboxDirective = function(lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function(scope, el) {\n      return lightboxService.open(el);\n    };\n    return {\n      scope: true,\n      controller: \"ChangeOwnerLightbox\",\n      controllerAs: \"vm\",\n      bindToController: {\n        currentOwnerId: \"=\",\n        projectId: \"=\",\n        activeUsers: \"=\"\n      },\n      templateUrl: \"common/lightbox/lightbox-change-owner.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbChangeOwner\", [\"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", ChangeOwnerLightboxDirective]);\n\n  TransferProjectStartSuccessDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el) {\n      scope.close = function() {\n        return lightboxService.close(el);\n      };\n      return lightboxService.open(el);\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-transfer-project-start-success.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbTransferProjectStartSuccess\", [\"lightboxService\", TransferProjectStartSuccessDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/memberships.coffee\n */\n\n(function() {\n  var MembershipsController, MembershipsDirective, MembershipsRowActionsDirective, MembershipsRowAdminCheckboxDirective, MembershipsRowAvatarDirective, MembershipsRowRoleSelectorDirective, NoMoreMembershipsExplanationDirective, bindMethods, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaAdmin\");\n\n  MembershipsController = (function(superClass) {\n    extend(MembershipsController, superClass);\n\n    MembershipsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAnalytics\", \"tgAppMetaService\", \"$translate\", \"$tgAuth\", \"tgLightboxFactory\", \"tgErrorHandlingService\"];\n\n    function MembershipsController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, analytics, appMetaService, translate, auth, lightboxFactory1, errorHandlingService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.auth = auth;\n      this.lightboxFactory = lightboxFactory1;\n      this.errorHandlingService = errorHandlingService;\n      bindMethods(this);\n      this.scope.project = {};\n      this.scope.filters = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.MEMBERSHIPS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"membersform:new:success\", (function(_this) {\n        return function() {\n          _this.loadInitialData();\n          return _this.analytics.trackEvent(\"membership\", \"create\", \"create memberships on admin\", 1);\n        };\n      })(this));\n    }\n\n    MembershipsController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.errorHandlingService.permissionDenied();\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.canAddUsers = project.max_memberships === null || project.max_memberships > project.total_memberships;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.loadMembers = function() {\n      var httpFilters;\n      httpFilters = this.getUrlFilters();\n      return this.rs.memberships.list(this.scope.projectId, httpFilters).then((function(_this) {\n        return function(data) {\n          _this.scope.memberships = _.filter(data.models, function(membership) {\n            return membership.user === null || membership.is_user_active;\n          });\n          _this.scope.page = data.current;\n          _this.scope.count = data.count;\n          _this.scope.paginatedBy = data.paginatedBy;\n          return data;\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.loadInitialData = function() {\n      return this.loadProject().then((function(_this) {\n        return function() {\n          return _this.q.all([_this.loadMembers(), _this.auth.refresh()]);\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.getUrlFilters = function() {\n      var filters;\n      filters = _.pick(this.location.search(), \"page\");\n      if (!filters.page) {\n        filters.page = 1;\n      }\n      return filters;\n    };\n\n    MembershipsController.prototype.addNewMembers = function() {\n      return this.lightboxFactory.create('tg-lb-add-members', {\n        \"class\": \"lightbox lightbox-add-member\",\n        \"project\": \"project\"\n      }, {\n        \"project\": this.scope.project\n      });\n    };\n\n    MembershipsController.prototype.showLimitUsersWarningMessage = function() {\n      var icon, message, title;\n      title = this.translate.instant(\"ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING\");\n      message = this.translate.instant(\"ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING_MESSAGE\", {\n        members: this.scope.project.max_memberships\n      });\n      icon = \"/\" + window._version + \"/svg/icons/team-question.svg\";\n      return this.confirm.success(title, message, {\n        name: icon,\n        type: \"img\"\n      });\n    };\n\n    return MembershipsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"MembershipsController\", MembershipsController);\n\n  MembershipsDirective = function($template, $compile) {\n    var link, linkPagination, template;\n    template = $template.get(\"admin/admin-membership-paginator.html\", true);\n    linkPagination = function($scope, $el, $attrs, $ctrl) {\n      var $pagEl, afterCurrent, atBegin, atEnd, beforeCurrent, getNumPages, renderPagination;\n      afterCurrent = 2;\n      beforeCurrent = 4;\n      atBegin = 2;\n      atEnd = 2;\n      $pagEl = $el.find(\".memberships-paginator\");\n      getNumPages = function() {\n        var numPages;\n        numPages = $scope.count / $scope.paginatedBy;\n        if (parseInt(numPages, 10) < numPages) {\n          numPages = parseInt(numPages, 10) + 1;\n        } else {\n          numPages = parseInt(numPages, 10);\n        }\n        return numPages;\n      };\n      renderPagination = function() {\n        var cpage, html, i, j, numPages, options, pages, ref;\n        numPages = getNumPages();\n        if (numPages <= 1) {\n          $pagEl.hide();\n          return;\n        }\n        pages = [];\n        options = {};\n        options.pages = pages;\n        options.showPrevious = $scope.page > 1;\n        options.showNext = !($scope.page === numPages);\n        cpage = $scope.page;\n        for (i = j = 1, ref = numPages; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n          if (i === (cpage + afterCurrent) && numPages > (cpage + afterCurrent + atEnd)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i === (cpage - beforeCurrent) && cpage > (atBegin + beforeCurrent)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i > (cpage + afterCurrent) && i <= (numPages - atEnd)) {\n\n          } else if (i < (cpage - beforeCurrent) && i > atBegin) {\n\n          } else if (i === cpage) {\n            pages.push({\n              classes: \"active\",\n              num: i,\n              type: \"page-active\"\n            });\n          } else {\n            pages.push({\n              classes: \"page\",\n              num: i,\n              type: \"page\"\n            });\n          }\n        }\n        html = template(options);\n        html = $compile(html)($scope);\n        $pagEl.html(html);\n        return $pagEl.show();\n      };\n      $scope.$watch(\"memberships\", function(value) {\n        if (!value) {\n          return;\n        }\n        return renderPagination();\n      });\n      $el.on(\"click\", \".memberships-paginator a.next\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page + 1);\n          return $ctrl.loadMembers();\n        });\n      });\n      $el.on(\"click\", \".memberships-paginator a.previous\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page - 1);\n          return $ctrl.loadMembers();\n        });\n      });\n      return $el.on(\"click\", \".memberships-paginator li.page > a\", function(event) {\n        var pagenum, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        pagenum = target.data(\"pagenum\");\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", pagenum);\n          return $ctrl.loadMembers();\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      linkPagination($scope, $el, $attrs, $ctrl);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMemberships\", [\"$tgTemplate\", \"$compile\", MembershipsDirective]);\n\n  MembershipsRowAvatarDirective = function($log, $template, $translate, $compile, avatarService) {\n    var link, template;\n    template = $template.get(\"admin/memberships-row-avatar.html\", true);\n    link = function($scope, $el, $attrs) {\n      var member, pending, render;\n      pending = $translate.instant(\"ADMIN.MEMBERSHIP.STATUS_PENDING\");\n      render = function(member) {\n        var avatar, ctx, html;\n        avatar = avatarService.getAvatar(member);\n        ctx = {\n          full_name: member.full_name ? member.full_name : \"\",\n          email: member.user_email ? member.user_email : member.email,\n          imgurl: avatar.url,\n          bg: avatar.bg,\n          pending: !member.is_user_active ? pending : \"\",\n          isOwner: member.is_owner\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowAvatar == null) {\n        return $log.error(\"MembershipsRowAvatarDirective: the directive need a member\");\n      }\n      member = $scope.$eval($attrs.tgMembershipsRowAvatar);\n      render(member);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowAvatar\", [\"$log\", \"$tgTemplate\", '$translate', \"$compile\", \"tgAvatarService\", MembershipsRowAvatarDirective]);\n\n  MembershipsRowAdminCheckboxDirective = function($log, $repo, $confirm, $template, $compile) {\n    var link, template;\n    template = $template.get(\"admin/admin-memberships-row-checkbox.html\", true);\n    link = function($scope, $el, $attrs) {\n      var html, member, render;\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      if ($attrs.tgMembershipsRowAdminCheckbox == null) {\n        return $log.error(\"MembershipsRowAdminCheckboxDirective: the directive need a member\");\n      }\n      member = $scope.$eval($attrs.tgMembershipsRowAdminCheckbox);\n      if (member.is_owner) {\n        $el.find(\".js-check\").remove();\n        return;\n      }\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          inputId: \"is-admin-\" + member.id\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \":checkbox\", (function(_this) {\n        return function(event) {\n          var onError, onSuccess, target;\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function(data) {\n            member.revert();\n            $el.find(\":checkbox\").prop(\"checked\", member.is_admin);\n            return $confirm.notify(\"error\", data.is_admin[0]);\n          };\n          target = angular.element(event.currentTarget);\n          member.is_admin = target.prop(\"checked\");\n          return $repo.save(member).then(onSuccess, onError);\n        };\n      })(this));\n      html = render(member);\n      if (member.is_admin) {\n        return $el.find(\":checkbox\").prop(\"checked\", true);\n      }\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowAdminCheckbox\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgTemplate\", \"$compile\", MembershipsRowAdminCheckboxDirective]);\n\n  MembershipsRowRoleSelectorDirective = function($log, $repo, $confirm) {\n    var link, template;\n    template = _.template(\"<select>\\n    <% _.each(roleList, function(role) { %>\\n    <option value=\\\"<%- role.id %>\\\" <% if(selectedRole === role.id){ %>selected=\\\"selected\\\"<% } %>>\\n        <%- role.name %>\\n    </option>\\n    <% }); %>\\n</select>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, html, member, render;\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          roleList: $scope.project.roles,\n          selectedRole: member.role\n        };\n        html = template(ctx);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowRoleSelector == null) {\n        return $log.error(\"MembershipsRowRoleSelectorDirective: the directive need a member\");\n      }\n      $ctrl = $el.controller();\n      member = $scope.$eval($attrs.tgMembershipsRowRoleSelector);\n      html = render(member);\n      $el.on(\"change\", \"select\", (function(_this) {\n        return function(event) {\n          var newRole, onError, onSuccess, target;\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          target = angular.element(event.currentTarget);\n          newRole = parseInt(target.val(), 10);\n          if (member.role !== newRole) {\n            member.role = newRole;\n            return $repo.save(member).then(onSuccess, onError);\n          }\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowRoleSelector\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", MembershipsRowRoleSelectorDirective]);\n\n  MembershipsRowActionsDirective = function($log, $repo, $rs, $confirm, $compile, $translate, $location, $navUrls, lightboxFactory) {\n    var activedTemplate, link, pendingTemplate;\n    activedTemplate = \"<div class=\\\"active\\\"\\n     translate=\\\"ADMIN.MEMBERSHIP.STATUS_ACTIVE\\\">\\n</div>\\n<a class=\\\"delete\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.DELETE_MEMBER' | translate }}\\\">\\n    <tg-svg svg-icon=\\\"icon-trash\\\"></tg-svg>\\n</a>\";\n    pendingTemplate = \"<a class=\\\"resend js-resend\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.RESEND' | translate }}\\\"\\n   translate=\\\"ADMIN.MEMBERSHIP.RESEND\\\">\\n</a>\\n<a class=\\\"delete\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.DELETE_MEMBER' | translate }}\\\">\\n    <tg-svg svg-icon=\\\"icon-trash\\\"></tg-svg>\\n</a>\";\n    link = function($scope, $el, $attrs) {\n      var $ctrl, leaveConfirm, member, render;\n      render = function(member) {\n        var html;\n        if (member.user) {\n          html = $compile(activedTemplate)($scope);\n        } else {\n          html = $compile(pendingTemplate)($scope);\n        }\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowActions == null) {\n        return $log.error(\"MembershipsRowActionsDirective: the directive need a member\");\n      }\n      $ctrl = $el.controller();\n      member = $scope.$eval($attrs.tgMembershipsRowActions);\n      render(member);\n      $el.on(\"click\", \".js-resend\", function(event) {\n        var onError, onSuccess;\n        event.preventDefault();\n        onSuccess = function() {\n          var text;\n          text = $translate.instant(\"ADMIN.MEMBERSHIP.SUCCESS_SEND_INVITATION\", {\n            email: $scope.member.email\n          });\n          return $confirm.notify(\"success\", text);\n        };\n        onError = function() {\n          var text;\n          text = $translate.instant(\"ADMIM.MEMBERSHIP.ERROR_SEND_INVITATION\");\n          return $confirm.notify(\"error\", text);\n        };\n        return $rs.memberships.resendInvitation($scope.member.id).then(onSuccess, onError);\n      });\n      leaveConfirm = function() {\n        var defaultMsg, message, title;\n        title = $translate.instant(\"ADMIN.MEMBERSHIP.DELETE_MEMBER\");\n        defaultMsg = $translate.instant(\"ADMIN.MEMBERSHIP.DEFAULT_DELETE_MESSAGE\", {\n          email: member.email\n        });\n        message = member.user ? member.full_name : defaultMsg;\n        return $confirm.askOnDelete(title, message).then(function(askResponse) {\n          var onError, onSuccess;\n          onSuccess = (function(_this) {\n            return function() {\n              var text;\n              askResponse.finish();\n              if (member.user !== $scope.user.id) {\n                if ($scope.page > 1 && ($scope.count - 1) <= $scope.paginatedBy) {\n                  $ctrl.selectFilter(\"page\", $scope.page - 1);\n                }\n                $ctrl.loadInitialData();\n              } else {\n                $location.path($navUrls.resolve(\"home\"));\n              }\n              text = $translate.instant(\"ADMIN.MEMBERSHIP.SUCCESS_DELETE\", {\n                message: message\n              });\n              return $confirm.notify(\"success\", text, null, 5000);\n            };\n          })(this);\n          onError = (function(_this) {\n            return function() {\n              var text;\n              askResponse.finish(false);\n              text = $translate.instant(\"ADMIN.MEMBERSHIP.ERROR_DELETE\", {\n                message: message\n              });\n              return $confirm.notify(\"error\", text);\n            };\n          })(this);\n          return $repo.remove(member).then(onSuccess, onError);\n        });\n      };\n      $el.on(\"click\", \".delete\", function(event) {\n        var isCurrentUser;\n        event.preventDefault();\n        if ($scope.project.owner.id === member.user) {\n          isCurrentUser = $scope.user.id === member.user;\n          return lightboxFactory.create(\"tg-lightbox-leave-project-warning\", {\n            \"class\": \"lightbox lightbox-leave-project-warning\"\n          }, {\n            isCurrentUser: isCurrentUser,\n            project: $scope.project\n          });\n        } else {\n          return leaveConfirm();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowActions\", [\"$log\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$compile\", \"$translate\", \"$tgLocation\", \"$tgNavUrls\", \"tgLightboxFactory\", MembershipsRowActionsDirective]);\n\n  NoMoreMembershipsExplanationDirective = function() {\n    return {\n      templateUrl: \"admin/no-more-memberships-explanation.html\",\n      scope: {\n        project: \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgNoMoreMembershipsExplanation\", [NoMoreMembershipsExplanationDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/nav.coffee\n */\n\n(function() {\n  var AdminNavigationDirective, module;\n\n  AdminNavigationDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var section;\n      section = $attrs.tgAdminNavigation;\n      $el.find(\".active\").removeClass(\"active\");\n      $el.find(\"#adminmenu-\" + section + \" a\").addClass(\"active\");\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaAdmin\");\n\n  module.directive(\"tgAdminNavigation\", AdminNavigationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/project-profile.coffee\n */\n\n(function() {\n  var AdminProjectChangeOwnerDirective, AdminProjectRequestOwnershipDirective, AdminProjectRestrictionsDirective, CsvEpicDirective, CsvExporterController, CsvExporterEpicsController, CsvExporterIssuesController, CsvExporterTasksController, CsvExporterUserstoriesController, CsvIssueDirective, CsvTaskDirective, CsvUsDirective, ProjectDefaultValuesDirective, ProjectExportDirective, ProjectLogoDirective, ProjectLogoModelDirective, ProjectModulesDirective, ProjectProfileController, ProjectProfileDirective, bindOnce, debounce, groupBy, joinStr, mixOf, module, taiga, toString, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAdmin\");\n\n  ProjectProfileController = (function(superClass) {\n    extend(ProjectProfileController, superClass);\n\n    ProjectProfileController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\", \"$tgAuth\", \"tgCurrentUserService\", \"tgErrorHandlingService\"];\n\n    function ProjectProfileController(scope1, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate, tgAuth, currentUserService1, errorHandlingService) {\n      var promise;\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.tgAuth = tgAuth;\n      this.currentUserService = currentUserService1;\n      this.errorHandlingService = errorHandlingService;\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      this.scope.projectTags = [];\n      promise.then((function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.PAGE_TITLE\", {\n            sectionName: sectionName,\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          _this.appMetaService.setAll(title, description);\n          return _this.fillUsersAndRoles(_this.scope.project.members, _this.scope.project.roles);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:loaded\", (function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.PAGE_TITLE\", {\n            sectionName: sectionName,\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n    }\n\n    ProjectProfileController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.errorHandlingService.permissionDenied();\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.epicStatusList = _.sortBy(project.epic_statuses, \"order\");\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.taskStatusList = _.sortBy(project.task_statuses, \"order\");\n          _this.scope.issueTypesList = _.sortBy(project.issue_types, \"order\");\n          _this.scope.issueStatusList = _.sortBy(project.issue_statuses, \"order\");\n          _this.scope.prioritiesList = _.sortBy(project.priorities, \"order\");\n          _this.scope.severitiesList = _.sortBy(project.severities, \"order\");\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.projectTags = _.map(_this.scope.project.tags, function(it) {\n            return [it, _this.scope.project.tags_colors[it]];\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    ProjectProfileController.prototype.loadInitialData = function() {\n      return this.q.all([this.loadProject(), this.tgAuth.refresh()]);\n    };\n\n    ProjectProfileController.prototype.openDeleteLightbox = function() {\n      return this.rootscope.$broadcast(\"deletelightbox:new\", this.scope.project);\n    };\n\n    ProjectProfileController.prototype.addTag = function(name, color) {\n      var tags;\n      tags = _.clone(this.scope.project.tags);\n      tags.push(name);\n      this.scope.projectTags.push([name, null]);\n      return this.scope.project.tags = tags;\n    };\n\n    ProjectProfileController.prototype.deleteTag = function(tag) {\n      var tags;\n      tags = _.clone(this.scope.project.tags);\n      _.pull(tags, tag[0]);\n      _.remove(this.scope.projectTags, (function(_this) {\n        return function(it) {\n          return it[0] === tag[0];\n        };\n      })(this));\n      return this.scope.project.tags = tags;\n    };\n\n    return ProjectProfileController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectProfileController\", ProjectProfileController);\n\n  ProjectProfileDirective = function($repo, $confirm, $loading, $navurls, $location, projectService, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, form, submit, submitButton;\n      $ctrl = $el.controller();\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            var newUrl;\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            newUrl = $navurls.resolve(\"project-admin-project-profile-details\", {\n              project: $scope.project.slug\n            });\n            $location.path(newUrl);\n            $ctrl.loadInitialData();\n            projectService.fetchProject();\n            return currentUserService.loadProjects();\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectProfile\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgNavUrls\", \"$tgLocation\", \"tgProjectService\", \"tgCurrentUserService\", ProjectProfileDirective]);\n\n  ProjectDefaultValuesDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectDefaultValues\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", ProjectDefaultValuesDirective]);\n\n  ProjectModulesDirective = function($repo, $confirm, $loading, projectService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      submit = (function(_this) {\n        return function() {\n          var form, promise;\n          form = $el.find(\"form\").checksley();\n          form.initializeFields();\n          form.reset();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            $scope.$emit(\"project:loaded\", $scope.project);\n            $confirm.notify(\"success\");\n            return projectService.fetchProject();\n          });\n          return promise.then(null, function(data) {\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this);\n      $el.on(\"change\", \".module-activation.module-direct-active input\", function(event) {\n        event.preventDefault();\n        return $scope.$applyAsync(submit);\n      });\n      $el.on(\"submit\", \"form\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"keydown\", \".videoconference-attributes input\", function(e) {\n        return e.which !== 32;\n      });\n      $scope.$watch(\"project.videoconferences\", function(newVal, oldVal) {\n        if ((newVal != null) && (oldVal != null) && newVal !== oldVal) {\n          return $scope.project.videoconferences_extra_data = \"\";\n        }\n      });\n      $scope.$watch(\"isVideoconferenceActivated\", function(newValue, oldValue) {\n        if (newValue === false) {\n          $scope.project.videoconferences = null;\n          $scope.project.videoconferences_extra_data = \"\";\n          if (oldValue === true) {\n            return submit();\n          }\n        }\n      });\n      return $scope.$watch(\"project\", function(project) {\n        if (project.videoconferences != null) {\n          return $scope.isVideoconferenceActivated = true;\n        } else {\n          return $scope.isVideoconferenceActivated = false;\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectModules\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"tgProjectService\", ProjectModulesDirective]);\n\n  ProjectExportDirective = function($window, $rs, $confirm, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var asyn_message, buttonsEl, dump_ready_text, hideButtons, hideResult, hideSpinner, loading_msg, loading_title, resultEl, resultMessageEl, resultTitleEl, setAsyncMessage, setAsyncTitle, setLoadingMessage, setLoadingTitle, setSyncMessage, setSyncTitle, showButtons, showErrorMode, showExportResultAsyncMode, showExportResultSyncMode, showLoadingMode, showResult, showSpinner, spinnerEl, syn_message;\n      buttonsEl = $el.find(\".admin-project-export-buttons\");\n      showButtons = function() {\n        return buttonsEl.removeClass(\"hidden\");\n      };\n      hideButtons = function() {\n        return buttonsEl.addClass(\"hidden\");\n      };\n      resultEl = $el.find(\".admin-project-export-result\");\n      showResult = function() {\n        return resultEl.removeClass(\"hidden\");\n      };\n      hideResult = function() {\n        return resultEl.addClass(\"hidden\");\n      };\n      spinnerEl = $el.find(\".spin\");\n      showSpinner = function() {\n        return spinnerEl.removeClass(\"hidden\");\n      };\n      hideSpinner = function() {\n        return spinnerEl.addClass(\"hidden\");\n      };\n      resultTitleEl = $el.find(\".result-title\");\n      loading_title = $translate.instant(\"ADMIN.PROJECT_EXPORT.LOADING_TITLE\");\n      loading_msg = $translate.instant(\"ADMIN.PROJECT_EXPORT.LOADING_MESSAGE\");\n      dump_ready_text = function() {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.DUMP_READY\"));\n      };\n      asyn_message = function() {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.ASYNC_MESSAGE\"));\n      };\n      syn_message = function(url) {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.SYNC_MESSAGE\", {\n          url: url\n        }));\n      };\n      setLoadingTitle = function() {\n        return resultTitleEl.html(loading_title);\n      };\n      setAsyncTitle = function() {\n        return resultTitleEl.html(loading_msg);\n      };\n      setSyncTitle = function() {\n        return resultTitleEl.html(dump_ready_text);\n      };\n      resultMessageEl = $el.find(\".result-message \");\n      setLoadingMessage = function() {\n        return resultMessageEl.html(loading_msg);\n      };\n      setAsyncMessage = function() {\n        return resultMessageEl.html(asyn_message);\n      };\n      setSyncMessage = function(url) {\n        return resultMessageEl.html(syn_message(url));\n      };\n      showLoadingMode = function() {\n        showSpinner();\n        setLoadingTitle();\n        setLoadingMessage();\n        hideButtons();\n        return showResult();\n      };\n      showExportResultAsyncMode = function() {\n        hideSpinner();\n        setAsyncTitle();\n        return setAsyncMessage();\n      };\n      showExportResultSyncMode = function(url) {\n        hideSpinner();\n        setSyncTitle();\n        return setSyncMessage(url);\n      };\n      showErrorMode = function() {\n        hideSpinner();\n        hideResult();\n        return showButtons();\n      };\n      return $el.on(\"click\", \"a.button-export\", debounce(2000, (function(_this) {\n        return function(event) {\n          var onError, onSuccess;\n          event.preventDefault();\n          onSuccess = function(result) {\n            var dumpUrl;\n            if (result.status === 202) {\n              return showExportResultAsyncMode();\n            } else {\n              dumpUrl = result.data.url;\n              showExportResultSyncMode(dumpUrl);\n              return $window.open(dumpUrl, \"_blank\");\n            }\n          };\n          onError = function(result) {\n            var errorMsg, ref;\n            showErrorMode();\n            errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR\");\n            if (result.status === 429) {\n              errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR_BUSY\");\n            } else if ((ref = result.data) != null ? ref._error_message : void 0) {\n              errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR_BUSY\", {\n                message: result.data._error_message\n              });\n            }\n            return $confirm.notify(\"error\", errorMsg);\n          };\n          showLoadingMode();\n          return $rs.projects[\"export\"]($scope.projectId).then(onSuccess, onError);\n        };\n      })(this)));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectExport\", [\"$window\", \"$tgResources\", \"$tgConfirm\", \"$translate\", ProjectExportDirective]);\n\n  CsvExporterController = (function(superClass) {\n    extend(CsvExporterController, superClass);\n\n    CsvExporterController.$inject = [\"$scope\", \"$rootScope\", \"$tgUrls\", \"$tgConfirm\", \"$tgResources\", \"$translate\"];\n\n    function CsvExporterController(scope1, rootscope, urls, confirm, rs, translate) {\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.urls = urls;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.translate = translate;\n      this._generateUuid = bind(this._generateUuid, this);\n      this.setCsvUuid = bind(this.setCsvUuid, this);\n      this.rootscope.$on(\"project:loaded\", this.setCsvUuid);\n      this.scope.$watch(\"csvUuid\", (function(_this) {\n        return function(value) {\n          if (value) {\n            return _this.scope.csvUrl = _this.urls.resolveAbsolute(_this.type + \"-csv\", value);\n          } else {\n            return _this.scope.csvUrl = \"\";\n          }\n        };\n      })(this));\n    }\n\n    CsvExporterController.prototype.setCsvUuid = function() {\n      return this.scope.csvUuid = this.scope.project[this.type + \"_csv_uuid\"];\n    };\n\n    CsvExporterController.prototype._generateUuid = function(response) {\n      var promise;\n      if (response == null) {\n        response = null;\n      }\n      promise = this.rs.projects[\"regenerate_\" + this.type + \"_csv_uuid\"](this.scope.projectId);\n      promise.then((function(_this) {\n        return function(data) {\n          var ref;\n          return _this.scope.csvUuid = (ref = data.data) != null ? ref.uuid : void 0;\n        };\n      })(this));\n      promise.then(null, (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n      promise[\"finally\"](function() {\n        if (response) {\n          return response.finish();\n        }\n      });\n      return promise;\n    };\n\n    CsvExporterController.prototype.regenerateUuid = function() {\n      var subtitle, title;\n      if (this.scope.csvUuid) {\n        title = this.translate.instant(\"ADMIN.REPORTS.REGENERATE_TITLE\");\n        subtitle = this.translate.instant(\"ADMIN.REPORTS.REGENERATE_SUBTITLE\");\n        return this.confirm.ask(title, subtitle).then(this._generateUuid);\n      } else {\n        return this._generateUuid();\n      }\n    };\n\n    return CsvExporterController;\n\n  })(taiga.Controller);\n\n  CsvExporterEpicsController = (function(superClass) {\n    extend(CsvExporterEpicsController, superClass);\n\n    function CsvExporterEpicsController() {\n      return CsvExporterEpicsController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterEpicsController.prototype.type = \"epics\";\n\n    return CsvExporterEpicsController;\n\n  })(CsvExporterController);\n\n  CsvExporterUserstoriesController = (function(superClass) {\n    extend(CsvExporterUserstoriesController, superClass);\n\n    function CsvExporterUserstoriesController() {\n      return CsvExporterUserstoriesController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterUserstoriesController.prototype.type = \"userstories\";\n\n    return CsvExporterUserstoriesController;\n\n  })(CsvExporterController);\n\n  CsvExporterTasksController = (function(superClass) {\n    extend(CsvExporterTasksController, superClass);\n\n    function CsvExporterTasksController() {\n      return CsvExporterTasksController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterTasksController.prototype.type = \"tasks\";\n\n    return CsvExporterTasksController;\n\n  })(CsvExporterController);\n\n  CsvExporterIssuesController = (function(superClass) {\n    extend(CsvExporterIssuesController, superClass);\n\n    function CsvExporterIssuesController() {\n      return CsvExporterIssuesController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterIssuesController.prototype.type = \"issues\";\n\n    return CsvExporterIssuesController;\n\n  })(CsvExporterController);\n\n  module.controller(\"CsvExporterEpicsController\", CsvExporterEpicsController);\n\n  module.controller(\"CsvExporterUserstoriesController\", CsvExporterUserstoriesController);\n\n  module.controller(\"CsvExporterTasksController\", CsvExporterTasksController);\n\n  module.controller(\"CsvExporterIssuesController\", CsvExporterIssuesController);\n\n  CsvEpicDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_EPIC\";\n    };\n    return {\n      controller: \"CsvExporterEpicsController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvEpic\", [\"$translate\", CsvEpicDirective]);\n\n  CsvUsDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_US\";\n    };\n    return {\n      controller: \"CsvExporterUserstoriesController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvUs\", [\"$translate\", CsvUsDirective]);\n\n  CsvTaskDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_TASK\";\n    };\n    return {\n      controller: \"CsvExporterTasksController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvTask\", [\"$translate\", CsvTaskDirective]);\n\n  CsvIssueDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_ISSUE\";\n    };\n    return {\n      controller: \"CsvExporterIssuesController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvIssue\", [\"$translate\", CsvIssueDirective]);\n\n  ProjectLogoDirective = function($auth, $model, $rs, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var onError, onSuccess, showSizeInfo;\n      showSizeInfo = function() {\n        return $el.find(\".size-info\").addClass(\"active\");\n      };\n      onSuccess = function(response) {\n        var project;\n        project = $model.make_model(\"projects\", response.data);\n        $scope.project = project;\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('success');\n      };\n      onError = function(response) {\n        if (response.status === 413) {\n          showSizeInfo();\n        }\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('error', response.data._error_message);\n      };\n      $el.on(\"click\", \".js-change-logo\", function() {\n        return $el.find(\"#logo-field\").click();\n      });\n      $el.on(\"change\", \"#logo-field\", function(event) {\n        if ($scope.logoAttachment) {\n          $el.find('.loading-overlay').addClass(\"active\");\n          return $rs.projects.changeLogo($scope.project.id, $scope.logoAttachment).then(onSuccess, onError);\n        }\n      });\n      $el.on(\"click\", \"a.js-use-default-logo\", function(event) {\n        $el.find('.loading-overlay').addClass(\"active\");\n        return $rs.projects.removeLogo($scope.project.id).then(onSuccess, onError);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectLogo\", [\"$tgAuth\", \"$tgModel\", \"$tgResources\", \"$tgConfirm\", ProjectLogoDirective]);\n\n  ProjectLogoModelDirective = function($parse) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var model, modelSetter;\n      model = $parse($attrs.tgProjectLogoModel);\n      modelSetter = model.assign;\n      return $el.bind('change', function() {\n        return $scope.$apply(function() {\n          return modelSetter($scope, $el[0].files[0]);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive('tgProjectLogoModel', ['$parse', ProjectLogoModelDirective]);\n\n  AdminProjectRestrictionsDirective = function() {\n    return {\n      scope: {\n        \"project\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-restrictions.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectRestrictions', [AdminProjectRestrictionsDirective]);\n\n  AdminProjectRequestOwnershipDirective = function(lightboxFactory) {\n    return {\n      link: function(scope) {\n        return scope.requestOwnership = function() {\n          return lightboxFactory.create(\"tg-lb-request-ownership\", {\n            \"class\": \"lightbox lightbox-request-ownership\"\n          }, {\n            projectId: scope.projectId\n          });\n        };\n      },\n      scope: {\n        \"projectId\": \"=\",\n        \"owner\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-request-ownership.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectRequestOwnership', [\"tgLightboxFactory\", AdminProjectRequestOwnershipDirective]);\n\n  AdminProjectChangeOwnerDirective = function(lightboxFactory) {\n    return {\n      link: function(scope) {\n        return scope.changeOwner = function() {\n          return lightboxFactory.create(\"tg-lb-change-owner\", {\n            \"class\": \"lightbox lightbox-select-user\",\n            \"project-id\": \"projectId\",\n            \"active-users\": \"activeUsers\",\n            \"current-owner-id\": \"currentOwnerId\"\n          }, {\n            projectId: scope.projectId,\n            activeUsers: scope.activeUsers,\n            currentOwnerId: scope.owner.id,\n            members: scope.members\n          });\n        };\n      },\n      scope: {\n        \"activeUsers\": \"=\",\n        \"projectId\": \"=\",\n        \"owner\": \"=\",\n        \"members\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-change-owner.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectChangeOwner', [\"tgLightboxFactory\", AdminProjectChangeOwnerDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/project-profile.coffee\n */\n\n(function() {\n  var ColorSelectionDirective, DATE_TYPE, MULTILINE_TYPE, ProjectCustomAttributesController, ProjectCustomAttributesDirective, ProjectTagsController, ProjectTagsDirective, ProjectValuesController, ProjectValuesDirective, ProjectValuesSectionController, TEXT_TYPE, TYPE_CHOICES, URL_TYPE, bindOnce, debounce, getDefaulColorList, groupBy, joinStr, mixOf, module, taiga, toString, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  getDefaulColorList = this.taiga.getDefaulColorList;\n\n  module = angular.module(\"taigaAdmin\");\n\n  ProjectValuesSectionController = (function(superClass) {\n    extend(ProjectValuesSectionController, superClass);\n\n    ProjectValuesSectionController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\", \"tgErrorHandlingService\"];\n\n    function ProjectValuesSectionController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate, errorHandlingService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_VALUES.PAGE_TITLE\", {\n            \"sectionName\": sectionName,\n            \"projectName\": _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    ProjectValuesSectionController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.errorHandlingService.permissionDenied();\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ProjectValuesSectionController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise;\n    };\n\n    return ProjectValuesSectionController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectValuesSectionController\", ProjectValuesSectionController);\n\n  ProjectValuesController = (function(superClass) {\n    extend(ProjectValuesController, superClass);\n\n    ProjectValuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\"];\n\n    function ProjectValuesController(scope, rootscope, repo, confirm, rs) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.moveValue = bind(this.moveValue, this);\n      this.loadValues = bind(this.loadValues, this);\n      this.scope.$on(\"admin:project-values:move\", this.moveValue);\n      this.rootscope.$on(\"project:loaded\", this.loadValues);\n    }\n\n    ProjectValuesController.prototype.loadValues = function() {\n      return this.rs[this.scope.resource].listValues(this.scope.projectId, this.scope.type).then((function(_this) {\n        return function(values) {\n          _this.scope.values = values;\n          _this.scope.maxValueOrder = _.maxBy(values, \"order\").order;\n          return values;\n        };\n      })(this));\n    };\n\n    ProjectValuesController.prototype.moveValue = function(ctx, itemValue, itemIndex) {\n      var r, values;\n      values = this.scope.values;\n      r = values.indexOf(itemValue);\n      values.splice(r, 1);\n      values.splice(itemIndex, 0, itemValue);\n      _.each(values, function(value, index) {\n        return value.order = index;\n      });\n      return this.repo.saveAll(values);\n    };\n\n    return ProjectValuesController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ProjectValuesController\", ProjectValuesController);\n\n  ProjectValuesDirective = function($log, $repo, $confirm, $location, animationFrame, $translate, $rootscope) {\n    var link, linkDragAndDrop, linkValue;\n    linkDragAndDrop = function($scope, $el, $attrs) {\n      var drake, itemEl, newParentScope, oldParentScope, scroll, tdom;\n      oldParentScope = null;\n      newParentScope = null;\n      itemEl = null;\n      tdom = $el.find(\".sortable\");\n      drake = dragula([tdom[0]], {\n        direction: 'vertical',\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: tdom[0],\n        moves: function(item) {\n          return $(item).is('div[tg-bind-scope]');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var itemIndex, itemValue;\n        itemEl = $(item);\n        itemValue = itemEl.scope().value;\n        itemIndex = itemEl.index();\n        return $scope.$broadcast(\"admin:project-values:move\", itemValue, itemIndex);\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return drake.destroy();\n      });\n    };\n    linkValue = function($scope, $el, $attrs) {\n      var $ctrl, cancel, goToBottomList, initializeNewValue, initializeTextTranslations, objName, saveNewValue, saveValue, valueType;\n      $ctrl = $el.controller();\n      valueType = $attrs.type;\n      objName = $attrs.objname;\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"name\": \"\",\n          \"is_closed\": false,\n          \"is_archived\": false\n        };\n      };\n      initializeTextTranslations = function() {\n        return $scope.addNewElementText = $translate.instant(\"ADMIN.PROJECT_VALUES_\" + (objName.toUpperCase()) + \".ACTION_ADD\");\n      };\n      initializeNewValue();\n      initializeTextTranslations();\n      $rootscope.$on(\"$translateChangeEnd\", function() {\n        return $scope.$evalAsync(initializeTextTranslations);\n      });\n      goToBottomList = (function(_this) {\n        return function(focus) {\n          var table;\n          if (focus == null) {\n            focus = false;\n          }\n          table = $el.find(\".table-main\");\n          $(document.body).scrollTop(table.offset().top + table.height());\n          if (focus) {\n            return $el.find(\".new-value input:visible\").first().focus();\n          }\n        };\n      })(this);\n      saveValue = function(target) {\n        var form, formEl, promise, value;\n        formEl = target.parents(\"form\");\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        value = formEl.scope().value;\n        promise = $repo.save(value);\n        promise.then((function(_this) {\n          return function() {\n            var row;\n            row = target.parents(\".row.table-main\");\n            row.addClass(\"hidden\");\n            return row.siblings(\".visualization\").removeClass('hidden');\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          return form.setErrors(data);\n        });\n      };\n      saveNewValue = function(target) {\n        var form, formEl, promise;\n        formEl = target.parents(\"form\");\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        $scope.newValue.project = $scope.project.id;\n        $scope.newValue.order = $scope.maxValueOrder ? $scope.maxValueOrder + 1 : 1;\n        promise = $repo.create(valueType, $scope.newValue);\n        promise.then((function(_this) {\n          return function(data) {\n            target.addClass(\"hidden\");\n            $scope.values.push(data);\n            $scope.maxValueOrder = data.order;\n            return initializeNewValue();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          return form.setErrors(data);\n        });\n      };\n      cancel = function(target) {\n        var formEl, row, value;\n        row = target.parents(\".row.table-main\");\n        formEl = target.parents(\"form\");\n        value = formEl.scope().value;\n        return $scope.$apply(function() {\n          row.addClass(\"hidden\");\n          value.revert();\n          return row.siblings(\".visualization\").removeClass('hidden');\n        });\n      };\n      $el.on(\"click\", \".show-add-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").removeClass('hidden');\n        return goToBottomList(true);\n      });\n      $el.on(\"click\", \".add-new\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        target = $el.find(\".new-value\");\n        return saveNewValue(target);\n      }));\n      $el.on(\"click\", \".delete-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").addClass(\"hidden\");\n        return initializeNewValue();\n      });\n      $el.on(\"click\", \".edit-value\", function(event) {\n        var editionRow, row, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        row = target.parents(\".row.table-main\");\n        row.addClass(\"hidden\");\n        editionRow = row.siblings(\".edition\");\n        editionRow.removeClass('hidden');\n        return editionRow.find('input:visible').first().focus().select();\n      });\n      $el.on(\"keyup\", \".new-value input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = $el.find(\".new-value\");\n          return saveNewValue(target);\n        } else if (event.keyCode === 27) {\n          $el.find(\".new-value\").addClass(\"hidden\");\n          return initializeNewValue();\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return saveValue(target);\n      });\n      $el.on(\"click\", \".cancel\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return cancel(target);\n      });\n      return $el.on(\"click\", \".delete-value\", function(event) {\n        var choices, formEl, subtitle, target, text, title, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.parents(\"form\");\n        value = formEl.scope().value;\n        choices = {};\n        _.each($scope.values, function(option) {\n          if (value.id !== option.id) {\n            return choices[option.id] = option.name;\n          }\n        });\n        subtitle = value.name;\n        if (_.keys(choices).length === 0) {\n          return $confirm.error($translate.instant(\"ADMIN.PROJECT_VALUES.ERROR_DELETE_ALL\"));\n        }\n        title = $translate.instant(\"ADMIN.COMMON.TITLE_ACTION_DELETE_VALUE\");\n        text = $translate.instant(\"ADMIN.PROJECT_VALUES.REPLACEMENT\");\n        return $confirm.askChoice(title, subtitle, choices, text).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadValues()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $repo.remove(value, {\n            \"moveTo\": response.selected\n          }).then(onSucces, onError);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      linkDragAndDrop($scope, $el, $attrs);\n      linkValue($scope, $el, $attrs);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectValues\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"animationFrame\", \"$translate\", \"$rootScope\", ProjectValuesDirective]);\n\n  ColorSelectionDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var $ctrl;\n      $scope.colorList = getDefaulColorList();\n      $scope.allowEmpty = false;\n      if ($attrs.tgAllowEmpty) {\n        $scope.allowEmpty = true;\n      }\n      $ctrl = $el.controller();\n      $scope.$watch($attrs.ngModel, function(element) {\n        return $scope.color = element.color;\n      });\n      $el.on(\"click\", \".current-color\", function(event) {\n        var body, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        $(\".select-color\").hide();\n        target.siblings(\".select-color\").show();\n        body = angular.element(\"body\");\n        return body.on(\"click\", (function(_this) {\n          return function(event) {\n            if (angular.element(event.target).parent(\".select-color\").length === 0) {\n              $el.find(\".select-color\").hide();\n              return body.unbind(\"click\");\n            }\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".select-color .color\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        $scope.$apply(function() {\n          return $model.$modelValue.color = target.data(\"color\");\n        });\n        return $el.find(\".select-color\").hide();\n      });\n      $el.on(\"click\", \".select-color .selected-color\", function(event) {\n        event.preventDefault();\n        $scope.$apply(function() {\n          return $model.$modelValue.color = $scope.color;\n        });\n        return $el.find(\".select-color\").hide();\n      });\n      $el.on(\"keyup\", \"input\", function(event) {\n        event.stopPropagation();\n        if (event.keyCode === 13) {\n          $scope.$apply(function() {\n            return $model.$modelValue.color = $scope.color;\n          });\n          return $el.find(\".select-color\").hide();\n        } else if (event.keyCode === 27) {\n          return $el.find(\".select-color\").hide();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgColorSelection\", ColorSelectionDirective);\n\n  TEXT_TYPE = \"text\";\n\n  MULTILINE_TYPE = \"multiline\";\n\n  DATE_TYPE = \"date\";\n\n  URL_TYPE = \"url\";\n\n  TYPE_CHOICES = [\n    {\n      key: TEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT\"\n    }, {\n      key: MULTILINE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI\"\n    }, {\n      key: DATE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE\"\n    }, {\n      key: URL_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_URL\"\n    }\n  ];\n\n  ProjectCustomAttributesController = (function(superClass) {\n    extend(ProjectCustomAttributesController, superClass);\n\n    ProjectCustomAttributesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function ProjectCustomAttributesController(scope, rootscope, repo, rs, params, q, location, navUrls, appMetaService, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.moveCustomAttributes = bind(this.moveCustomAttributes, this);\n      this.deleteCustomAttribute = bind(this.deleteCustomAttribute, this);\n      this.saveCustomAttribute = bind(this.saveCustomAttribute, this);\n      this.createCustomAttribute = bind(this.createCustomAttribute, this);\n      this.loadCustomAttributes = bind(this.loadCustomAttributes, this);\n      this.scope.TYPE_CHOICES = TYPE_CHOICES;\n      this.scope.project = {};\n      this.rootscope.$on(\"project:loaded\", (function(_this) {\n        return function() {\n          var description, sectionName, title;\n          _this.loadCustomAttributes();\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.CUSTOM_ATTRIBUTES.PAGE_TITLE\", {\n            \"sectionName\": sectionName,\n            \"projectName\": _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n    }\n\n    ProjectCustomAttributesController.prototype.loadCustomAttributes = function() {\n      return this.rs.customAttributes[this.scope.type].list(this.scope.projectId).then((function(_this) {\n        return function(customAttributes) {\n          var ref;\n          _this.scope.customAttributes = customAttributes;\n          _this.scope.maxOrder = (ref = _.maxBy(customAttributes, \"order\")) != null ? ref.order : void 0;\n          return customAttributes;\n        };\n      })(this));\n    };\n\n    ProjectCustomAttributesController.prototype.createCustomAttribute = function(attrValues) {\n      return this.repo.create(\"custom-attributes/\" + this.scope.type, attrValues);\n    };\n\n    ProjectCustomAttributesController.prototype.saveCustomAttribute = function(attrModel) {\n      return this.repo.save(attrModel);\n    };\n\n    ProjectCustomAttributesController.prototype.deleteCustomAttribute = function(attrModel) {\n      return this.repo.remove(attrModel);\n    };\n\n    ProjectCustomAttributesController.prototype.moveCustomAttributes = function(attrModel, newIndex) {\n      var customAttributes, r;\n      customAttributes = this.scope.customAttributes;\n      r = customAttributes.indexOf(attrModel);\n      customAttributes.splice(r, 1);\n      customAttributes.splice(newIndex, 0, attrModel);\n      _.each(customAttributes, function(val, idx) {\n        return val.order = idx;\n      });\n      return this.repo.saveAll(customAttributes);\n    };\n\n    return ProjectCustomAttributesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectCustomAttributesController\", ProjectCustomAttributesController);\n\n  ProjectCustomAttributesDirective = function($log, $confirm, animationFrame, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, cancelCreate, cancelUpdate, create, deleteCustomAttribute, drake, hideAddButton, hideCancelButton, hideCreateForm, hideEditForm, resetNewAttr, revertChangesInCustomAttribute, showAddButton, showCancelButton, showCreateForm, showEditForm, sortableEl, update;\n      $ctrl = $el.controller();\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      sortableEl = $el.find(\".js-sortable\");\n      drake = dragula([sortableEl[0]], {\n        direction: 'vertical',\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: sortableEl[0],\n        moves: function(item) {\n          return $(item).is('div[tg-bind-scope]');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var itemAttr, itemEl, itemIndex;\n        itemEl = $(item);\n        itemAttr = itemEl.scope().attr;\n        itemIndex = itemEl.index();\n        return $ctrl.moveCustomAttributes(itemAttr, itemIndex);\n      });\n      showCreateForm = function() {\n        $el.find(\".js-new-custom-field\").removeClass(\"hidden\");\n        return $el.find(\".js-new-custom-field input:visible\").first().focus();\n      };\n      hideCreateForm = function() {\n        return $el.find(\".js-new-custom-field\").addClass(\"hidden\");\n      };\n      showAddButton = function() {\n        return $el.find(\".js-add-custom-field-button\").removeClass(\"hidden\");\n      };\n      hideAddButton = function() {\n        return $el.find(\".js-add-custom-field-button\").addClass(\"hidden\");\n      };\n      showCancelButton = function() {\n        return $el.find(\".js-cancel-new-custom-field-button\").removeClass(\"hidden\");\n      };\n      hideCancelButton = function() {\n        return $el.find(\".js-cancel-new-custom-field-button\").addClass(\"hidden\");\n      };\n      resetNewAttr = function() {\n        return $scope.newAttr = {};\n      };\n      create = function(formEl) {\n        var attr, form, onError, onSucces;\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        onSucces = (function(_this) {\n          return function() {\n            $ctrl.loadCustomAttributes();\n            hideCreateForm();\n            resetNewAttr();\n            return $confirm.notify(\"success\");\n          };\n        })(this);\n        onError = (function(_this) {\n          return function(data) {\n            return form.setErrors(data);\n          };\n        })(this);\n        attr = $scope.newAttr;\n        attr.project = $scope.projectId;\n        attr.order = $scope.maxOrder ? $scope.maxOrder + 1 : 1;\n        return $ctrl.createCustomAttribute(attr).then(onSucces, onError);\n      };\n      cancelCreate = function() {\n        hideCreateForm();\n        return resetNewAttr();\n      };\n      $scope.$watch(\"customAttributes\", function(customAttributes) {\n        if (!customAttributes) {\n          return;\n        }\n        if (customAttributes.length === 0) {\n          hideCancelButton();\n          hideAddButton();\n          return showCreateForm();\n        } else {\n          hideCreateForm();\n          showAddButton();\n          return showCancelButton();\n        }\n      });\n      $el.on(\"click\", \".js-add-custom-field-button\", function(event) {\n        event.preventDefault();\n        return showCreateForm();\n      });\n      $el.on(\"click\", \".js-create-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return create(formEl);\n      }));\n      $el.on(\"click\", \".js-cancel-new-custom-field-button\", function(event) {\n        event.preventDefault();\n        return cancelCreate();\n      });\n      $el.on(\"keyup\", \".js-new-custom-field input\", function(event) {\n        var formEl, target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return create(formEl);\n        } else if (event.keyCode === 27) {\n          return cancelCreate();\n        }\n      });\n      showEditForm = function(formEl) {\n        formEl.find(\".js-view-custom-field\").addClass(\"hidden\");\n        formEl.find(\".js-edit-custom-field\").removeClass(\"hidden\");\n        return formEl.find(\".js-edit-custom-field input:visible\").first().focus().select();\n      };\n      hideEditForm = function(formEl) {\n        formEl.find(\".js-edit-custom-field\").addClass(\"hidden\");\n        return formEl.find(\".js-view-custom-field\").removeClass(\"hidden\");\n      };\n      revertChangesInCustomAttribute = function(formEl) {\n        return $scope.$apply(function() {\n          return formEl.scope().attr.revert();\n        });\n      };\n      update = function(formEl) {\n        var attr, form, onError, onSucces;\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        onSucces = (function(_this) {\n          return function() {\n            $ctrl.loadCustomAttributes();\n            hideEditForm(formEl);\n            return $confirm.notify(\"success\");\n          };\n        })(this);\n        onError = (function(_this) {\n          return function(data) {\n            return form.setErrors(data);\n          };\n        })(this);\n        attr = formEl.scope().attr;\n        return $ctrl.saveCustomAttribute(attr).then(onSucces, onError);\n      };\n      cancelUpdate = function(formEl) {\n        hideEditForm(formEl);\n        return revertChangesInCustomAttribute(formEl);\n      };\n      $el.on(\"click\", \".js-edit-custom-field-button\", function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return showEditForm(formEl);\n      });\n      $el.on(\"click\", \".js-update-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return update(formEl);\n      }));\n      $el.on(\"click\", \".js-cancel-edit-custom-field-button\", function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return cancelUpdate(formEl);\n      });\n      $el.on(\"keyup\", \".js-edit-custom-field input\", function(event) {\n        var formEl, target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return update(formEl);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return cancelUpdate(formEl);\n        }\n      });\n      deleteCustomAttribute = function(formEl) {\n        var attr, message, text, title;\n        attr = formEl.scope().attr;\n        message = attr.name;\n        title = $translate.instant(\"COMMON.CUSTOM_ATTRIBUTES.DELETE\");\n        text = $translate.instant(\"COMMON.CUSTOM_ATTRIBUTES.CONFIRM_DELETE\");\n        return $confirm.ask(title, text, message).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadCustomAttributes()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\", null, \"We have not been able to delete '\" + message + \"'.\");\n          };\n          return $ctrl.deleteCustomAttribute(attr).then(onSucces, onError);\n        });\n      };\n      return $el.on(\"click\", \".js-delete-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return deleteCustomAttribute(formEl);\n      }));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectCustomAttributes\", [\"$log\", \"$tgConfirm\", \"animationFrame\", \"$translate\", ProjectCustomAttributesDirective]);\n\n  ProjectTagsController = (function(superClass) {\n    extend(ProjectTagsController, superClass);\n\n    ProjectTagsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$tgModel\"];\n\n    function ProjectTagsController(scope, rootscope, repo, confirm, rs, model) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.model = model;\n      this.mixingClass = bind(this.mixingClass, this);\n      this.cancelMixingTags = bind(this.cancelMixingTags, this);\n      this.confirmMixingTags = bind(this.confirmMixingTags, this);\n      this.toggleMixingFromTags = bind(this.toggleMixingFromTags, this);\n      this.startMixingTags = bind(this.startMixingTags, this);\n      this.deleteTag = bind(this.deleteTag, this);\n      this.editTag = bind(this.editTag, this);\n      this.createTag = bind(this.createTag, this);\n      this.filterAndSortTags = bind(this.filterAndSortTags, this);\n      this.loadTags = bind(this.loadTags, this);\n      this.loading = true;\n      this.rootscope.$on(\"project:loaded\", this.loadTags);\n    }\n\n    ProjectTagsController.prototype.loadTags = function() {\n      return this.rs.projects.tagsColors(this.scope.projectId).then((function(_this) {\n        return function(tags) {\n          _this.scope.projectTagsAll = _.map(tags.getAttrs(), function(color, name) {\n            return _this.model.make_model('tag', {\n              name: name,\n              color: color\n            });\n          });\n          _this.filterAndSortTags();\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    ProjectTagsController.prototype.filterAndSortTags = function() {\n      return this.scope.projectTags = _.filter(_.sortBy(this.scope.projectTagsAll, \"name\"), (function(_this) {\n        return function(tag) {\n          return tag.name.indexOf(_this.scope.tagsFilter.name) !== -1;\n        };\n      })(this));\n    };\n\n    ProjectTagsController.prototype.createTag = function(tag, color) {\n      return this.rs.projects.createTag(this.scope.projectId, tag, color);\n    };\n\n    ProjectTagsController.prototype.editTag = function(from_tag, to_tag, color) {\n      if (from_tag === to_tag) {\n        to_tag = null;\n      }\n      return this.rs.projects.editTag(this.scope.projectId, from_tag, to_tag, color);\n    };\n\n    ProjectTagsController.prototype.deleteTag = function(tag) {\n      this.scope.loadingDelete = true;\n      return this.rs.projects.deleteTag(this.scope.projectId, tag)[\"finally\"]((function(_this) {\n        return function() {\n          return _this.scope.loadingDelete = false;\n        };\n      })(this));\n    };\n\n    ProjectTagsController.prototype.startMixingTags = function(tag) {\n      return this.scope.mixingTags.toTag = tag.name;\n    };\n\n    ProjectTagsController.prototype.toggleMixingFromTags = function(tag) {\n      var index;\n      if (tag.name !== this.scope.mixingTags.toTag) {\n        index = this.scope.mixingTags.fromTags.indexOf(tag.name);\n        if (index === -1) {\n          return this.scope.mixingTags.fromTags.push(tag.name);\n        } else {\n          return this.scope.mixingTags.fromTags.splice(index, 1);\n        }\n      }\n    };\n\n    ProjectTagsController.prototype.confirmMixingTags = function() {\n      var fromTags, toTag;\n      toTag = this.scope.mixingTags.toTag;\n      fromTags = this.scope.mixingTags.fromTags;\n      this.scope.loadingMixing = true;\n      return this.rs.projects.mixTags(this.scope.projectId, toTag, fromTags).then((function(_this) {\n        return function() {\n          _this.cancelMixingTags();\n          return _this.loadTags();\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.scope.loadingMixing = false;\n        };\n      })(this));\n    };\n\n    ProjectTagsController.prototype.cancelMixingTags = function() {\n      this.scope.mixingTags.toTag = null;\n      return this.scope.mixingTags.fromTags = [];\n    };\n\n    ProjectTagsController.prototype.mixingClass = function(tag) {\n      if (this.scope.mixingTags.toTag !== null) {\n        if (tag.name === this.scope.mixingTags.toTag) {\n          return \"mixing-tags-to\";\n        } else if (this.scope.mixingTags.fromTags.indexOf(tag.name) !== -1) {\n          return \"mixing-tags-from\";\n        }\n      }\n    };\n\n    return ProjectTagsController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ProjectTagsController\", ProjectTagsController);\n\n  ProjectTagsDirective = function($log, $repo, $confirm, $location, animationFrame, $translate, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, $window, cancel, goToBottomList, initializeMixingTags, initializeNewValue, initializeTagsFilter, initializeTextTranslations, objName, saveNewValue, saveValue, valueType;\n      $window = $(window);\n      $ctrl = $el.controller();\n      valueType = $attrs.type;\n      objName = $attrs.objname;\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"tag\": \"\",\n          \"color\": \"\"\n        };\n      };\n      initializeTagsFilter = function() {\n        return $scope.tagsFilter = {\n          \"name\": \"\"\n        };\n      };\n      initializeMixingTags = function() {\n        return $scope.mixingTags = {\n          \"toTag\": null,\n          \"fromTags\": []\n        };\n      };\n      initializeTextTranslations = function() {\n        return $scope.addNewElementText = $translate.instant(\"ADMIN.PROJECT_VALUES_TAGS.ACTION_ADD\");\n      };\n      initializeNewValue();\n      initializeTagsFilter();\n      initializeMixingTags();\n      initializeTextTranslations();\n      $rootscope.$on(\"$translateChangeEnd\", function() {\n        return $scope.$evalAsync(initializeTextTranslations);\n      });\n      goToBottomList = (function(_this) {\n        return function(focus) {\n          var table;\n          if (focus == null) {\n            focus = false;\n          }\n          table = $el.find(\".table-main\");\n          $(document.body).scrollTop(table.offset().top + table.height());\n          if (focus) {\n            return $el.find(\".new-value input:visible\").first().focus();\n          }\n        };\n      })(this);\n      saveValue = (function(_this) {\n        return function(target) {\n          var form, formEl, originalTag, promise, tag;\n          formEl = target.parents(\"form\");\n          form = formEl.checksley();\n          if (!form.validate()) {\n            return;\n          }\n          tag = formEl.scope().tag;\n          originalTag = tag.clone();\n          originalTag.revert();\n          $scope.loadingEdit = true;\n          promise = $ctrl.editTag(originalTag.name, tag.name, tag.color);\n          promise.then(function() {\n            return $ctrl.loadTags().then(function() {\n              var row;\n              row = target.parents(\".row.table-main\");\n              row.addClass(\"hidden\");\n              $scope.loadingEdit = false;\n              return row.siblings(\".visualization\").removeClass('hidden');\n            });\n          });\n          return promise.then(null, function(response) {\n            $scope.loadingEdit = false;\n            return form.setErrors(response.data);\n          });\n        };\n      })(this);\n      saveNewValue = (function(_this) {\n        return function(target) {\n          var form, formEl, promise;\n          formEl = target.parents(\"form\");\n          formEl = target;\n          form = formEl.checksley();\n          if (!form.validate()) {\n            return;\n          }\n          $scope.loadingCreate = true;\n          promise = $ctrl.createTag($scope.newValue.tag, $scope.newValue.color);\n          promise.then(function(data) {\n            return $ctrl.loadTags().then(function() {\n              $scope.loadingCreate = false;\n              target.addClass(\"hidden\");\n              return initializeNewValue();\n            });\n          });\n          return promise.then(null, function(response) {\n            $scope.loadingCreate = false;\n            return form.setErrors(response.data);\n          });\n        };\n      })(this);\n      cancel = function(target) {\n        var formEl, row, tag;\n        row = target.parents(\".row.table-main\");\n        formEl = target.parents(\"form\");\n        tag = formEl.scope().tag;\n        return $scope.$apply(function() {\n          row.addClass(\"hidden\");\n          tag.revert();\n          return row.siblings(\".visualization\").removeClass('hidden');\n        });\n      };\n      $scope.$watch(\"tagsFilter.name\", function(tagsFilter) {\n        return $ctrl.filterAndSortTags();\n      });\n      $window.on(\"keyup\", function(event) {\n        if (event.keyCode === 27) {\n          return $scope.$apply(function() {\n            return initializeMixingTags();\n          });\n        }\n      });\n      $el.on(\"click\", \".show-add-new\", function(event) {\n        event.preventDefault();\n        return $el.find(\".new-value\").removeClass('hidden');\n      });\n      $el.on(\"click\", \".add-new\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        target = $el.find(\".new-value\");\n        return saveNewValue(target);\n      }));\n      $el.on(\"click\", \".delete-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").addClass(\"hidden\");\n        return initializeNewValue();\n      });\n      $el.on(\"click\", \".mix-tags\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return $scope.$apply(function() {\n          return $ctrl.startMixingTags(target.parents('form').scope().tag);\n        });\n      });\n      $el.on(\"click\", \".mixing-row\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return $scope.$apply(function() {\n          return $ctrl.toggleMixingFromTags(target.parents('form').scope().tag);\n        });\n      });\n      $el.on(\"click\", \".mixing-confirm\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $scope.$apply(function() {\n          return $ctrl.confirmMixingTags();\n        });\n      });\n      $el.on(\"click\", \".mixing-cancel\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $scope.$apply(function() {\n          return $ctrl.cancelMixingTags();\n        });\n      });\n      $el.on(\"click\", \".edit-value\", function(event) {\n        var editionRow, row, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        row = target.parents(\".row.table-main\");\n        row.addClass(\"hidden\");\n        editionRow = row.siblings(\".edition\");\n        editionRow.removeClass('hidden');\n        return editionRow.find('input:visible').first().focus().select();\n      });\n      $el.on(\"keyup\", \".new-value input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = $el.find(\".new-value\");\n          return saveNewValue(target);\n        } else if (event.keyCode === 27) {\n          $el.find(\".new-value\").addClass(\"hidden\");\n          return initializeNewValue();\n        }\n      });\n      $el.on(\"keyup\", \".status-name input\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if (event.keyCode === 13) {\n          return saveValue(target);\n        } else if (event.keyCode === 27) {\n          return cancel(target);\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return saveValue(target);\n      });\n      $el.on(\"click\", \".cancel\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return cancel(target);\n      });\n      $el.on(\"click\", \".delete-tag\", function(event) {\n        var formEl, tag, target, title;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.parents(\"form\");\n        tag = formEl.scope().tag;\n        title = $translate.instant(\"ADMIN.COMMON.TITLE_ACTION_DELETE_TAG\");\n        return $confirm.askOnDelete(title, tag.name).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadTags()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $ctrl.deleteTag(tag.name).then(onSucces, onError);\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return $window.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectTags\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"animationFrame\", \"$translate\", \"$rootScope\", ProjectTagsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/memberships.coffee\n */\n\n(function() {\n  var EditRoleDirective, NewRoleDirective, RolePermissionsDirective, RolesController, RolesDirective, bindMethods, bindOnce, debounce, mixOf, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaAdmin\");\n\n  RolesController = (function(superClass) {\n    extend(RolesController, superClass);\n\n    RolesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\", \"tgErrorHandlingService\"];\n\n    function RolesController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate, errorHandlingService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      this._disableComputable = bind(this._disableComputable, this);\n      this._enableComputable = bind(this._enableComputable, this);\n      bindMethods(this);\n      this.scope.sectionName = \"ADMIN.MENU.PERMISSIONS\";\n      this.scope.project = {};\n      this.scope.anyComputableRole = true;\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.ROLES.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    RolesController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.errorHandlingService.permissionDenied();\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.anyComputableRole = _.some(_.map(project.roles, function(point) {\n            return point.computable;\n          }));\n          return project;\n        };\n      })(this));\n    };\n\n    RolesController.prototype.loadRoles = function() {\n      return this.rs.roles.list(this.scope.projectId).then((function(_this) {\n        return function(roles) {\n          var public_permission;\n          roles = roles.map(function(role) {\n            role.external_user = false;\n            return role;\n          });\n          public_permission = {\n            \"name\": _this.translate.instant(\"ADMIN.ROLES.EXTERNAL_USER\"),\n            \"permissions\": _this.scope.project.public_permissions,\n            \"external_user\": true\n          };\n          roles.push(public_permission);\n          _this.scope.roles = roles;\n          _this.scope.role = _this.scope.roles[0];\n          return roles;\n        };\n      })(this));\n    };\n\n    RolesController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadRoles();\n        };\n      })(this));\n      return promise;\n    };\n\n    RolesController.prototype.setRole = function(role) {\n      this.scope.role = role;\n      return this.scope.$broadcast(\"role:changed\", this.scope.role);\n    };\n\n    RolesController.prototype[\"delete\"] = function() {\n      var choices, i, len, ref, replacement, role, subtitle, title, warning;\n      choices = {};\n      ref = this.scope.roles;\n      for (i = 0, len = ref.length; i < len; i++) {\n        role = ref[i];\n        if (role.id !== this.scope.role.id) {\n          choices[role.id] = role.name;\n        }\n      }\n      if (_.keys(choices).length === 0) {\n        return this.confirm.error(this.translate.instant(\"ADMIN.ROLES.ERROR_DELETE_ALL\"));\n      }\n      title = this.translate.instant(\"ADMIN.ROLES.TITLE_DELETE_ROLE\");\n      subtitle = this.scope.role.name;\n      replacement = this.translate.instant(\"ADMIN.ROLES.REPLACEMENT_ROLE\");\n      warning = this.translate.instant(\"ADMIN.ROLES.WARNING_DELETE_ROLE\");\n      return this.confirm.askChoice(title, subtitle, choices, replacement, warning).then((function(_this) {\n        return function(response) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            _this.loadProject();\n            return _this.loadRoles()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return _this.confirm.notify('error');\n          };\n          return _this.repo.remove(_this.scope.role, {\n            moveTo: response.selected\n          }).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    RolesController.prototype._enableComputable = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"success\");\n          return _this.loadProject();\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"error\");\n          return _this.scope.role.revert();\n        };\n      })(this);\n      return this.repo.save(this.scope.role).then(onSuccess, onError);\n    };\n\n    RolesController.prototype._disableComputable = function() {\n      var askOnError, askOnSuccess, subtitle, title;\n      askOnSuccess = (function(_this) {\n        return function(response) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            response.finish();\n            _this.confirm.notify(\"success\");\n            return _this.loadProject();\n          };\n          onError = function() {\n            response.finish();\n            _this.confirm.notify(\"error\");\n            return _this.scope.role.revert();\n          };\n          return _this.repo.save(_this.scope.role).then(onSuccess, onError);\n        };\n      })(this);\n      askOnError = (function(_this) {\n        return function(response) {\n          return _this.scope.role.revert();\n        };\n      })(this);\n      title = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_TITLE\");\n      subtitle = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_SUBTITLE\", {\n        roleName: this.scope.role.name\n      });\n      return this.confirm.ask(title, subtitle, \"\").then(askOnSuccess, askOnError);\n    };\n\n    RolesController.prototype.toggleComputable = debounce(2000, function() {\n      if (!this.scope.role.computable) {\n        return this._disableComputable();\n      } else {\n        return this._enableComputable();\n      }\n    });\n\n    return RolesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"RolesController\", RolesController);\n\n  EditRoleDirective = function($repo, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit, toggleView;\n      toggleView = function() {\n        $el.find('.total').toggle();\n        return $el.find('.edit-role').toggle();\n      };\n      submit = function() {\n        var promise;\n        $scope.role.name = $el.find(\"input\").val();\n        promise = $repo.save($scope.role);\n        promise.then(function() {\n          return $confirm.notify(\"success\");\n        });\n        promise.then(null, function(data) {\n          return $confirm.notify(\"error\");\n        });\n        return toggleView();\n      };\n      $el.on(\"click\", \".edit-value\", function() {\n        toggleView();\n        $el.find(\"input\").focus();\n        return $el.find(\"input\").val($scope.role.name);\n      });\n      $el.on(\"click\", \"a.save\", submit);\n      $el.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === 13) {\n          return submit();\n        } else if (event.keyCode === 27) {\n          return toggleView();\n        }\n      });\n      $scope.$on(\"role:changed\", function() {\n        if ($el.find('.edit-role').is(\":visible\")) {\n          return toggleView();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgEditRole\", [\"$tgRepo\", \"$tgConfirm\", EditRoleDirective]);\n\n  RolesDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRoles\", RolesDirective);\n\n  NewRoleDirective = function($tgrepo, $confirm) {\n    var DEFAULT_PERMISSIONS, link;\n    DEFAULT_PERMISSIONS = [\"view_project\", \"view_milestones\", \"view_us\", \"view_tasks\", \"view_issues\"];\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $el.on(\"click\", \"a.add-button\", function(event) {\n        event.preventDefault();\n        $el.find(\".new\").removeClass(\"hidden\");\n        $el.find(\".new\").focus();\n        return $el.find(\".add-button\").hide();\n      });\n      return $el.on(\"keyup\", \".new\", function(event) {\n        var newRole, onError, onSuccess, target;\n        event.preventDefault();\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          newRole = {\n            project: $scope.projectId,\n            name: target.val(),\n            permissions: DEFAULT_PERMISSIONS,\n            order: _.maxBy($scope.roles, function(r) {\n              return r.order;\n            }).order + 1,\n            computable: false\n          };\n          $el.find(\".new\").addClass(\"hidden\");\n          $el.find(\".new\").val('');\n          onSuccess = function(role) {\n            var insertPosition;\n            insertPosition = $scope.roles.length - 1;\n            $scope.roles.splice(insertPosition, 0, role);\n            $ctrl.setRole(role);\n            $el.find(\".add-button\").show();\n            return $ctrl.loadProject();\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $tgrepo.create(\"roles\", newRole).then(onSuccess, onError);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          $el.find(\".new\").addClass(\"hidden\");\n          $el.find(\".new\").val('');\n          return $el.find(\".add-button\").show();\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNewRole\", [\"$tgRepo\", \"$tgConfirm\", NewRoleDirective]);\n\n  RolePermissionsDirective = function($rootscope, $repo, $confirm, $compile) {\n    var baseTemplate, categoryTemplate, link, resumeTemplate;\n    resumeTemplate = _.template(\"<div class=\\\"resume-title\\\" translate=\\\"<%- category.name %>\\\"></div>\\n<div class=\\\"summary-role\\\">\\n    <div class=\\\"count\\\"><%- category.activePermissions %>/<%- category.permissions.length %></div>\\n    <% _.each(category.permissions, function(permission) { %>\\n        <div class=\\\"role-summary-single <% if(permission.active) { %>active<% } %>\\\"\\n             title=\\\"{{ '<%- permission.name %>' | translate }}\\\"></div>\\n    <% }) %>\\n</div>\\n<tg-svg svg-icon=\\\"icon-arrow-right\\\"></tg-svg>\");\n    categoryTemplate = _.template(\"<div class=\\\"category-config\\\" data-id=\\\"<%- index %>\\\">\\n    <div class=\\\"resume\\\">\\n    </div>\\n    <div class=\\\"category-items\\\">\\n        <div class=\\\"items-container\\\">\\n        <% _.each(category.permissions, function(permission) { %>\\n            <div class=\\\"category-item\\\" data-id=\\\"<%- permission.key %>\\\">\\n                <span translate=\\\"<%- permission.name %>\\\"></span>\\n                <div class=\\\"check\\\">\\n                    <input type=\\\"checkbox\\\"\\n                           <% if(!permission.editable) { %> disabled=\\\"disabled\\\" <% } %>\\n                           <% if(permission.active) { %> checked=\\\"checked\\\" <% } %>/>\\n                    <div></div>\\n                    <span class=\\\"check-text check-yes\\\" translate=\\\"COMMON.YES\\\"></span>\\n                    <span class=\\\"check-text check-no\\\" translate=\\\"COMMON.NO\\\"></span>\\n                </div>\\n            </div>\\n        <% }) %>\\n        </div>\\n    </div>\\n</div>\");\n    baseTemplate = _.template(\"<div class=\\\"category-config-list\\\"></div>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, generateCategoriesFromRole, renderCategory, renderPermissions, renderResume;\n      $ctrl = $el.controller();\n      generateCategoriesFromRole = function(role) {\n        var categories, epicPermissions, isPermissionEditable, issuePermissions, milestonePermissions, setActivePermissions, setActivePermissionsPerCategory, taskPermissions, userStoryPermissions, wikiPermissions;\n        setActivePermissions = function(permissions) {\n          return _.map(permissions, function(x) {\n            var ref;\n            return _.extend({}, x, {\n              active: (ref = x[\"key\"], indexOf.call(role.permissions, ref) >= 0)\n            });\n          });\n        };\n        isPermissionEditable = function(permission, role, project) {\n          if (role.external_user && !project.is_private && permission.key.indexOf(\"view_\") === 0) {\n            return false;\n          } else {\n            return true;\n          }\n        };\n        setActivePermissionsPerCategory = function(category) {\n          return _.map(category, function(cat) {\n            cat.permissions = cat.permissions.map(function(permission) {\n              permission.editable = isPermissionEditable(permission, role, $scope.project);\n              return permission;\n            });\n            return _.extend({}, cat, {\n              activePermissions: _.filter(cat[\"permissions\"], \"active\").length\n            });\n          });\n        };\n        categories = [];\n        epicPermissions = [\n          {\n            key: \"view_epics\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.EPICS.VIEW_EPICS\"\n          }, {\n            key: \"add_epic\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.EPICS.ADD_EPICS\"\n          }, {\n            key: \"modify_epic\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.EPICS.MODIFY_EPICS\"\n          }, {\n            key: \"comment_epic\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.EPICS.COMMENT_EPICS\"\n          }, {\n            key: \"delete_epic\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.EPICS.DELETE_EPICS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.EPICS.NAME\",\n          permissions: setActivePermissions(epicPermissions)\n        });\n        milestonePermissions = [\n          {\n            key: \"view_milestones\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.VIEW_SPRINTS\"\n          }, {\n            key: \"add_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.ADD_SPRINTS\"\n          }, {\n            key: \"modify_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.MODIFY_SPRINTS\"\n          }, {\n            key: \"delete_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.DELETE_SPRINTS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.NAME\",\n          permissions: setActivePermissions(milestonePermissions)\n        });\n        userStoryPermissions = [\n          {\n            key: \"view_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.VIEW_USER_STORIES\"\n          }, {\n            key: \"add_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.ADD_USER_STORIES\"\n          }, {\n            key: \"modify_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.MODIFY_USER_STORIES\"\n          }, {\n            key: \"comment_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.COMMENT_USER_STORIES\"\n          }, {\n            key: \"delete_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.DELETE_USER_STORIES\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.NAME\",\n          permissions: setActivePermissions(userStoryPermissions)\n        });\n        taskPermissions = [\n          {\n            key: \"view_tasks\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.VIEW_TASKS\"\n          }, {\n            key: \"add_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.ADD_TASKS\"\n          }, {\n            key: \"modify_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.MODIFY_TASKS\"\n          }, {\n            key: \"comment_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.COMMENT_TASKS\"\n          }, {\n            key: \"delete_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.DELETE_TASKS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.NAME\",\n          permissions: setActivePermissions(taskPermissions)\n        });\n        issuePermissions = [\n          {\n            key: \"view_issues\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.VIEW_ISSUES\"\n          }, {\n            key: \"add_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.ADD_ISSUES\"\n          }, {\n            key: \"modify_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.MODIFY_ISSUES\"\n          }, {\n            key: \"comment_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.COMMENT_ISSUES\"\n          }, {\n            key: \"delete_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.DELETE_ISSUES\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.NAME\",\n          permissions: setActivePermissions(issuePermissions)\n        });\n        wikiPermissions = [\n          {\n            key: \"view_wiki_pages\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_PAGES\"\n          }, {\n            key: \"add_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_PAGES\"\n          }, {\n            key: \"modify_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.MODIFY_WIKI_PAGES\"\n          }, {\n            key: \"delete_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_PAGES\"\n          }, {\n            key: \"view_wiki_links\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_LINKS\"\n          }, {\n            key: \"add_wiki_link\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_LINKS\"\n          }, {\n            key: \"delete_wiki_link\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_LINKS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.NAME\",\n          permissions: setActivePermissions(wikiPermissions)\n        });\n        return setActivePermissionsPerCategory(categories);\n      };\n      renderResume = function(element, category) {\n        return element.find(\".resume\").html($compile(resumeTemplate({\n          category: category\n        }))($scope));\n      };\n      renderCategory = function(category, index) {\n        var html;\n        html = categoryTemplate({\n          category: category,\n          index: index\n        });\n        html = angular.element(html);\n        renderResume(html, category);\n        return $compile(html)($scope);\n      };\n      renderPermissions = function() {\n        var html;\n        $el.off();\n        html = baseTemplate();\n        _.each(generateCategoriesFromRole($scope.role), function(category, index) {\n          return html = angular.element(html).append(renderCategory(category, index));\n        });\n        $el.html(html);\n        $el.on(\"click\", \".resume\", function(event) {\n          var target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          target.toggleClass(\"open-drawer\");\n          return target.next().toggleClass(\"open\");\n        });\n        return $el.on(\"change\", \".category-item input\", function(event) {\n          var getActivePermissions, onError, onSuccess, target;\n          getActivePermissions = function() {\n            var activePermissions;\n            activePermissions = _.filter($el.find(\".category-item input\"), function(t) {\n              return angular.element(t).is(\":checked\");\n            });\n            activePermissions = _.sortBy(_.map(activePermissions, function(t) {\n              var permission;\n              return permission = angular.element(t).parents(\".category-item\").data(\"id\");\n            }));\n            if (activePermissions.length) {\n              activePermissions.push(\"view_project\");\n            }\n            return activePermissions;\n          };\n          target = angular.element(event.currentTarget);\n          $scope.role.permissions = getActivePermissions();\n          onSuccess = function() {\n            var categories, categoryId;\n            categories = generateCategoriesFromRole($scope.role);\n            categoryId = target.parents(\".category-config\").data(\"id\");\n            renderResume(target.parents(\".category-config\"), categories[categoryId]);\n            $rootscope.$broadcast(\"projects:reload\");\n            $confirm.notify(\"success\");\n            return $ctrl.loadProject();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            target.prop(\"checked\", !target.prop(\"checked\"));\n            return $scope.role.permissions = getActivePermissions();\n          };\n          if ($scope.role.external_user) {\n            $scope.project.public_permissions = $scope.role.permissions;\n            $scope.project.anon_permissions = $scope.role.permissions.filter(function(permission) {\n              return permission.indexOf(\"view_\") === 0;\n            });\n            return $repo.save($scope.project).then(onSuccess, onError);\n          } else {\n            return $repo.save($scope.role).then(onSuccess, onError);\n          }\n        });\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $scope.$on(\"role:changed\", function() {\n        return renderPermissions();\n      });\n      return bindOnce($scope, $attrs.ngModel, renderPermissions);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRolePermissions\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$compile\", RolePermissionsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/third-parties.coffee\n */\n\n(function() {\n  var BitbucketController, BitbucketWebhooksDirective, GithubController, GithubWebhooksDirective, GitlabController, GitlabWebhooksDirective, GogsController, NewWebhookDirective, SelectInputText, ValidOriginIpsDirective, WebhookDirective, WebhooksController, bindMethods, debounce, mixOf, module, taiga, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindMethods = this.taiga.bindMethods;\n\n  debounce = this.taiga.debounce;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaAdmin\");\n\n  WebhooksController = (function(superClass) {\n    extend(WebhooksController, superClass);\n\n    WebhooksController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\", \"tgErrorHandlingService\"];\n\n    function WebhooksController(scope, repo, rs, params, location, navUrls, appMetaService, translate, errorHandlingService) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      bindMethods(this);\n      this.scope.sectionName = \"ADMIN.WEBHOOKS.SECTION_NAME\";\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.WEBHOOKS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"webhooks:reload\", this.loadWebhooks);\n    }\n\n    WebhooksController.prototype.loadWebhooks = function() {\n      return this.rs.webhooks.list(this.scope.projectId).then((function(_this) {\n        return function(webhooks) {\n          return _this.scope.webhooks = webhooks;\n        };\n      })(this));\n    };\n\n    WebhooksController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.errorHandlingService.permissionDenied();\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    WebhooksController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadWebhooks();\n        };\n      })(this));\n      return promise;\n    };\n\n    return WebhooksController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"WebhooksController\", WebhooksController);\n\n  WebhookDirective = function($rs, $repo, $confirm, $loading, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var cancel, openHistory, save, showEditMode, showVisualizationMode, updateLogs, updateShowHideHistoryText, webhook;\n      webhook = $scope.$eval($attrs.tgWebhook);\n      updateLogs = function() {\n        var prettyDate;\n        prettyDate = $translate.instant(\"ADMIN.WEBHOOKS.DATE\");\n        return $rs.webhooklogs.list(webhook.id).then((function(_this) {\n          return function(webhooklogs) {\n            var i, len, log, ref;\n            for (i = 0, len = webhooklogs.length; i < len; i++) {\n              log = webhooklogs[i];\n              log.validStatus = (200 <= (ref = log.status) && ref < 300);\n              log.prettySentHeaders = _.map(_.toPairs(log.request_headers), function(arg) {\n                var header, value;\n                header = arg[0], value = arg[1];\n                return header + \": \" + value;\n              }).join(\"\\n\");\n              log.prettySentData = JSON.stringify(log.request_data);\n              log.prettyDate = moment(log.created).format(prettyDate);\n            }\n            webhook.logs_counter = webhooklogs.length;\n            webhook.logs = webhooklogs;\n            return updateShowHideHistoryText();\n          };\n        })(this));\n      };\n      updateShowHideHistoryText = function() {\n        var historyElement, text, textElement, title;\n        textElement = $el.find(\".toggle-history\");\n        historyElement = textElement.parents(\".single-webhook-wrapper\").find(\".webhooks-history\");\n        if (historyElement.hasClass(\"open\")) {\n          text = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY\");\n          title = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY_TITLE\");\n        } else {\n          text = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY\");\n          title = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY_TITLE\");\n        }\n        textElement.text(text);\n        return textElement.prop(\"title\", title);\n      };\n      showVisualizationMode = function() {\n        $el.find(\".edition-mode\").addClass(\"hidden\");\n        return $el.find(\".visualization-mode\").removeClass(\"hidden\");\n      };\n      showEditMode = function() {\n        $el.find(\".visualization-mode\").addClass(\"hidden\");\n        return $el.find(\".edition-mode\").removeClass(\"hidden\");\n      };\n      openHistory = function() {\n        return $el.find(\".webhooks-history\").addClass(\"open\");\n      };\n      cancel = function() {\n        showVisualizationMode();\n        return $scope.$apply(function() {\n          return webhook.revert();\n        });\n      };\n      save = debounce(2000, function(target) {\n        var form, promise;\n        form = target.parents(\"form\").checksley();\n        if (!form.validate()) {\n          return;\n        }\n        promise = $repo.save(webhook);\n        promise.then((function(_this) {\n          return function() {\n            return showVisualizationMode();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          $confirm.notify(\"error\");\n          return form.setErrors(data);\n        });\n      });\n      $el.on(\"click\", \".test-webhook\", function() {\n        openHistory();\n        return $rs.webhooks.test(webhook.id).then((function(_this) {\n          return function() {\n            return updateLogs();\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".edit-webhook\", function() {\n        return showEditMode();\n      });\n      $el.on(\"click\", \".cancel-existing\", function() {\n        return cancel();\n      });\n      $el.on(\"click\", \".edit-existing\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return save(target);\n      });\n      $el.on(\"keyup\", \".edition-mode input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          return save(target);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          return cancel(target);\n        }\n      });\n      $el.on(\"click\", \".delete-webhook\", function() {\n        var message, title;\n        title = $translate.instant(\"ADMIN.WEBHOOKS.DELETE\");\n        message = $translate.instant(\"ADMIN.WEBHOOKS.WEBHOOK_NAME\", {\n          name: webhook.name\n        });\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var onError, onSucces;\n            onSucces = function() {\n              askResponse.finish();\n              return $scope.$emit(\"webhooks:reload\");\n            };\n            onError = function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            };\n            return $repo.remove(webhook).then(onSucces, onError);\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".toggle-history\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if ((webhook.logs == null) || webhook.logs.length === 0) {\n          return updateLogs().then(function() {\n            return timeout(0, function() {\n              $el.find(\".webhooks-history\").toggleClass(\"open\").slideToggle();\n              return updateShowHideHistoryText();\n            });\n          });\n        } else {\n          $el.find(\".webhooks-history\").toggleClass(\"open\").slideToggle();\n          return $scope.$apply(function() {\n            return updateShowHideHistoryText();\n          });\n        }\n      });\n      $el.on(\"click\", \".history-single\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        target.toggleClass(\"history-single-open\");\n        return target.siblings(\".history-single-response\").toggleClass(\"open\");\n      });\n      return $el.on(\"click\", \".resend-request\", function(event) {\n        var log, target;\n        target = angular.element(event.currentTarget);\n        log = target.data(\"log\");\n        return $rs.webhooklogs.resend(log).then((function(_this) {\n          return function() {\n            return updateLogs();\n          };\n        })(this));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgWebhook\", [\"$tgResources\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$translate\", WebhookDirective]);\n\n  NewWebhookDirective = function($rs, $repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var addWebhookDOMNode, formDOMNode, initializeNewValue, save, webhook;\n      webhook = $scope.$eval($attrs.tgWebhook);\n      formDOMNode = $el.find(\".new-webhook-form\");\n      addWebhookDOMNode = $el.find(\".add-webhook\");\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"name\": \"\",\n          \"url\": \"\",\n          \"key\": \"\"\n        };\n      };\n      initializeNewValue();\n      $scope.$watch(\"webhooks\", function(webhooks) {\n        if (webhooks != null) {\n          if (webhooks.length === 0) {\n            formDOMNode.removeClass(\"hidden\");\n            addWebhookDOMNode.addClass(\"hidden\");\n            return formDOMNode.find(\"input\")[0].focus();\n          } else {\n            formDOMNode.addClass(\"hidden\");\n            return addWebhookDOMNode.removeClass(\"hidden\");\n          }\n        }\n      });\n      save = debounce(2000, function() {\n        var form, promise;\n        form = formDOMNode.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        $scope.newValue.project = $scope.project.id;\n        promise = $repo.create(\"webhooks\", $scope.newValue);\n        promise.then((function(_this) {\n          return function() {\n            $scope.$emit(\"webhooks:reload\");\n            return initializeNewValue();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          $confirm.notify(\"error\");\n          return form.setErrors(data);\n        });\n      });\n      formDOMNode.on(\"click\", \".add-new\", function(event) {\n        event.preventDefault();\n        return save();\n      });\n      formDOMNode.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === 13) {\n          return save();\n        }\n      });\n      formDOMNode.on(\"click\", \".cancel-new\", function(event) {\n        return $scope.$apply(function() {\n          initializeNewValue();\n          if ($scope.webhooks.length >= 1) {\n            return formDOMNode.addClass(\"hidden\");\n          }\n        });\n      });\n      return addWebhookDOMNode.on(\"click\", function(event) {\n        formDOMNode.removeClass(\"hidden\");\n        return formDOMNode.find(\"input\")[0].focus();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNewWebhook\", [\"$tgResources\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", NewWebhookDirective]);\n\n  GithubController = (function(superClass) {\n    extend(GithubController, superClass);\n\n    GithubController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function GithubController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GITHUB.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GITHUB.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    GithubController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"github\").then((function(_this) {\n        return function(github) {\n          return _this.scope.github = github;\n        };\n      })(this));\n    };\n\n    GithubController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    GithubController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return GithubController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"GithubController\", GithubController);\n\n  GitlabController = (function(superClass) {\n    extend(GitlabController, superClass);\n\n    GitlabController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function GitlabController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GITLAB.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GITLAB.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:modules:reload\", (function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n    }\n\n    GitlabController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"gitlab\").then((function(_this) {\n        return function(gitlab) {\n          return _this.scope.gitlab = gitlab;\n        };\n      })(this));\n    };\n\n    GitlabController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    GitlabController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return GitlabController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"GitlabController\", GitlabController);\n\n  BitbucketController = (function(superClass) {\n    extend(BitbucketController, superClass);\n\n    BitbucketController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function BitbucketController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.BITBUCKET.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.BITBUCKET.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:modules:reload\", (function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n    }\n\n    BitbucketController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"bitbucket\").then((function(_this) {\n        return function(bitbucket) {\n          return _this.scope.bitbucket = bitbucket;\n        };\n      })(this));\n    };\n\n    BitbucketController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    BitbucketController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return BitbucketController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"BitbucketController\", BitbucketController);\n\n  SelectInputText = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.on(\"click\", \".select-input-content\", function() {\n        $el.find(\"input\").select();\n        return $el.find(\".help-copy\").addClass(\"visible\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSelectInputText\", SelectInputText);\n\n  GithubWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.github, \"github\");\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgGithubWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", GithubWebhooksDirective]);\n\n  GitlabWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.gitlab, \"gitlab\");\n          promise.then(function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $scope.$emit(\"project:modules:reload\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgGitlabWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", GitlabWebhooksDirective]);\n\n  BitbucketWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.bitbucket, \"bitbucket\");\n          promise.then(function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $scope.$emit(\"project:modules:reload\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBitbucketWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", BitbucketWebhooksDirective]);\n\n  ValidOriginIpsDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs, $ngModel) {\n      return $ngModel.$parsers.push(function(value) {\n        value = $.trim(value);\n        if (value === \"\") {\n          return [];\n        }\n        return value.split(\",\");\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgValidOriginIps\", ValidOriginIpsDirective);\n\n  GogsController = (function(superClass) {\n    extend(GogsController, superClass);\n\n    GogsController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function GogsController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GOGS.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GOGS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    GogsController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"gogs\").then((function(_this) {\n        return function(gogs) {\n          return _this.scope.gogs = gogs;\n        };\n      })(this));\n    };\n\n    GogsController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    GogsController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return GogsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"GogsController\", GogsController);\n\n}).call(this);\n\n(function() {\n  var createProjectRestrictionDirective, module;\n\n  module = angular.module(\"taigaProject\");\n\n  createProjectRestrictionDirective = function() {\n    return {\n      templateUrl: \"project/wizard-restrictions.html\"\n    };\n  };\n\n  module.directive('tgCreateProjectRestriction', [createProjectRestrictionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/attachments.coffee\n */\n\n(function() {\n  var CreateProject, DeleteProjectDirective, bindOnce, debounce, module, taiga, timeout;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  timeout = this.taiga.timeout;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaProject\");\n\n  CreateProject = function($rootscope, $repo, $confirm, $location, $navurls, $rs, $projectUrl, $loading, lightboxService, $cacheFactory, $translate, currentUserService, $auth) {\n    var directive, link;\n    link = function($scope, $el, attrs) {\n      var currentLoading, form, onErrorSubmit, onSuccessSubmit, openLightbox, submit, submitButton;\n      $scope.data = {};\n      $scope.templates = [];\n      currentLoading = null;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      onSuccessSubmit = function(response) {\n        $cacheFactory.get('$http').removeAll();\n        currentLoading.finish();\n        $rootscope.$broadcast(\"projects:reload\");\n        $confirm.notify(\"success\", $translate.instant(\"COMMON.SAVE\"));\n        $location.url($projectUrl.get(response));\n        lightboxService.close($el);\n        return currentUserService.loadProjects();\n      };\n      onErrorSubmit = function(response) {\n        var error_field, i, len, ref, results, selectors;\n        currentLoading.finish();\n        form.setErrors(response);\n        selectors = [];\n        ref = _.keys(response);\n        results = [];\n        for (i = 0, len = ref.length; i < len; i++) {\n          error_field = ref[i];\n          results.push(selectors.push(\"[name=\" + error_field + \"]\"));\n        }\n        return results;\n      };\n      submit = (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"projects\", $scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this);\n      openLightbox = function() {\n        $scope.data = {\n          is_private: false\n        };\n        if (!$scope.templates.length) {\n          $rs.projects.templates().then((function(_this) {\n            return function(result) {\n              $scope.templates = result;\n              return $scope.data.creation_template = _.head(_.filter($scope.templates, function(x) {\n                return x.slug === \"scrum\";\n              })).id;\n            };\n          })(this));\n        } else {\n          $scope.data.creation_template = _.head(_.filter($scope.templates, function(x) {\n            return x.slug === \"scrum\";\n          })).id;\n        }\n        $scope.canCreatePrivateProjects = currentUserService.canCreatePrivateProjects();\n        $scope.canCreatePublicProjects = currentUserService.canCreatePublicProjects();\n        return lightboxService.open($el);\n      };\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $auth.refresh().then(function() {\n        return openLightbox();\n      });\n    };\n    directive = {\n      link: link,\n      templateUrl: \"project/wizard-create-project.html\",\n      scope: {}\n    };\n    return directive;\n  };\n\n  module.directive(\"tgLbCreateProject\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$location\", \"$tgNavUrls\", \"$tgResources\", \"$projectUrl\", \"$tgLoading\", \"lightboxService\", \"$cacheFactory\", \"$translate\", \"tgCurrentUserService\", \"$tgAuth\", CreateProject]);\n\n  DeleteProjectDirective = function($repo, $rootscope, $auth, $location, $navUrls, $confirm, lightboxService, tgLoader, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var projectToDelete, submit;\n      projectToDelete = null;\n      $scope.$on(\"deletelightbox:new\", function(ctx, project) {\n        lightboxService.open($el);\n        return projectToDelete = project;\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      submit = function() {\n        var promise;\n        tgLoader.start();\n        lightboxService.close($el);\n        promise = $repo.remove(projectToDelete);\n        promise.then(function(data) {\n          tgLoader.pageLoaded();\n          $rootscope.$broadcast(\"projects:reload\");\n          $location.path($navUrls.resolve(\"home\"));\n          $confirm.notify(\"success\");\n          return currentUserService.loadProjects();\n        });\n        return promise.then(null, function() {\n          $confirm.notify(\"error\");\n          return lightboxService.close($el);\n        });\n      };\n      $el.on(\"click\", \".button-red\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      return $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbDeleteProject\", [\"$tgRepo\", \"$rootScope\", \"$tgAuth\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfirm\", \"lightboxService\", \"tgLoader\", \"tgCurrentUserService\", DeleteProjectDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/bind.coffee\n */\n\n(function() {\n  var BindHtmlDirective, BindOnceAltDirective, BindOnceBindDirective, BindOnceHrefDirective, BindOnceHtmlDirective, BindOnceRefDirective, BindOnceSrcDirective, BindOnceTitleDirective, BindTitleDirective, bindOnce, module;\n\n  bindOnce = this.taiga.bindOnce;\n\n  BindOnceBindDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoBind, function(val) {\n        return $el.text(val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceHtmlDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoHtml, function(val) {\n        return $el.html(val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceRefDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoRef, function(val) {\n        return $el.html(\"#\" + val + \" \");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceSrcDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoSrc, function(val) {\n        return $el.attr(\"src\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceHrefDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoHref, function(val) {\n        return $el.attr(\"href\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceAltDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoAlt, function(val) {\n        return $el.attr(\"alt\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceTitleDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoTitle, function(val) {\n        return $el.attr(\"title\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindTitleDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$watch($attrs.tgTitleHtml, function(val) {\n        if (val != null) {\n          return $el.attr(\"title\", val);\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindHtmlDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$watch($attrs.tgBindHtml, function(val) {\n        if (val != null) {\n          return $el.html(val);\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.directive(\"tgBoBind\", BindOnceBindDirective);\n\n  module.directive(\"tgBoHtml\", BindOnceHtmlDirective);\n\n  module.directive(\"tgBoRef\", BindOnceRefDirective);\n\n  module.directive(\"tgBoSrc\", BindOnceSrcDirective);\n\n  module.directive(\"tgBoHref\", BindOnceHrefDirective);\n\n  module.directive(\"tgBoAlt\", BindOnceAltDirective);\n\n  module.directive(\"tgBoTitle\", BindOnceTitleDirective);\n\n  module.directive(\"tgBindTitle\", BindTitleDirective);\n\n  module.directive(\"tgBindHtml\", BindHtmlDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/conf.coffee\n */\n\n(function() {\n  var ConfigurationService, module;\n\n  ConfigurationService = (function() {\n    function ConfigurationService() {\n      this.config = window.taigaConfig;\n    }\n\n    ConfigurationService.prototype.get = function(key, defaultValue) {\n      if (defaultValue == null) {\n        defaultValue = null;\n      }\n      if (_.has(this.config, key)) {\n        return this.config[key];\n      }\n      return defaultValue;\n    };\n\n    return ConfigurationService;\n\n  })();\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgConfig\", ConfigurationService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/contrib.coffee\n */\n\n(function() {\n  var ContribController, ContribUserSettingsController, module,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  module = angular.module(\"taigaBase\");\n\n  ContribController = (function(superClass) {\n    extend(ContribController, superClass);\n\n    ContribController.$inject = [\"$rootScope\", \"$scope\", \"$routeParams\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\"];\n\n    function ContribController(rootScope, scope, params, repo, rs, confirm) {\n      var promise;\n      this.rootScope = rootScope;\n      this.scope = scope;\n      this.params = params;\n      this.repo = repo;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.scope.currentPlugin = _.head(_.filter(this.rootScope.adminPlugins, {\n        \"slug\": this.params.plugin\n      }));\n      this.scope.projectSlug = this.params.pslug;\n      promise = this.loadInitialData();\n      promise.then(null, (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    }\n\n    ContribController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.$broadcast('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ContribController.prototype.loadInitialData = function() {\n      return this.loadProject();\n    };\n\n    return ContribController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ContribController\", ContribController);\n\n  ContribUserSettingsController = (function(superClass) {\n    extend(ContribUserSettingsController, superClass);\n\n    ContribUserSettingsController.$inject = [\"$rootScope\", \"$scope\", \"$routeParams\"];\n\n    function ContribUserSettingsController(rootScope, scope, params) {\n      this.rootScope = rootScope;\n      this.scope = scope;\n      this.params = params;\n      this.scope.currentPlugin = _.head(_.filter(this.rootScope.userSettingsPlugins, {\n        \"slug\": this.params.plugin\n      }));\n    }\n\n    return ContribUserSettingsController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ContribUserSettingsController\", ContribUserSettingsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/filters.coffee\n */\n\n(function() {\n  var FiltersStorageService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  FiltersStorageService = (function(superClass) {\n    extend(FiltersStorageService, superClass);\n\n    FiltersStorageService.$inject = [\"$tgStorage\", \"$routeParams\"];\n\n    function FiltersStorageService(storage, params) {\n      this.storage = storage;\n      this.params = params;\n    }\n\n    FiltersStorageService.prototype.generateHash = function(components) {\n      if (components == null) {\n        components = [];\n      }\n      components = _.map(components, function(x) {\n        return JSON.stringify(x);\n      });\n      return hex_sha1(components.join(\":\"));\n    };\n\n    return FiltersStorageService;\n\n  })(taiga.Service);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/http.coffee\n */\n\n(function() {\n  var HttpService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  HttpService = (function(superClass) {\n    extend(HttpService, superClass);\n\n    HttpService.$inject = [\"$http\", \"$q\", \"$tgStorage\", \"$rootScope\", \"$cacheFactory\", \"$translate\"];\n\n    function HttpService(http, q, storage, rootScope, cacheFactory, translate) {\n      this.http = http;\n      this.q = q;\n      this.storage = storage;\n      this.rootScope = rootScope;\n      this.cacheFactory = cacheFactory;\n      this.translate = translate;\n      HttpService.__super__.constructor.call(this);\n      this.cache = this.cacheFactory(\"httpget\");\n    }\n\n    HttpService.prototype.headers = function() {\n      var headers, lang, token;\n      headers = {};\n      token = this.storage.get('token');\n      if (token) {\n        headers[\"Authorization\"] = \"Bearer \" + token;\n      }\n      lang = this.translate.preferredLanguage();\n      if (lang) {\n        headers[\"Accept-Language\"] = lang;\n      }\n      return headers;\n    };\n\n    HttpService.prototype.request = function(options) {\n      options.headers = _.assign({}, options.headers || {}, this.headers());\n      return this.http(options);\n    };\n\n    HttpService.prototype.get = function(url, params, options) {\n      options = _.assign({\n        method: \"GET\",\n        url: url\n      }, options);\n      if (params) {\n        options.params = params;\n      }\n      options.cache = this.cache;\n      return this.request(options)[\"finally\"]((function(_this) {\n        return function(data) {\n          return _this.cache.removeAll();\n        };\n      })(this));\n    };\n\n    HttpService.prototype.post = function(url, data, params, options) {\n      options = _.assign({\n        method: \"POST\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype.put = function(url, data, params, options) {\n      options = _.assign({\n        method: \"PUT\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype.patch = function(url, data, params, options) {\n      options = _.assign({\n        method: \"PATCH\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype[\"delete\"] = function(url, data, params, options) {\n      options = _.assign({\n        method: \"DELETE\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    return HttpService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgHttp\", HttpService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/location.coffee\n */\n\n(function() {\n  var locationFactory, module;\n\n  locationFactory = function($location, $route, $rootscope) {\n    $location.noreload = function(scope) {\n      var lastRoute, un;\n      lastRoute = $route.current;\n      un = scope.$on(\"$locationChangeSuccess\", function() {\n        $route.current = lastRoute;\n        return un();\n      });\n      return $location;\n    };\n    $location.isInCurrentRouteParams = function(name, value) {\n      var params;\n      params = $location.search() || {};\n      return params[name] === value;\n    };\n    return $location;\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.factory(\"$tgLocation\", [\"$location\", \"$route\", \"$rootScope\", locationFactory]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/model.coffee\n */\n\n(function() {\n  var Model, ModelService, module, provider, taiga,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  Model = (function() {\n    function Model(name, data, dataTypes) {\n      this._attrs = data;\n      this._name = name;\n      this._dataTypes = dataTypes;\n      this.setAttrs(data);\n      this.initialize();\n    }\n\n    Model.prototype.clone = function() {\n      var instance;\n      instance = new Model(this._name, this._attrs, this._dataTypes);\n      instance._modifiedAttrs = this._modifiedAttrs;\n      instance._isModified = this._isModified;\n      return instance;\n    };\n\n    Model.prototype.applyCasts = function() {\n      var attrName, castMethod, castName, ref, results;\n      ref = this._dataTypes;\n      results = [];\n      for (attrName in ref) {\n        castName = ref[attrName];\n        castMethod = service.casts[castName];\n        if (!castMethod) {\n          continue;\n        }\n        results.push(this._attrs[attrName] = castMethod(this._attrs[attrName]));\n      }\n      return results;\n    };\n\n    Model.prototype.getIdAttrName = function() {\n      return \"id\";\n    };\n\n    Model.prototype.getName = function() {\n      return this._name;\n    };\n\n    Model.prototype.getAttrs = function(patch) {\n      if (patch == null) {\n        patch = false;\n      }\n      if (this._attrs.version != null) {\n        this._modifiedAttrs.version = this._attrs.version;\n      }\n      if (patch) {\n        return _.extend({}, this._modifiedAttrs);\n      }\n      return _.extend({}, this._attrs, this._modifiedAttrs);\n    };\n\n    Model.prototype.setAttrs = function(attrs) {\n      this._attrs = attrs;\n      this._modifiedAttrs = {};\n      this.applyCasts();\n      return this._isModified = false;\n    };\n\n    Model.prototype.setAttr = function(name, value) {\n      this._modifiedAttrs[name] = value;\n      return this._isModified = true;\n    };\n\n    Model.prototype.initialize = function() {\n      var getter, self, setter;\n      self = this;\n      getter = function(name) {\n        return function() {\n          if (typeof name === 'string' && name.substr(0, 2) === \"__\") {\n            return self[name];\n          }\n          if (indexOf.call(_.keys(self._modifiedAttrs), name) < 0) {\n            return self._attrs[name];\n          }\n          return self._modifiedAttrs[name];\n        };\n      };\n      setter = function(name) {\n        return function(value) {\n          if (typeof name === 'string' && name.substr(0, 2) === \"__\") {\n            self[name] = value;\n            return;\n          }\n          if (self._attrs[name] !== value) {\n            self._modifiedAttrs[name] = value;\n            self._isModified = true;\n          } else {\n            delete self._modifiedAttrs[name];\n          }\n        };\n      };\n      return _.each(this._attrs, function(value, name) {\n        var options;\n        options = {\n          get: getter(name),\n          set: setter(name),\n          enumerable: true,\n          configurable: true\n        };\n        return Object.defineProperty(self, name, options);\n      });\n    };\n\n    Model.prototype.serialize = function() {\n      var data;\n      data = {\n        \"data\": _.clone(this._attrs),\n        \"name\": this._name\n      };\n      return JSON.stringify(data);\n    };\n\n    Model.prototype.isModified = function() {\n      return this._isModified;\n    };\n\n    Model.prototype.isAttributeModified = function(attribute) {\n      return this._modifiedAttrs[attribute] != null;\n    };\n\n    Model.prototype.markSaved = function() {\n      this._isModified = false;\n      this._attrs = this.getAttrs();\n      return this._modifiedAttrs = {};\n    };\n\n    Model.prototype.revert = function() {\n      this._modifiedAttrs = {};\n      return this._isModified = false;\n    };\n\n    Model.desSerialize = function(sdata) {\n      var ddata, model;\n      ddata = JSON.parse(sdata);\n      model = new Model(ddata.url, ddata.data);\n      return model;\n    };\n\n    return Model;\n\n  })();\n\n  taiga = this.taiga;\n\n  ModelService = (function(superClass) {\n    extend(ModelService, superClass);\n\n    ModelService.$inject = [\"$q\", \"$tgUrls\", \"$tgStorage\", \"$tgHttp\"];\n\n    function ModelService(q, urls, storage, http) {\n      this.q = q;\n      this.urls = urls;\n      this.storage = storage;\n      this.http = http;\n      ModelService.__super__.constructor.call(this);\n    }\n\n    return ModelService;\n\n  })(taiga.Service);\n\n  provider = function($q, $http, $gmUrls, $gmStorage) {\n    var service;\n    service = {};\n    service.make_model = function(name, data, cls, dataTypes) {\n      if (cls == null) {\n        cls = Model;\n      }\n      if (dataTypes == null) {\n        dataTypes = {};\n      }\n      return new cls(name, data, dataTypes);\n    };\n    service.cls = Model;\n    service.casts = {\n      int: function(value) {\n        return parseInt(value, 10);\n      },\n      float: function(value) {\n        return parseFloat(value, 10);\n      }\n    };\n    return service;\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.factory(\"$tgModel\", [\"$q\", \"$http\", \"$tgUrls\", \"$tgStorage\", provider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/navurl.coffee\n */\n\n(function() {\n  var NavigationUrlsDirective, NavigationUrlsService, bindOnce, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBase\");\n\n  NavigationUrlsService = (function(superClass) {\n    extend(NavigationUrlsService, superClass);\n\n    function NavigationUrlsService() {\n      this.urls = {};\n    }\n\n    NavigationUrlsService.prototype.update = function(urls) {\n      return this.urls = _.merge({}, this.urls, urls || {});\n    };\n\n    NavigationUrlsService.prototype.formatUrl = function(url, ctx) {\n      var replacer;\n      if (ctx == null) {\n        ctx = {};\n      }\n      replacer = function(match) {\n        match = trim(match, \":\");\n        return ctx[match] || \"undefined\";\n      };\n      return url.replace(/(:\\w+)/g, replacer);\n    };\n\n    NavigationUrlsService.prototype.resolve = function(name, ctx) {\n      var url;\n      url = this.urls[name];\n      if (!url) {\n        return \"\";\n      }\n      if (ctx) {\n        return this.formatUrl(url, ctx);\n      }\n      return url;\n    };\n\n    return NavigationUrlsService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgNavUrls\", NavigationUrlsService);\n\n  NavigationUrlsDirective = function($navurls, $auth, $q, $location, lightboxService) {\n    var bindOnceP, link, parseNav;\n    bindOnceP = function($scope, attr) {\n      var defered;\n      defered = $q.defer();\n      bindOnce($scope, attr, function(v) {\n        return defered.resolve(v);\n      });\n      return defered.promise;\n    };\n    parseNav = function(data, $scope) {\n      var index, name, obj, params, promises, ref, result, values;\n      ref = _.map(data.split(\":\"), trim), name = ref[0], params = ref[1];\n      if (params) {\n        result = params.split(/(\\w+)=/);\n        result = _.filter(result, function(str) {\n          return str.length;\n        });\n        result = _.map(result, function(str) {\n          return trim(str.replace(/,$/g, ''));\n        });\n        params = [];\n        index = 0;\n        while (index < result.length) {\n          obj = {};\n          obj[result[index]] = result[index + 1];\n          params.push(obj);\n          index = index + 2;\n        }\n      } else {\n        params = [];\n      }\n      values = _.map(params, function(param) {\n        return _.values(param)[0];\n      });\n      promises = _.map(values, function(x) {\n        return bindOnceP($scope, x);\n      });\n      return $q.all(promises).then(function() {\n        var i, key, len, options, param, value;\n        options = {};\n        for (i = 0, len = params.length; i < len; i++) {\n          param = params[i];\n          key = Object.keys(param)[0];\n          value = param[key];\n          options[key] = $scope.$eval(value);\n        }\n        return [name, options];\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      if ($el.is(\"a\")) {\n        $el.attr(\"href\", \"#\");\n      }\n      $el.on(\"mouseenter\", function(event) {\n        var target;\n        target = $(event.currentTarget);\n        if (!target.data(\"fullUrl\") || $attrs.tgNavGetParams !== target.data(\"params\")) {\n          return parseNav($attrs.tgNav, $scope).then(function(result) {\n            var fullUrl, getURLParams, getURLParamsStr, name, options, url, user;\n            name = result[0], options = result[1];\n            user = $auth.getUser();\n            if (user) {\n              options.user = user.username;\n            }\n            url = $navurls.resolve(name);\n            fullUrl = $navurls.formatUrl(url, options);\n            if ($attrs.tgNavGetParams) {\n              getURLParams = JSON.parse($attrs.tgNavGetParams);\n              getURLParamsStr = $.param(getURLParams);\n              fullUrl = fullUrl + \"?\" + getURLParamsStr;\n              target.data(\"params\", $attrs.tgNavGetParams);\n            }\n            target.data(\"fullUrl\", fullUrl);\n            if (target.is(\"a\")) {\n              target.attr(\"href\", fullUrl);\n            }\n            return $el.on(\"click\", function(event) {\n              if (event.metaKey || event.ctrlKey) {\n                return;\n              }\n              event.preventDefault();\n              target = $(event.currentTarget);\n              if (target.hasClass('noclick')) {\n                return;\n              }\n              fullUrl = target.data(\"fullUrl\");\n              switch (event.which) {\n                case 1:\n                  $location.url(fullUrl);\n                  $scope.$apply();\n                  break;\n                case 2:\n                  window.open(fullUrl);\n              }\n              return lightboxService.closeAll();\n            });\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNav\", [\"$tgNavUrls\", \"$tgAuth\", \"$q\", \"$tgLocation\", \"lightboxService\", NavigationUrlsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/repository.coffee\n */\n\n(function() {\n  var RepositoryService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  RepositoryService = (function(superClass) {\n    extend(RepositoryService, superClass);\n\n    RepositoryService.$inject = [\"$q\", \"$tgModel\", \"$tgStorage\", \"$tgHttp\", \"$tgUrls\"];\n\n    function RepositoryService(q, model1, storage, http, urls) {\n      this.q = q;\n      this.model = model1;\n      this.storage = storage;\n      this.http = http;\n      this.urls = urls;\n      RepositoryService.__super__.constructor.call(this);\n    }\n\n    RepositoryService.prototype.resolveUrlForModel = function(model) {\n      var idAttrName;\n      idAttrName = model.getIdAttrName();\n      return (this.urls.resolve(model.getName())) + \"/\" + model[idAttrName];\n    };\n\n    RepositoryService.prototype.resolveUrlForAttributeModel = function(model) {\n      return this.urls.resolve(model.getName(), model.parent);\n    };\n\n    RepositoryService.prototype.create = function(name, data, dataTypes, extraParams) {\n      var defered, promise, url;\n      if (dataTypes == null) {\n        dataTypes = {};\n      }\n      if (extraParams == null) {\n        extraParams = {};\n      }\n      defered = this.q.defer();\n      url = this.urls.resolve(name);\n      promise = this.http.post(url, JSON.stringify(data), extraParams);\n      promise.success((function(_this) {\n        return function(_data, _status) {\n          return defered.resolve(_this.model.make_model(name, _data, null, dataTypes));\n        };\n      })(this));\n      promise.error((function(_this) {\n        return function(data, status) {\n          return defered.reject(data);\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.remove = function(model, params) {\n      var defered, promise, url;\n      if (params == null) {\n        params = {};\n      }\n      defered = this.q.defer();\n      url = this.resolveUrlForModel(model);\n      promise = this.http[\"delete\"](url, {}, params);\n      promise.success(function(data, status) {\n        return defered.resolve(model);\n      });\n      promise.error(function(data, status) {\n        return defered.reject(model);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.saveAll = function(models, patch) {\n      var promises;\n      if (patch == null) {\n        patch = true;\n      }\n      promises = _.map(models, (function(_this) {\n        return function(x) {\n          return _this.save(x, true);\n        };\n      })(this));\n      return this.q.all(promises);\n    };\n\n    RepositoryService.prototype.save = function(model, patch, params, options, returnHeaders) {\n      var data, defered, promise, url;\n      if (patch == null) {\n        patch = true;\n      }\n      if (params == null) {\n        params = {};\n      }\n      if (returnHeaders == null) {\n        returnHeaders = false;\n      }\n      defered = this.q.defer();\n      if (!model.isModified() && patch) {\n        defered.resolve(model);\n        return defered.promise;\n      }\n      url = this.resolveUrlForModel(model);\n      data = JSON.stringify(model.getAttrs(patch));\n      if (patch) {\n        promise = this.http.patch(url, data, params, options);\n      } else {\n        promise = this.http.put(url, data, params, options);\n      }\n      promise.success((function(_this) {\n        return function(data, status, headers, response) {\n          model._isModified = false;\n          model._attrs = _.extend(model.getAttrs(), data);\n          model._modifiedAttrs = {};\n          model.applyCasts();\n          if (returnHeaders) {\n            return defered.resolve([model, headers()]);\n          } else {\n            return defered.resolve(model);\n          }\n        };\n      })(this));\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.saveAttribute = function(model, attribute, patch) {\n      var data, defered, promise, url;\n      if (patch == null) {\n        patch = true;\n      }\n      defered = this.q.defer();\n      if (!model.isModified() && patch) {\n        defered.resolve(model);\n        return defered.promise;\n      }\n      url = this.resolveUrlForAttributeModel(model);\n      data = {};\n      data[attribute] = model.getAttrs();\n      if (patch) {\n        promise = this.http.patch(url, data);\n      } else {\n        promise = this.http.put(url, data);\n      }\n      promise.success((function(_this) {\n        return function(data, status) {\n          model._isModified = false;\n          model._attrs = _.extend(model.getAttrs(), data);\n          model._modifiedAttrs = {};\n          model.applyCasts();\n          return defered.resolve(model);\n        };\n      })(this));\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.refresh = function(model) {\n      var defered, promise, url;\n      defered = this.q.defer();\n      url = this.resolveUrlForModel(model);\n      promise = this.http.get(url);\n      promise.success(function(data, status) {\n        model._modifiedAttrs = {};\n        model._attrs = data;\n        model._isModified = false;\n        model.applyCasts();\n        return defered.resolve(model);\n      });\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.queryMany = function(name, params, options, headers) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      if (headers == null) {\n        headers = false;\n      }\n      url = this.urls.resolve(name);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var result;\n          result = _.map(data.data, function(x) {\n            return _this.model.make_model(name, x);\n          });\n          if (headers) {\n            return [result, data.headers];\n          }\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOneAttribute = function(name, id, attribute, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name, id);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var model;\n          model = _this.model.make_model(name, data.data[attribute]);\n          model.parent = id;\n          return model;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOne = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          return _this.model.make_model(name, data.data);\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOneRaw = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryPaginated = function(name, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var headers, result;\n          headers = data.headers();\n          result = {};\n          result.models = _.map(data.data, function(x) {\n            return _this.model.make_model(name, x);\n          });\n          result.count = parseInt(headers[\"x-pagination-count\"], 10);\n          result.current = parseInt(headers[\"x-pagination-current\"] || 1, 10);\n          result.paginatedBy = parseInt(headers[\"x-paginated-by\"], 10);\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOnePaginatedRaw = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var headers, result;\n          headers = data.headers();\n          result = {};\n          result.data = data.data;\n          result.count = parseInt(headers[\"x-pagination-count\"], 10);\n          result.current = parseInt(headers[\"x-pagination-current\"] || 1, 10);\n          result.paginatedBy = parseInt(headers[\"x-paginated-by\"], 10);\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.resolve = function(options) {\n      var cache, params;\n      params = {};\n      if (options.pslug != null) {\n        params.project = options.pslug;\n      }\n      if (options.usref != null) {\n        params.us = options.usref;\n      }\n      if (options.taskref != null) {\n        params.task = options.taskref;\n      }\n      if (options.issueref != null) {\n        params.issue = options.issueref;\n      }\n      if (options.sslug != null) {\n        params.milestone = options.sslug;\n      }\n      if (options.wikipage != null) {\n        params.wikipage = options.wikipage;\n      }\n      cache = !(options.wikipage || options.sslug);\n      return this.queryOneRaw(\"resolver\", null, params, {\n        cache: cache\n      });\n    };\n\n    return RepositoryService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgRepo\", RepositoryService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/storage.coffee\n */\n\n(function() {\n  var StorageService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  StorageService = (function(superClass) {\n    extend(StorageService, superClass);\n\n    StorageService.$inject = [\"$rootScope\"];\n\n    function StorageService($rootScope) {\n      StorageService.__super__.constructor.call(this);\n    }\n\n    StorageService.prototype.get = function(key, _default) {\n      var serializedValue;\n      serializedValue = localStorage.getItem(key);\n      if (serializedValue === null) {\n        return _default || null;\n      }\n      return JSON.parse(serializedValue);\n    };\n\n    StorageService.prototype.set = function(key, val) {\n      if (_.isObject(key)) {\n        return _.each(key, (function(_this) {\n          return function(val, key) {\n            return _this.set(key, val);\n          };\n        })(this));\n      } else {\n        return localStorage.setItem(key, JSON.stringify(val));\n      }\n    };\n\n    StorageService.prototype.contains = function(key) {\n      var value;\n      value = this.get(key);\n      return value !== null;\n    };\n\n    StorageService.prototype.remove = function(key) {\n      return localStorage.removeItem(key);\n    };\n\n    StorageService.prototype.clear = function() {\n      return localStorage.clear();\n    };\n\n    return StorageService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgStorage\", StorageService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/http.coffee\n */\n\n(function() {\n  var UrlsService, format, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  format = function(fmt, obj) {\n    obj = _.clone(obj);\n    return fmt.replace(/%s/g, function(match) {\n      return String(obj.shift());\n    });\n  };\n\n  taiga = this.taiga;\n\n  UrlsService = (function(superClass) {\n    extend(UrlsService, superClass);\n\n    UrlsService.$inject = [\"$tgConfig\"];\n\n    function UrlsService(config) {\n      this.config = config;\n      this.urls = {};\n      this.mainUrl = this.config.get(\"api\");\n    }\n\n    UrlsService.prototype.update = function(urls) {\n      return this.urls = _.merge(this.urls, urls);\n    };\n\n    UrlsService.prototype.resolve = function() {\n      var args, name, url;\n      args = _.toArray(arguments);\n      if (args.length === 0) {\n        throw Error(\"wrong arguments to setUrls\");\n      }\n      name = args.slice(0, 1)[0];\n      url = format(this.urls[name], args.slice(1));\n      return format(\"%s/%s\", [_.trimEnd(this.mainUrl, \"/\"), _.trimStart(url, \"/\")]);\n    };\n\n    UrlsService.prototype.resolveAbsolute = function() {\n      var url;\n      url = this.resolve.apply(this, arguments);\n      if (/^https?:\\/\\//i.test(url)) {\n        return url;\n      }\n      if (/^\\//.test(url)) {\n        return window.location.protocol + \"//\" + window.location.host + url;\n      }\n      return window.location.protocol + \"//\" + window.location.host + \"/\" + url;\n    };\n\n    return UrlsService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service('$tgUrls', UrlsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/custom-field-values.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo) {\n    var _get, service;\n    _get = function(objectId, resource) {\n      return $repo.queryOne(resource, objectId);\n    };\n    service = {\n      epic: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/epic\");\n        }\n      },\n      userstory: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/userstory\");\n        }\n      },\n      task: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/task\");\n        }\n      },\n      issue: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/issue\");\n        }\n      }\n    };\n    return function(instance) {\n      return instance.customAttributesValues = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgCustomAttributesValuesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($repo) {\n    var _list, service;\n    _list = function(projectId, resource) {\n      return $repo.queryMany(resource, {\n        project: projectId\n      });\n    };\n    service = {\n      epic: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/epic\");\n        }\n      },\n      userstory: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/userstory\");\n        }\n      },\n      task: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/task\");\n        }\n      },\n      issue: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/issue\");\n        }\n      }\n    };\n    return function(instance) {\n      return instance.customAttributes = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgCustomAttributesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/epics.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage) {\n    var hashSuffix, service;\n    service = {};\n    hashSuffix = \"epics-queryparams\";\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"epics\", \"by_ref\", params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.upvote = function(epicId) {\n      var url;\n      url = $urls.resolve(\"epic-upvote\", epicId);\n      return $http.post(url);\n    };\n    service.downvote = function(epicId) {\n      var url;\n      url = $urls.resolve(\"epic-downvote\", epicId);\n      return $http.post(url);\n    };\n    service.watch = function(epicId) {\n      var url;\n      url = $urls.resolve(\"epic-watch\", epicId);\n      return $http.post(url);\n    };\n    service.unwatch = function(epicId) {\n      var url;\n      url = $urls.resolve(\"epic-unwatch\", epicId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.epics = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgEpicsResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/history.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(type, objectId) {\n      return $repo.queryOneRaw(\"history/\" + type, objectId);\n    };\n    service.editComment = function(type, objectId, activityId, comment) {\n      var commentData, params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/edit_comment\";\n      params = {\n        id: activityId\n      };\n      commentData = {\n        comment: comment\n      };\n      return $http.post(url, commentData, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    service.getCommentHistory = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/comment_versions\";\n      params = {\n        id: activityId\n      };\n      return $http.get(url, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    service.deleteComment = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/delete_comment\";\n      params = {\n        id: activityId\n      };\n      return $http.post(url, null, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    service.undeleteComment = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/undelete_comment\";\n      params = {\n        id: activityId\n      };\n      return $http.post(url, null, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.history = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgHistoryResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {};\n    service.get = function(token) {\n      return $repo.queryOne(\"invitations\", token);\n    };\n    return function(instance) {\n      return instance.invitations = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgInvitationsResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/issues.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage, $q) {\n    var hashSuffix, service;\n    service = {};\n    hashSuffix = \"issues-queryparams\";\n    service.get = function(projectId, issueId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"issues\", issueId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"issues\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"issues\", filters);\n    };\n    service.list = function(projectId, filters, options) {\n      var params;\n      params = {\n        project: projectId\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryPaginated(\"issues\", params, options);\n    };\n    service.bulkCreate = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-issues\");\n      params = {\n        project_id: projectId,\n        bulk_issues: data\n      };\n      return $http.post(url, params);\n    };\n    service.upvote = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-upvote\", issueId);\n      return $http.post(url);\n    };\n    service.downvote = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-downvote\", issueId);\n      return $http.post(url);\n    };\n    service.watch = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-watch\", issueId);\n      return $http.post(url);\n    };\n    service.unwatch = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-unwatch\", issueId);\n      return $http.post(url);\n    };\n    service.stats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/issues_stats\");\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"issues-filters\", null, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.issues = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgIssuesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/kanban.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($storage) {\n    var hashSuffixStatusColumnModes, hashSuffixStatusViewModes, service;\n    service = {};\n    hashSuffixStatusViewModes = \"kanban-statusviewmodels\";\n    hashSuffixStatusColumnModes = \"kanban-statuscolumnmodels\";\n    service.storeStatusColumnModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusColumnModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.kanban = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgKanbanResourcesProvider\", [\"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/locales.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {\n      list: function() {\n        return $repo.queryMany(\"locales\");\n      }\n    };\n    return function(instance) {\n      return instance.locales = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgLocalesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/mdrender.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.render = function(projectId, content) {\n      var params, url;\n      if ((content == null) || content === \"\") {\n        content = ' ';\n      }\n      params = {\n        project_id: projectId,\n        content: content\n      };\n      url = $urls.resolve(\"wiki\");\n      return $http.post(url + \"/render\", params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.mdrender = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgMdRenderResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"memberships\", id);\n    };\n    service.list = function(projectId, filters, enablePagination) {\n      var options, params;\n      if (enablePagination == null) {\n        enablePagination = true;\n      }\n      params = {\n        project: projectId\n      };\n      params = _.extend({}, params, filters || {});\n      if (enablePagination) {\n        return $repo.queryPaginated(\"memberships\", params);\n      }\n      return $repo.queryMany(\"memberships\", params, options = {\n        enablePagination: enablePagination\n      });\n    };\n    service.listByUser = function(userId, filters) {\n      var params;\n      params = {\n        user: userId\n      };\n      params = _.extend({}, params, filters || {});\n      return $repo.queryPaginated(\"memberships\", params);\n    };\n    service.resendInvitation = function(id) {\n      var url;\n      url = $urls.resolve(\"memberships\");\n      return $http.post(url + \"/\" + id + \"/resend_invitation\", {});\n    };\n    service.bulkCreateMemberships = function(projectId, data, invitation_extra_text) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-memberships\");\n      params = {\n        project_id: projectId,\n        bulk_memberships: data,\n        invitation_extra_text: invitation_extra_text\n      };\n      return $http.post(url, params);\n    };\n    return function(instance) {\n      return instance.memberships = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgMembershipsResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {};\n    service.list = function(projectId, module) {\n      return $repo.queryOneAttribute(\"project-modules\", projectId, module);\n    };\n    return function(instance) {\n      return instance.modules = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgModulesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"notify-policies\", id);\n    };\n    service.list = function(filters) {\n      var params;\n      params = _.extend({}, params, filters || {});\n      return $repo.queryMany(\"notify-policies\", params);\n    };\n    return function(instance) {\n      return instance.notifyPolicies = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgNotifyPoliciesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($config, $repo, $http, $urls, $auth, $q, $translate) {\n    var service;\n    service = {};\n    service.get = function(projectId) {\n      return $repo.queryOne(\"projects\", projectId);\n    };\n    service.getBySlug = function(projectSlug) {\n      return $repo.queryOne(\"projects\", \"by_slug?slug=\" + projectSlug);\n    };\n    service.list = function() {\n      return $repo.queryMany(\"projects\");\n    };\n    service.listByMember = function(memberId) {\n      var params;\n      params = {\n        \"member\": memberId,\n        \"order_by\": \"user_order\"\n      };\n      return $repo.queryMany(\"projects\", params);\n    };\n    service.templates = function() {\n      return $repo.queryMany(\"project-templates\");\n    };\n    service.usersList = function(projectId) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(\"users\", params);\n    };\n    service.rolesList = function(projectId) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(\"roles\", params);\n    };\n    service.stats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/stats\");\n    };\n    service.bulkUpdateOrder = function(bulkData) {\n      var url;\n      url = $urls.resolve(\"bulk-update-projects-order\");\n      return $http.post(url, bulkData);\n    };\n    service.regenerate_epics_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_epics_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_userstories_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_userstories_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_tasks_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_tasks_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_issues_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_issues_csv_uuid\";\n      return $http.post(url);\n    };\n    service.leave = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/leave\";\n      return $http.post(url);\n    };\n    service.memberStats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/member_stats\");\n    };\n    service.tagsColors = function(projectId) {\n      return $repo.queryOne(\"projects\", projectId + \"/tags_colors\");\n    };\n    service.deleteTag = function(projectId, tag) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/delete_tag\";\n      return $http.post(url, {\n        tag: tag\n      });\n    };\n    service.createTag = function(projectId, tag, color) {\n      var data, url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/create_tag\";\n      data = {};\n      data.tag = tag;\n      data.color = null;\n      if (color) {\n        data.color = color;\n      }\n      return $http.post(url, data);\n    };\n    service.editTag = function(projectId, from_tag, to_tag, color) {\n      var data, url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/edit_tag\";\n      data = {};\n      data.from_tag = from_tag;\n      if (to_tag) {\n        data.to_tag = to_tag;\n      }\n      data.color = null;\n      if (color) {\n        data.color = color;\n      }\n      return $http.post(url, data);\n    };\n    service.mixTags = function(projectId, to_tag, from_tags) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/mix_tags\";\n      return $http.post(url, {\n        to_tag: to_tag,\n        from_tags: from_tags\n      });\n    };\n    service[\"export\"] = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"exporter\")) + \"/\" + projectId;\n      return $http.get(url);\n    };\n    service[\"import\"] = function(file, statusUpdater) {\n      var complete, data, defered, errorMsg, failed, maxFileSize, response, uploadComplete, uploadFailed, uploadProgress, xhr;\n      defered = $q.defer();\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_MAX_SIZE_EXCEEDED\", {\n          fileName: file.name,\n          fileSize: sizeFormat(file.size),\n          maxFileSize: sizeFormat(maxFileSize)\n        });\n        response = {\n          status: 413,\n          data: {\n            _error_message: errorMsg\n          }\n        };\n        defered.reject(response);\n        return defered.promise;\n      }\n      uploadProgress = (function(_this) {\n        return function(evt) {\n          var message, percent;\n          percent = Math.round((evt.loaded / evt.total) * 100);\n          message = $translate.instant(\"PROJECT.IMPORT.UPLOAD_IN_PROGRESS_MESSAGE\", {\n            uploadedSize: sizeFormat(evt.loaded),\n            totalSize: sizeFormat(evt.total)\n          });\n          return statusUpdater(\"in-progress\", null, message, percent);\n        };\n      })(this);\n      uploadComplete = (function(_this) {\n        return function(evt) {\n          return statusUpdater(\"done\", $translate.instant(\"PROJECT.IMPORT.TITLE\"), $translate.instant(\"PROJECT.IMPORT.DESCRIPTION\"));\n        };\n      })(this);\n      uploadFailed = (function(_this) {\n        return function(evt) {\n          return statusUpdater(\"error\");\n        };\n      })(this);\n      complete = (function(_this) {\n        return function(evt) {\n          var ref;\n          response = {};\n          try {\n            response.data = JSON.parse(evt.target.responseText);\n          } catch (error) {\n            response.data = {};\n          }\n          response.status = evt.target.status;\n          if (evt.target.getResponseHeader('Taiga-Info-Project-Is-Private')) {\n            response.headers = {\n              isPrivate: evt.target.getResponseHeader('Taiga-Info-Project-Is-Private') === 'True',\n              memberships: parseInt(evt.target.getResponseHeader('Taiga-Info-Project-Memberships'))\n            };\n          }\n          if ((ref = response.status) === 201 || ref === 202) {\n            defered.resolve(response);\n          }\n          return defered.reject(response);\n        };\n      })(this);\n      failed = (function(_this) {\n        return function(evt) {\n          return defered.reject(\"fail\");\n        };\n      })(this);\n      data = new FormData();\n      data.append('dump', file);\n      xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener(\"progress\", uploadProgress, false);\n      xhr.upload.addEventListener(\"load\", uploadComplete, false);\n      xhr.upload.addEventListener(\"error\", uploadFailed, false);\n      xhr.upload.addEventListener(\"abort\", uploadFailed, false);\n      xhr.addEventListener(\"load\", complete, false);\n      xhr.addEventListener(\"error\", failed, false);\n      xhr.open(\"POST\", $urls.resolve(\"importer\"));\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + ($auth.getToken()));\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send(data);\n      return defered.promise;\n    };\n    service.changeLogo = function(projectId, file) {\n      var data, defered, maxFileSize, options, response, url;\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered = $q.defer();\n        defered.reject(response);\n        return defered.promise;\n      }\n      data = new FormData();\n      data.append('logo', file);\n      options = {\n        transformRequest: angular.identity,\n        headers: {\n          'Content-Type': void 0\n        }\n      };\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/change_logo\";\n      return $http.post(url, data, {}, options);\n    };\n    service.removeLogo = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/remove_logo\";\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.projects = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgProjectsResourcesProvider\", [\"$tgConfig\", \"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgAuth\", \"$q\", \"$translate\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"roles\", id);\n    };\n    service.list = function(projectId) {\n      return $repo.queryMany(\"roles\", {\n        project: projectId\n      });\n    };\n    return function(instance) {\n      return instance.roles = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgRolesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/search.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $urls, $http, $q) {\n    var service;\n    service = {};\n    service[\"do\"] = function(projectId, term) {\n      var deferredAbort, params, request, url;\n      deferredAbort = $q.defer();\n      url = $urls.resolve(\"search\");\n      params = {\n        url: url,\n        method: \"GET\",\n        timeout: deferredAbort.promise,\n        cancelable: true,\n        params: {\n          project: projectId,\n          text: term,\n          get_all: false\n        }\n      };\n      request = $http.request(params).then(function(data) {\n        return data.data;\n      });\n      request.abort = function() {\n        return deferredAbort.resolve();\n      };\n      request[\"finally\"] = function() {\n        request.abort = angular.noop;\n        return deferredAbort = request = null;\n      };\n      return request;\n    };\n    return function(instance) {\n      return instance.search = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgSearchResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/sprints.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $model, $storage) {\n    var service;\n    service = {};\n    service.get = function(projectId, sprintId) {\n      return $repo.queryOne(\"milestones\", sprintId).then(function(sprint) {\n        var uses;\n        uses = sprint.user_stories;\n        uses = _.map(uses, function(u) {\n          return $model.make_model(\"userstories\", u);\n        });\n        sprint._attrs.user_stories = uses;\n        return sprint;\n      });\n    };\n    service.stats = function(projectId, sprintId) {\n      return $repo.queryOneRaw(\"milestones\", sprintId + \"/stats\");\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"milestones\", filters);\n    };\n    service.list = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      params = _.extend({}, params, filters || {});\n      return $repo.queryMany(\"milestones\", params, {}, true).then((function(_this) {\n        return function(result) {\n          var headers, i, len, m, milestones, uses;\n          milestones = result[0];\n          headers = result[1];\n          for (i = 0, len = milestones.length; i < len; i++) {\n            m = milestones[i];\n            uses = m.user_stories;\n            uses = _.map(uses, function(u) {\n              return $model.make_model(\"userstories\", u);\n            });\n            m._attrs.user_stories = uses;\n          }\n          return {\n            milestones: milestones,\n            closed: parseInt(headers(\"Taiga-Info-Total-Closed-Milestones\"), 10),\n            open: parseInt(headers(\"Taiga-Info-Total-Opened-Milestones\"), 10)\n          };\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.sprints = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgSprintsResourcesProvider\", [\"$tgRepo\", \"$tgModel\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/tasks.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage) {\n    var hashSuffix, hashSuffixStatusColumnModes, hashSuffixUsRowModes, service;\n    service = {};\n    hashSuffix = \"tasks-queryparams\";\n    hashSuffixStatusColumnModes = \"tasks-statuscolumnmodels\";\n    hashSuffixUsRowModes = \"tasks-usrowmodels\";\n    service.get = function(projectId, taskId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"tasks\", taskId, params);\n    };\n    service.getByRef = function(projectId, ref, extraParams) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      params = _.extend({}, params, extraParams);\n      return $repo.queryOne(\"tasks\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"tasks\", filters);\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"task-filters\", null, params);\n    };\n    service.list = function(projectId, sprintId, userStoryId, params) {\n      if (sprintId == null) {\n        sprintId = null;\n      }\n      if (userStoryId == null) {\n        userStoryId = null;\n      }\n      params = _.merge(params, {\n        project: projectId\n      });\n      if (sprintId) {\n        params.milestone = sprintId;\n      }\n      if (userStoryId) {\n        params.user_story = userStoryId;\n      }\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"tasks\", params);\n    };\n    service.bulkCreate = function(projectId, sprintId, usId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-tasks\");\n      params = {\n        project_id: projectId,\n        milestone_id: sprintId,\n        us_id: usId,\n        bulk_tasks: data\n      };\n      return $http.post(url, params).then(function(result) {\n        return result.data;\n      });\n    };\n    service.upvote = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-upvote\", taskId);\n      return $http.post(url);\n    };\n    service.downvote = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-downvote\", taskId);\n      return $http.post(url);\n    };\n    service.watch = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-watch\", taskId);\n      return $http.post(url);\n    };\n    service.unwatch = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-unwatch\", taskId);\n      return $http.post(url);\n    };\n    service.bulkUpdateTaskTaskboardOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-task-taskboard-order\");\n      params = {\n        project_id: projectId,\n        bulk_tasks: data\n      };\n      return $http.post(url, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeStatusColumnModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusColumnModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeUsRowModes = function(projectId, sprintId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixUsRowModes;\n      hash = generateHash([projectId, sprintId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getUsRowModes = function(projectId, sprintId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixUsRowModes;\n      hash = generateHash([projectId, sprintId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.tasks = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgTasksResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($config, $repo, $http, $urls, $q) {\n    var service;\n    service = {};\n    service.changeAvatar = function(file) {\n      var data, defered, maxFileSize, options, response, url;\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered = $q.defer();\n        defered.reject(response);\n        return defered.promise;\n      }\n      data = new FormData();\n      data.append('avatar', file);\n      options = {\n        transformRequest: angular.identity,\n        headers: {\n          'Content-Type': void 0\n        }\n      };\n      url = ($urls.resolve(\"users\")) + \"/change_avatar\";\n      return $http.post(url, data, {}, options);\n    };\n    service.removeAvatar = function() {\n      var url;\n      url = ($urls.resolve(\"users\")) + \"/remove_avatar\";\n      return $http.post(url);\n    };\n    service.changePassword = function(currentPassword, newPassword) {\n      var data, url;\n      url = ($urls.resolve(\"users\")) + \"/change_password\";\n      data = {\n        current_password: currentPassword,\n        password: newPassword\n      };\n      return $http.post(url, data);\n    };\n    return function(instance) {\n      return instance.userSettings = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUserSettingsResourcesProvider\", [\"$tgConfig\", \"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/user.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($http, $urls) {\n    var service;\n    service = {};\n    service.contacts = function(userId, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = $urls.resolve(\"user-contacts\", userId);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return $http.get(url, {}, httpOptions).then(function(result) {\n        return result.data;\n      });\n    };\n    return function(instance) {\n      return instance.users = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUsersResourcesProvider\", [\"$tgHttp\", \"$tgUrls\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/userstories.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage, $q) {\n    var hashSuffix, service;\n    service = {};\n    hashSuffix = \"userstories-queryparams\";\n    service.get = function(projectId, usId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"userstories\", usId, params);\n    };\n    service.getByRef = function(projectId, ref, extraParams) {\n      var params;\n      if (extraParams == null) {\n        extraParams = {};\n      }\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      params = _.extend({}, params, extraParams);\n      return $repo.queryOne(\"userstories\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"userstories\", filters);\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"userstories-filters\", null, params);\n    };\n    service.listUnassigned = function(projectId, filters, pageSize) {\n      var params;\n      params = {\n        \"project\": projectId,\n        \"milestone\": \"null\"\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"userstories\", _.extend(params, {\n        page_size: pageSize\n      }), {\n        enablePagination: true\n      }, true);\n    };\n    service.listAll = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"userstories\", params);\n    };\n    service.bulkCreate = function(projectId, status, bulk) {\n      var data, url;\n      data = {\n        project_id: projectId,\n        status_id: status,\n        bulk_stories: bulk\n      };\n      url = $urls.resolve(\"bulk-create-us\");\n      return $http.post(url, data);\n    };\n    service.upvote = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-upvote\", userStoryId);\n      return $http.post(url);\n    };\n    service.downvote = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-downvote\", userStoryId);\n      return $http.post(url);\n    };\n    service.watch = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-watch\", userStoryId);\n      return $http.post(url);\n    };\n    service.unwatch = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-unwatch\", userStoryId);\n      return $http.post(url);\n    };\n    service.bulkUpdateBacklogOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-backlog-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.bulkUpdateMilestone = function(projectId, milestoneId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-milestone\");\n      params = {\n        project_id: projectId,\n        milestone_id: milestoneId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.bulkUpdateKanbanOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-kanban-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeShowTags = function(projectId, showTags) {\n      var hash;\n      hash = generateHash([projectId, 'showTags']);\n      return $storage.set(hash, showTags);\n    };\n    service.getShowTags = function(projectId) {\n      var hash;\n      hash = generateHash([projectId, 'showTags']);\n      return $storage.get(hash) || null;\n    };\n    return function(instance) {\n      return instance.userstories = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUserstoriesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: webhooklogs.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.list = function(webhookId) {\n      var params;\n      params = {\n        webhook: webhookId\n      };\n      return $repo.queryMany(\"webhooklogs\", params);\n    };\n    service.resend = function(webhooklogId) {\n      var url;\n      url = $urls.resolve(\"webhooklogs-resend\", webhooklogId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.webhooklogs = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWebhookLogsResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: webhooks.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.list = function(projectId) {\n      var params;\n      params = {\n        project: projectId\n      };\n      return $repo.queryMany(\"webhooks\", params);\n    };\n    service.test = function(webhookId) {\n      var url;\n      url = $urls.resolve(\"webhooks-test\", webhookId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.webhooks = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWebhooksResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/wikis.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(wikiId) {\n      return $repo.queryOne(\"wiki\", wikiId);\n    };\n    service.getBySlug = function(projectId, slug) {\n      return $repo.queryOne(\"wiki\", \"by_slug?project=\" + projectId + \"&slug=\" + slug);\n    };\n    service.list = function(projectId) {\n      return $repo.queryMany(\"wiki\", {\n        project: projectId\n      });\n    };\n    service.listLinks = function(projectId) {\n      return $repo.queryMany(\"wiki-links\", {\n        project: projectId\n      });\n    };\n    return function(instance) {\n      return instance.wiki = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWikiResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/main.coffee\n */\n\n(function() {\n  var UserChangePasswordController, UserChangePasswordDirective, debounce, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  UserChangePasswordController = (function(superClass) {\n    extend(UserChangePasswordController, superClass);\n\n    UserChangePasswordController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"$translate\"];\n\n    function UserChangePasswordController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, auth, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.translate = translate;\n      this.scope.sectionName = this.translate.instant(\"CHANGE_PASSWORD.SECTION_NAME\");\n      this.scope.user = this.auth.getUser();\n    }\n\n    return UserChangePasswordController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserChangePasswordController\", UserChangePasswordController);\n\n  UserChangePasswordDirective = function($rs, $confirm, $loading, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, ctrl) {\n      var form, submit, submitButton;\n      form = new checksley.Form($el.find(\"form\"));\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          if ($scope.newPassword1 !== $scope.newPassword2) {\n            $confirm.notify('error', $translate.instant(\"CHANGE_PASSWORD.ERROR_PASSWORD_MATCH\"));\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $rs.userSettings.changePassword($scope.currentPassword, $scope.newPassword1);\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify('success');\n          });\n          return promise.then(null, function(response) {\n            currentLoading.finish();\n            return $confirm.notify('error', response.data._error_message);\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserChangePassword\", [\"$tgResources\", \"$tgConfirm\", \"$tgLoading\", \"$translate\", UserChangePasswordDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/lightboxes.coffee\n */\n\n(function() {\n  var DeleteUserDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  DeleteUserDirective = function($repo, $rootscope, $auth, $location, $navUrls, lightboxService, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit, submitButton;\n      $scope.$on(\"deletelightbox:new\", function(ctx, user) {\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      submit = function() {\n        var currentLoading, promise;\n        currentLoading = $loading().target(submitButton).start();\n        promise = $repo.remove($scope.user);\n        promise.then(function(data) {\n          currentLoading.finish();\n          lightboxService.close($el);\n          $auth.logout();\n          return $location.path($navUrls.resolve(\"login\"));\n        });\n        return promise.then(null, function() {\n          currentLoading.finish();\n          return console.log(\"FAIL\");\n        });\n      };\n      $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      $el.on(\"click\", \".button-red\", debounce(2000, function(event) {\n        event.preventDefault();\n        return submit();\n      }));\n      return submitButton = $el.find(\".button-red\");\n    };\n    return {\n      link: link,\n      templateUrl: \"user/lightbox/lightbox-delete-account.html\"\n    };\n  };\n\n  module.directive(\"tgLbDeleteUser\", [\"$tgRepo\", \"$rootScope\", \"$tgAuth\", \"$tgLocation\", \"$tgNavUrls\", \"lightboxService\", \"$tgLoading\", DeleteUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/main.coffee\n */\n\n(function() {\n  var TaigaAvatarModelDirective, UserAvatarDirective, UserProfileDirective, UserSettingsController, debounce, mixOf, module, sizeFormat, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  debounce = this.taiga.debounce;\n\n  UserSettingsController = (function(superClass) {\n    extend(UserSettingsController, superClass);\n\n    UserSettingsController.$inject = [\"$scope\", \"$rootScope\", \"$tgConfig\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"$translate\", \"tgErrorHandlingService\"];\n\n    function UserSettingsController(scope, rootscope, config, repo, confirm, rs, params, q, location, navUrls, auth, translate, errorHandlingService) {\n      var maxFileSize, promise, text;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.config = config;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      this.scope.sectionName = \"USER_SETTINGS.MENU.SECTION_TITLE\";\n      this.scope.project = {};\n      this.scope.user = this.auth.getUser();\n      if (!this.scope.user) {\n        this.errorHandlingService.permissionDenied();\n      }\n      this.scope.lang = this.getLan();\n      this.scope.theme = this.getTheme();\n      maxFileSize = this.config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize) {\n        text = this.translate.instant(\"USER_SETTINGS.AVATAR_MAX_SIZE\", {\n          \"maxFileSize\": sizeFormat(maxFileSize)\n        });\n        this.scope.maxFileSizeMsg = text;\n      }\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserSettingsController.prototype.loadInitialData = function() {\n      this.scope.availableThemes = this.config.get(\"themes\", []);\n      return this.rs.locales.list().then((function(_this) {\n        return function(locales) {\n          _this.scope.locales = locales;\n          return locales;\n        };\n      })(this));\n    };\n\n    UserSettingsController.prototype.openDeleteLightbox = function() {\n      return this.rootscope.$broadcast(\"deletelightbox:new\", this.scope.user);\n    };\n\n    UserSettingsController.prototype.getLan = function() {\n      return this.scope.user.lang || this.translate.preferredLanguage();\n    };\n\n    UserSettingsController.prototype.getTheme = function() {\n      return this.scope.user.theme || this.config.get(\"defaultTheme\") || \"taiga\";\n    };\n\n    return UserSettingsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserSettingsController\", UserSettingsController);\n\n  UserProfileDirective = function($confirm, $auth, $repo, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var changeEmail, form, onError, onSuccess;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          changeEmail = $scope.user.isAttributeModified(\"email\");\n          $scope.user.lang = $scope.lang;\n          $scope.user.theme = $scope.theme;\n          onSuccess = function(data) {\n            var text;\n            $auth.setUser(data);\n            if (changeEmail) {\n              text = $translate.instant(\"USER_PROFILE.CHANGE_EMAIL_SUCCESS\");\n              return $confirm.success(text);\n            } else {\n              return $confirm.notify('success');\n            }\n          };\n          onError = function(data) {\n            form.setErrors(data);\n            return $confirm.notify('error', data._error_message);\n          };\n          return $repo.save($scope.user).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserProfile\", [\"$tgConfirm\", \"$tgAuth\", \"$tgRepo\", \"$translate\", UserProfileDirective]);\n\n  UserAvatarDirective = function($auth, $model, $rs, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var onError, onSuccess, showSizeInfo;\n      showSizeInfo = function() {\n        return $el.find(\".size-info\").removeClass(\"hidden\");\n      };\n      onSuccess = function(response) {\n        var user;\n        user = $model.make_model(\"users\", response.data);\n        $auth.setUser(user);\n        $scope.user = user;\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('success');\n      };\n      onError = function(response) {\n        if (response.status === 413) {\n          showSizeInfo();\n        }\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('error', response.data._error_message);\n      };\n      $el.on(\"click\", \".js-change-avatar\", function() {\n        return $el.find(\"#avatar-field\").click();\n      });\n      $el.on(\"change\", \"#avatar-field\", function(event) {\n        if ($scope.avatarAttachment) {\n          $el.find('.loading-overlay').addClass(\"active\");\n          return $rs.userSettings.changeAvatar($scope.avatarAttachment).then(onSuccess, onError);\n        }\n      });\n      $el.on(\"click\", \"a.js-use-gravatar\", function(event) {\n        $el.find('.loading-overlay').addClass(\"active\");\n        return $rs.userSettings.removeAvatar().then(onSuccess, onError);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserAvatar\", [\"$tgAuth\", \"$tgModel\", \"$tgResources\", \"$tgConfirm\", UserAvatarDirective]);\n\n  TaigaAvatarModelDirective = function($parse) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var model, modelSetter;\n      model = $parse($attrs.tgAvatarModel);\n      modelSetter = model.assign;\n      return $el.bind('change', function() {\n        return $scope.$apply(function() {\n          return modelSetter($scope, $el[0].files[0]);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive('tgAvatarModel', ['$parse', TaigaAvatarModelDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/nav.coffee\n */\n\n(function() {\n  var UserSettingsNavigationDirective, module;\n\n  UserSettingsNavigationDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var section;\n      section = $attrs.tgUserSettingsNavigation;\n      $el.find(\".active\").removeClass(\"active\");\n      $el.find(\"#usersettingsmenu-\" + section + \" a\").addClass(\"active\");\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaUserSettings\");\n\n  module.directive(\"tgUserSettingsNavigation\", UserSettingsNavigationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/notifications.coffee\n */\n\n(function() {\n  var UserNotificationsController, UserNotificationsDirective, UserNotificationsListDirective, bindOnce, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  UserNotificationsController = (function(superClass) {\n    extend(UserNotificationsController, superClass);\n\n    UserNotificationsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"tgErrorHandlingService\"];\n\n    function UserNotificationsController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, auth, errorHandlingService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.errorHandlingService = errorHandlingService;\n      this.scope.sectionName = \"USER_SETTINGS.NOTIFICATIONS.SECTION_NAME\";\n      this.scope.user = this.auth.getUser();\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserNotificationsController.prototype.loadInitialData = function() {\n      return this.rs.notifyPolicies.list().then((function(_this) {\n        return function(notifyPolicies) {\n          _this.scope.notifyPolicies = notifyPolicies;\n          return notifyPolicies;\n        };\n      })(this));\n    };\n\n    return UserNotificationsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserNotificationsController\", UserNotificationsController);\n\n  UserNotificationsDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserNotifications\", UserNotificationsDirective);\n\n  UserNotificationsListDirective = function($repo, $confirm, $compile) {\n    var link, template;\n    template = _.template(\"<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\\n<div class=\\\"policy-table-row\\\" data-index=\\\"<%- index %>\\\">\\n  <div class=\\\"policy-table-project\\\"><span><%- notifyPolicy.project_name %></span></div>\\n  <div class=\\\"policy-table-all\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-all-<%- notifyPolicy.id %>\\\"\\n             value=\\\"2\\\" <% if (notifyPolicy.notify_level == 2) { %>checked=\\\"checked\\\"<% } %>/>\\n      <label for=\\\"policy-all-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_ALL\\\"></label>\\n    </fieldset>\\n  </div>\\n  <div class=\\\"policy-table-involved\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-involved-<%- notifyPolicy.id %>\\\"\\n             value=\\\"1\\\" <% if (notifyPolicy.notify_level == 1) { %>checked=\\\"checked\\\"<% } %> />\\n      <label for=\\\"policy-involved-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_INVOLVED\\\"></label>\\n    </fieldset>\\n  </div>\\n  <div class=\\\"policy-table-none\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-none-<%- notifyPolicy.id %>\\\"\\n             value=\\\"3\\\" <% if (notifyPolicy.notify_level == 3) { %>checked=\\\"checked\\\"<% } %> />\\n      <label for=\\\"policy-none-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_NONE\\\"></label>\\n    </fieldset>\\n  </div>\\n</div>\\n<% }) %>\");\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function() {\n        var ctx, html;\n        $el.off();\n        ctx = {\n          notifyPolicies: $scope.notifyPolicies\n        };\n        html = template(ctx);\n        $el.html($compile(html)($scope));\n        return $el.on(\"change\", \"input[type=radio]\", function(event) {\n          var onError, onSuccess, policy, policyIndex, prev_level, target;\n          target = angular.element(event.currentTarget);\n          policyIndex = target.parents(\".policy-table-row\").data('index');\n          policy = $scope.notifyPolicies[policyIndex];\n          prev_level = policy.notify_level;\n          policy.notify_level = parseInt(target.val(), 10);\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return target.parents(\".policy-table-row\").find(\"input[value=\" + prev_level + \"]\").prop(\"checked\", true);\n          };\n          return $repo.save(policy).then(onSuccess, onError);\n        });\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return bindOnce($scope, $attrs.ngModel, render);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserNotificationsList\", [\"$tgRepo\", \"$tgConfirm\", \"$compile\", UserNotificationsListDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: components.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaComponents\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaDiscover\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-apps.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaExternalApps\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaHistory\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaHome\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaNavigationBar\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaProfile\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaProjects\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: resources.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaResources2\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: search.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaSearch\", ['taigaIssues']);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaUserTimeline\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: utils.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUtils\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: wiki-history.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaWikiHistory\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: assigned-to-selector.directive.coffee\n */\n\n(function() {\n  var AssignedItemDirective;\n\n  AssignedItemDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      templateUrl: \"components/assigned-to/assigned-item/assigned-item.html\",\n      scope: {\n        member: \"=\"\n      },\n      link: link\n    };\n  };\n\n  AssignedItemDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAssignedItem\", AssignedItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: assigned-to-selector.controller.coffee\n */\n\n(function() {\n  var AssignedToSelectorController;\n\n  AssignedToSelectorController = (function() {\n    AssignedToSelectorController.$inject = [];\n\n    function AssignedToSelectorController() {\n      if (this.assigned) {\n        this._getAssignedMember();\n      }\n      this._filterAssignedMember();\n    }\n\n    AssignedToSelectorController.prototype._getAssignedMember = function() {\n      return this.assignedMember = _.filter(this.project.members, (function(_this) {\n        return function(member) {\n          return member.id === _this.assigned.get('id');\n        };\n      })(this));\n    };\n\n    AssignedToSelectorController.prototype._filterAssignedMember = function() {\n      if (this.assigned) {\n        return this.nonAssignedMembers = _.filter(this.project.members, (function(_this) {\n          return function(member) {\n            return member.id !== _this.assigned.get('id');\n          };\n        })(this));\n      } else {\n        return this.nonAssignedMembers = this.project.members;\n      }\n    };\n\n    return AssignedToSelectorController;\n\n  })();\n\n  angular.module('taigaComponents').controller('AssignedToSelectorCtrl', AssignedToSelectorController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: assigned-to-selector.directive.coffee\n */\n\n(function() {\n  var AssignedToSelectorDirective;\n\n  AssignedToSelectorDirective = function() {\n    return {\n      controller: \"AssignedToSelectorCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"components/assigned-to/assigned-to-selector/assigned-to-selector.html\",\n      scope: {\n        assigned: \"=\",\n        project: \"=\",\n        onRemoveAssigned: \"&\",\n        onAssignTo: \"&\"\n      }\n    };\n  };\n\n  AssignedToSelectorDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAssignedToSelector\", AssignedToSelectorDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: assigned-to.controller.coffee\n */\n\n(function() {\n  var AssignedToController;\n\n  AssignedToController = (function() {\n    AssignedToController.$inject = [\"tgLightboxFactory\", \"lightboxService\"];\n\n    function AssignedToController(lightboxFactory, lightboxService) {\n      this.lightboxFactory = lightboxFactory;\n      this.lightboxService = lightboxService;\n      this.has_permissions = _.includes(this.project.my_permissions, 'modify_epic');\n    }\n\n    AssignedToController.prototype._closeAndRemoveAssigned = function() {\n      this.lightboxService.closeAll();\n      return this.onRemoveAssigned();\n    };\n\n    AssignedToController.prototype._closeAndAssign = function(member) {\n      this.lightboxService.closeAll();\n      return this.onAssignTo({\n        'member': member\n      });\n    };\n\n    AssignedToController.prototype.onSelectAssignedTo = function(assigned, project) {\n      return this.lightboxFactory.create('tg-assigned-to-selector', {\n        \"class\": \"lightbox lightbox-assigned-to-selector open\",\n        \"assigned\": \"assigned\",\n        \"project\": \"project\",\n        \"on-remove-assigned\": \"onRemoveAssigned()\",\n        \"on-assign-to\": \"assignTo(member)\"\n      }, {\n        \"assigned\": this.assignedTo,\n        \"project\": this.project,\n        \"onRemoveAssigned\": this._closeAndRemoveAssigned.bind(this),\n        \"assignTo\": this._closeAndAssign.bind(this)\n      });\n    };\n\n    return AssignedToController;\n\n  })();\n\n  angular.module('taigaComponents').controller('AssignedToCtrl', AssignedToController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: assigned-to.directive.coffee\n */\n\n(function() {\n  var AssignedToDirective;\n\n  AssignedToDirective = function() {\n    return {\n      controller: \"AssignedToCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"components/assigned-to/assigned-to.html\",\n      scope: {\n        assignedTo: \"=\",\n        project: \"=\",\n        onRemoveAssigned: \"&\",\n        onAssignTo: \"&\"\n      }\n    };\n  };\n\n  AssignedToDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAssignedToComponent\", AssignedToDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment-link.directive.coffee\n */\n\n(function() {\n  var AttachmentLinkDirective;\n\n  AttachmentLinkDirective = function($parse, attachmentsPreviewService, lightboxService) {\n    var link;\n    link = function(scope, el, attrs) {\n      var attachment;\n      attachment = $parse(attrs.tgAttachmentLink)(scope);\n      el.on(\"click\", function(event) {\n        if (taiga.isImage(attachment.getIn(['file', 'name']))) {\n          event.preventDefault();\n          return scope.$apply(function() {\n            lightboxService.open($('tg-attachments-preview'));\n            return attachmentsPreviewService.fileId = attachment.getIn(['file', 'id']);\n          });\n        } else if (taiga.isPdf(attachment.getIn(['file', 'name']))) {\n          event.preventDefault();\n          return window.open(attachment.getIn(['file', 'url']));\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentLinkDirective.$inject = [\"$parse\", \"tgAttachmentsPreviewService\", \"lightboxService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentLink\", AttachmentLinkDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment-gallery.directive.coffee\n */\n\n(function() {\n  var AttachmentGalleryDirective;\n\n  AttachmentGalleryDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachment: \"=\",\n        onDelete: \"&\",\n        onUpdate: \"&\",\n        type: \"=\"\n      },\n      controller: \"Attachment\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachment/attachment-gallery.html\",\n      link: link\n    };\n  };\n\n  AttachmentGalleryDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentGallery\", AttachmentGalleryDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchment.controller.coffee\n */\n\n(function() {\n  var AttachmentController;\n\n  AttachmentController = (function() {\n    AttachmentController.$inject = ['tgAttachmentsService', '$translate'];\n\n    function AttachmentController(attachmentsService, translate) {\n      this.attachmentsService = attachmentsService;\n      this.translate = translate;\n      this.form = {};\n      this.form.description = this.attachment.getIn(['file', 'description']);\n      this.form.is_deprecated = this.attachment.get(['file', 'is_deprecated']);\n      this.title = this.translate.instant(\"ATTACHMENT.TITLE\", {\n        fileName: this.attachment.get('name'),\n        date: moment(this.attachment.get('created_date')).format(this.translate.instant(\"ATTACHMENT.DATE\"))\n      });\n    }\n\n    AttachmentController.prototype.editMode = function(mode) {\n      var attachment;\n      attachment = this.attachment.set('editable', mode);\n      return this.onUpdate({\n        attachment: attachment\n      });\n    };\n\n    AttachmentController.prototype[\"delete\"] = function() {\n      return this.onDelete({\n        attachment: this.attachment\n      });\n    };\n\n    AttachmentController.prototype.save = function() {\n      var attachment;\n      attachment = this.attachment.set('loading', true);\n      this.onUpdate({\n        attachment: attachment\n      });\n      attachment = this.attachment.merge({\n        editable: false,\n        loading: false\n      });\n      attachment = attachment.mergeIn(['file'], {\n        description: this.form.description,\n        is_deprecated: !!this.form.is_deprecated\n      });\n      return this.onUpdate({\n        attachment: attachment\n      });\n    };\n\n    return AttachmentController;\n\n  })();\n\n  angular.module('taigaComponents').controller('Attachment', AttachmentController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment.directive.coffee\n */\n\n(function() {\n  var AttachmentDirective;\n\n  AttachmentDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachment: \"=\",\n        onDelete: \"&\",\n        onUpdate: \"&\",\n        type: \"=\"\n      },\n      controller: \"Attachment\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachment/attachment.html\",\n      link: link\n    };\n  };\n\n  AttachmentDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachment\", AttachmentDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-drop.directive.coffee\n */\n\n(function() {\n  var AttachmentsDropDirective;\n\n  AttachmentsDropDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs) {\n      var eventAttr;\n      eventAttr = $parse(attrs.tgAttachmentsDrop);\n      el.on('dragover', function(e) {\n        e.preventDefault();\n        return false;\n      });\n      el.on('drop', function(e) {\n        var dataTransfer;\n        e.stopPropagation();\n        e.preventDefault();\n        dataTransfer = e.dataTransfer || (e.originalEvent && e.originalEvent.dataTransfer);\n        return scope.$apply(function() {\n          return eventAttr(scope, {\n            files: dataTransfer.files\n          });\n        });\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentsDropDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsDrop\", AttachmentsDropDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-full.controller.coffee\n */\n\n(function() {\n  var AttachmentsFullController, sizeFormat;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  AttachmentsFullController = (function() {\n    AttachmentsFullController.$inject = [\"$translate\", \"$tgConfirm\", \"$tgConfig\", \"$tgStorage\", \"tgAttachmentsFullService\", \"tgProjectService\", \"tgAttachmentsPreviewService\"];\n\n    function AttachmentsFullController(translate, confirm, config, storage, attachmentsFullService, projectService, attachmentsPreviewService) {\n      this.translate = translate;\n      this.confirm = confirm;\n      this.config = config;\n      this.storage = storage;\n      this.attachmentsFullService = attachmentsFullService;\n      this.projectService = projectService;\n      this.attachmentsPreviewService = attachmentsPreviewService;\n      this.mode = this.storage.get('attachment-mode', 'list');\n      this.maxFileSize = this.config.get(\"maxUploadFileSize\", null);\n      if (this.maxFileSize) {\n        this.maxFileSize = sizeFormat(this.maxFileSize);\n      }\n      this.maxFileSizeMsg = this.maxFileSize ? this.translate.instant(\"ATTACHMENT.MAX_UPLOAD_SIZE\", {\n        maxFileSize: this.maxFileSize\n      }) : \"\";\n      taiga.defineImmutableProperty(this, 'attachments', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.attachments;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsCount', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.deprecatedsCount;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'attachmentsVisible', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.attachmentsVisible;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsVisible', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.deprecatedsVisible;\n        };\n      })(this));\n    }\n\n    AttachmentsFullController.prototype.uploadingAttachments = function() {\n      return this.attachmentsFullService.uploadingAttachments;\n    };\n\n    AttachmentsFullController.prototype.addAttachment = function(file) {\n      var editable;\n      editable = this.mode === 'list';\n      return this.attachmentsFullService.addAttachment(this.projectId, this.objId, this.type, file, editable);\n    };\n\n    AttachmentsFullController.prototype.setMode = function(mode) {\n      this.mode = mode;\n      return this.storage.set('attachment-mode', mode);\n    };\n\n    AttachmentsFullController.prototype.toggleDeprecatedsVisible = function() {\n      return this.attachmentsFullService.toggleDeprecatedsVisible();\n    };\n\n    AttachmentsFullController.prototype.addAttachments = function(files) {\n      return _.forEach(files, (function(_this) {\n        return function(file) {\n          return _this.addAttachment(file);\n        };\n      })(this));\n    };\n\n    AttachmentsFullController.prototype.loadAttachments = function() {\n      return this.attachmentsFullService.loadAttachments(this.type, this.objId, this.projectId);\n    };\n\n    AttachmentsFullController.prototype.deleteAttachment = function(toDeleteAttachment) {\n      var message, title;\n      this.attachmentsPreviewService.fileId = null;\n      title = this.translate.instant(\"ATTACHMENT.TITLE_LIGHTBOX_DELETE_ATTACHMENT\");\n      message = this.translate.instant(\"ATTACHMENT.MSG_LIGHTBOX_DELETE_ATTACHMENT\", {\n        fileName: toDeleteAttachment.getIn(['file', 'name'])\n      });\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var onError, onSuccess;\n          onError = function() {\n            message = _this.translate.instant(\"ATTACHMENT.ERROR_DELETE_ATTACHMENT\", {\n              errorMessage: message\n            });\n            _this.confirm.notify(\"error\", null, message);\n            return askResponse.finish(false);\n          };\n          onSuccess = function() {\n            return askResponse.finish();\n          };\n          return _this.attachmentsFullService.deleteAttachment(toDeleteAttachment, _this.type).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    AttachmentsFullController.prototype.reorderAttachment = function(attachment, newIndex) {\n      return this.attachmentsFullService.reorderAttachment(this.type, attachment, newIndex);\n    };\n\n    AttachmentsFullController.prototype.updateAttachment = function(toUpdateAttachment) {\n      return this.attachmentsFullService.updateAttachment(toUpdateAttachment, this.type);\n    };\n\n    AttachmentsFullController.prototype._isEditable = function() {\n      if (this.projectService.project) {\n        return this.projectService.hasPermission(this.editPermission);\n      }\n      return false;\n    };\n\n    AttachmentsFullController.prototype.showAttachments = function() {\n      return this._isEditable() || this.attachmentsFullService.attachments.size;\n    };\n\n    return AttachmentsFullController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"AttachmentsFull\", AttachmentsFullController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-full.directive.coffee\n */\n\n(function() {\n  var AttachmentsFullDirective, bindOnce;\n\n  bindOnce = this.taiga.bindOnce;\n\n  AttachmentsFullDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return bindOnce(scope, 'vm.objId', function(value) {\n        return ctrl.loadAttachments();\n      });\n    };\n    return {\n      scope: {},\n      bindToController: {\n        type: \"@\",\n        objId: \"=\",\n        projectId: \"=\",\n        editPermission: \"@\"\n      },\n      controller: \"AttachmentsFull\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachments-full/attachments-full.html\",\n      link: link\n    };\n  };\n\n  AttachmentsFullDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsFull\", AttachmentsFullDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-full.service.coffee\n */\n\n(function() {\n  var AttachmentsFullService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  AttachmentsFullService = (function(superClass) {\n    extend(AttachmentsFullService, superClass);\n\n    AttachmentsFullService.$inject = [\"tgAttachmentsService\", \"$rootScope\"];\n\n    function AttachmentsFullService(attachmentsService, rootScope) {\n      this.attachmentsService = attachmentsService;\n      this.rootScope = rootScope;\n      this._attachments = Immutable.List();\n      this._deprecatedsCount = 0;\n      this._attachmentsVisible = Immutable.List();\n      this._deprecatedsVisible = false;\n      this.uploadingAttachments = [];\n      taiga.defineImmutableProperty(this, 'attachments', (function(_this) {\n        return function() {\n          return _this._attachments;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsCount', (function(_this) {\n        return function() {\n          return _this._deprecatedsCount;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'attachmentsVisible', (function(_this) {\n        return function() {\n          return _this._attachmentsVisible;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsVisible', (function(_this) {\n        return function() {\n          return _this._deprecatedsVisible;\n        };\n      })(this));\n    }\n\n    AttachmentsFullService.prototype.toggleDeprecatedsVisible = function() {\n      this._deprecatedsVisible = !this._deprecatedsVisible;\n      return this.regenerate();\n    };\n\n    AttachmentsFullService.prototype.regenerate = function() {\n      this._deprecatedsCount = this._attachments.count(function(it) {\n        return it.getIn(['file', 'is_deprecated']);\n      });\n      if (this._deprecatedsVisible) {\n        return this._attachmentsVisible = this._attachments;\n      } else {\n        return this._attachmentsVisible = this._attachments.filter(function(it) {\n          return !it.getIn(['file', 'is_deprecated']);\n        });\n      }\n    };\n\n    AttachmentsFullService.prototype.addAttachment = function(projectId, objId, type, file, editable) {\n      if (editable == null) {\n        editable = true;\n      }\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          var promise;\n          if (_this.attachmentsService.validate(file)) {\n            _this.uploadingAttachments.push(file);\n            promise = _this.attachmentsService.upload(file, objId, projectId, type);\n            return promise.then(function(file) {\n              var attachment;\n              _this.uploadingAttachments = _this.uploadingAttachments.filter(function(uploading) {\n                return uploading.name !== file.get('name');\n              });\n              attachment = Immutable.Map();\n              attachment = attachment.merge({\n                file: file,\n                editable: editable,\n                loading: false\n              });\n              _this._attachments = _this._attachments.push(attachment);\n              _this.regenerate();\n              _this.rootScope.$broadcast(\"attachment:create\");\n              return resolve(attachment);\n            });\n          } else {\n            return reject(new Error(file));\n          }\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.loadAttachments = function(type, objId, projectId) {\n      return this.attachmentsService.list(type, objId, projectId).then((function(_this) {\n        return function(files) {\n          _this._attachments = files.map(function(file) {\n            var attachment;\n            attachment = Immutable.Map();\n            return attachment.merge({\n              loading: false,\n              editable: false,\n              file: file\n            });\n          });\n          return _this.regenerate();\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.deleteAttachment = function(toDeleteAttachment, type) {\n      var onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this._attachments = _this._attachments.filter(function(attachment) {\n            return attachment !== toDeleteAttachment;\n          });\n          return _this.regenerate();\n        };\n      })(this);\n      return this.attachmentsService[\"delete\"](type, toDeleteAttachment.getIn(['file', 'id'])).then(onSuccess);\n    };\n\n    AttachmentsFullService.prototype.reorderAttachment = function(type, attachment, newIndex) {\n      var attachments, oldIndex, promises;\n      oldIndex = this.attachments.findIndex(function(it) {\n        return it === attachment;\n      });\n      if (oldIndex === newIndex) {\n        return;\n      }\n      attachments = this.attachments.remove(oldIndex);\n      attachments = attachments.splice(newIndex, 0, attachment);\n      attachments = attachments.map(function(x, i) {\n        return x.setIn(['file', 'order'], i + 1);\n      });\n      promises = [];\n      attachments.forEach((function(_this) {\n        return function(attachment) {\n          var patch;\n          patch = {\n            order: attachment.getIn(['file', 'order'])\n          };\n          return promises.push(_this.attachmentsService.patch(attachment.getIn(['file', 'id']), type, patch));\n        };\n      })(this));\n      return Promise.all(promises).then((function(_this) {\n        return function() {\n          _this._attachments = attachments;\n          return _this.regenerate();\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.updateAttachment = function(toUpdateAttachment, type) {\n      var index, oldAttachment, patch;\n      index = this._attachments.findIndex(function(attachment) {\n        return attachment.getIn(['file', 'id']) === toUpdateAttachment.getIn(['file', 'id']);\n      });\n      oldAttachment = this._attachments.get(index);\n      patch = taiga.patch(oldAttachment.get('file'), toUpdateAttachment.get('file'));\n      if (toUpdateAttachment.get('loading')) {\n        this._attachments = this._attachments.set(index, toUpdateAttachment);\n        return this.regenerate();\n      } else {\n        return this.attachmentsService.patch(toUpdateAttachment.getIn(['file', 'id']), type, patch).then((function(_this) {\n          return function() {\n            _this._attachments = _this._attachments.set(index, toUpdateAttachment);\n            return _this.regenerate();\n          };\n        })(this));\n      }\n    };\n\n    return AttachmentsFullService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgAttachmentsFullService\", AttachmentsFullService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-preview.controller.coffee\n */\n\n(function() {\n  var AttachmentsPreviewController;\n\n  AttachmentsPreviewController = (function() {\n    AttachmentsPreviewController.$inject = [\"tgAttachmentsPreviewService\"];\n\n    function AttachmentsPreviewController(attachmentsPreviewService) {\n      this.attachmentsPreviewService = attachmentsPreviewService;\n      taiga.defineImmutableProperty(this, \"current\", (function(_this) {\n        return function() {\n          if (!_this.attachmentsPreviewService.fileId) {\n            return null;\n          }\n          return _this.getCurrent();\n        };\n      })(this));\n    }\n\n    AttachmentsPreviewController.prototype.hasPagination = function() {\n      var images;\n      images = this.attachments.filter((function(_this) {\n        return function(attachment) {\n          return taiga.isImage(attachment.getIn(['file', 'name']));\n        };\n      })(this));\n      return images.size > 1;\n    };\n\n    AttachmentsPreviewController.prototype.getCurrent = function() {\n      var attachment, file;\n      attachment = this.attachments.find((function(_this) {\n        return function(attachment) {\n          return _this.attachmentsPreviewService.fileId === attachment.getIn(['file', 'id']);\n        };\n      })(this));\n      file = attachment.get('file');\n      return file;\n    };\n\n    AttachmentsPreviewController.prototype.getIndex = function() {\n      return this.attachments.findIndex((function(_this) {\n        return function(attachment) {\n          return _this.attachmentsPreviewService.fileId === attachment.getIn(['file', 'id']);\n        };\n      })(this));\n    };\n\n    AttachmentsPreviewController.prototype.next = function() {\n      var attachmentIndex, image;\n      attachmentIndex = this.getIndex();\n      image = this.attachments.slice(attachmentIndex + 1).find(function(attachment) {\n        return taiga.isImage(attachment.getIn(['file', 'name']));\n      });\n      if (!image) {\n        image = this.attachments.find(function(attachment) {\n          return taiga.isImage(attachment.getIn(['file', 'name']));\n        });\n      }\n      return this.attachmentsPreviewService.fileId = image.getIn(['file', 'id']);\n    };\n\n    AttachmentsPreviewController.prototype.previous = function() {\n      var attachmentIndex, image;\n      attachmentIndex = this.getIndex();\n      image = this.attachments.slice(0, attachmentIndex).findLast(function(attachment) {\n        return taiga.isImage(attachment.getIn(['file', 'name']));\n      });\n      if (!image) {\n        image = this.attachments.findLast(function(attachment) {\n          return taiga.isImage(attachment.getIn(['file', 'name']));\n        });\n      }\n      return this.attachmentsPreviewService.fileId = image.getIn(['file', 'id']);\n    };\n\n    return AttachmentsPreviewController;\n\n  })();\n\n  angular.module('taigaComponents').controller('AttachmentsPreview', AttachmentsPreviewController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-preview.directive.coffee\n */\n\n(function() {\n  var AttachmentPreviewLightboxDirective;\n\n  AttachmentPreviewLightboxDirective = function(lightboxService, attachmentsPreviewService) {\n    var link;\n    link = function($scope, el, attrs, ctrl) {\n      $(document.body).on(\"keydown.image-preview\", function(e) {\n        if (attachmentsPreviewService.fileId) {\n          if (e.keyCode === 39) {\n            ctrl.next();\n          } else if (e.keyCode === 37) {\n            ctrl.previous();\n          }\n        }\n        return $scope.$digest();\n      });\n      return $scope.$on('$destroy', function() {\n        return $(document.body).off('.image-preview');\n      });\n    };\n    return {\n      scope: {},\n      controller: 'AttachmentsPreview',\n      templateUrl: 'components/attachments-preview/attachments-preview.html',\n      link: link,\n      controllerAs: \"vm\",\n      bindToController: {\n        attachments: \"=\"\n      }\n    };\n  };\n\n  angular.module('taigaComponents').directive(\"tgAttachmentsPreview\", [\"lightboxService\", \"tgAttachmentsPreviewService\", AttachmentPreviewLightboxDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-preview.service.coffee\n */\n\n(function() {\n  var AttachmentsPreviewService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  AttachmentsPreviewService = (function(superClass) {\n    extend(AttachmentsPreviewService, superClass);\n\n    AttachmentsPreviewService.$inject = [];\n\n    function AttachmentsPreviewService() {}\n\n    return AttachmentsPreviewService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgAttachmentsPreviewService\", AttachmentsPreviewService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-simple.controller.coffee\n */\n\n(function() {\n  var AttachmentsSimpleController;\n\n  AttachmentsSimpleController = (function() {\n    AttachmentsSimpleController.$inject = [\"tgAttachmentsService\"];\n\n    function AttachmentsSimpleController(attachmentsService) {\n      this.attachmentsService = attachmentsService;\n    }\n\n    AttachmentsSimpleController.prototype.addAttachment = function(file) {\n      var attachment;\n      attachment = Immutable.fromJS({\n        file: file,\n        name: file.name,\n        size: file.size\n      });\n      if (this.attachmentsService.validate(file)) {\n        this.attachments = this.attachments.push(attachment);\n        if (this.onAdd) {\n          return this.onAdd({\n            attachment: attachment\n          });\n        }\n      }\n    };\n\n    AttachmentsSimpleController.prototype.addAttachments = function(files) {\n      return _.forEach(files, this.addAttachment.bind(this));\n    };\n\n    AttachmentsSimpleController.prototype.deleteAttachment = function(toDeleteAttachment) {\n      this.attachments = this.attachments.filter(function(attachment) {\n        return attachment !== toDeleteAttachment;\n      });\n      if (this.onDelete) {\n        return this.onDelete({\n          attachment: toDeleteAttachment\n        });\n      }\n    };\n\n    return AttachmentsSimpleController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"AttachmentsSimple\", AttachmentsSimpleController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-simple.directive.coffee\n */\n\n(function() {\n  var AttachmentsSimpleDirective;\n\n  AttachmentsSimpleDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachments: \"=\",\n        onAdd: \"&\",\n        onDelete: \"&\"\n      },\n      controller: \"AttachmentsSimple\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachments-simple/attachments-simple.html\",\n      link: link\n    };\n  };\n\n  AttachmentsSimpleDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsSimple\", AttachmentsSimpleDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-sortable.directive.coffee\n */\n\n(function() {\n  var AttachmentSortableDirective;\n\n  AttachmentSortableDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs) {\n      var callback, drake, scroll;\n      callback = $parse(attrs.tgAttachmentsSortable);\n      drake = dragula([el[0]], {\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: el[0],\n        moves: function(item) {\n          return $(item).is('div[tg-bind-scope]');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var attachment, newIndex;\n        item = $(item);\n        attachment = item.scope().attachment;\n        newIndex = item.index();\n        return scope.$apply(function() {\n          return callback(scope, {\n            attachment: attachment,\n            index: newIndex\n          });\n        });\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        el.off();\n        return drake.destroy();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentSortableDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsSortable\", AttachmentSortableDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: auto-select.directive.coffee\n */\n\n(function() {\n  var AutoSelectDirective;\n\n  AutoSelectDirective = function($timeout) {\n    return {\n      link: function(scope, elm) {\n        return $timeout(function() {\n          return elm[0].select();\n        });\n      }\n    };\n  };\n\n  AutoSelectDirective.$inject = ['$timeout'];\n\n  angular.module(\"taigaComponents\").directive(\"tgAutoSelect\", AutoSelectDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: avatar.directive.coffee\n */\n\n(function() {\n  var AvatarDirective;\n\n  AvatarDirective = function(avatarService) {\n    var link;\n    link = function(scope, el, attrs) {\n      var attributeName;\n      if (attrs.tgAvatarBig) {\n        attributeName = 'avatarBig';\n      } else {\n        attributeName = 'avatar';\n      }\n      return scope.$watch(attributeName, function(user) {\n        var avatar;\n        avatar = avatarService.getAvatar(user, attributeName);\n        el.attr('src', avatar.url);\n        if (avatar.bg) {\n          return el.css('background', avatar.bg);\n        }\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        avatar: \"=tgAvatar\",\n        avatarBig: \"=tgAvatarBig\"\n      }\n    };\n  };\n\n  AvatarDirective.$inject = ['tgAvatarService'];\n\n  angular.module(\"taigaComponents\").directive(\"tgAvatar\", AvatarDirective);\n\n  angular.module(\"taigaComponents\").directive(\"tgAvatarBig\", AvatarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: belong-to-epics.directive.coffee\n */\n\n(function() {\n  var BelongToEpicsDirective, module;\n\n  module = angular.module('taigaEpics');\n\n  BelongToEpicsDirective = function() {\n    var link, templateUrl;\n    link = function(scope, el, attrs) {\n      return scope.$watch('epics', function(epics) {\n        if (epics && !epics.isIterable) {\n          return scope.epics = Immutable.fromJS(epics);\n        }\n      });\n    };\n    templateUrl = function(el, attrs) {\n      if (attrs.format) {\n        return \"components/belong-to-epics/belong-to-epics-\" + attrs.format + \".html\";\n      }\n      return \"components/belong-to-epics/belong-to-epics-pill.html\";\n    };\n    return {\n      link: link,\n      scope: {\n        epics: '='\n      },\n      templateUrl: templateUrl\n    };\n  };\n\n  module.directive(\"tgBelongToEpics\", BelongToEpicsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: board-zoom.directive.coffee\n */\n\n(function() {\n  var BoardZoomDirective;\n\n  BoardZoomDirective = function() {\n    return {\n      scope: {\n        levels: \"=\",\n        value: \"=\"\n      },\n      templateUrl: 'components/board-zoom/board-zoom.html'\n    };\n  };\n\n  angular.module('taigaComponents').directive(\"tgBoardZoom\", [BoardZoomDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: card-slideshow.controller.coffee\n */\n\n(function() {\n  var CardSlideshowController;\n\n  CardSlideshowController = (function() {\n    CardSlideshowController.$inject = [];\n\n    function CardSlideshowController() {\n      this.index = 0;\n    }\n\n    CardSlideshowController.prototype.next = function() {\n      this.index++;\n      if (this.index >= this.images.size) {\n        return this.index = 0;\n      }\n    };\n\n    CardSlideshowController.prototype.previous = function() {\n      this.index--;\n      if (this.index < 0) {\n        return this.index = this.images.size - 1;\n      }\n    };\n\n    return CardSlideshowController;\n\n  })();\n\n  angular.module('taigaComponents').controller('CardSlideshow', CardSlideshowController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: card.directive.coffee\n */\n\n(function() {\n  var cardSlideshowDirective, module;\n\n  module = angular.module(\"taigaComponents\");\n\n  cardSlideshowDirective = function() {\n    return {\n      controller: \"CardSlideshow\",\n      templateUrl: \"components/card-slideshow/card-slideshow.html\",\n      bindToController: true,\n      controllerAs: \"vm\",\n      scope: {\n        images: \"=\"\n      }\n    };\n  };\n\n  module.directive('tgCardSlideshow', cardSlideshowDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: card.controller.coffee\n */\n\n(function() {\n  var CardController;\n\n  CardController = (function() {\n    function CardController() {}\n\n    CardController.$inject = [];\n\n    CardController.prototype.visible = function(name) {\n      return this.zoom.indexOf(name) !== -1;\n    };\n\n    CardController.prototype.toggleFold = function() {\n      return this.onToggleFold({\n        id: this.item.get('id')\n      });\n    };\n\n    CardController.prototype.getClosedTasks = function() {\n      return this.item.getIn(['model', 'tasks']).filter(function(task) {\n        return task.get('is_closed');\n      });\n    };\n\n    CardController.prototype.closedTasksPercent = function() {\n      return this.getClosedTasks().size * 100 / this.item.getIn(['model', 'tasks']).size;\n    };\n\n    CardController.prototype.getPermissionsKey = function() {\n      if (this.type === 'task') {\n        return 'modify_task';\n      } else {\n        return 'modify_us';\n      }\n    };\n\n    CardController.prototype._setVisibility = function() {\n      var visibility;\n      visibility = {\n        related: this.visible('related_tasks'),\n        slides: this.visible('attachments')\n      };\n      if (!_.isUndefined(this.item.get('foldStatusChanged'))) {\n        if (this.visible('related_tasks') && this.visible('attachments')) {\n          visibility.related = !this.item.get('foldStatusChanged');\n          visibility.slides = !this.item.get('foldStatusChanged');\n        } else if (this.visible('attachments')) {\n          visibility.related = this.item.get('foldStatusChanged');\n          visibility.slides = this.item.get('foldStatusChanged');\n        } else if (!this.visible('related_tasks') && !this.visible('attachments')) {\n          visibility.related = this.item.get('foldStatusChanged');\n          visibility.slides = this.item.get('foldStatusChanged');\n        }\n      }\n      if (!this.item.getIn(['model', 'tasks']) || !this.item.getIn(['model', 'tasks']).size) {\n        visibility.related = false;\n      }\n      if (!this.item.get('images') || !this.item.get('images').size) {\n        visibility.slides = false;\n      }\n      return visibility;\n    };\n\n    CardController.prototype.isRelatedTasksVisible = function() {\n      var visibility;\n      visibility = this._setVisibility();\n      return visibility.related;\n    };\n\n    CardController.prototype.isSlideshowVisible = function() {\n      var visibility;\n      visibility = this._setVisibility();\n      return visibility.slides;\n    };\n\n    CardController.prototype.getNavKey = function() {\n      if (this.type === 'task') {\n        return 'project-tasks-detail';\n      } else {\n        return 'project-userstories-detail';\n      }\n    };\n\n    return CardController;\n\n  })();\n\n  angular.module('taigaComponents').controller('Card', CardController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: card.directive.coffee\n */\n\n(function() {\n  var cardDirective, module;\n\n  module = angular.module(\"taigaComponents\");\n\n  cardDirective = function() {\n    return {\n      link: function(scope) {},\n      controller: \"Card\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"components/card/card.html\",\n      scope: {\n        onToggleFold: \"&\",\n        onClickAssignedTo: \"&\",\n        onClickEdit: \"&\",\n        project: \"=\",\n        item: \"=\",\n        zoom: \"=\",\n        zoomLevel: \"=\",\n        archived: \"=\",\n        type: \"@\"\n      }\n    };\n  };\n\n  module.directive('tgCard', cardDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: color-selector.controller.coffee\n */\n\n(function() {\n  var ColorSelectorController, getDefaulColorList, taiga;\n\n  taiga = this.taiga;\n\n  getDefaulColorList = taiga.getDefaulColorList;\n\n  ColorSelectorController = (function() {\n    ColorSelectorController.$inject = [\"tgProjectService\"];\n\n    function ColorSelectorController(projectService) {\n      this.projectService = projectService;\n      this.colorList = getDefaulColorList();\n      this.checkIsColorRequired();\n      this.displayColorList = false;\n    }\n\n    ColorSelectorController.prototype.userCanChangeColor = function() {\n      if (!this.requiredPerm) {\n        return true;\n      }\n      return this.projectService.hasPermission(this.requiredPerm);\n    };\n\n    ColorSelectorController.prototype.checkIsColorRequired = function() {\n      if (!this.isColorRequired) {\n        return this.colorList = _.dropRight(this.colorList);\n      }\n    };\n\n    ColorSelectorController.prototype.setColor = function(color) {\n      return this.color = this.initColor;\n    };\n\n    ColorSelectorController.prototype.resetColor = function() {\n      if (this.isColorRequired && !this.color) {\n        return this.color = this.initColor;\n      }\n    };\n\n    ColorSelectorController.prototype.toggleColorList = function() {\n      this.displayColorList = !this.displayColorList;\n      return this.resetColor();\n    };\n\n    ColorSelectorController.prototype.onSelectDropdownColor = function(color) {\n      this.color = color;\n      this.onSelectColor({\n        color: color\n      });\n      return this.toggleColorList();\n    };\n\n    ColorSelectorController.prototype.onKeyDown = function(event) {\n      if (event.which === 13) {\n        if (this.color || !this.isColorRequired) {\n          this.onSelectDropdownColor(this.color);\n        }\n        return event.preventDefault();\n      }\n    };\n\n    return ColorSelectorController;\n\n  })();\n\n  angular.module('taigaComponents').controller(\"ColorSelectorCtrl\", ColorSelectorController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: color-selector.directive.coffee\n */\n\n(function() {\n  var ColorSelectorDirective, bindOnce;\n\n  bindOnce = this.taiga.bindOnce;\n\n  ColorSelectorDirective = function($timeout) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var _timeout, cancel, close;\n      _timeout = null;\n      cancel = function() {\n        $timeout.cancel(_timeout);\n        return _timeout = null;\n      };\n      close = function() {\n        if (_timeout) {\n          return;\n        }\n        return _timeout = $timeout((function() {\n          ctrl.displayColorList = false;\n          return ctrl.resetColor();\n        }), 400);\n      };\n      el.find('.color-selector').mouseenter(cancel).mouseleave(close);\n      el.find('.color-selector-dropdown').mouseenter(cancel).mouseleave(close);\n      return scope.$watch('vm.initColor', function(color) {\n        return ctrl.setColor(color);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"components/color-selector/color-selector.html\",\n      controller: \"ColorSelectorCtrl\",\n      controllerAs: \"vm\",\n      bindToController: {\n        isColorRequired: \"=\",\n        onSelectColor: \"&\",\n        initColor: \"=\",\n        requiredPerm: \"@\"\n      },\n      scope: {}\n    };\n  };\n\n  ColorSelectorDirective.$inject = [\"$timeout\"];\n\n  angular.module('taigaComponents').directive(\"tgColorSelector\", ColorSelectorDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: story-header.controller.coffee\n */\n\n(function() {\n  var StoryHeaderController, module;\n\n  module = angular.module(\"taigaUserStories\");\n\n  StoryHeaderController = (function() {\n    StoryHeaderController.$inject = [\"$rootScope\", \"$tgConfirm\", \"$tgQueueModelTransformation\", \"$tgNavUrls\", \"$window\"];\n\n    function StoryHeaderController(rootScope, confirm, modelTransform, navUrls, window) {\n      this.rootScope = rootScope;\n      this.confirm = confirm;\n      this.modelTransform = modelTransform;\n      this.navUrls = navUrls;\n      this.window = window;\n      this.editMode = false;\n      this.loadingSubject = false;\n      this.originalSubject = this.item.subject;\n    }\n\n    StoryHeaderController.prototype._checkNav = function() {\n      var ctx, ref, ref1;\n      if (((ref = this.item.neighbors.previous) != null ? ref.ref : void 0) != null) {\n        ctx = {\n          project: this.project.slug,\n          ref: this.item.neighbors.previous.ref\n        };\n        this.previousUrl = this.navUrls.resolve(\"project-\" + this.item._name + \"-detail\", ctx);\n      }\n      if (((ref1 = this.item.neighbors.next) != null ? ref1.ref : void 0) != null) {\n        ctx = {\n          project: this.project.slug,\n          ref: this.item.neighbors.next.ref\n        };\n        return this.nextUrl = this.navUrls.resolve(\"project-\" + this.item._name + \"-detail\", ctx);\n      }\n    };\n\n    StoryHeaderController.prototype._checkPermissions = function() {\n      return this.permissions = {\n        canEdit: _.includes(this.project.my_permissions, this.requiredPerm)\n      };\n    };\n\n    StoryHeaderController.prototype.editSubject = function(value) {\n      var selection;\n      selection = this.window.getSelection();\n      if (selection.type !== \"Range\") {\n        if (value) {\n          this.editMode = true;\n        }\n        if (!value) {\n          return this.editMode = false;\n        }\n      }\n    };\n\n    StoryHeaderController.prototype.onKeyDown = function(event) {\n      if (event.which === 13) {\n        this.saveSubject();\n      }\n      if (event.which === 27) {\n        this.item.subject = this.originalSubject;\n        return this.editSubject(false);\n      }\n    };\n\n    StoryHeaderController.prototype.saveSubject = function() {\n      var item, onEditSubjectError, onEditSubjectSuccess, transform;\n      onEditSubjectSuccess = (function(_this) {\n        return function() {\n          _this.loadingSubject = false;\n          _this.rootScope.$broadcast(\"object:updated\");\n          _this.confirm.notify('success');\n          return _this.originalSubject = _this.item.subject;\n        };\n      })(this);\n      onEditSubjectError = (function(_this) {\n        return function() {\n          _this.loadingSubject = false;\n          return _this.confirm.notify('error');\n        };\n      })(this);\n      this.editMode = false;\n      this.loadingSubject = true;\n      item = this.item;\n      transform = this.modelTransform.save(function(item) {\n        return item;\n      });\n      return transform.then(onEditSubjectSuccess, onEditSubjectError);\n    };\n\n    return StoryHeaderController;\n\n  })();\n\n  module.controller(\"StoryHeaderCtrl\", StoryHeaderController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: story-header.directive.coffee\n */\n\n(function() {\n  var DetailHeaderDirective, module;\n\n  module = angular.module('taigaUserStories');\n\n  DetailHeaderDirective = function() {\n    var link;\n    this.$inject = [];\n    link = function(scope, el, attrs, ctrl) {\n      ctrl._checkPermissions();\n      return ctrl._checkNav();\n    };\n    return {\n      link: link,\n      controller: \"StoryHeaderCtrl\",\n      bindToController: true,\n      scope: {\n        item: \"=\",\n        project: \"=\",\n        requiredPerm: \"@\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"components/detail/header/detail-header.html\"\n    };\n  };\n\n  module.directive(\"tgDetailHeader\", DetailHeaderDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: file-change.directive.coffee\n */\n\n(function() {\n  var FileChangeDirective;\n\n  FileChangeDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var eventAttr;\n      eventAttr = $parse(attrs.tgFileChange);\n      el.on('change', function(event) {\n        return scope.$apply(function() {\n          return eventAttr(scope, {\n            files: event.currentTarget.files\n          });\n        });\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      require: \"ngModel\",\n      restrict: \"A\",\n      link: link\n    };\n  };\n\n  FileChangeDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgFileChange\", FileChangeDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: filter-utils.service.coffee\n */\n\n(function() {\n  var FilterRemoteStorageService, generateHash,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  generateHash = taiga.generateHash;\n\n  FilterRemoteStorageService = (function(superClass) {\n    extend(FilterRemoteStorageService, superClass);\n\n    FilterRemoteStorageService.$inject = [\"$q\", \"$tgUrls\", \"$tgHttp\"];\n\n    function FilterRemoteStorageService(q, urls, http) {\n      this.q = q;\n      this.urls = urls;\n      this.http = http;\n    }\n\n    FilterRemoteStorageService.prototype.storeFilters = function(projectId, myFilters, filtersHashSuffix) {\n      var deferred, hash, ns, promise, url;\n      deferred = this.q.defer();\n      url = this.urls.resolve(\"user-storage\");\n      ns = projectId + \":\" + filtersHashSuffix;\n      hash = generateHash([projectId, ns]);\n      if (_.isEmpty(myFilters)) {\n        promise = this.http[\"delete\"](url + \"/\" + hash, {\n          key: hash,\n          value: myFilters\n        });\n        promise.then(function() {\n          return deferred.resolve();\n        });\n        promise.then(null, function() {\n          return deferred.reject();\n        });\n      } else {\n        promise = this.http.put(url + \"/\" + hash, {\n          key: hash,\n          value: myFilters\n        });\n        promise.then(function(data) {\n          return deferred.resolve();\n        });\n        promise.then(null, (function(_this) {\n          return function(data) {\n            var innerPromise;\n            innerPromise = _this.http.post(\"\" + url, {\n              key: hash,\n              value: myFilters\n            });\n            innerPromise.then(function() {\n              return deferred.resolve();\n            });\n            return innerPromise.then(null, function() {\n              return deferred.reject();\n            });\n          };\n        })(this));\n      }\n      return deferred.promise;\n    };\n\n    FilterRemoteStorageService.prototype.getFilters = function(projectId, filtersHashSuffix) {\n      var deferred, hash, ns, promise, url;\n      deferred = this.q.defer();\n      url = this.urls.resolve(\"user-storage\");\n      ns = projectId + \":\" + filtersHashSuffix;\n      hash = generateHash([projectId, ns]);\n      promise = this.http.get(url + \"/\" + hash);\n      promise.then(function(data) {\n        return deferred.resolve(data.data.value);\n      });\n      promise.then(null, function(data) {\n        return deferred.resolve({});\n      });\n      return deferred.promise;\n    };\n\n    return FilterRemoteStorageService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgFilterRemoteStorageService\", FilterRemoteStorageService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: filter.-slide-down.controller.coffee\n */\n\n(function() {\n  var FilterSlideDownDirective;\n\n  FilterSlideDownDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var filter;\n      filter = $('tg-filter');\n      return scope.$watch(attrs.ngIf, function(value) {\n        var contentHeight, wrapperHeight;\n        if (value) {\n          filter.find('.filter-list').hide();\n          wrapperHeight = filter.height();\n          contentHeight = 0;\n          filter.children().each(function() {\n            return contentHeight += $(this).outerHeight(true);\n          });\n          return $(el.context.nextSibling).css({\n            \"max-height\": wrapperHeight - contentHeight,\n            \"display\": \"block\"\n          });\n        }\n      });\n    };\n    return {\n      priority: 900,\n      link: link\n    };\n  };\n\n  angular.module('taigaComponents').directive(\"tgFilterSlideDown\", [FilterSlideDownDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: filter.controller.coffee\n */\n\n(function() {\n  var FilterController;\n\n  FilterController = (function() {\n    FilterController.$inject = [];\n\n    function FilterController() {\n      this.opened = null;\n      this.customFilterForm = false;\n      this.customFilterName = '';\n    }\n\n    FilterController.prototype.toggleFilterCategory = function(filterName) {\n      if (this.opened === filterName) {\n        return this.opened = null;\n      } else {\n        return this.opened = filterName;\n      }\n    };\n\n    FilterController.prototype.isOpen = function(filterName) {\n      return this.opened === filterName;\n    };\n\n    FilterController.prototype.saveCustomFilter = function() {\n      this.onSaveCustomFilter({\n        name: this.customFilterName\n      });\n      this.customFilterForm = false;\n      this.opened = 'custom-filter';\n      return this.customFilterName = '';\n    };\n\n    FilterController.prototype.changeQ = function() {\n      return this.onChangeQ({\n        q: this.q\n      });\n    };\n\n    FilterController.prototype.unselectFilter = function(filter) {\n      return this.onRemoveFilter({\n        filter: filter\n      });\n    };\n\n    FilterController.prototype.unselectFilter = function(filter) {\n      return this.onRemoveFilter({\n        filter: filter\n      });\n    };\n\n    FilterController.prototype.selectFilter = function(filterCategory, filter) {\n      filter = {\n        category: filterCategory,\n        filter: filter\n      };\n      return this.onAddFilter({\n        filter: filter\n      });\n    };\n\n    FilterController.prototype.removeCustomFilter = function(filter) {\n      return this.onRemoveCustomFilter({\n        filter: filter\n      });\n    };\n\n    FilterController.prototype.selectCustomFilter = function(filter) {\n      return this.onSelectCustomFilter({\n        filter: filter\n      });\n    };\n\n    FilterController.prototype.isFilterSelected = function(filterCategory, filter) {\n      return !!_.find(this.selectedFilters, function(it) {\n        return filter.id === it.id && filterCategory.dataType === it.dataType;\n      });\n    };\n\n    return FilterController;\n\n  })();\n\n  angular.module('taigaComponents').controller('Filter', FilterController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: filter.directive.coffee\n */\n\n(function() {\n  var FilterDirective;\n\n  FilterDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {\n        onChangeQ: \"&\",\n        onAddFilter: \"&\",\n        onSelectCustomFilter: \"&\",\n        onRemoveFilter: \"&\",\n        onRemoveCustomFilter: \"&\",\n        onSaveCustomFilter: \"&\",\n        customFilters: \"<\",\n        q: \"<\",\n        filters: \"<\",\n        customFilters: \"<\",\n        selectedFilters: \"<\"\n      },\n      bindToController: true,\n      controller: \"Filter\",\n      controllerAs: \"vm\",\n      templateUrl: 'components/filter/filter.html',\n      link: link\n    };\n  };\n\n  angular.module('taigaComponents').directive(\"tgFilter\", [FilterDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: joy-ride.directive.coffee\n */\n\n(function() {\n  var JoyRideDirective, taiga;\n\n  taiga = this.taiga;\n\n  JoyRideDirective = function($rootScope, currentUserService, joyRideService, $location, $translate) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var initJoyrRide, intro, unsuscribe;\n      unsuscribe = null;\n      intro = introJs();\n      intro.oncomplete(function() {\n        return $('html,body').scrollTop(0);\n      });\n      intro.onexit(function() {\n        return currentUserService.disableJoyRide();\n      });\n      initJoyrRide = function(next, config) {\n        if (!config[next.joyride]) {\n          return;\n        }\n        intro.setOptions({\n          exitOnEsc: false,\n          exitOnOverlayClick: false,\n          showStepNumbers: false,\n          nextLabel: $translate.instant('JOYRIDE.NAV.NEXT') + ' &rarr;',\n          prevLabel: '&larr; ' + $translate.instant('JOYRIDE.NAV.BACK'),\n          skipLabel: $translate.instant('JOYRIDE.NAV.SKIP'),\n          doneLabel: $translate.instant('JOYRIDE.NAV.DONE'),\n          disableInteraction: true\n        });\n        intro.setOption('steps', joyRideService.get(next.joyride));\n        return intro.start();\n      };\n      return $rootScope.$on('$routeChangeSuccess', function(event, next) {\n        if (!next.joyride || !currentUserService.isAuthenticated()) {\n          intro.exit();\n          if (unsuscribe) {\n            unsuscribe();\n          }\n          return;\n        }\n        intro.oncomplete(function() {\n          return currentUserService.disableJoyRide(next.joyride);\n        });\n        if (next.loader) {\n          return unsuscribe = $rootScope.$on('loader:end', function() {\n            currentUserService.loadJoyRideConfig().then(function(config) {\n              return initJoyrRide(next, config);\n            });\n            return unsuscribe();\n          });\n        } else {\n          return currentUserService.loadJoyRideConfig().then(function(config) {\n            return initJoyrRide(next, config);\n          });\n        }\n      });\n    };\n    return {\n      scope: {},\n      link: link\n    };\n  };\n\n  JoyRideDirective.$inject = [\"$rootScope\", \"tgCurrentUserService\", \"tgJoyRideService\", \"$location\", \"$translate\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgJoyRide\", JoyRideDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: joy-ride.service.coffee\n */\n\n(function() {\n  var JoyRideService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  JoyRideService = (function(superClass) {\n    extend(JoyRideService, superClass);\n\n    JoyRideService.$inject = ['$translate', 'tgCheckPermissionsService'];\n\n    function JoyRideService(translate, checkPermissionsService) {\n      this.translate = translate;\n      this.checkPermissionsService = checkPermissionsService;\n    }\n\n    JoyRideService.prototype.getConfig = function() {\n      return {\n        dashboard: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.project-list > section:not(.ng-hide)',\n                position: 'left',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP1.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.DASHBOARD.STEP1.TEXT')\n                }\n              }, {\n                element: '.working-on-container',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.DASHBOARD.STEP2.TEXT')\n                }\n              }, {\n                element: '.watching-container',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TEXT1'), _this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TEXT2')]\n                }\n              }\n            ];\n            if (!$('.project-list .create-project-button').is(':hidden')) {\n              steps.push({\n                element: '.project-list .create-project-button',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TEXT1'), _this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TEXT2')]\n                }\n              });\n            }\n            return steps;\n          };\n        })(this),\n        backlog: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.summary',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP1.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.BACKLOG.STEP1.TEXT1'), _this.translate.instant('JOYRIDE.BACKLOG.STEP1.TEXT2')]\n                }\n              }, {\n                element: '.backlog-table-empty',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP2.TEXT')\n                }\n              }, {\n                element: '.sprints',\n                position: 'left',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP3.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP3.TEXT')\n                }\n              }\n            ];\n            if (_this.checkPermissionsService.check('add_us')) {\n              steps.push({\n                element: '.new-us',\n                position: 'rigth',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP4.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP4.TEXT')\n                }\n              });\n            }\n            return steps;\n          };\n        })(this),\n        kanban: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.kanban-table-inner',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP1.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.KANBAN.STEP1.TEXT')\n                }\n              }, {\n                element: '.card-placeholder',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.KANBAN.STEP2.TEXT')\n                }\n              }\n            ];\n            if (_this.checkPermissionsService.check('add_us')) {\n              steps.push({\n                element: '.add-action',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP3.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.KANBAN.STEP3.TEXT1'), _this.translate.instant('JOYRIDE.KANBAN.STEP3.TEXT2')]\n                }\n              });\n            }\n            return steps;\n          };\n        })(this)\n      };\n    };\n\n    JoyRideService.prototype.get = function(name) {\n      var joyRide, joyRides;\n      joyRides = this.getConfig();\n      joyRide = joyRides[name].call(this);\n      return _.map(joyRide, function(item) {\n        var html;\n        html = \"\";\n        if (item.joyride.title) {\n          html += \"<h3>\" + item.joyride.title + \"</h3>\";\n        }\n        if (_.isArray(item.joyride.text)) {\n          _.forEach(item.joyride.text, function(text) {\n            return html += \"<p>\" + text + \"</p>\";\n          });\n        } else {\n          html += \"<p>\" + item.joyride.text + \"</p>\";\n        }\n        item.intro = html;\n        return item;\n      });\n    };\n\n    return JoyRideService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgJoyRideService\", JoyRideService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: kanban-board-zoom.directive.coffee\n */\n\n(function() {\n  var KanbanBoardZoomDirective;\n\n  KanbanBoardZoomDirective = function(storage, projectService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var getZoomView, unwatch, zooms;\n      scope.zoomIndex = storage.get(\"kanban_zoom\") || 2;\n      scope.levels = 5;\n      zooms = [[\"ref\"], [\"subject\"], [\"owner\", \"tags\", \"extra_info\", \"unfold\"], [\"attachments\"], [\"related_tasks\"]];\n      getZoomView = function(zoomIndex) {\n        if (zoomIndex == null) {\n          zoomIndex = 0;\n        }\n        if (storage.get(\"kanban_zoom\") !== zoomIndex) {\n          storage.set(\"kanban_zoom\", zoomIndex);\n        }\n        return _.reduce(zooms, function(result, value, key) {\n          if (key <= zoomIndex) {\n            result = result.concat(value);\n          }\n          return result;\n        });\n      };\n      scope.$watch('zoomIndex', function(zoomLevel) {\n        var zoom;\n        zoom = getZoomView(zoomLevel);\n        return scope.onZoomChange({\n          zoomLevel: zoomLevel,\n          zoom: zoom\n        });\n      });\n      return unwatch = scope.$watch(function() {\n        return projectService.project;\n      }, function(project) {\n        if (project) {\n          if (project.get('my_permissions').indexOf(\"view_tasks\") === -1) {\n            scope.levels = 4;\n          }\n          return unwatch();\n        }\n      });\n    };\n    return {\n      scope: {\n        onZoomChange: \"&\"\n      },\n      template: \"<tg-board-zoom\\n    class=\\\"board-zoom\\\"\\n    value=\\\"zoomIndex\\\"\\n    levels=\\\"levels\\\"\\n></tg-board-zoom>\",\n      link: link\n    };\n  };\n\n  angular.module('taigaComponents').directive(\"tgKanbanBoardZoom\", [\"$tgStorage\", \"tgProjectService\", KanbanBoardZoomDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2015 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2015 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: live-announcement.directive.coffee\n */\n\n(function() {\n  var LiveAnnouncementDirective;\n\n  LiveAnnouncementDirective = function(liveAnnouncementService) {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      restrict: \"AE\",\n      scope: {},\n      controllerAs: 'vm',\n      controller: function() {\n        this.close = function() {\n          return liveAnnouncementService.open = false;\n        };\n        return Object.defineProperties(this, {\n          open: {\n            get: function() {\n              return liveAnnouncementService.open;\n            }\n          },\n          title: {\n            get: function() {\n              return liveAnnouncementService.title;\n            }\n          },\n          desc: {\n            get: function() {\n              return liveAnnouncementService.desc;\n            }\n          }\n        });\n      },\n      link: link,\n      templateUrl: \"components/live-announcement/live-announcement.html\"\n    };\n  };\n\n  LiveAnnouncementDirective.$inject = [\"tgLiveAnnouncementService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgLiveAnnouncement\", LiveAnnouncementDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: notification.service.coffee\n */\n\n(function() {\n  var LiveAnnouncementService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  LiveAnnouncementService = (function(superClass) {\n    extend(LiveAnnouncementService, superClass);\n\n    function LiveAnnouncementService() {\n      this.open = false;\n      this.title = \"\";\n      this.desc = \"\";\n    }\n\n    LiveAnnouncementService.prototype.show = function(title, desc) {\n      this.open = true;\n      this.title = title;\n      return this.desc = desc;\n    };\n\n    return LiveAnnouncementService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgLiveAnnouncementService\", LiveAnnouncementService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo-big-src.directive.coffee\n */\n\n(function() {\n  var ProjectLogoBigSrcDirective;\n\n  ProjectLogoBigSrcDirective = function(projectLogoService) {\n    var link;\n    link = function(scope, el, attrs) {\n      return scope.$watch('project', function(project) {\n        var logo, projectLogo;\n        project = Immutable.fromJS(project);\n        if (!project) {\n          return;\n        }\n        projectLogo = project.get('logo_big_url');\n        if (projectLogo) {\n          el.attr('src', projectLogo);\n          return el.css('background', \"\");\n        } else {\n          logo = projectLogoService.getDefaultProjectLogo(project.get('slug'), project.get('id'));\n          el.attr('src', logo.src);\n          return el.css('background', logo.color);\n        }\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        project: \"=tgProjectLogoBigSrc\"\n      }\n    };\n  };\n\n  ProjectLogoBigSrcDirective.$inject = [\"tgProjectLogoService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectLogoBigSrc\", ProjectLogoBigSrcDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo-small-src.directive.coffee\n */\n\n(function() {\n  var ProjectLogoSmallSrcDirective;\n\n  ProjectLogoSmallSrcDirective = function(projectLogoService) {\n    var link;\n    link = function(scope, el, attrs) {\n      return scope.$watch('project', function(project) {\n        var logo, projectLogo;\n        project = Immutable.fromJS(project);\n        if (!project) {\n          return;\n        }\n        projectLogo = project.get('logo_small_url');\n        if (projectLogo) {\n          el.attr('src', projectLogo);\n          return el.css('background', \"\");\n        } else {\n          logo = projectLogoService.getDefaultProjectLogo(project.get('slug'), project.get('id'));\n          el.attr('src', logo.src);\n          return el.css('background', logo.color);\n        }\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        project: \"=tgProjectLogoSmallSrc\"\n      }\n    };\n  };\n\n  ProjectLogoSmallSrcDirective.$inject = [\"tgProjectLogoService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectLogoSmallSrc\", ProjectLogoSmallSrcDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-menu.controller.coffee\n */\n\n(function() {\n  var ProjectMenuController;\n\n  ProjectMenuController = (function() {\n    ProjectMenuController.$inject = [\"tgProjectService\", \"tgLightboxFactory\"];\n\n    function ProjectMenuController(projectService, lightboxFactory) {\n      this.projectService = projectService;\n      this.lightboxFactory = lightboxFactory;\n      this.project = null;\n      this.menu = Immutable.Map();\n    }\n\n    ProjectMenuController.prototype.show = function() {\n      this.project = this.projectService.project;\n      this.active = this._getActiveSection();\n      this._setVideoConference();\n      return this._setMenuPermissions();\n    };\n\n    ProjectMenuController.prototype.hide = function() {\n      this.project = null;\n      return this.menu = {};\n    };\n\n    ProjectMenuController.prototype.search = function() {\n      return this.lightboxFactory.create(\"tg-search-box\", {\n        \"class\": \"lightbox lightbox-search\"\n      });\n    };\n\n    ProjectMenuController.prototype._setVideoConference = function() {\n      var videoconferenceUrl;\n      videoconferenceUrl = this._videoConferenceUrl();\n      if (videoconferenceUrl) {\n        return this.project = this.project.set(\"videoconferenceUrl\", videoconferenceUrl);\n      }\n    };\n\n    ProjectMenuController.prototype._setMenuPermissions = function() {\n      this.menu = Immutable.Map({\n        epics: false,\n        backlog: false,\n        kanban: false,\n        issues: false,\n        wiki: false\n      });\n      if (this.project.get(\"is_epics_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_epics\") !== -1) {\n        this.menu = this.menu.set(\"epics\", true);\n      }\n      if (this.project.get(\"is_backlog_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_us\") !== -1) {\n        this.menu = this.menu.set(\"backlog\", true);\n      }\n      if (this.project.get(\"is_kanban_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_us\") !== -1) {\n        this.menu = this.menu.set(\"kanban\", true);\n      }\n      if (this.project.get(\"is_issues_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_issues\") !== -1) {\n        this.menu = this.menu.set(\"issues\", true);\n      }\n      if (this.project.get(\"is_wiki_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_wiki_pages\") !== -1) {\n        return this.menu = this.menu.set(\"wiki\", true);\n      }\n    };\n\n    ProjectMenuController.prototype._getActiveSection = function() {\n      var indexBacklog, indexKanban, oldSectionName, sectionName, sectionsBreadcrumb;\n      sectionName = this.projectService.section;\n      sectionsBreadcrumb = this.projectService.sectionsBreadcrumb;\n      indexBacklog = sectionsBreadcrumb.lastIndexOf(\"backlog\");\n      indexKanban = sectionsBreadcrumb.lastIndexOf(\"kanban\");\n      if (indexBacklog !== -1 || indexKanban !== -1) {\n        if (indexKanban === -1 || indexBacklog > indexKanban) {\n          oldSectionName = \"backlog\";\n        } else {\n          oldSectionName = \"kanban\";\n        }\n      }\n      if (sectionName === \"backlog-kanban\") {\n        if (oldSectionName === \"backlog\" || oldSectionName === \"kanban\") {\n          sectionName = oldSectionName;\n        } else if (this.project.get(\"is_backlog_activated\") && !this.project.get(\"is_kanban_activated\")) {\n          sectionName = \"backlog\";\n        } else if (!this.project.get(\"is_backlog_activated\") && this.project.get(\"is_kanban_activated\")) {\n          sectionName = \"kanban\";\n        }\n      }\n      return sectionName;\n    };\n\n    ProjectMenuController.prototype._videoConferenceUrl = function() {\n      var baseUrl, url;\n      if (this.project.get(\"videoconferences\") === \"appear-in\") {\n        baseUrl = \"https://appear.in/\";\n      } else if (this.project.get(\"videoconferences\") === \"talky\") {\n        baseUrl = \"https://talky.io/\";\n      } else if (this.project.get(\"videoconferences\") === \"jitsi\") {\n        baseUrl = \"https://meet.jit.si/\";\n      } else if (this.project.get(\"videoconferences\") === \"custom\") {\n        return this.project.get(\"videoconferences_extra_data\");\n      } else {\n        return \"\";\n      }\n      if (this.project.get(\"videoconferences_extra_data\")) {\n        url = this.project.get(\"slug\") + \"-\" + taiga.slugify(this.project.get(\"videoconferences_extra_data\"));\n      } else {\n        url = this.project.get(\"slug\");\n      }\n      if (this.project.get(\"videoconferences\") === \"jitsi\") {\n        url = url.replace(/-/g, \"\");\n      }\n      return baseUrl + url;\n    };\n\n    return ProjectMenuController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"ProjectMenu\", ProjectMenuController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-menu.directive.coffee\n */\n\n(function() {\n  var ProjectMenuDirective, taiga;\n\n  taiga = this.taiga;\n\n  ProjectMenuDirective = function(projectService, lightboxFactory) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var projectChange;\n      projectChange = function() {\n        if (projectService.project) {\n          return ctrl.show();\n        } else {\n          return ctrl.hide();\n        }\n      };\n      scope.$watch((function() {\n        return projectService.project;\n      }), projectChange);\n      scope.vm.fixed = false;\n      return $(window).on(\"scroll\", function() {\n        var position;\n        position = $(window).scrollTop();\n        if (position > 100 && scope.vm.fixed === false) {\n          scope.vm.fixed = true;\n          return scope.$digest();\n        } else if (position < 100 && scope.vm.fixed === true) {\n          scope.vm.fixed = false;\n          return scope.$digest();\n        }\n      });\n    };\n    return {\n      scope: {},\n      controller: \"ProjectMenu\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/project-menu/project-menu.html\",\n      link: link\n    };\n  };\n\n  ProjectMenuDirective.$inject = [\"tgProjectService\", \"tgLightboxFactory\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectMenu\", ProjectMenuDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tag-line.directive.coffee\n */\n\n(function() {\n  var TagOptionDirective, module;\n\n  module = angular.module('taigaCommon');\n\n  TagOptionDirective = function() {\n    var dispatch, link, select, stop;\n    select = function(selected) {\n      var containerHeight, diff, selectedPosition;\n      selected.addClass('selected');\n      selectedPosition = selected.position().top + selected.outerHeight();\n      containerHeight = selected.parent().outerHeight();\n      if (selectedPosition > containerHeight) {\n        diff = selectedPosition - containerHeight;\n        return selected.parent().scrollTop(selected.parent().scrollTop() + diff);\n      } else if (selected.position().top < 0) {\n        return selected.parent().scrollTop(selected.parent().scrollTop() + selected.position().top);\n      }\n    };\n    dispatch = function(el, code, scope) {\n      var activeElement, next, prev;\n      activeElement = el.find(\".selected\");\n      if (code === 40) {\n        if (!activeElement.length) {\n          return select(el.find('li:first'));\n        } else {\n          next = activeElement.next('li');\n          if (next.length) {\n            activeElement.removeClass('selected');\n            return select(next);\n          }\n        }\n      } else if (code === 38) {\n        if (!activeElement.length) {\n          return select(el.find('li:last'));\n        } else {\n          prev = activeElement.prev('li');\n          if (prev.length) {\n            activeElement.removeClass('selected');\n            return select(prev);\n          }\n        }\n      }\n    };\n    stop = function() {\n      return $(document).off(\".tags-keyboard-navigation\");\n    };\n    link = function(scope, el) {\n      stop();\n      $(document).on(\"keydown.tags-keyboard-navigation\", (function(_this) {\n        return function(event) {\n          var code;\n          code = event.keyCode ? event.keyCode : event.which;\n          if (code === 40 || code === 38) {\n            event.preventDefault();\n            return dispatch(el, code, scope);\n          }\n        };\n      })(this));\n      return scope.$on(\"$destroy\", stop);\n    };\n    return {\n      link: link,\n      templateUrl: \"components/tags/tag-dropdown/tag-dropdown.html\",\n      scope: {\n        onSelectTag: \"&\",\n        colorArray: \"=\",\n        tag: \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgTagsDropdown\", TagOptionDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tag-line.controller.coffee\n */\n\n(function() {\n  var TagLineCommonController, module, trim;\n\n  trim = this.taiga.trim;\n\n  module = angular.module('taigaCommon');\n\n  TagLineCommonController = (function() {\n    TagLineCommonController.$inject = [\"tgTagLineService\"];\n\n    function TagLineCommonController(tagLineService) {\n      this.tagLineService = tagLineService;\n      this.disableColorSelection = false;\n      this.newTag = {\n        name: \"\",\n        color: null\n      };\n      this.colorArray = [];\n      this.addTag = false;\n    }\n\n    TagLineCommonController.prototype.checkPermissions = function() {\n      return this.tagLineService.checkPermissions(this.project.my_permissions, this.permissions);\n    };\n\n    TagLineCommonController.prototype._createColorsArray = function(projectTagColors) {\n      return this.colorArray = this.tagLineService.createColorsArray(projectTagColors);\n    };\n\n    TagLineCommonController.prototype.displayTagInput = function() {\n      return this.addTag = true;\n    };\n\n    TagLineCommonController.prototype.addNewTag = function(name, color) {\n      this.newTag.name = \"\";\n      this.newTag.color = null;\n      if (!name.length) {\n        return;\n      }\n      if (this.disableColorSelection) {\n        if (name.length) {\n          return this.onAddTag({\n            name: name,\n            color: color\n          });\n        }\n      } else {\n        if (this.project.tags_colors[name]) {\n          color = this.project.tags_colors[name];\n        }\n        return this.onAddTag({\n          name: name,\n          color: color\n        });\n      }\n    };\n\n    TagLineCommonController.prototype.selectColor = function(color) {\n      return this.newTag.color = color;\n    };\n\n    return TagLineCommonController;\n\n  })();\n\n  module.controller(\"TagLineCommonCtrl\", TagLineCommonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tag-line.directive.coffee\n */\n\n(function() {\n  var TagLineCommonDirective, module;\n\n  module = angular.module('taigaCommon');\n\n  TagLineCommonDirective = function() {\n    var link;\n    link = function(scope, el, attr, ctrl) {\n      var unwatch;\n      if (!_.isUndefined(attr.disableColorSelection)) {\n        ctrl.disableColorSelection = true;\n      }\n      unwatch = scope.$watch(\"vm.project\", function(project) {\n        if (!project || !Object.keys(project).length) {\n          return;\n        }\n        unwatch();\n        if (!ctrl.disableColorSelection) {\n          return ctrl.colorArray = ctrl._createColorsArray(ctrl.project.tags_colors);\n        }\n      });\n      return el.on(\"keydown\", \".tag-input\", function(event) {\n        var tagName;\n        if (event.keyCode === 27) {\n          ctrl.addTag = false;\n          ctrl.newTag.name = \"\";\n          ctrl.newTag.color = \"\";\n          event.stopPropagation();\n        } else if (event.keyCode === 13) {\n          event.preventDefault();\n          if (el.find('.tags-dropdown .selected').length) {\n            tagName = $('.tags-dropdown .selected .tags-dropdown-name').text();\n            ctrl.addNewTag(tagName, null);\n          } else {\n            ctrl.addNewTag(ctrl.newTag.name, ctrl.newTag.color);\n          }\n        }\n        return scope.$apply();\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        permissions: \"@\",\n        loadingAddTag: \"=\",\n        loadingRemoveTag: \"=\",\n        tags: \"=\",\n        project: \"=\",\n        onAddTag: \"&\",\n        onDeleteTag: \"&\"\n      },\n      templateUrl: \"components/tags/tag-line-common/tag-line-common.html\",\n      controller: \"TagLineCommonCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true\n    };\n  };\n\n  module.directive(\"tgTagLineCommon\", TagLineCommonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tag-line.controller.coffee\n */\n\n(function() {\n  var TagLineController, module, trim;\n\n  trim = this.taiga.trim;\n\n  module = angular.module('taigaCommon');\n\n  TagLineController = (function() {\n    TagLineController.$inject = [\"$rootScope\", \"$tgConfirm\", \"$tgQueueModelTransformation\"];\n\n    function TagLineController(rootScope, confirm, modelTransform) {\n      this.rootScope = rootScope;\n      this.confirm = confirm;\n      this.modelTransform = modelTransform;\n      this.loadingAddTag = false;\n    }\n\n    TagLineController.prototype.onDeleteTag = function(tag) {\n      var onDeleteTagError, onDeleteTagSuccess, tagName, transform;\n      this.loadingRemoveTag = tag[0];\n      onDeleteTagSuccess = (function(_this) {\n        return function(item) {\n          _this.rootScope.$broadcast(\"object:updated\");\n          _this.loadingRemoveTag = false;\n          return item;\n        };\n      })(this);\n      onDeleteTagError = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"error\");\n          return _this.loadingRemoveTag = false;\n        };\n      })(this);\n      tagName = trim(tag[0].toLowerCase());\n      transform = this.modelTransform.save(function(item) {\n        var itemtags;\n        itemtags = _.clone(item.tags);\n        _.remove(itemtags, function(tag) {\n          return tag[0] === tagName;\n        });\n        item.tags = itemtags;\n        return item;\n      });\n      return transform.then(onDeleteTagSuccess, onDeleteTagError);\n    };\n\n    TagLineController.prototype.onAddTag = function(tag, color) {\n      var onAddTagError, onAddTagSuccess, transform;\n      this.loadingAddTag = true;\n      onAddTagSuccess = (function(_this) {\n        return function(item) {\n          _this.rootScope.$broadcast(\"object:updated\");\n          _this.addTag = false;\n          _this.loadingAddTag = false;\n          return item;\n        };\n      })(this);\n      onAddTagError = (function(_this) {\n        return function() {\n          _this.loadingAddTag = false;\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      transform = this.modelTransform.save((function(_this) {\n        return function(item) {\n          var itemtags, value;\n          value = trim(tag.toLowerCase());\n          itemtags = _.clone(item.tags);\n          itemtags.push([tag, color]);\n          item.tags = itemtags;\n          return item;\n        };\n      })(this));\n      return transform.then(onAddTagSuccess, onAddTagError);\n    };\n\n    return TagLineController;\n\n  })();\n\n  module.controller(\"TagLineCtrl\", TagLineController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tag-line.directive.coffee\n */\n\n(function() {\n  var TagLineDirective, module;\n\n  module = angular.module('taigaCommon');\n\n  TagLineDirective = function() {\n    return {\n      scope: {\n        item: \"=\",\n        permissions: \"@\",\n        project: \"=\"\n      },\n      templateUrl: \"components/tags/tag-line-detail/tag-line-detail.html\",\n      controller: \"TagLineCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true\n    };\n  };\n\n  module.directive(\"tgTagLine\", TagLineDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tag-line.service.coffee\n */\n\n(function() {\n  var TagLineService, module,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  module = angular.module('taigaCommon');\n\n  TagLineService = (function(superClass) {\n    extend(TagLineService, superClass);\n\n    TagLineService.$inject = [];\n\n    function TagLineService() {}\n\n    TagLineService.prototype.checkPermissions = function(myPermissions, projectPermissions) {\n      return _.includes(myPermissions, projectPermissions);\n    };\n\n    TagLineService.prototype.createColorsArray = function(projectTagColors) {\n      return _.map(projectTagColors, function(index, value) {\n        return [value, index];\n      });\n    };\n\n    return TagLineService;\n\n  })(taiga.Service);\n\n  module.service(\"tgTagLineService\", TagLineService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tag-line.directive.coffee\n */\n\n(function() {\n  var TagDirective, module;\n\n  module = angular.module('taigaCommon');\n\n  TagDirective = function() {\n    return {\n      templateUrl: \"components/tags/tag/tag.html\",\n      scope: {\n        tag: \"<\",\n        loadingRemoveTag: \"<\",\n        onDeleteTag: \"&\",\n        hasPermissions: \"@\"\n      }\n    };\n  };\n\n  module.directive(\"tgTag\", TagDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: taskboard-zoom.directive.coffee\n */\n\n(function() {\n  var TaskboardZoomDirective;\n\n  TaskboardZoomDirective = function(storage) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var getZoomView, zooms;\n      scope.zoomIndex = storage.get(\"taskboard_zoom\") || 2;\n      scope.levels = 4;\n      zooms = [[\"ref\"], [\"subject\"], [\"owner\", \"tags\", \"extra_info\", \"unfold\"], [\"attachments\"], [\"related_tasks\"]];\n      getZoomView = function(zoomIndex) {\n        if (zoomIndex == null) {\n          zoomIndex = 0;\n        }\n        if (storage.get(\"taskboard_zoom\") !== zoomIndex) {\n          storage.set(\"taskboard_zoom\", zoomIndex);\n        }\n        return _.reduce(zooms, function(result, value, key) {\n          if (key <= zoomIndex) {\n            result = result.concat(value);\n          }\n          return result;\n        });\n      };\n      return scope.$watch('zoomIndex', function(zoomLevel) {\n        var zoom;\n        zoom = getZoomView(zoomLevel);\n        return scope.onZoomChange({\n          zoomLevel: zoomLevel,\n          zoom: zoom\n        });\n      });\n    };\n    return {\n      scope: {\n        onZoomChange: \"&\"\n      },\n      template: \"<tg-board-zoom\\n    levels=\\\"levels\\\"\\n    class=\\\"board-zoom\\\"\\n    value=\\\"zoomIndex\\\"\\n></tg-board-zoom>\",\n      link: link\n    };\n  };\n\n  angular.module('taigaComponents').directive(\"tgTaskboardZoom\", [\"$tgStorage\", TaskboardZoomDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.directive.coffee\n */\n\n(function() {\n  var TermsOfServiceAndPrivacyPolicyNoticeDirective;\n\n  TermsOfServiceAndPrivacyPolicyNoticeDirective = function($config) {\n    var link;\n    link = function(scope, el, attrs) {\n      scope.privacyPolicyUrl = $config.get(\"privacyPolicyUrl\");\n      return scope.termsOfServiceUrl = $config.get(\"termsOfServiceUrl\");\n    };\n    return {\n      restrict: \"AE\",\n      scope: {},\n      link: link,\n      templateUrl: \"components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgTermsOfServiceAndPrivacyPolicyNotice\", [\"$tgConfig\", TermsOfServiceAndPrivacyPolicyNoticeDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tribe-button.directive.coffee\n */\n\n(function() {\n  var TribeButtonDirective;\n\n  TribeButtonDirective = function(configService, locationService) {\n    var link;\n    link = function(scope, el, attrs) {\n      scope.vm = {};\n      scope.vm.tribeHost = configService.config.tribeHost;\n      scope.vm.url = (locationService.protocol()) + \"://\" + (locationService.host());\n      if (locationService.protocol() === \"http\" && locationService.port() !== 80) {\n        return scope.vm.url = scope.vm.url + \":\" + (locationService.port());\n      } else if (locationService.protocol() === \"https\" && locationService.port() !== 443) {\n        return scope.vm.url = scope.vm.url + \":\" + (locationService.port());\n      }\n    };\n    return {\n      scope: {\n        usId: \"=\",\n        projectSlug: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"components/tribe-button/tribe-button.html\",\n      link: link\n    };\n  };\n\n  TribeButtonDirective.$inject = [\"$tgConfig\", \"$tgLocation\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgTribeButton\", TribeButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tribe-linked.directive.coffee\n */\n\n(function() {\n  var TribeLinkedDirective;\n\n  TribeLinkedDirective = function(configService) {\n    var directive, link;\n    link = function(scope, el, attrs) {\n      scope.vm = {};\n      scope.vm.tribeHost = configService.config.tribeHost;\n      scope.vm.show = function() {\n        return scope.vm.open = true;\n      };\n      return scope.vm.hide = function(event) {\n        return scope.vm.open = false;\n      };\n    };\n    directive = {\n      templateUrl: \"components/tribe-button/tribe-linked.html\",\n      scope: {\n        gigTitle: \"=\",\n        gigId: \"=\"\n      },\n      link: link\n    };\n    return directive;\n  };\n\n  TribeLinkedDirective.$inject = [\"$tgConfig\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgTribeLinked\", TribeLinkedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: vote-button.controller.coffee\n */\n\n(function() {\n  var VoteButtonController;\n\n  VoteButtonController = (function() {\n    VoteButtonController.$inject = [\"tgCurrentUserService\"];\n\n    function VoteButtonController(currentUserService) {\n      this.currentUserService = currentUserService;\n      this.user = this.currentUserService.getUser();\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    VoteButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    VoteButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    VoteButtonController.prototype.toggleVote = function() {\n      var promise;\n      this.loading = true;\n      if (!this.item.is_voter) {\n        promise = this._upvote();\n      } else {\n        promise = this._downvote();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    VoteButtonController.prototype._upvote = function() {\n      return this.onUpvote().then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this));\n    };\n\n    VoteButtonController.prototype._downvote = function() {\n      return this.onDownvote();\n    };\n\n    return VoteButtonController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"VoteButton\", VoteButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: vote-button.directive.coffee\n */\n\n(function() {\n  var VoteButtonDirective;\n\n  VoteButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"VoteButton\",\n      bindToController: {\n        item: \"=\",\n        onUpvote: \"=\",\n        onDownvote: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"components/vote-button/vote-button.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgVoteButton\", VoteButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-button.controller.coffee\n */\n\n(function() {\n  var WatchButtonController;\n\n  WatchButtonController = (function() {\n    WatchButtonController.$inject = [\"tgCurrentUserService\", \"$rootScope\"];\n\n    function WatchButtonController(currentUserService, rootScope) {\n      this.currentUserService = currentUserService;\n      this.rootScope = rootScope;\n      this.user = this.currentUserService.getUser();\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    WatchButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    WatchButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    WatchButtonController.prototype.openWatchers = function() {\n      return this.rootScope.$broadcast(\"watcher:add\", this.item);\n    };\n\n    WatchButtonController.prototype.getPerms = function() {\n      var name, perms;\n      if (!this.item) {\n        return \"\";\n      }\n      name = this.item._name;\n      perms = {\n        userstories: 'modify_us',\n        issues: 'modify_issue',\n        tasks: 'modify_task',\n        epics: 'modify_epic'\n      };\n      return perms[name];\n    };\n\n    WatchButtonController.prototype.toggleWatch = function() {\n      var promise;\n      this.loading = true;\n      if (!this.item.is_watcher) {\n        promise = this._watch();\n      } else {\n        promise = this._unwatch();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    WatchButtonController.prototype._watch = function() {\n      return this.onWatch().then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this));\n    };\n\n    WatchButtonController.prototype._unwatch = function() {\n      return this.onUnwatch();\n    };\n\n    return WatchButtonController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"WatchButton\", WatchButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-button.directive.coffee\n */\n\n(function() {\n  var WatchButtonDirective;\n\n  WatchButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"WatchButton\",\n      bindToController: {\n        item: \"=\",\n        onWatch: \"=\",\n        onUnwatch: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: function(item, attributes) {\n        return \"components/watch-button/watch-button-\" + attributes.environment + \".html\";\n      }\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgWatchButton\", WatchButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home-order-by.controller.coffee\n */\n\n(function() {\n  var DiscoverHomeOrderByController;\n\n  DiscoverHomeOrderByController = (function() {\n    DiscoverHomeOrderByController.$inject = ['$translate'];\n\n    function DiscoverHomeOrderByController(translate) {\n      this.translate = translate;\n      this.is_open = false;\n      this.texts = {\n        week: this.translate.instant('DISCOVER.FILTERS.WEEK'),\n        month: this.translate.instant('DISCOVER.FILTERS.MONTH'),\n        year: this.translate.instant('DISCOVER.FILTERS.YEAR'),\n        all: this.translate.instant('DISCOVER.FILTERS.ALL_TIME')\n      };\n    }\n\n    DiscoverHomeOrderByController.prototype.currentText = function() {\n      return this.texts[this.currentOrderBy];\n    };\n\n    DiscoverHomeOrderByController.prototype.open = function() {\n      return this.is_open = true;\n    };\n\n    DiscoverHomeOrderByController.prototype.close = function() {\n      return this.is_open = false;\n    };\n\n    DiscoverHomeOrderByController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      this.is_open = false;\n      return this.onChange({\n        orderBy: this.currentOrderBy\n      });\n    };\n\n    return DiscoverHomeOrderByController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverHomeOrderBy\", DiscoverHomeOrderByController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home-order-by.directive.coffee\n */\n\n(function() {\n  var DiscoverHomeOrderByDirective;\n\n  DiscoverHomeOrderByDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"DiscoverHomeOrderBy\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"discover/components/discover-home-order-by/discover-home-order-by.html\",\n      scope: {\n        currentOrderBy: \"=orderBy\",\n        onChange: \"&\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverHomeOrderByDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverHomeOrderBy\", DiscoverHomeOrderByDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-bar.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchBarController;\n\n  DiscoverSearchBarController = (function() {\n    DiscoverSearchBarController.$inject = ['tgDiscoverProjectsService'];\n\n    function DiscoverSearchBarController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, 'projects', (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.projectsCount;\n        };\n      })(this));\n      this.discoverProjectsService.fetchStats();\n    }\n\n    DiscoverSearchBarController.prototype.selectFilter = function(filter) {\n      return this.onChange({\n        filter: filter,\n        q: this.q\n      });\n    };\n\n    DiscoverSearchBarController.prototype.submitFilter = function() {\n      return this.onChange({\n        filter: this.filter,\n        q: this.q\n      });\n    };\n\n    return DiscoverSearchBarController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearchBar\", DiscoverSearchBarController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchBarDirective;\n\n  DiscoverSearchBarDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      controller: \"DiscoverSearchBar\",\n      controllerAs: \"vm\",\n      templateUrl: 'discover/components/discover-search-bar/discover-search-bar.html',\n      bindToController: true,\n      scope: {\n        q: \"=\",\n        filter: \"=\",\n        onChange: \"&\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverSearchBarDirective.$inject = [];\n\n  angular.module('taigaDiscover').directive('tgDiscoverSearchBar', DiscoverSearchBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-list-header.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchListHeaderController;\n\n  DiscoverSearchListHeaderController = (function() {\n    DiscoverSearchListHeaderController.$inject = [];\n\n    function DiscoverSearchListHeaderController() {\n      this.like_is_open = this.orderBy.indexOf('-total_fans') === 0;\n      this.activity_is_open = this.orderBy.indexOf('-total_activity') === 0;\n    }\n\n    DiscoverSearchListHeaderController.prototype.openLike = function() {\n      this.like_is_open = true;\n      this.activity_is_open = false;\n      return this.setOrderBy('-total_fans_last_week');\n    };\n\n    DiscoverSearchListHeaderController.prototype.openActivity = function() {\n      this.activity_is_open = true;\n      this.like_is_open = false;\n      return this.setOrderBy('-total_activity_last_week');\n    };\n\n    DiscoverSearchListHeaderController.prototype.setOrderBy = function(type) {\n      if (type == null) {\n        type = '';\n      }\n      if (!type) {\n        this.like_is_open = false;\n        this.activity_is_open = false;\n      }\n      return this.onChange({\n        orderBy: type\n      });\n    };\n\n    return DiscoverSearchListHeaderController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearchListHeader\", DiscoverSearchListHeaderController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-list-header.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchListHeaderDirective;\n\n  DiscoverSearchListHeaderDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"DiscoverSearchListHeader\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"discover/components/discover-search-list-header/discover-search-list-header.html\",\n      scope: {\n        onChange: \"&\",\n        orderBy: \"=\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverSearchListHeaderDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverSearchListHeader\", DiscoverSearchListHeaderDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: featured-projects.controller.coffee\n */\n\n(function() {\n  var FeaturedProjectsController;\n\n  FeaturedProjectsController = (function() {\n    FeaturedProjectsController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function FeaturedProjectsController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"featured\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.featured;\n        };\n      })(this));\n      this.discoverProjectsService.fetchFeatured();\n    }\n\n    return FeaturedProjectsController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"FeaturedProjects\", FeaturedProjectsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: featured-projects.directive.coffee\n */\n\n(function() {\n  var FeaturedProjectsDirective;\n\n  FeaturedProjectsDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"FeaturedProjects\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/featured-projects/featured-projects.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  FeaturedProjectsDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgFeaturedProjects\", FeaturedProjectsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: highlighted.directive.coffee\n */\n\n(function() {\n  var HighlightedDirective;\n\n  HighlightedDirective = function() {\n    return {\n      templateUrl: \"discover/components/highlighted/highlighted.html\",\n      scope: {\n        loading: \"=\",\n        highlighted: \"=\",\n        orderBy: \"=\"\n      }\n    };\n  };\n\n  HighlightedDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgHighlighted\", HighlightedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-active.controller.coffee\n */\n\n(function() {\n  var MostActiveController;\n\n  MostActiveController = (function() {\n    MostActiveController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function MostActiveController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"highlighted\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.mostActive;\n        };\n      })(this));\n      this.currentOrderBy = 'week';\n      this.order_by = this.getOrderBy();\n    }\n\n    MostActiveController.prototype.fetch = function() {\n      this.loading = true;\n      this.order_by = this.getOrderBy();\n      return this.discoverProjectsService.fetchMostActive({\n        order_by: this.order_by\n      }).then((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    MostActiveController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      return this.fetch();\n    };\n\n    MostActiveController.prototype.getOrderBy = function(type) {\n      if (this.currentOrderBy === 'all') {\n        return '-total_activity';\n      } else {\n        return '-total_activity_last_' + this.currentOrderBy;\n      }\n    };\n\n    return MostActiveController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"MostActive\", MostActiveController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-active.directive.coffee\n */\n\n(function() {\n  var MostActiveDirective;\n\n  MostActiveDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"MostActive\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/most-active/most-active.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  MostActiveDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgMostActive\", MostActiveDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: msot-liked.controller.coffee\n */\n\n(function() {\n  var MostLikedController;\n\n  MostLikedController = (function() {\n    MostLikedController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function MostLikedController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"highlighted\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.mostLiked;\n        };\n      })(this));\n      this.currentOrderBy = 'week';\n      this.order_by = this.getOrderBy();\n    }\n\n    MostLikedController.prototype.fetch = function() {\n      this.loading = true;\n      this.order_by = this.getOrderBy();\n      return this.discoverProjectsService.fetchMostLiked({\n        order_by: this.order_by\n      }).then((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    MostLikedController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      return this.fetch();\n    };\n\n    MostLikedController.prototype.getOrderBy = function() {\n      if (this.currentOrderBy === 'all') {\n        return '-total_fans';\n      } else {\n        return '-total_fans_last_' + this.currentOrderBy;\n      }\n    };\n\n    return MostLikedController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"MostLiked\", MostLikedController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-liked.directive.coffee\n */\n\n(function() {\n  var MostLikedDirective;\n\n  MostLikedDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"MostLiked\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/most-liked/most-liked.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  MostLikedDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgMostLiked\", MostLikedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home.controller.coffee\n */\n\n(function() {\n  var DiscoverHomeController;\n\n  DiscoverHomeController = (function() {\n    DiscoverHomeController.$inject = ['$tgLocation', '$tgNavUrls', 'tgAppMetaService', '$translate'];\n\n    function DiscoverHomeController(location, navUrls, appMetaService, translate) {\n      var description, title;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      title = this.translate.instant(\"DISCOVER.PAGE_TITLE\");\n      description = this.translate.instant(\"DISCOVER.PAGE_DESCRIPTION\");\n      this.appMetaService.setAll(title, description);\n    }\n\n    DiscoverHomeController.prototype.onSubmit = function(q) {\n      var url;\n      url = this.navUrls.resolve('discover-search');\n      return this.location.search('text', q).path(url);\n    };\n\n    return DiscoverHomeController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverHome\", DiscoverHomeController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchController;\n\n  DiscoverSearchController = (function() {\n    DiscoverSearchController.$inject = ['$routeParams', 'tgDiscoverProjectsService', '$route', 'tgAppMetaService', '$translate'];\n\n    function DiscoverSearchController(routeParams, discoverProjectsService, route, appMetaService, translate) {\n      var description, title;\n      this.routeParams = routeParams;\n      this.discoverProjectsService = discoverProjectsService;\n      this.route = route;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.page = 1;\n      taiga.defineImmutableProperty(this, \"searchResult\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.searchResult;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"nextSearchPage\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.nextSearchPage;\n        };\n      })(this));\n      this.q = this.routeParams.text;\n      this.filter = this.routeParams.filter || 'all';\n      this.orderBy = this.routeParams['order_by'] || '';\n      this.loadingGlobal = false;\n      this.loadingList = false;\n      this.loadingPagination = false;\n      title = this.translate.instant(\"DISCOVER.SEARCH.PAGE_TITLE\");\n      description = this.translate.instant(\"DISCOVER.SEARCH.PAGE_DESCRIPTION\");\n      this.appMetaService.setAll(title, description);\n    }\n\n    DiscoverSearchController.prototype.fetch = function() {\n      this.page = 1;\n      this.discoverProjectsService.resetSearchList();\n      return this.search();\n    };\n\n    DiscoverSearchController.prototype.fetchByGlobalSearch = function() {\n      if (this.loadingGlobal) {\n        return;\n      }\n      this.loadingGlobal = true;\n      return this.fetch().then((function(_this) {\n        return function() {\n          return _this.loadingGlobal = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.fetchByOrderBy = function() {\n      if (this.loadingList) {\n        return;\n      }\n      this.loadingList = true;\n      return this.fetch().then((function(_this) {\n        return function() {\n          return _this.loadingList = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.showMore = function() {\n      if (this.loadingPagination) {\n        return;\n      }\n      this.loadingPagination = true;\n      this.page++;\n      return this.search().then((function(_this) {\n        return function() {\n          return _this.loadingPagination = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.search = function() {\n      var filter, params;\n      filter = this.getFilter();\n      params = {\n        page: this.page,\n        q: this.q,\n        order_by: this.orderBy\n      };\n      _.assign(params, filter);\n      return this.discoverProjectsService.fetchSearch(params);\n    };\n\n    DiscoverSearchController.prototype.getFilter = function() {\n      if (this.filter === 'people') {\n        return {\n          is_looking_for_people: true\n        };\n      } else if (this.filter === 'scrum') {\n        return {\n          is_backlog_activated: true\n        };\n      } else if (this.filter === 'kanban') {\n        return {\n          is_kanban_activated: true\n        };\n      }\n      return {};\n    };\n\n    DiscoverSearchController.prototype.onChangeFilter = function(filter, q) {\n      this.filter = filter;\n      this.q = q;\n      this.route.updateParams({\n        filter: this.filter,\n        text: this.q\n      });\n      return this.fetchByGlobalSearch();\n    };\n\n    DiscoverSearchController.prototype.onChangeOrder = function(orderBy) {\n      this.orderBy = orderBy;\n      this.route.updateParams({\n        order_by: orderBy\n      });\n      return this.fetchByOrderBy();\n    };\n\n    return DiscoverSearchController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearch\", DiscoverSearchController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchDirective;\n\n  DiscoverSearchDirective = function() {\n    var link;\n    link = function(scope, element, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"DiscoverSearch\",\n      controllerAs: \"vm\",\n      link: link\n    };\n  };\n\n  DiscoverSearchDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverSearch\", DiscoverSearchDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-projects.service.coffee\n */\n\n(function() {\n  var DiscoverProjectsService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  DiscoverProjectsService = (function(superClass) {\n    var _discoverParams;\n\n    extend(DiscoverProjectsService, superClass);\n\n    DiscoverProjectsService.$inject = [\"tgResources\", \"tgProjectsService\"];\n\n    _discoverParams = {\n      discover_mode: true\n    };\n\n    function DiscoverProjectsService(rs, projectsService) {\n      this.rs = rs;\n      this.projectsService = projectsService;\n      this._mostLiked = Immutable.List();\n      this._mostActive = Immutable.List();\n      this._featured = Immutable.List();\n      this._searchResult = Immutable.List();\n      this._projectsCount = 0;\n      this.decorate = this.projectsService._decorate.bind(this.projectsService);\n      taiga.defineImmutableProperty(this, \"mostLiked\", (function(_this) {\n        return function() {\n          return _this._mostLiked;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"mostActive\", (function(_this) {\n        return function() {\n          return _this._mostActive;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"featured\", (function(_this) {\n        return function() {\n          return _this._featured;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"searchResult\", (function(_this) {\n        return function() {\n          return _this._searchResult;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"nextSearchPage\", (function(_this) {\n        return function() {\n          return _this._nextSearchPage;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"projectsCount\", (function(_this) {\n        return function() {\n          return _this._projectsCount;\n        };\n      })(this));\n    }\n\n    DiscoverProjectsService.prototype.fetchMostLiked = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 5);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._mostLiked = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchMostActive = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 5);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._mostActive = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchFeatured = function() {\n      var _params;\n      _params = _.extend({}, _discoverParams);\n      _params.is_featured = true;\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 4);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._featured = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.resetSearchList = function() {\n      return this._searchResult = Immutable.List();\n    };\n\n    DiscoverProjectsService.prototype.fetchStats = function() {\n      return this.rs.stats.discover().then((function(_this) {\n        return function(discover) {\n          return _this._projectsCount = discover.getIn(['projects', 'total']);\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchSearch = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params).then((function(_this) {\n        return function(result) {\n          var projects;\n          _this._nextSearchPage = !!result.headers('X-Pagination-Next');\n          projects = Immutable.fromJS(result.data);\n          projects = projects.map(_this.decorate);\n          return _this._searchResult = _this._searchResult.concat(projects);\n        };\n      })(this));\n    };\n\n    return DiscoverProjectsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaDiscover\").service(\"tgDiscoverProjectsService\", DiscoverProjectsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: create-epic.controller.coffee\n */\n\n(function() {\n  var CreateEpicController, getRandomDefaultColor, taiga, trim;\n\n  taiga = this.taiga;\n\n  trim = taiga.trim;\n\n  getRandomDefaultColor = taiga.getRandomDefaultColor;\n\n  CreateEpicController = (function() {\n    CreateEpicController.$inject = [\"$tgConfirm\", \"tgProjectService\", \"tgEpicsService\"];\n\n    function CreateEpicController(confirm, projectService, epicsService) {\n      this.confirm = confirm;\n      this.projectService = projectService;\n      this.epicsService = epicsService;\n      this.project = this.projectService.project.toJS();\n      this.newEpic = {\n        color: getRandomDefaultColor(),\n        status: this.project.default_epic_status,\n        tags: []\n      };\n      this.attachments = Immutable.List();\n      this.loading = false;\n    }\n\n    CreateEpicController.prototype.createEpic = function() {\n      if (!this.validateForm()) {\n        return;\n      }\n      this.loading = true;\n      return this.epicsService.createEpic(this.newEpic, this.attachments).then((function(_this) {\n        return function(response) {\n          _this.onCreateEpic();\n          return _this.loading = false;\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(response) {\n          _this.loading = false;\n          _this.setFormErrors(response.data);\n          if (response.data._error_message) {\n            return _this.confirm.notify(\"error\", response.data._error_message);\n          }\n        };\n      })(this));\n    };\n\n    CreateEpicController.prototype.selectColor = function(color) {\n      return this.newEpic.color = color;\n    };\n\n    CreateEpicController.prototype.addTag = function(name, color) {\n      name = trim(name.toLowerCase());\n      if (!_.find(this.newEpic.tags, function(it) {\n        return it[0] === name;\n      })) {\n        return this.newEpic.tags.push([name, color]);\n      }\n    };\n\n    CreateEpicController.prototype.deleteTag = function(tag) {\n      return _.remove(this.newEpic.tags, function(it) {\n        return it[0] === tag[0];\n      });\n    };\n\n    CreateEpicController.prototype.addAttachment = function(attachment) {\n      return this.attachments.push(attachment);\n    };\n\n    return CreateEpicController;\n\n  })();\n\n  angular.module(\"taigaEpics\").controller(\"CreateEpicCtrl\", CreateEpicController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: create-epic.directive.coffee\n */\n\n(function() {\n  var CreateEpicDirective;\n\n  CreateEpicDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var form;\n      form = el.find(\"form\").checksley();\n      ctrl.validateForm = (function(_this) {\n        return function() {\n          return form.validate();\n        };\n      })(this);\n      return ctrl.setFormErrors = (function(_this) {\n        return function(errors) {\n          return form.setErrors(errors);\n        };\n      })(this);\n    };\n    return {\n      link: link,\n      templateUrl: \"epics/create-epic/create-epic.html\",\n      controller: \"CreateEpicCtrl\",\n      controllerAs: \"vm\",\n      bindToController: {\n        onCreateEpic: '&'\n      },\n      scope: {}\n    };\n  };\n\n  angular.module('taigaEpics').directive(\"tgCreateEpic\", CreateEpicDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics-table.controller.coffee\n */\n\n(function() {\n  var EpicRowController;\n\n  EpicRowController = (function() {\n    EpicRowController.$inject = [\"$tgConfirm\", \"tgProjectService\", \"tgEpicsService\"];\n\n    function EpicRowController(confirm, projectService, epicsService) {\n      this.confirm = confirm;\n      this.projectService = projectService;\n      this.epicsService = epicsService;\n      this.displayUserStories = false;\n      this.displayAssignedTo = false;\n      this.displayStatusList = false;\n      this.loadingStatus = false;\n      this.project = this.projectService.project.toJS();\n      this._calculateProgressBar();\n    }\n\n    EpicRowController.prototype._calculateProgressBar = function() {\n      var closed, opened, total;\n      if (this.epic.getIn(['status_extra_info', 'is_closed']) === true) {\n        return this.percentage = \"100%\";\n      } else {\n        opened = this.epic.getIn(['user_stories_counts', 'opened']);\n        closed = this.epic.getIn(['user_stories_counts', 'closed']);\n        total = opened + closed;\n        if (total === 0) {\n          return this.percentage = \"0%\";\n        } else {\n          return this.percentage = (closed * 100 / total) + \"%\";\n        }\n      }\n    };\n\n    EpicRowController.prototype.canEditEpics = function() {\n      return this.projectService.hasPermission(\"modify_epic\");\n    };\n\n    EpicRowController.prototype.toggleUserStoryList = function() {\n      if (!this.displayUserStories) {\n        return this.epicsService.listRelatedUserStories(this.epic).then((function(_this) {\n          return function(userStories) {\n            _this.epicStories = userStories;\n            return _this.displayUserStories = true;\n          };\n        })(this))[\"catch\"]((function(_this) {\n          return function() {\n            return _this.confirm.notify('error');\n          };\n        })(this));\n      } else {\n        return this.displayUserStories = false;\n      }\n    };\n\n    EpicRowController.prototype.updateStatus = function(statusId) {\n      this.displayStatusList = false;\n      this.loadingStatus = true;\n      return this.epicsService.updateEpicStatus(this.epic, statusId)[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify('error');\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loadingStatus = false;\n        };\n      })(this));\n    };\n\n    EpicRowController.prototype.updateAssignedTo = function(member) {\n      this.assignLoader = true;\n      return this.epicsService.updateEpicAssignedTo(this.epic, (member != null ? member.id : void 0) || null)[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify('error');\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.assignLoader = false;\n        };\n      })(this));\n    };\n\n    return EpicRowController;\n\n  })();\n\n  angular.module(\"taigaEpics\").controller(\"EpicRowCtrl\", EpicRowController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics-table.directive.coffee\n */\n\n(function() {\n  var EpicRowDirective;\n\n  EpicRowDirective = function() {\n    return {\n      templateUrl: \"epics/dashboard/epic-row/epic-row.html\",\n      controller: \"EpicRowCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        epic: '=',\n        column: '='\n      }\n    };\n  };\n\n  angular.module('taigaEpics').directive(\"tgEpicRow\", EpicRowDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics.dashboard.controller.coffee\n */\n\n(function() {\n  var EpicsDashboardController, taiga;\n\n  taiga = this.taiga;\n\n  EpicsDashboardController = (function() {\n    EpicsDashboardController.$inject = [\"$routeParams\", \"tgErrorHandlingService\", \"tgLightboxFactory\", \"lightboxService\", \"$tgConfirm\", \"tgProjectService\", \"tgEpicsService\", \"tgAppMetaService\", \"$translate\"];\n\n    function EpicsDashboardController(params, errorHandlingService, lightboxFactory, lightboxService, confirm, projectService, epicsService, appMetaService, translate) {\n      this.params = params;\n      this.errorHandlingService = errorHandlingService;\n      this.lightboxFactory = lightboxFactory;\n      this.lightboxService = lightboxService;\n      this.confirm = confirm;\n      this.projectService = projectService;\n      this.epicsService = epicsService;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.sectionName = \"EPICS.SECTION_NAME\";\n      taiga.defineImmutableProperty(this, 'project', (function(_this) {\n        return function() {\n          return _this.projectService.project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'epics', (function(_this) {\n        return function() {\n          return _this.epicsService.epics;\n        };\n      })(this));\n      this.appMetaService.setfn(this._setMeta.bind(this));\n    }\n\n    EpicsDashboardController.prototype._setMeta = function() {\n      var ctx;\n      if (!this.project) {\n        return null;\n      }\n      ctx = {\n        projectName: this.project.get(\"name\"),\n        projectDescription: this.project.get(\"description\")\n      };\n      return {\n        title: this.translate.instant(\"EPICS.PAGE_TITLE\", ctx),\n        description: this.translate.instant(\"EPICS.PAGE_DESCRIPTION\", ctx)\n      };\n    };\n\n    EpicsDashboardController.prototype.loadInitialData = function() {\n      this.epicsService.clear();\n      return this.projectService.setProjectBySlug(this.params.pslug).then((function(_this) {\n        return function() {\n          if (!_this.projectService.isEpicsDashboardEnabled()) {\n            return _this.errorHandlingService.notFound();\n          }\n          if (!_this.projectService.hasPermission(\"view_epics\")) {\n            return _this.errorHandlingService.permissionDenied();\n          }\n          return _this.epicsService.fetchEpics();\n        };\n      })(this));\n    };\n\n    EpicsDashboardController.prototype.canCreateEpics = function() {\n      return this.projectService.hasPermission(\"add_epic\");\n    };\n\n    EpicsDashboardController.prototype.onCreateEpic = function() {\n      var onCreateEpic;\n      onCreateEpic = (function(_this) {\n        return function() {\n          _this.lightboxService.closeAll();\n          _this.confirm.notify(\"success\");\n        };\n      })(this);\n      return this.lightboxFactory.create('tg-create-epic', {\n        \"class\": \"lightbox lightbox-create-epic open\",\n        \"on-create-epic\": \"onCreateEpic()\"\n      }, {\n        \"onCreateEpic\": onCreateEpic.bind(this)\n      });\n    };\n\n    return EpicsDashboardController;\n\n  })();\n\n  angular.module(\"taigaEpics\").controller(\"EpicsDashboardCtrl\", EpicsDashboardController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics-sortable.directive.coffee\n */\n\n(function() {\n  var EpicsSortableDirective;\n\n  EpicsSortableDirective = function($parse, projectService) {\n    var link;\n    link = function(scope, el, attrs) {\n      var callback, drake, scroll;\n      if (!projectService.hasPermission(\"modify_epic\")) {\n        return;\n      }\n      callback = $parse(attrs.tgEpicsSortable);\n      drake = dragula([el[0]], {\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: el[0],\n        moves: function(item) {\n          return $(item).is('div.epics-table-body-row');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var epic, itemEl, newIndex;\n        itemEl = $(item);\n        epic = itemEl.scope().epic;\n        newIndex = itemEl.index();\n        return scope.$apply(function() {\n          return callback(scope, {\n            epic: epic,\n            newIndex: newIndex\n          });\n        });\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        el.off();\n        return drake.destroy();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  EpicsSortableDirective.$inject = [\"$parse\", \"tgProjectService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgEpicsSortable\", EpicsSortableDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics-table.controller.coffee\n */\n\n(function() {\n  var EpicsTableController, taiga;\n\n  taiga = this.taiga;\n\n  EpicsTableController = (function() {\n    EpicsTableController.$inject = [\"$tgConfirm\", \"tgEpicsService\", \"$timeout\"];\n\n    function EpicsTableController(confirm, epicsService, timeout) {\n      this.confirm = confirm;\n      this.epicsService = epicsService;\n      this.timeout = timeout;\n      this.displayOptions = false;\n      this.displayVotes = true;\n      this.column = {\n        votes: true,\n        name: true,\n        project: true,\n        sprint: true,\n        assigned: true,\n        status: true,\n        progress: true\n      };\n      taiga.defineImmutableProperty(this, 'epics', (function(_this) {\n        return function() {\n          return _this.epicsService.epics;\n        };\n      })(this));\n    }\n\n    EpicsTableController.prototype.toggleEpicTableOptions = function() {\n      return this.displayOptions = !this.displayOptions;\n    };\n\n    EpicsTableController.prototype.reorderEpic = function(epic, newIndex) {\n      return this.epicsService.reorderEpic(epic, newIndex).then(null, (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    EpicsTableController.prototype.hoverEpicTableOption = function() {\n      if (this.timer) {\n        return this.timeout.cancel(this.timer);\n      }\n    };\n\n    EpicsTableController.prototype.hideEpicTableOption = function() {\n      return this.timer = this.timeout(((function(_this) {\n        return function() {\n          return _this.displayOptions = false;\n        };\n      })(this)), 400);\n    };\n\n    return EpicsTableController;\n\n  })();\n\n  angular.module(\"taigaEpics\").controller(\"EpicsTableCtrl\", EpicsTableController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics-table.directive.coffee\n */\n\n(function() {\n  var EpicsTableDirective;\n\n  EpicsTableDirective = function() {\n    return {\n      templateUrl: \"epics/dashboard/epics-table/epics-table.html\",\n      controller: \"EpicsTableCtrl\",\n      controllerAs: \"vm\",\n      scope: {}\n    };\n  };\n\n  angular.module('taigaEpics').directive(\"tgEpicsTable\", EpicsTableDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics-table.controller.coffee\n */\n\n(function() {\n  var StoryRowController, module;\n\n  module = angular.module(\"taigaEpics\");\n\n  StoryRowController = (function() {\n    StoryRowController.$inject = [];\n\n    function StoryRowController() {\n      this._calculateProgressBar();\n    }\n\n    StoryRowController.prototype._calculateProgressBar = function() {\n      var totalTasks, totalTasksCompleted;\n      if (this.story.get('is_closed') === true) {\n        return this.percentage = \"100%\";\n      } else {\n        totalTasks = this.story.get('tasks').size;\n        totalTasksCompleted = this.story.get('tasks').filter(function(it) {\n          return it.get(\"is_closed\");\n        }).size;\n        if (totalTasks === 0) {\n          return this.percentage = \"0%\";\n        } else {\n          return this.percentage = (totalTasksCompleted * 100 / totalTasks) + \"%\";\n        }\n      }\n    };\n\n    return StoryRowController;\n\n  })();\n\n  module.controller(\"StoryRowCtrl\", StoryRowController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics-table.directive.coffee\n */\n\n(function() {\n  var StoryRowDirective, module;\n\n  module = angular.module('taigaEpics');\n\n  StoryRowDirective = function() {\n    return {\n      templateUrl: \"epics/dashboard/story-row/story-row.html\",\n      controller: \"StoryRowCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        story: '=',\n        column: '='\n      }\n    };\n  };\n\n  module.directive(\"tgStoryRow\", StoryRowDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics.service.coffee\n */\n\n(function() {\n  var EpicsService, taiga;\n\n  taiga = this.taiga;\n\n  EpicsService = (function() {\n    EpicsService.$inject = ['tgProjectService', 'tgAttachmentsService', 'tgResources', 'tgXhrErrorService'];\n\n    function EpicsService(projectService, attachmentsService, resources, xhrError) {\n      this.projectService = projectService;\n      this.attachmentsService = attachmentsService;\n      this.resources = resources;\n      this.xhrError = xhrError;\n      this._epics = Immutable.List();\n      taiga.defineImmutableProperty(this, 'epics', (function(_this) {\n        return function() {\n          return _this._epics;\n        };\n      })(this));\n    }\n\n    EpicsService.prototype.clear = function() {\n      return this._epics = Immutable.List();\n    };\n\n    EpicsService.prototype.fetchEpics = function() {\n      return this.resources.epics.list(this.projectService.project.get('id')).then((function(_this) {\n        return function(epics) {\n          return _this._epics = epics;\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    EpicsService.prototype.listRelatedUserStories = function(epic) {\n      return this.resources.userstories.listInEpic(epic.get('id'));\n    };\n\n    EpicsService.prototype.createEpic = function(epicData, attachments) {\n      epicData.project = this.projectService.project.get('id');\n      return this.resources.epics.post(epicData).then((function(_this) {\n        return function(epic) {\n          var promises;\n          promises = _.map(attachments.toJS(), function(attachment) {\n            return _this.attachmentsService.upload(attachment.file, epic.get('id'), epic.get('project'), 'epic');\n          });\n          return Promise.all(promises).then(function() {\n            return _this.fetchEpics();\n          });\n        };\n      })(this));\n    };\n\n    EpicsService.prototype.reorderEpic = function(epic, newIndex) {\n      var beforeDestination, data, newOrder, previous, previousWithTheSameOrder, setOrders, withoutMoved;\n      withoutMoved = this.epics.filter((function(_this) {\n        return function(it) {\n          return it.get('id') !== epic.get('id');\n        };\n      })(this));\n      beforeDestination = withoutMoved.slice(0, newIndex);\n      previous = beforeDestination.last();\n      newOrder = !previous ? 0 : previous.get('epics_order') + 1;\n      previousWithTheSameOrder = beforeDestination.filter((function(_this) {\n        return function(it) {\n          return it.get('epics_order') === previous.get('epics_order');\n        };\n      })(this));\n      setOrders = _.fromPairs(previousWithTheSameOrder.map((function(_this) {\n        return function(it) {\n          return [it.get('id'), it.get('epics_order')];\n        };\n      })(this)).toJS());\n      data = {\n        epics_order: newOrder,\n        version: epic.get('version')\n      };\n      return this.resources.epics.reorder(epic.get('id'), data, setOrders).then((function(_this) {\n        return function() {\n          return _this.fetchEpics();\n        };\n      })(this));\n    };\n\n    EpicsService.prototype.reorderRelatedUserstory = function(epic, epicUserstories, userstory, newIndex) {\n      var beforeDestination, data, epicId, newOrder, previous, previousWithTheSameOrder, setOrders, userstoryId, withoutMoved;\n      withoutMoved = epicUserstories.filter((function(_this) {\n        return function(it) {\n          return it.get('id') !== userstory.get('id');\n        };\n      })(this));\n      beforeDestination = withoutMoved.slice(0, newIndex);\n      previous = beforeDestination.last();\n      newOrder = !previous ? 0 : previous.get('epic_order') + 1;\n      previousWithTheSameOrder = beforeDestination.filter((function(_this) {\n        return function(it) {\n          return it.get('epic_order') === previous.get('epic_order');\n        };\n      })(this));\n      setOrders = _.fromPairs(previousWithTheSameOrder.map((function(_this) {\n        return function(it) {\n          return [it.get('id'), it.get('epic_order')];\n        };\n      })(this)).toJS());\n      data = {\n        order: newOrder\n      };\n      epicId = epic.get('id');\n      userstoryId = userstory.get('id');\n      return this.resources.epics.reorderRelatedUserstory(epicId, userstoryId, data, setOrders).then((function(_this) {\n        return function() {\n          return _this.listRelatedUserStories(epic);\n        };\n      })(this));\n    };\n\n    EpicsService.prototype.updateEpicStatus = function(epic, statusId) {\n      var data;\n      data = {\n        status: statusId,\n        version: epic.get('version')\n      };\n      return this.resources.epics.patch(epic.get('id'), data).then((function(_this) {\n        return function() {\n          return _this.fetchEpics();\n        };\n      })(this));\n    };\n\n    EpicsService.prototype.updateEpicAssignedTo = function(epic, userId) {\n      var data;\n      data = {\n        assigned_to: userId,\n        version: epic.get('version')\n      };\n      return this.resources.epics.patch(epic.get('id'), data).then((function(_this) {\n        return function() {\n          return _this.fetchEpics();\n        };\n      })(this));\n    };\n\n    return EpicsService;\n\n  })();\n\n  angular.module('taigaEpics').service('tgEpicsService', EpicsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: related-userstories.controller.coffee\n */\n\n(function() {\n  var RelatedUserStoriesController, module;\n\n  module = angular.module(\"taigaEpics\");\n\n  RelatedUserStoriesController = (function() {\n    RelatedUserStoriesController.$inject = [\"tgProjectService\", \"tgEpicsService\"];\n\n    function RelatedUserStoriesController(projectService, epicsService) {\n      this.projectService = projectService;\n      this.epicsService = epicsService;\n      this.sectionName = \"Epics\";\n      this.showCreateRelatedUserstoriesLightbox = false;\n    }\n\n    RelatedUserStoriesController.prototype.showRelatedUserStoriesSection = function() {\n      var ref;\n      return this.projectService.hasPermission(\"modify_epic\") || ((ref = this.userstories) != null ? ref.legth : void 0) > 0;\n    };\n\n    RelatedUserStoriesController.prototype.userCanSort = function() {\n      return this.projectService.hasPermission(\"modify_epic\");\n    };\n\n    RelatedUserStoriesController.prototype.loadRelatedUserstories = function() {\n      return this.epicsService.listRelatedUserStories(this.epic).then((function(_this) {\n        return function(userstories) {\n          return _this.userstories = userstories;\n        };\n      })(this));\n    };\n\n    RelatedUserStoriesController.prototype.reorderRelatedUserstory = function(us, newIndex) {\n      return this.epicsService.reorderRelatedUserstory(this.epic, this.userstories, us, newIndex).then((function(_this) {\n        return function(userstories) {\n          return _this.userstories = userstories;\n        };\n      })(this));\n    };\n\n    return RelatedUserStoriesController;\n\n  })();\n\n  module.controller(\"RelatedUserStoriesCtrl\", RelatedUserStoriesController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: related-userstory-create.controller.coffee\n */\n\n(function() {\n  var RelatedUserstoriesCreateController, module;\n\n  module = angular.module(\"taigaEpics\");\n\n  RelatedUserstoriesCreateController = (function() {\n    RelatedUserstoriesCreateController.$inject = [\"tgCurrentUserService\", \"tgResources\", \"$tgConfirm\", \"$tgAnalytics\"];\n\n    function RelatedUserstoriesCreateController(currentUserService, rs, confirm, analytics) {\n      this.currentUserService = currentUserService;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.analytics = analytics;\n      this.projects = this.currentUserService.projects.get(\"all\");\n      this.projectUserstories = Immutable.List();\n      this.loading = false;\n    }\n\n    RelatedUserstoriesCreateController.prototype.selectProject = function(selectedProjectId, onSelectedProject) {\n      return this.rs.userstories.listAllInProject(selectedProjectId).then((function(_this) {\n        return function(data) {\n          var excludeIds, filteredData;\n          excludeIds = _this.epicUserstories.map(function(us) {\n            return us.get('id');\n          });\n          filteredData = data.filter(function(us) {\n            return excludeIds.indexOf(us.get('id')) === -1;\n          });\n          _this.projectUserstories = filteredData;\n          if (onSelectedProject) {\n            return onSelectedProject();\n          }\n        };\n      })(this));\n    };\n\n    RelatedUserstoriesCreateController.prototype.saveRelatedUserStory = function(selectedUserstoryId, onSavedRelatedUserstory) {\n      var epicId, onError, onSuccess;\n      if (!this.validateExistingUserstoryForm()) {\n        return;\n      }\n      this.loading = true;\n      onError = (function(_this) {\n        return function(data) {\n          _this.loading = false;\n          _this.confirm.notify(\"error\");\n          return _this.setExistingUserstoryFormErrors(data);\n        };\n      })(this);\n      onSuccess = (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"epic related user story\", \"create\", \"create related user story on epic\", 1);\n          _this.loading = false;\n          if (onSavedRelatedUserstory) {\n            onSavedRelatedUserstory();\n          }\n          return _this.loadRelatedUserstories();\n        };\n      })(this);\n      epicId = this.epic.get('id');\n      return this.rs.epics.addRelatedUserstory(epicId, selectedUserstoryId).then(onSuccess, onError);\n    };\n\n    RelatedUserstoriesCreateController.prototype.bulkCreateRelatedUserStories = function(selectedProjectId, userstoriesText, onCreatedRelatedUserstory) {\n      var epicId, onError, onSuccess;\n      if (!this.validateNewUserstoryForm()) {\n        return;\n      }\n      this.loading = true;\n      onError = (function(_this) {\n        return function(data) {\n          _this.loading = false;\n          _this.confirm.notify(\"error\");\n          return _this.setNewUserstoryFormErrors(data);\n        };\n      })(this);\n      onSuccess = (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"epic related user story\", \"create\", \"create related user story on epic\", 1);\n          _this.loading = false;\n          if (onCreatedRelatedUserstory) {\n            onCreatedRelatedUserstory();\n          }\n          return _this.loadRelatedUserstories();\n        };\n      })(this);\n      epicId = this.epic.get('id');\n      return this.rs.epics.bulkCreateRelatedUserStories(epicId, selectedProjectId, userstoriesText).then(onSuccess, onError);\n    };\n\n    return RelatedUserstoriesCreateController;\n\n  })();\n\n  module.controller(\"RelatedUserstoriesCreateCtrl\", RelatedUserstoriesCreateController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: related-userstory-create.directive.coffee\n */\n\n(function() {\n  var RelatedUserstoriesCreateDirective, module;\n\n  module = angular.module('taigaEpics');\n\n  RelatedUserstoriesCreateDirective = function(lightboxService1) {\n    var link;\n    this.lightboxService = lightboxService1;\n    link = function(scope, el, attrs, ctrl) {\n      var existingUserstoryForm, newUserstoryForm;\n      newUserstoryForm = el.find(\".new-user-story-form\").checksley();\n      existingUserstoryForm = el.find(\".existing-user-story-form\").checksley();\n      ctrl.validateNewUserstoryForm = (function(_this) {\n        return function() {\n          return newUserstoryForm.validate();\n        };\n      })(this);\n      ctrl.setNewUserstoryFormErrors = (function(_this) {\n        return function(errors) {\n          return newUserstoryForm.setErrors(errors);\n        };\n      })(this);\n      ctrl.validateExistingUserstoryForm = (function(_this) {\n        return function() {\n          return existingUserstoryForm.validate();\n        };\n      })(this);\n      ctrl.setExistingUserstoryFormErrors = (function(_this) {\n        return function(errors) {\n          return existingUserstoryForm.setErrors(errors);\n        };\n      })(this);\n      scope.showLightbox = function(selectedProjectId) {\n        return scope.selectProject(selectedProjectId).then((function(_this) {\n          return function() {\n            return lightboxService.open(el.find(\".lightbox-create-related-user-stories\"));\n          };\n        })(this));\n      };\n      scope.closeLightbox = function() {\n        scope.selectedUserstory = null;\n        scope.searchUserstory = \"\";\n        scope.relatedUserstoriesText = \"\";\n        return lightboxService.close(el.find(\".lightbox-create-related-user-stories\"));\n      };\n      scope.$watch('vm.project', function(project) {\n        if (project != null) {\n          return scope.selectedProject = project.get('id');\n        }\n      });\n      scope.selectProject = function(selectedProjectId) {\n        scope.selectedUserstory = null;\n        scope.searchUserstory = \"\";\n        return ctrl.selectProject(selectedProjectId);\n      };\n      return scope.onUpdateSearchUserstory = function() {\n        return scope.selectedUserstory = null;\n      };\n    };\n    return {\n      link: link,\n      templateUrl: \"epics/related-userstories/related-userstories-create/related-userstories-create.html\",\n      controller: \"RelatedUserstoriesCreateCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        showCreateRelatedUserstoriesLightbox: \"=\",\n        project: \"=\",\n        epic: \"=\",\n        epicUserstories: \"=\",\n        loadRelatedUserstories: \"&\"\n      }\n    };\n  };\n\n  RelatedUserstoriesCreateDirective.$inject = [\"lightboxService\"];\n\n  module.directive(\"tgRelatedUserstoriesCreate\", RelatedUserstoriesCreateDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: related-userstories-sortable.directive.coffee\n */\n\n(function() {\n  var RelatedUserstoriesSortableDirective, module;\n\n  module = angular.module('taigaEpics');\n\n  RelatedUserstoriesSortableDirective = function($parse, projectService) {\n    var link;\n    link = function(scope, el, attrs) {\n      var callback, drake, scroll;\n      if (!projectService.hasPermission(\"modify_epic\")) {\n        return;\n      }\n      callback = $parse(attrs.tgRelatedUserstoriesSortable);\n      drake = dragula([el[0]], {\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: el[0],\n        moves: function(item) {\n          return $(item).is('tg-related-userstory-row');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var itemEl, newIndex, us;\n        itemEl = $(item);\n        us = itemEl.scope().us;\n        newIndex = itemEl.index();\n        return scope.$apply(function() {\n          return callback(scope, {\n            us: us,\n            newIndex: newIndex\n          });\n        });\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        el.off();\n        return drake.destroy();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  RelatedUserstoriesSortableDirective.$inject = [\"$parse\", \"tgProjectService\"];\n\n  module.directive(\"tgRelatedUserstoriesSortable\", RelatedUserstoriesSortableDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: related-userstories.directive.coffee\n */\n\n(function() {\n  var RelatedUserStoriesDirective, module;\n\n  module = angular.module('taigaEpics');\n\n  RelatedUserStoriesDirective = function() {\n    return {\n      templateUrl: \"epics/related-userstories/related-userstories.html\",\n      controller: \"RelatedUserStoriesCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        userstories: '=',\n        project: '=',\n        epic: '='\n      }\n    };\n  };\n\n  RelatedUserStoriesDirective.$inject = [];\n\n  module.directive(\"tgRelatedUserstories\", RelatedUserStoriesDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: reñated-userstory-row.controller.coffee\n */\n\n(function() {\n  var RelatedUserstoryRowController, module;\n\n  module = angular.module(\"taigaEpics\");\n\n  RelatedUserstoryRowController = (function() {\n    RelatedUserstoryRowController.$inject = [\"tgAvatarService\", \"$translate\", \"$tgConfirm\", \"tgResources\"];\n\n    function RelatedUserstoryRowController(avatarService, translate, confirm, rs) {\n      this.avatarService = avatarService;\n      this.translate = translate;\n      this.confirm = confirm;\n      this.rs = rs;\n    }\n\n    RelatedUserstoryRowController.prototype.setAvatarData = function() {\n      var member;\n      member = this.userstory.get('assigned_to_extra_info');\n      return this.avatar = this.avatarService.getAvatar(member);\n    };\n\n    RelatedUserstoryRowController.prototype.getAssignedToFullNameDisplay = function() {\n      if (this.userstory.get('assigned_to')) {\n        return this.userstory.getIn(['assigned_to_extra_info', 'full_name_display']);\n      }\n      return this.translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\");\n    };\n\n    RelatedUserstoryRowController.prototype.onDeleteRelatedUserstory = function() {\n      var message, title;\n      title = this.translate.instant('EPIC.TITLE_LIGHTBOX_UNLINK_RELATED_USERSTORY');\n      message = this.translate.instant('EPIC.MSG_LIGHTBOX_UNLINK_RELATED_USERSTORY', {\n        subject: this.userstory.get('subject')\n      });\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var epicId, onError, onSuccess, userstoryId;\n          onError = function() {\n            message = _this.translate.instant('EPIC.ERROR_UNLINK_RELATED_USERSTORY', {\n              errorMessage: message\n            });\n            _this.confirm.notify(\"error\", null, message);\n            return askResponse.finish(false);\n          };\n          onSuccess = function() {\n            _this.loadRelatedUserstories();\n            return askResponse.finish();\n          };\n          epicId = _this.epic.get('id');\n          userstoryId = _this.userstory.get('id');\n          return _this.rs.epics.deleteRelatedUserstory(epicId, userstoryId).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    return RelatedUserstoryRowController;\n\n  })();\n\n  module.controller(\"RelatedUserstoryRowCtrl\", RelatedUserstoryRowController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: related-userstory-row.directive.coffee\n */\n\n(function() {\n  var RelatedUserstoryRowDirective, module;\n\n  module = angular.module('taigaEpics');\n\n  RelatedUserstoryRowDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.setAvatarData();\n    };\n    return {\n      link: link,\n      templateUrl: \"epics/related-userstories/related-userstory-row/related-userstory-row.html\",\n      controller: \"RelatedUserstoryRowCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        userstory: '=',\n        epic: '=',\n        project: '=',\n        loadRelatedUserstories: \"&\"\n      }\n    };\n  };\n\n  RelatedUserstoryRowDirective.$inject = [];\n\n  module.directive(\"tgRelatedUserstoryRow\", RelatedUserstoryRowDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-app.controller.coffee\n */\n\n(function() {\n  var ExternalAppController, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ExternalAppController = (function(superClass) {\n    extend(ExternalAppController, superClass);\n\n    ExternalAppController.$inject = [\"$routeParams\", \"tgExternalAppsService\", \"$window\", \"tgCurrentUserService\", \"$location\", \"$tgNavUrls\", \"tgXhrErrorService\", \"tgLoader\"];\n\n    function ExternalAppController(routeParams, externalAppsService, window, currentUserService, location, navUrls, xhrError, loader) {\n      var loginUrl, nextUrl;\n      this.routeParams = routeParams;\n      this.externalAppsService = externalAppsService;\n      this.window = window;\n      this.currentUserService = currentUserService;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.xhrError = xhrError;\n      this.loader = loader;\n      this.createApplicationToken = bind(this.createApplicationToken, this);\n      this._getApplicationToken = bind(this._getApplicationToken, this);\n      this._redirect = bind(this._redirect, this);\n      this.loader.start(false);\n      this._applicationId = this.routeParams.application;\n      this._state = this.routeParams.state;\n      this._getApplicationToken();\n      this._user = this.currentUserService.getUser();\n      this._application = null;\n      nextUrl = encodeURIComponent(this.location.url());\n      loginUrl = this.navUrls.resolve(\"login\");\n      this.loginWithAnotherUserUrl = loginUrl + \"?next=\" + nextUrl;\n      taiga.defineImmutableProperty(this, \"user\", (function(_this) {\n        return function() {\n          return _this._user;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"application\", (function(_this) {\n        return function() {\n          return _this._application;\n        };\n      })(this));\n    }\n\n    ExternalAppController.prototype._redirect = function(applicationToken) {\n      var nextUrl;\n      nextUrl = applicationToken.get(\"next_url\");\n      return this.window.open(nextUrl, \"_self\");\n    };\n\n    ExternalAppController.prototype._getApplicationToken = function() {\n      return this.externalAppsService.getApplicationToken(this._applicationId, this._state).then((function(_this) {\n        return function(data) {\n          _this._application = data.get(\"application\");\n          if (data.get(\"auth_code\")) {\n            return _this._redirect(data);\n          } else {\n            return _this.loader.pageLoaded();\n          }\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          _this.loader.pageLoaded();\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    ExternalAppController.prototype.cancel = function() {\n      return this.window.history.back();\n    };\n\n    ExternalAppController.prototype.createApplicationToken = function() {\n      return this.externalAppsService.authorizeApplicationToken(this._applicationId, this._state).then((function(_this) {\n        return function(data) {\n          return _this._redirect(data);\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    return ExternalAppController;\n\n  })(taiga.Controller);\n\n  angular.module(\"taigaExternalApps\").controller(\"ExternalApp\", ExternalAppController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-app.service.coffee\n */\n\n(function() {\n  var ExternalAppsService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  ExternalAppsService = (function(superClass) {\n    extend(ExternalAppsService, superClass);\n\n    ExternalAppsService.$inject = [\"tgResources\"];\n\n    function ExternalAppsService(rs) {\n      this.rs = rs;\n    }\n\n    ExternalAppsService.prototype.getApplicationToken = function(applicationId, state) {\n      return this.rs.externalapps.getApplicationToken(applicationId, state);\n    };\n\n    ExternalAppsService.prototype.authorizeApplicationToken = function(applicationId, state) {\n      return this.rs.externalapps.authorizeApplicationToken(applicationId, state);\n    };\n\n    return ExternalAppsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaExternalApps\").service(\"tgExternalAppsService\", ExternalAppsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: feedback.service.coffee\n */\n\n(function() {\n  var FeedbackService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  FeedbackService = (function(superClass) {\n    extend(FeedbackService, superClass);\n\n    FeedbackService.$inject = [\"tgLightboxFactory\"];\n\n    function FeedbackService(lightboxFactory) {\n      this.lightboxFactory = lightboxFactory;\n    }\n\n    FeedbackService.prototype.sendFeedback = function() {\n      return this.lightboxFactory.create(\"tg-lb-feedback\", {\n        \"class\": \"lightbox lightbox-feedback lightbox-generic-form\"\n      });\n    };\n\n    return FeedbackService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaFeedback\").service(\"tgFeedbackService\", FeedbackService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history.controller.coffee\n */\n\n(function() {\n  var CommentController, module;\n\n  module = angular.module(\"taigaHistory\");\n\n  CommentController = (function() {\n    CommentController.$inject = [\"tgCurrentUserService\", \"tgCheckPermissionsService\", \"tgLightboxFactory\"];\n\n    function CommentController(currentUserService, permissionService, lightboxFactory) {\n      this.currentUserService = currentUserService;\n      this.permissionService = permissionService;\n      this.lightboxFactory = lightboxFactory;\n      this.hiddenDeletedComment = true;\n      this.commentContent = angular.copy(this.comment);\n    }\n\n    CommentController.prototype.showDeletedComment = function() {\n      return this.hiddenDeletedComment = false;\n    };\n\n    CommentController.prototype.hideDeletedComment = function() {\n      return this.hiddenDeletedComment = true;\n    };\n\n    CommentController.prototype.checkCancelComment = function(event) {\n      if (event.keyCode === 27) {\n        return this.onEditMode({\n          commentId: this.comment.id\n        });\n      }\n    };\n\n    CommentController.prototype.canEditDeleteComment = function() {\n      if (this.currentUserService.getUser()) {\n        this.user = this.currentUserService.getUser();\n        return this.user.get('id') === this.comment.user.pk || this.permissionService.check('modify_project');\n      }\n    };\n\n    CommentController.prototype.displayCommentHistory = function() {\n      return this.lightboxFactory.create('tg-lb-display-historic', {\n        \"class\": \"lightbox lightbox-display-historic\",\n        \"comment\": \"comment\",\n        \"name\": \"name\",\n        \"object\": \"object\"\n      }, {\n        \"comment\": this.comment,\n        \"name\": this.name,\n        \"object\": this.object\n      });\n    };\n\n    return CommentController;\n\n  })();\n\n  module.controller(\"CommentCtrl\", CommentController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: comment.directive.coffee\n */\n\n(function() {\n  var CommentDirective, module;\n\n  module = angular.module('taigaHistory');\n\n  CommentDirective = function() {\n    return {\n      scope: {\n        name: \"@\",\n        object: \"@\",\n        comment: \"<\",\n        type: \"<\",\n        loading: \"<\",\n        editing: \"<\",\n        deleting: \"<\",\n        objectId: \"<\",\n        editMode: \"<\",\n        onEditMode: \"&\",\n        onDeleteComment: \"&\",\n        onRestoreDeletedComment: \"&\",\n        onEditComment: \"&\"\n      },\n      templateUrl: \"history/comments/comment.html\",\n      bindToController: true,\n      controller: 'CommentCtrl',\n      controllerAs: \"vm\"\n    };\n  };\n\n  module.directive(\"tgComment\", CommentDirective);\n\n}).call(this);\n\n\n/*\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: comments.controller.coffee\n */\n\n(function() {\n  var CommentsController, module;\n\n  module = angular.module(\"taigaHistory\");\n\n  CommentsController = (function() {\n    CommentsController.$inject = [];\n\n    function CommentsController() {}\n\n    CommentsController.prototype.initializePermissions = function() {\n      return this.canAddCommentPermission = 'comment_' + this.name;\n    };\n\n    return CommentsController;\n\n  })();\n\n  module.controller(\"CommentsCtrl\", CommentsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: comments.directive.coffee\n */\n\n(function() {\n  var CommentsDirective, module;\n\n  module = angular.module('taigaHistory');\n\n  CommentsDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.initializePermissions();\n    };\n    return {\n      scope: {\n        type: \"<\",\n        name: \"@\",\n        object: \"@\",\n        comments: \"<\",\n        onEditMode: \"&\",\n        onDeleteComment: \"&\",\n        onRestoreDeletedComment: \"&\",\n        onAddComment: \"&\",\n        onEditComment: \"&\",\n        editMode: \"<\",\n        loading: \"<\",\n        deleting: \"<\",\n        editing: \"<\",\n        projectId: \"=\"\n      },\n      templateUrl: \"history/comments/comments.html\",\n      bindToController: true,\n      controller: 'CommentsCtrl',\n      controllerAs: \"vm\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgComments\", CommentsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history.controller.coffee\n */\n\n(function() {\n  var LightboxDisplayHistoricController, module;\n\n  module = angular.module(\"taigaHistory\");\n\n  LightboxDisplayHistoricController = (function() {\n    LightboxDisplayHistoricController.$inject = [\"$tgResources\"];\n\n    function LightboxDisplayHistoricController(rs) {\n      this.rs = rs;\n    }\n\n    LightboxDisplayHistoricController.prototype._loadHistoric = function() {\n      var activityId, objectId, type;\n      type = this.name;\n      objectId = this.object;\n      activityId = this.comment.id;\n      return this.rs.history.getCommentHistory(type, objectId, activityId).then((function(_this) {\n        return function(data) {\n          return _this.commentHistoryEntries = data;\n        };\n      })(this));\n    };\n\n    return LightboxDisplayHistoricController;\n\n  })();\n\n  module.controller(\"LightboxDisplayHistoricCtrl\", LightboxDisplayHistoricController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: comment.directive.coffee\n */\n\n(function() {\n  var LightboxDisplayHistoricDirective, module;\n\n  module = angular.module('taigaHistory');\n\n  LightboxDisplayHistoricDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      ctrl._loadHistoric();\n      return lightboxService.open(el);\n    };\n    return {\n      scope: {},\n      bindToController: {\n        name: '=',\n        object: '=',\n        comment: '='\n      },\n      templateUrl: \"history/history-lightbox/comment-history-lightbox.html\",\n      controller: \"LightboxDisplayHistoricCtrl\",\n      controllerAs: \"vm\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbDisplayHistoric\", LightboxDisplayHistoricDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: comment.directive.coffee\n */\n\n(function() {\n  var HistoryEntryDirective, module;\n\n  module = angular.module('taigaHistory');\n\n  HistoryEntryDirective = function(lightboxService) {\n    return {\n      scope: {\n        entry: \"<\"\n      },\n      templateUrl: \"history/history-lightbox/history-entry.html\"\n    };\n  };\n\n  module.directive(\"tgHistoryEntry\", HistoryEntryDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history-tabs.directive.coffee\n */\n\n(function() {\n  var HistoryTabsDirective, module;\n\n  module = angular.module('taigaHistory');\n\n  HistoryTabsDirective = function() {\n    return {\n      templateUrl: \"history/history-tabs/history-tabs.html\",\n      scope: {\n        showCommentTab: \"&\",\n        showActivityTab: \"&\",\n        onActiveComments: \"&\",\n        onActiveActivities: \"&\",\n        onOrderComments: \"&\",\n        activeTab: \"<\",\n        commentsNum: \"<\",\n        activitiesNum: \"<\",\n        onReverse: \"<\"\n      }\n    };\n  };\n\n  module.directive(\"tgHistoryTabs\", HistoryTabsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history.controller.coffee\n */\n\n(function() {\n  var HistorySectionController, module;\n\n  module = angular.module(\"taigaHistory\");\n\n  HistorySectionController = (function() {\n    HistorySectionController.$inject = [\"$tgResources\", \"$tgRepo\", \"$tgStorage\", \"tgProjectService\"];\n\n    function HistorySectionController(rs, repo, storage, projectService) {\n      this.rs = rs;\n      this.repo = repo;\n      this.storage = storage;\n      this.projectService = projectService;\n      this.editing = null;\n      this.deleting = null;\n      this.editMode = {};\n      this.viewComments = true;\n      this._loadHistory();\n      if (this.storage.get(\"orderComments\") != null) {\n        this.reverse = this.storage.get(\"orderComments\");\n      } else {\n        this.reverse = true;\n      }\n    }\n\n    HistorySectionController.prototype._loadHistory = function() {\n      return this.rs.history.get(this.name, this.id).then((function(_this) {\n        return function(history) {\n          _this._getComments(history);\n          return _this._getActivities(history);\n        };\n      })(this));\n    };\n\n    HistorySectionController.prototype._getComments = function(comments) {\n      this.comments = _.filter(comments, function(item) {\n        return item.comment !== \"\";\n      });\n      if (this.reverse) {\n        this.comments - _.reverse(this.comments);\n      }\n      return this.commentsNum = this.comments.length;\n    };\n\n    HistorySectionController.prototype._getActivities = function(activities) {\n      this.activities = _.filter(activities, function(item) {\n        return Object.keys(item.values_diff).length > 0;\n      });\n      return this.activitiesNum = this.activities.length;\n    };\n\n    HistorySectionController.prototype.showHistorySection = function() {\n      return this.showCommentTab() || this.showActivityTab();\n    };\n\n    HistorySectionController.prototype.showCommentTab = function() {\n      return this.commentsNum > 0 || this.projectService.hasPermission(\"comment_\" + this.name);\n    };\n\n    HistorySectionController.prototype.showActivityTab = function() {\n      return this.activitiesNum > 0;\n    };\n\n    HistorySectionController.prototype.toggleEditMode = function(commentId) {\n      return this.editMode[commentId] = !this.editMode[commentId];\n    };\n\n    HistorySectionController.prototype.onActiveHistoryTab = function(active) {\n      return this.viewComments = active;\n    };\n\n    HistorySectionController.prototype.deleteComment = function(commentId) {\n      var activityId, objectId, type;\n      type = this.name;\n      objectId = this.id;\n      activityId = commentId;\n      this.deleting = commentId;\n      return this.rs.history.deleteComment(type, objectId, activityId).then((function(_this) {\n        return function() {\n          _this._loadHistory();\n          return _this.deleting = commentId;\n        };\n      })(this));\n    };\n\n    HistorySectionController.prototype.editComment = function(commentId, comment) {\n      var activityId, objectId, type;\n      type = this.name;\n      objectId = this.id;\n      activityId = commentId;\n      this.editing = commentId;\n      return this.rs.history.editComment(type, objectId, activityId, comment).then((function(_this) {\n        return function() {\n          _this._loadHistory();\n          _this.toggleEditMode(commentId);\n          return _this.editing = null;\n        };\n      })(this));\n    };\n\n    HistorySectionController.prototype.restoreDeletedComment = function(commentId) {\n      var activityId, objectId, type;\n      type = this.name;\n      objectId = this.id;\n      activityId = commentId;\n      this.editing = commentId;\n      return this.rs.history.undeleteComment(type, objectId, activityId).then((function(_this) {\n        return function() {\n          _this._loadHistory();\n          return _this.editing = null;\n        };\n      })(this));\n    };\n\n    HistorySectionController.prototype.addComment = function() {\n      var type;\n      type = this.type;\n      this.loading = true;\n      return this.repo.save(this.type).then((function(_this) {\n        return function() {\n          _this._loadHistory();\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    HistorySectionController.prototype.onOrderComments = function() {\n      this.reverse = !this.reverse;\n      this.storage.set(\"orderComments\", this.reverse);\n      return this._loadHistory();\n    };\n\n    return HistorySectionController;\n\n  })();\n\n  module.controller(\"HistorySection\", HistorySectionController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history.directive.coffee\n */\n\n(function() {\n  var HistorySectionDirective, module;\n\n  module = angular.module('taigaHistory');\n\n  HistorySectionDirective = function() {\n    var link;\n    link = function(scope, el, attr, ctrl) {\n      return scope.$on(\"object:updated\", function() {\n        return ctrl._loadHistory(scope.type, scope.id);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"history/history.html\",\n      controller: \"HistorySection\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        type: \"=\",\n        name: \"@\",\n        id: \"=\",\n        projectId: \"=\"\n      }\n    };\n  };\n\n  HistorySectionDirective.$inject = [];\n\n  module.directive(\"tgHistorySection\", HistorySectionDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history.controller.coffee\n */\n\n(function() {\n  var ActivitiesDiffController, module;\n\n  module = angular.module(\"taigaHistory\");\n\n  ActivitiesDiffController = (function() {\n    ActivitiesDiffController.$inject = [];\n\n    function ActivitiesDiffController() {}\n\n    ActivitiesDiffController.prototype.diffTags = function() {\n      if (this.type === 'tags') {\n        this.diffRemoveTags = _.difference(this.diff[0], this.diff[1]).toString();\n        return this.diffAddTags = _.difference(this.diff[1], this.diff[0]).toString();\n      }\n    };\n\n    return ActivitiesDiffController;\n\n  })();\n\n  module.controller(\"ActivitiesDiffCtrl\", ActivitiesDiffController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history.directive.coffee\n */\n\n(function() {\n  var HistoryDiffDirective, module;\n\n  module = angular.module('taigaHistory');\n\n  HistoryDiffDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.diffTags();\n    };\n    return {\n      scope: {\n        type: \"<\",\n        diff: \"<\"\n      },\n      templateUrl: \"history/history/history-diff.html\",\n      controller: \"ActivitiesDiffCtrl\",\n      controllerAs: 'vm',\n      bindToController: true,\n      link: link\n    };\n  };\n\n  module.directive(\"tgHistoryDiff\", HistoryDiffDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history.directive.coffee\n */\n\n(function() {\n  var HistoryDirective, module;\n\n  module = angular.module('taigaHistory');\n\n  HistoryDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      scope: {\n        activities: \"<\"\n      },\n      templateUrl: \"history/history/history.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgHistory\", HistoryDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: duty.directive.coffee\n */\n\n(function() {\n  var DutyDirective;\n\n  DutyDirective = function(navurls, $translate) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      scope.vm.duty = scope.duty;\n      scope.vm.type = scope.type;\n      return scope.vm.getDutyType = function() {\n        if (scope.vm.duty) {\n          if (scope.vm.duty.get('_name') === \"epics\") {\n            return $translate.instant(\"COMMON.EPIC\");\n          }\n          if (scope.vm.duty.get('_name') === \"userstories\") {\n            return $translate.instant(\"COMMON.USER_STORY\");\n          }\n          if (scope.vm.duty.get('_name') === \"tasks\") {\n            return $translate.instant(\"COMMON.TASK\");\n          }\n          if (scope.vm.duty.get('_name') === \"issues\") {\n            return $translate.instant(\"COMMON.ISSUE\");\n          }\n        }\n      };\n    };\n    return {\n      templateUrl: \"home/duties/duty.html\",\n      scope: {\n        \"duty\": \"=tgDuty\",\n        \"type\": \"@\"\n      },\n      link: link\n    };\n  };\n\n  DutyDirective.$inject = [\"$tgNavUrls\", \"$translate\"];\n\n  angular.module(\"taigaHome\").directive(\"tgDuty\", DutyDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.controller.coffee\n */\n\n(function() {\n  var HomeController;\n\n  HomeController = (function() {\n    HomeController.$inject = [\"tgCurrentUserService\", \"$location\", \"$tgNavUrls\"];\n\n    function HomeController(currentUserService, location, navUrls) {\n      this.currentUserService = currentUserService;\n      this.location = location;\n      this.navUrls = navUrls;\n      if (!this.currentUserService.getUser()) {\n        this.location.path(this.navUrls.resolve(\"discover\"));\n      }\n    }\n\n    return HomeController;\n\n  })();\n\n  angular.module(\"taigaHome\").controller(\"Home\", HomeController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.service.coffee\n */\n\n(function() {\n  var HomeService, groupBy,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  groupBy = this.taiga.groupBy;\n\n  HomeService = (function(superClass) {\n    extend(HomeService, superClass);\n\n    HomeService.$inject = [\"$tgNavUrls\", \"tgResources\", \"tgProjectsService\"];\n\n    function HomeService(navurls, rs, projectsService) {\n      this.navurls = navurls;\n      this.rs = rs;\n      this.projectsService = projectsService;\n    }\n\n    HomeService.prototype._attachProjectInfoToWorkInProgress = function(workInProgress, projectsById) {\n      var _attachProjectInfoToDuty, _duties, _getValidDutiesAndAttachProjectInfo, assignedTo, watching;\n      _attachProjectInfoToDuty = (function(_this) {\n        return function(duty, objType) {\n          var ctx, project, url;\n          project = projectsById.get(String(duty.get('project')));\n          ctx = {\n            project: project.get('slug'),\n            ref: duty.get('ref')\n          };\n          url = _this.navurls.resolve(\"project-\" + objType + \"-detail\", ctx);\n          duty = duty.set('url', url);\n          duty = duty.set('project', project);\n          duty = duty.set(\"_name\", objType);\n          return duty;\n        };\n      })(this);\n      _getValidDutiesAndAttachProjectInfo = function(duties, dutyType) {\n        duties = duties.filter(function(duty) {\n          return projectsById.get(String(duty.get('project')));\n        });\n        duties = duties.map(function(duty) {\n          return _attachProjectInfoToDuty(duty, dutyType);\n        });\n        return duties;\n      };\n      assignedTo = workInProgress.get(\"assignedTo\");\n      if (assignedTo.get(\"epics\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(assignedTo.get(\"epics\"), \"epics\");\n        assignedTo = assignedTo.set(\"epics\", _duties);\n      }\n      if (assignedTo.get(\"userStories\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(assignedTo.get(\"userStories\"), \"userstories\");\n        assignedTo = assignedTo.set(\"userStories\", _duties);\n      }\n      if (assignedTo.get(\"tasks\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(assignedTo.get(\"tasks\"), \"tasks\");\n        assignedTo = assignedTo.set(\"tasks\", _duties);\n      }\n      if (assignedTo.get(\"issues\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(assignedTo.get(\"issues\"), \"issues\");\n        assignedTo = assignedTo.set(\"issues\", _duties);\n      }\n      watching = workInProgress.get(\"watching\");\n      if (watching.get(\"epics\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(watching.get(\"epics\"), \"epics\");\n        watching = watching.set(\"epics\", _duties);\n      }\n      if (watching.get(\"userStories\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(watching.get(\"userStories\"), \"userstories\");\n        watching = watching.set(\"userStories\", _duties);\n      }\n      if (watching.get(\"tasks\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(watching.get(\"tasks\"), \"tasks\");\n        watching = watching.set(\"tasks\", _duties);\n      }\n      if (watching.get(\"issues\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(watching.get(\"issues\"), \"issues\");\n        watching = watching.set(\"issues\", _duties);\n      }\n      workInProgress = workInProgress.set(\"assignedTo\", assignedTo);\n      return workInProgress = workInProgress.set(\"watching\", watching);\n    };\n\n    HomeService.prototype.getWorkInProgress = function(userId) {\n      var assignedEpicsPromise, assignedIssuesPromise, assignedTasksPromise, assignedTo, assignedUserStoriesPromise, params, params_epics, params_us, projectsById, projectsPromise, watching, watchingEpicsPromise, watchingIssuesPromise, watchingTasksPromise, watchingUserStoriesPromise, workInProgress;\n      projectsById = Immutable.Map();\n      projectsPromise = this.projectsService.getProjectsByUserId(userId).then(function(projects) {\n        return projectsById = Immutable.fromJS(groupBy(projects.toJS(), function(p) {\n          return p.id;\n        }));\n      });\n      assignedTo = Immutable.Map();\n      params = {\n        status__is_closed: false,\n        assigned_to: userId\n      };\n      params_us = {\n        is_closed: false,\n        assigned_to: userId\n      };\n      params_epics = {\n        is_closed: false,\n        assigned_to: userId\n      };\n      assignedEpicsPromise = this.rs.epics.listInAllProjects(params_epics).then(function(epics) {\n        return assignedTo = assignedTo.set(\"epics\", epics);\n      });\n      assignedUserStoriesPromise = this.rs.userstories.listInAllProjects(params_us).then(function(userstories) {\n        return assignedTo = assignedTo.set(\"userStories\", userstories);\n      });\n      assignedTasksPromise = this.rs.tasks.listInAllProjects(params).then(function(tasks) {\n        return assignedTo = assignedTo.set(\"tasks\", tasks);\n      });\n      assignedIssuesPromise = this.rs.issues.listInAllProjects(params).then(function(issues) {\n        return assignedTo = assignedTo.set(\"issues\", issues);\n      });\n      params = {\n        status__is_closed: false,\n        watchers: userId\n      };\n      params_us = {\n        is_closed: false,\n        watchers: userId\n      };\n      params_epics = {\n        is_closed: false,\n        watchers: userId\n      };\n      watching = Immutable.Map();\n      watchingEpicsPromise = this.rs.epics.listInAllProjects(params_epics).then(function(epics) {\n        return watching = watching.set(\"epics\", epics);\n      });\n      watchingUserStoriesPromise = this.rs.userstories.listInAllProjects(params_us).then(function(userstories) {\n        return watching = watching.set(\"userStories\", userstories);\n      });\n      watchingTasksPromise = this.rs.tasks.listInAllProjects(params).then(function(tasks) {\n        return watching = watching.set(\"tasks\", tasks);\n      });\n      watchingIssuesPromise = this.rs.issues.listInAllProjects(params).then(function(issues) {\n        return watching = watching.set(\"issues\", issues);\n      });\n      workInProgress = Immutable.Map();\n      return Promise.all([projectsPromise, assignedEpicsPromise, watchingEpicsPromise, assignedUserStoriesPromise, watchingUserStoriesPromise, assignedTasksPromise, watchingTasksPromise, assignedIssuesPromise, watchingIssuesPromise]).then((function(_this) {\n        return function() {\n          workInProgress = workInProgress.set(\"assignedTo\", assignedTo);\n          workInProgress = workInProgress.set(\"watching\", watching);\n          workInProgress = _this._attachProjectInfoToWorkInProgress(workInProgress, projectsById);\n          return workInProgress;\n        };\n      })(this));\n    };\n\n    return HomeService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaHome\").service(\"tgHomeService\", HomeService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home-project-list.directive.coffee\n */\n\n(function() {\n  var HomeProjectListDirective;\n\n  HomeProjectListDirective = function(currentUserService, projectsService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      return scope.vm.newProject = function() {\n        return projectsService.newProject();\n      };\n    };\n    directive = {\n      templateUrl: \"home/projects/home-project-list.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  HomeProjectListDirective.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n  angular.module(\"taigaHome\").directive(\"tgHomeProjectList\", HomeProjectListDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: working-on.controller.coffee\n */\n\n(function() {\n  var WorkingOnController;\n\n  WorkingOnController = (function() {\n    WorkingOnController.$inject = [\"tgHomeService\"];\n\n    function WorkingOnController(homeService) {\n      this.homeService = homeService;\n      this.assignedTo = Immutable.Map();\n      this.watching = Immutable.Map();\n    }\n\n    WorkingOnController.prototype._setAssignedTo = function(workInProgress) {\n      var epics, issues, tasks, userStories;\n      epics = workInProgress.get(\"assignedTo\").get(\"epics\");\n      userStories = workInProgress.get(\"assignedTo\").get(\"userStories\");\n      tasks = workInProgress.get(\"assignedTo\").get(\"tasks\");\n      issues = workInProgress.get(\"assignedTo\").get(\"issues\");\n      this.assignedTo = userStories.concat(tasks).concat(issues).concat(epics);\n      if (this.assignedTo.size > 0) {\n        return this.assignedTo = this.assignedTo.sortBy(function(elem) {\n          return elem.get(\"modified_date\");\n        }).reverse();\n      }\n    };\n\n    WorkingOnController.prototype._setWatching = function(workInProgress) {\n      var epics, issues, tasks, userStories;\n      epics = workInProgress.get(\"watching\").get(\"epics\");\n      userStories = workInProgress.get(\"watching\").get(\"userStories\");\n      tasks = workInProgress.get(\"watching\").get(\"tasks\");\n      issues = workInProgress.get(\"watching\").get(\"issues\");\n      this.watching = userStories.concat(tasks).concat(issues).concat(epics);\n      if (this.watching.size > 0) {\n        return this.watching = this.watching.sortBy(function(elem) {\n          return elem.get(\"modified_date\");\n        }).reverse();\n      }\n    };\n\n    WorkingOnController.prototype.getWorkInProgress = function(userId) {\n      return this.homeService.getWorkInProgress(userId).then((function(_this) {\n        return function(workInProgress) {\n          _this._setAssignedTo(workInProgress);\n          return _this._setWatching(workInProgress);\n        };\n      })(this));\n    };\n\n    return WorkingOnController;\n\n  })();\n\n  angular.module(\"taigaHome\").controller(\"WorkingOn\", WorkingOnController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: working-on.directive.coffee\n */\n\n(function() {\n  var WorkingOnDirective;\n\n  WorkingOnDirective = function(homeService, currentUserService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var user, userId;\n      user = currentUserService.getUser();\n      if (user) {\n        userId = user.get(\"id\");\n        return ctrl.getWorkInProgress(userId);\n      }\n    };\n    return {\n      controller: \"WorkingOn\",\n      controllerAs: \"vm\",\n      templateUrl: \"home/working-on/working-on.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  WorkingOnDirective.$inject = [\"tgHomeService\", \"tgCurrentUserService\"];\n\n  angular.module(\"taigaHome\").directive(\"tgWorkingOn\", WorkingOnDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: dropdown-project-list.directive.coffee\n */\n\n(function() {\n  var DropdownProjectListDirective;\n\n  DropdownProjectListDirective = function(currentUserService, projectsService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      return scope.vm.newProject = function() {\n        return projectsService.newProject();\n      };\n    };\n    directive = {\n      templateUrl: \"navigation-bar/dropdown-project-list/dropdown-project-list.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  DropdownProjectListDirective.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgDropdownProjectList\", DropdownProjectListDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: dropdown-user.directive.coffee\n */\n\n(function() {\n  var DropdownUserDirective;\n\n  DropdownUserDirective = function(authService, configService, locationService, navUrlsService, feedbackService, $rootScope) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      scope.vm.isFeedbackEnabled = configService.get(\"feedbackEnabled\");\n      taiga.defineImmutableProperty(scope.vm, \"user\", function() {\n        return authService.userData;\n      });\n      scope.vm.logout = function() {\n        authService.logout();\n        locationService.url(navUrlsService.resolve(\"discover\"));\n        return locationService.search({});\n      };\n      scope.vm.sendFeedback = function() {\n        return feedbackService.sendFeedback();\n      };\n      return scope.vm.userSettingsPlugins = _.filter($rootScope.userSettingsPlugins, {\n        userMenu: true\n      });\n    };\n    directive = {\n      templateUrl: \"navigation-bar/dropdown-user/dropdown-user.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  DropdownUserDirective.$inject = [\"$tgAuth\", \"$tgConfig\", \"$tgLocation\", \"$tgNavUrls\", \"tgFeedbackService\", \"$rootScope\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgDropdownUser\", DropdownUserDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.directive.coffee\n */\n\n(function() {\n  var NavigationBarDirective;\n\n  NavigationBarDirective = function(currentUserService, navigationBarService, locationService, navUrlsService, config) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      taiga.defineImmutableProperty(scope.vm, \"isAuthenticated\", function() {\n        return currentUserService.isAuthenticated();\n      });\n      taiga.defineImmutableProperty(scope.vm, \"isEnabledHeader\", function() {\n        return navigationBarService.isEnabledHeader();\n      });\n      scope.vm.publicRegisterEnabled = config.get(\"publicRegisterEnabled\");\n      scope.vm.login = function() {\n        var nextUrl;\n        nextUrl = encodeURIComponent(locationService.url());\n        locationService.url(navUrlsService.resolve(\"login\"));\n        return locationService.search({\n          next: nextUrl\n        });\n      };\n      scope.vm.register = function() {\n        var nextUrl;\n        nextUrl = encodeURIComponent(locationService.url());\n        locationService.url(navUrlsService.resolve(\"register\"));\n        return locationService.search({\n          next: nextUrl\n        });\n      };\n      return scope.$on(\"$routeChangeSuccess\", function() {\n        if (locationService.path() === \"/\") {\n          return scope.vm.active = true;\n        } else {\n          return scope.vm.active = false;\n        }\n      });\n    };\n    directive = {\n      templateUrl: \"navigation-bar/navigation-bar.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  NavigationBarDirective.$inject = [\"tgCurrentUserService\", \"tgNavigationBarService\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfig\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgNavigationBar\", NavigationBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.service.coffee\n */\n\n(function() {\n  var NavigationBarService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  NavigationBarService = (function(superClass) {\n    extend(NavigationBarService, superClass);\n\n    function NavigationBarService() {\n      this.disableHeader();\n    }\n\n    NavigationBarService.prototype.enableHeader = function() {\n      return this.enabledHeader = true;\n    };\n\n    NavigationBarService.prototype.disableHeader = function() {\n      return this.enabledHeader = false;\n    };\n\n    NavigationBarService.prototype.isEnabledHeader = function() {\n      return this.enabledHeader;\n    };\n\n    return NavigationBarService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaNavigationBar\").service(\"tgNavigationBarService\", NavigationBarService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-bar.controller.coffee\n */\n\n(function() {\n  var ProfileBarController;\n\n  ProfileBarController = (function() {\n    ProfileBarController.$inject = [\"tgUserService\"];\n\n    function ProfileBarController(userService) {\n      this.userService = userService;\n      this.loadStats();\n    }\n\n    ProfileBarController.prototype.loadStats = function() {\n      return this.userService.getStats(this.user.get(\"id\")).then((function(_this) {\n        return function(stats) {\n          return _this.stats = stats;\n        };\n      })(this));\n    };\n\n    return ProfileBarController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileBar\", ProfileBarController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-bar.directive.coffee\n */\n\n(function() {\n  var ProfileBarDirective;\n\n  ProfileBarDirective = function() {\n    return {\n      templateUrl: \"profile/profile-bar/profile-bar.html\",\n      controller: \"ProfileBar\",\n      controllerAs: \"vm\",\n      scope: {\n        user: \"=user\",\n        isCurrentUser: \"=iscurrentuser\"\n      },\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileBar\", ProfileBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-contacts.controller.coffee\n */\n\n(function() {\n  var ProfileContactsController;\n\n  ProfileContactsController = (function() {\n    ProfileContactsController.$inject = [\"tgUserService\", \"tgCurrentUserService\"];\n\n    function ProfileContactsController(userService, currentUserService) {\n      this.userService = userService;\n      this.currentUserService = currentUserService;\n      this.currentUser = this.currentUserService.getUser();\n      this.isCurrentUser = false;\n      if (this.currentUser && this.currentUser.get(\"id\") === this.user.get(\"id\")) {\n        this.isCurrentUser = true;\n      }\n    }\n\n    ProfileContactsController.prototype.loadContacts = function() {\n      return this.userService.getContacts(this.user.get(\"id\")).then((function(_this) {\n        return function(contacts) {\n          return _this.contacts = contacts;\n        };\n      })(this));\n    };\n\n    return ProfileContactsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileContacts\", ProfileContactsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-contacts.directive.coffee\n */\n\n(function() {\n  var ProfileContactsDirective;\n\n  ProfileContactsDirective = function() {\n    var link;\n    link = function(scope, elm, attrs, ctrl) {\n      return ctrl.loadContacts();\n    };\n    return {\n      templateUrl: \"profile/profile-contacts/profile-contacts.html\",\n      scope: {\n        user: \"=\"\n      },\n      controllerAs: \"vm\",\n      controller: \"ProfileContacts\",\n      link: link,\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileContacts\", ProfileContactsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: items.directive.coffee\n */\n\n(function() {\n  var FavItemDirective;\n\n  FavItemDirective = function() {\n    var link, templateUrl;\n    link = function(scope, el, attrs, ctrl) {\n      return scope.vm = {\n        item: scope.item\n      };\n    };\n    templateUrl = function(el, attrs) {\n      if (attrs.itemType === \"project\") {\n        return \"profile/profile-favs/items/project.html\";\n      } else {\n        return \"profile/profile-favs/items/ticket.html\";\n      }\n    };\n    return {\n      scope: {\n        \"item\": \"=tgFavItem\"\n      },\n      link: link,\n      templateUrl: templateUrl\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgFavItem\", FavItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-favs.controller.coffee\n */\n\n(function() {\n  var FavsBaseController, ProfileLikedController, ProfileVotedController, ProfileWatchedController, debounceLeading,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  FavsBaseController = (function() {\n    function FavsBaseController() {\n      this._init();\n    }\n\n    FavsBaseController.prototype._init = function() {\n      this.enableFilterByAll = true;\n      this.enableFilterByProjects = true;\n      this.enableFilterByEpics = true;\n      this.enableFilterByUserStories = true;\n      this.enableFilterByTasks = true;\n      this.enableFilterByIssues = true;\n      this.enableFilterByTextQuery = true;\n      this._resetList();\n      this.q = null;\n      return this.type = null;\n    };\n\n    FavsBaseController.prototype._resetList = function() {\n      this.items = Immutable.List();\n      this.scrollDisabled = false;\n      return this._page = 1;\n    };\n\n    FavsBaseController.prototype._enableLoadingSpinner = function() {\n      return this.isLoading = true;\n    };\n\n    FavsBaseController.prototype._disableLoadingSpinner = function() {\n      return this.isLoading = false;\n    };\n\n    FavsBaseController.prototype._enableScroll = function() {\n      return this.scrollDisabled = false;\n    };\n\n    FavsBaseController.prototype._disableScroll = function() {\n      return this.scrollDisabled = true;\n    };\n\n    FavsBaseController.prototype._checkIfHasMorePages = function(hasNext) {\n      if (hasNext) {\n        this._page += 1;\n        return this._enableScroll();\n      } else {\n        return this._disableScroll();\n      }\n    };\n\n    FavsBaseController.prototype._checkIfHasNoResults = function() {\n      return this.hasNoResults = this.items.size === 0;\n    };\n\n    FavsBaseController.prototype.loadItems = function() {\n      this._enableLoadingSpinner();\n      this._disableScroll();\n      return this._getItems(this.user.get(\"id\"), this._page, this.type, this.q).then((function(_this) {\n        return function(response) {\n          _this.items = _this.items.concat(response.get(\"data\"));\n          _this._checkIfHasMorePages(response.get(\"next\"));\n          _this._checkIfHasNoResults();\n          _this._disableLoadingSpinner();\n          return _this.items;\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function() {\n          _this._disableLoadingSpinner();\n          return _this.items;\n        };\n      })(this));\n    };\n\n    FavsBaseController.prototype.filterByTextQuery = debounceLeading(500, function() {\n      this._resetList();\n      return this.loadItems();\n    });\n\n    FavsBaseController.prototype.showAll = function() {\n      if (this.type !== null) {\n        this.type = null;\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showProjectsOnly = function() {\n      if (this.type !== \"project\") {\n        this.type = \"project\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showEpicsOnly = function() {\n      if (this.type !== \"epic\") {\n        this.type = \"epic\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showUserStoriesOnly = function() {\n      if (this.type !== \"userstory\") {\n        this.type = \"userstory\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showTasksOnly = function() {\n      if (this.type !== \"task\") {\n        this.type = \"task\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showIssuesOnly = function() {\n      if (this.type !== \"issue\") {\n        this.type = \"issue\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    return FavsBaseController;\n\n  })();\n\n  ProfileLikedController = (function(superClass) {\n    extend(ProfileLikedController, superClass);\n\n    ProfileLikedController.$inject = [\"tgUserService\"];\n\n    function ProfileLikedController(userService) {\n      this.userService = userService;\n      ProfileLikedController.__super__.constructor.call(this);\n      this.tabName = 'likes';\n      this.enableFilterByAll = false;\n      this.enableFilterByProjects = false;\n      this.enableFilterByEpics = false;\n      this.enableFilterByUserStories = false;\n      this.enableFilterByTasks = false;\n      this.enableFilterByIssues = false;\n      this.enableFilterByTextQuery = true;\n      this._getItems = this.userService.getLiked;\n    }\n\n    return ProfileLikedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileLiked\", ProfileLikedController);\n\n  ProfileVotedController = (function(superClass) {\n    extend(ProfileVotedController, superClass);\n\n    ProfileVotedController.$inject = [\"tgUserService\"];\n\n    function ProfileVotedController(userService) {\n      this.userService = userService;\n      ProfileVotedController.__super__.constructor.call(this);\n      this.tabName = 'upvotes';\n      this.enableFilterByAll = true;\n      this.enableFilterByProjects = false;\n      this.enableFilterByEpics = true;\n      this.enableFilterByUserStories = true;\n      this.enableFilterByTasks = true;\n      this.enableFilterByIssues = true;\n      this.enableFilterByTextQuery = true;\n      this._getItems = this.userService.getVoted;\n    }\n\n    return ProfileVotedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileVoted\", ProfileVotedController);\n\n  ProfileWatchedController = (function(superClass) {\n    extend(ProfileWatchedController, superClass);\n\n    ProfileWatchedController.$inject = [\"tgUserService\"];\n\n    function ProfileWatchedController(userService) {\n      this.userService = userService;\n      ProfileWatchedController.__super__.constructor.call(this);\n      this.tabName = 'watchers';\n      this._getItems = this.userService.getWatched;\n    }\n\n    return ProfileWatchedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileWatched\", ProfileWatchedController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-favs.directive.coffee\n */\n\n(function() {\n  var ProfileLikedDirective, ProfileVotedDirective, ProfileWatchedDirective, base;\n\n  base = {\n    scope: {},\n    bindToController: {\n      user: \"=\",\n      type: \"@\",\n      q: \"@\",\n      scrollDisabled: \"@\",\n      isLoading: \"@\",\n      hasNoResults: \"@\"\n    },\n    controller: null,\n    controllerAs: \"vm\",\n    templateUrl: \"profile/profile-favs/profile-favs.html\"\n  };\n\n  ProfileLikedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileLiked\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileLiked\", ProfileLikedDirective);\n\n  ProfileVotedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileVoted\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileVoted\", ProfileVotedDirective);\n\n  ProfileWatchedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileWatched\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileWatched\", ProfileWatchedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-hints.controller.coffee\n */\n\n(function() {\n  var ProfileHints;\n\n  ProfileHints = (function() {\n    ProfileHints.prototype.HINTS = [\n      {\n        url: \"https://tree.taiga.io/support/admin/import-export-projects/\"\n      }, {\n        url: \"https://tree.taiga.io/support/admin/custom-fields/\"\n      }, {}, {}\n    ];\n\n    function ProfileHints(translate) {\n      var hintKey;\n      this.translate = translate;\n      hintKey = Math.floor(Math.random() * this.HINTS.length) + 1;\n      this.hint = this.HINTS[hintKey - 1];\n      this.hint.linkText = this.hint.linkText || 'HINTS.LINK';\n      this.hint.title = this.translate.instant(\"HINTS.HINT\" + hintKey + \"_TITLE\");\n      this.hint.text = this.translate.instant(\"HINTS.HINT\" + hintKey + \"_TEXT\");\n    }\n\n    return ProfileHints;\n\n  })();\n\n  ProfileHints.$inject = [\"$translate\"];\n\n  angular.module(\"taigaProfile\").controller(\"ProfileHints\", ProfileHints);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-hints.directive.coffee\n */\n\n(function() {\n  var ProfileHints;\n\n  ProfileHints = function($translate) {\n    return {\n      scope: {},\n      controller: \"ProfileHints\",\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-hints/profile-hints.html\"\n    };\n  };\n\n  ProfileHints.$inject = [\"$translate\"];\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileHints\", ProfileHints);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-projects.controller.coffee\n */\n\n(function() {\n  var ProfileProjectsController;\n\n  ProfileProjectsController = (function() {\n    ProfileProjectsController.$inject = [\"tgProjectsService\", \"tgUserService\"];\n\n    function ProfileProjectsController(projectsService, userService) {\n      this.projectsService = projectsService;\n      this.userService = userService;\n    }\n\n    ProfileProjectsController.prototype.loadProjects = function() {\n      return this.projectsService.getProjectsByUserId(this.user.get(\"id\")).then((function(_this) {\n        return function(projects) {\n          return _this.userService.attachUserContactsToProjects(_this.user.get(\"id\"), projects);\n        };\n      })(this)).then((function(_this) {\n        return function(projects) {\n          return _this.projects = projects;\n        };\n      })(this));\n    };\n\n    return ProfileProjectsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileProjects\", ProfileProjectsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-projects.directive.coffee\n */\n\n(function() {\n  var ProfileProjectsDirective;\n\n  ProfileProjectsDirective = function() {\n    var link;\n    link = function(scope, elm, attr, ctrl) {\n      return ctrl.loadProjects();\n    };\n    return {\n      templateUrl: \"profile/profile-projects/profile-projects.html\",\n      scope: {\n        user: \"=\"\n      },\n      link: link,\n      bindToController: true,\n      controllerAs: \"vm\",\n      controller: \"ProfileProjects\"\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileProjects\", ProfileProjectsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tab.directive.coffee\n */\n\n(function() {\n  var ProfileTabDirective;\n\n  ProfileTabDirective = function() {\n    var link;\n    link = function(scope, element, attrs, ctrl, transclude) {\n      scope.tab = {};\n      attrs.$observe(\"tgProfileTab\", function(name) {\n        return scope.tab.name = name;\n      });\n      attrs.$observe(\"tabTitle\", function(title) {\n        return scope.tab.title = title;\n      });\n      scope.tab.icon = attrs.tabIcon;\n      scope.tab.active = !!attrs.tabActive;\n      if (scope.$eval(attrs.tabDisabled) !== true) {\n        return ctrl.addTab(scope.tab);\n      }\n    };\n    return {\n      templateUrl: \"profile/profile-tab/profile-tab.html\",\n      scope: {},\n      require: \"^tgProfileTabs\",\n      link: link,\n      transclude: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileTab\", ProfileTabDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tabs.controller.coffee\n */\n\n(function() {\n  var ProfileTabsController;\n\n  ProfileTabsController = (function() {\n    function ProfileTabsController() {\n      this.tabs = [];\n    }\n\n    ProfileTabsController.prototype.addTab = function(tab) {\n      return this.tabs.push(tab);\n    };\n\n    ProfileTabsController.prototype.toggleTab = function(tab) {\n      _.map(this.tabs, function(tab) {\n        return tab.active = false;\n      });\n      return tab.active = true;\n    };\n\n    return ProfileTabsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileTabs\", ProfileTabsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tabs.directive.coffee\n */\n\n(function() {\n  var ProfileTabsDirective;\n\n  ProfileTabsDirective = function() {\n    return {\n      scope: {},\n      controller: \"ProfileTabs\",\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-tabs/profile-tabs.html\",\n      transclude: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileTabs\", ProfileTabsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile.controller.coffee\n */\n\n(function() {\n  var ProfileController;\n\n  ProfileController = (function() {\n    ProfileController.$inject = [\"tgAppMetaService\", \"tgCurrentUserService\", \"$routeParams\", \"tgUserService\", \"tgXhrErrorService\", \"$translate\"];\n\n    function ProfileController(appMetaService, currentUserService, routeParams, userService, xhrError, translate) {\n      this.appMetaService = appMetaService;\n      this.currentUserService = currentUserService;\n      this.routeParams = routeParams;\n      this.userService = userService;\n      this.xhrError = xhrError;\n      this.translate = translate;\n      this.isCurrentUser = false;\n      if (this.routeParams.slug) {\n        this.userService.getUserByUserName(this.routeParams.slug).then((function(_this) {\n          return function(user) {\n            if (!user.get('is_active')) {\n              return _this.xhrError.notFound();\n            } else {\n              _this.user = user;\n              _this.isCurrentUser = false;\n              _this._setMeta(_this.user);\n              return user;\n            }\n          };\n        })(this))[\"catch\"]((function(_this) {\n          return function(xhr) {\n            return _this.xhrError.response(xhr);\n          };\n        })(this));\n      } else {\n        this.user = this.currentUserService.getUser();\n        this.isCurrentUser = true;\n        this._setMeta(this.user);\n      }\n    }\n\n    ProfileController.prototype._setMeta = function(user) {\n      var ctx, description, title;\n      ctx = {\n        userFullName: user.get(\"full_name_display\"),\n        userUsername: user.get(\"username\")\n      };\n      title = this.translate.instant(\"USER.PROFILE.PAGE_TITLE\", ctx);\n      description = user.get(\"bio\");\n      return this.appMetaService.setAll(title, description);\n    };\n\n    return ProfileController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"Profile\", ProfileController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: blocked-project-explanation.directive.coffee\n */\n\n(function() {\n  var BlockedProjectExplanationDirective;\n\n  BlockedProjectExplanationDirective = function() {\n    return {\n      templateUrl: \"projects/project/blocked-project-explanation.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgBlockedProjectExplanation\", BlockedProjectExplanationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.controller.coffee\n */\n\n(function() {\n  var LikeProjectButtonController;\n\n  LikeProjectButtonController = (function() {\n    LikeProjectButtonController.$inject = [\"$tgConfirm\", \"tgLikeProjectButtonService\"];\n\n    function LikeProjectButtonController(confirm, likeButtonService) {\n      this.confirm = confirm;\n      this.likeButtonService = likeButtonService;\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    LikeProjectButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    LikeProjectButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    LikeProjectButtonController.prototype.toggleLike = function() {\n      var promise;\n      this.loading = true;\n      if (!this.project.get(\"is_fan\")) {\n        promise = this._like();\n      } else {\n        promise = this._unlike();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    LikeProjectButtonController.prototype._like = function() {\n      return this.likeButtonService.like(this.project.get('id')).then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    LikeProjectButtonController.prototype._unlike = function() {\n      return this.likeButtonService.unlike(this.project.get('id'))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    return LikeProjectButtonController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"LikeProjectButton\", LikeProjectButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.directive.coffee\n */\n\n(function() {\n  var LikeProjectButtonDirective;\n\n  LikeProjectButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"LikeProjectButton\",\n      bindToController: {\n        project: '='\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/like-project-button/like-project-button.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgLikeProjectButton\", LikeProjectButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.service.coffee\n */\n\n(function() {\n  var LikeProjectButtonService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  LikeProjectButtonService = (function(superClass) {\n    extend(LikeProjectButtonService, superClass);\n\n    LikeProjectButtonService.$inject = [\"tgResources\", \"tgCurrentUserService\", \"tgProjectService\"];\n\n    function LikeProjectButtonService(rs, currentUserService, projectService) {\n      this.rs = rs;\n      this.currentUserService = currentUserService;\n      this.projectService = projectService;\n    }\n\n    LikeProjectButtonService.prototype._getProjectIndex = function(projectId) {\n      return this.currentUserService.projects.get('all').findIndex(function(project) {\n        return project.get('id') === projectId;\n      });\n    };\n\n    LikeProjectButtonService.prototype._updateProjects = function(projectId, isFan) {\n      var projectIndex, projects;\n      projectIndex = this._getProjectIndex(projectId);\n      if (projectIndex === -1) {\n        return;\n      }\n      projects = this.currentUserService.projects.get('all').update(projectIndex, function(project) {\n        var totalFans;\n        totalFans = project.get(\"total_fans\");\n        if (isFan) {\n          totalFans++;\n        } else {\n          totalFans--;\n        }\n        return project.merge({\n          is_fan: isFan,\n          total_fans: totalFans\n        });\n      });\n      return this.currentUserService.setProjects(projects);\n    };\n\n    LikeProjectButtonService.prototype._updateCurrentProject = function(isFan) {\n      var project, totalFans;\n      totalFans = this.projectService.project.get(\"total_fans\");\n      if (isFan) {\n        totalFans++;\n      } else {\n        totalFans--;\n      }\n      project = this.projectService.project.merge({\n        is_fan: isFan,\n        total_fans: totalFans\n      });\n      return this.projectService.setProject(project);\n    };\n\n    LikeProjectButtonService.prototype.like = function(projectId) {\n      return this.rs.projects.likeProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, true);\n          return _this._updateCurrentProject(true);\n        };\n      })(this));\n    };\n\n    LikeProjectButtonService.prototype.unlike = function(projectId) {\n      return this.rs.projects.unlikeProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, false);\n          return _this._updateCurrentProject(false);\n        };\n      })(this));\n    };\n\n    return LikeProjectButtonService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgLikeProjectButtonService\", LikeProjectButtonService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: sort-projects.directive.coffee\n */\n\n(function() {\n  var SortProjectsDirective;\n\n  SortProjectsDirective = function(currentUserService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      var drake, itemEl, scroll;\n      itemEl = null;\n      drake = dragula([el[0]], {\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: el[0],\n        moves: function(item) {\n          return $(item).hasClass('list-itemtype-project');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var i, index, len, project, sortData, sorted_project_ids, value;\n        itemEl = $(item);\n        project = itemEl.scope().project;\n        index = itemEl.index();\n        sorted_project_ids = _.map(scope.projects.toJS(), function(p) {\n          return p.id;\n        });\n        sorted_project_ids = _.without(sorted_project_ids, project.get(\"id\"));\n        sorted_project_ids.splice(index, 0, project.get('id'));\n        sortData = [];\n        for (index = i = 0, len = sorted_project_ids.length; i < len; index = ++i) {\n          value = sorted_project_ids[index];\n          sortData.push({\n            \"project_id\": value,\n            \"order\": index\n          });\n        }\n        return currentUserService.bulkUpdateProjectsOrder(sortData);\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        el.off();\n        return drake.destroy();\n      });\n    };\n    directive = {\n      scope: {\n        projects: \"=tgSortProjects\"\n      },\n      link: link\n    };\n    return directive;\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgSortProjects\", [\"tgCurrentUserService\", SortProjectsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.controller.coffee\n */\n\n(function() {\n  var WatchProjectButtonController;\n\n  WatchProjectButtonController = (function() {\n    WatchProjectButtonController.$inject = [\"$tgConfirm\", \"tgWatchProjectButtonService\"];\n\n    function WatchProjectButtonController(confirm, watchButtonService) {\n      this.confirm = confirm;\n      this.watchButtonService = watchButtonService;\n      this.showWatchOptions = false;\n      this.loading = false;\n    }\n\n    WatchProjectButtonController.prototype.toggleWatcherOptions = function() {\n      return this.showWatchOptions = !this.showWatchOptions;\n    };\n\n    WatchProjectButtonController.prototype.closeWatcherOptions = function() {\n      return this.showWatchOptions = false;\n    };\n\n    WatchProjectButtonController.prototype.watch = function(notifyLevel) {\n      if (notifyLevel === this.project.get('notify_level')) {\n        return;\n      }\n      this.loading = true;\n      this.closeWatcherOptions();\n      return this.watchButtonService.watch(this.project.get('id'), notifyLevel)[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    WatchProjectButtonController.prototype.unwatch = function() {\n      this.loading = true;\n      this.closeWatcherOptions();\n      return this.watchButtonService.unwatch(this.project.get('id'))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    return WatchProjectButtonController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"WatchProjectButton\", WatchProjectButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.directive.coffee\n */\n\n(function() {\n  var WatchProjectButtonDirective;\n\n  WatchProjectButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"WatchProjectButton\",\n      bindToController: {\n        project: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/watch-project-button/watch-project-button.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgWatchProjectButton\", WatchProjectButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.service.coffee\n */\n\n(function() {\n  var WatchProjectButtonService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  WatchProjectButtonService = (function(superClass) {\n    extend(WatchProjectButtonService, superClass);\n\n    WatchProjectButtonService.$inject = [\"tgResources\", \"tgCurrentUserService\", \"tgProjectService\"];\n\n    function WatchProjectButtonService(rs, currentUserService, projectService) {\n      this.rs = rs;\n      this.currentUserService = currentUserService;\n      this.projectService = projectService;\n    }\n\n    WatchProjectButtonService.prototype._getProjectIndex = function(projectId) {\n      return this.currentUserService.projects.get('all').findIndex(function(project) {\n        return project.get('id') === projectId;\n      });\n    };\n\n    WatchProjectButtonService.prototype._updateProjects = function(projectId, notifyLevel, isWatcher) {\n      var projectIndex, projects;\n      projectIndex = this._getProjectIndex(projectId);\n      if (projectIndex === -1) {\n        return;\n      }\n      projects = this.currentUserService.projects.get('all').update(projectIndex, (function(_this) {\n        return function(project) {\n          var totalWatchers;\n          totalWatchers = project.get('total_watchers');\n          if (!_this.projectService.project.get('is_watcher') && isWatcher) {\n            totalWatchers++;\n          } else if (_this.projectService.project.get('is_watcher') && !isWatcher) {\n            totalWatchers--;\n          }\n          return project.merge({\n            is_watcher: isWatcher,\n            total_watchers: totalWatchers,\n            notify_level: notifyLevel\n          });\n        };\n      })(this));\n      return this.currentUserService.setProjects(projects);\n    };\n\n    WatchProjectButtonService.prototype._updateCurrentProject = function(notifyLevel, isWatcher) {\n      var project, totalWatchers;\n      totalWatchers = this.projectService.project.get(\"total_watchers\");\n      if (!this.projectService.project.get('is_watcher') && isWatcher) {\n        totalWatchers++;\n      } else if (this.projectService.project.get('is_watcher') && !isWatcher) {\n        totalWatchers--;\n      }\n      project = this.projectService.project.merge({\n        is_watcher: isWatcher,\n        notify_level: notifyLevel,\n        total_watchers: totalWatchers\n      });\n      return this.projectService.setProject(project);\n    };\n\n    WatchProjectButtonService.prototype.watch = function(projectId, notifyLevel) {\n      return this.rs.projects.watchProject(projectId, notifyLevel).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, notifyLevel, true);\n          return _this._updateCurrentProject(notifyLevel, true);\n        };\n      })(this));\n    };\n\n    WatchProjectButtonService.prototype.unwatch = function(projectId) {\n      return this.rs.projects.unwatchProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, null, false);\n          return _this._updateCurrentProject(null, false);\n        };\n      })(this));\n    };\n\n    return WatchProjectButtonService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgWatchProjectButtonService\", WatchProjectButtonService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects-listing.controller.coffee\n */\n\n(function() {\n  var ProjectsListingController;\n\n  ProjectsListingController = (function() {\n    ProjectsListingController.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n    function ProjectsListingController(currentUserService, projectsService) {\n      this.currentUserService = currentUserService;\n      this.projectsService = projectsService;\n      taiga.defineImmutableProperty(this, \"projects\", (function(_this) {\n        return function() {\n          return _this.currentUserService.projects.get(\"all\");\n        };\n      })(this));\n    }\n\n    ProjectsListingController.prototype.newProject = function() {\n      return this.projectsService.newProject();\n    };\n\n    return ProjectsListingController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"ProjectsListing\", ProjectsListingController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.controller.coffee\n */\n\n(function() {\n  var ProjectController;\n\n  ProjectController = (function() {\n    ProjectController.$inject = [\"$routeParams\", \"tgAppMetaService\", \"$tgAuth\", \"$translate\", \"tgProjectService\"];\n\n    function ProjectController(routeParams, appMetaService, auth, translate, projectService) {\n      this.routeParams = routeParams;\n      this.appMetaService = appMetaService;\n      this.auth = auth;\n      this.translate = translate;\n      this.projectService = projectService;\n      this.user = this.auth.userData;\n      taiga.defineImmutableProperty(this, \"project\", (function(_this) {\n        return function() {\n          return _this.projectService.project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"members\", (function(_this) {\n        return function() {\n          return _this.projectService.activeMembers;\n        };\n      })(this));\n      this.appMetaService.setfn(this._setMeta.bind(this));\n    }\n\n    ProjectController.prototype._setMeta = function() {\n      var ctx;\n      if (!this.project) {\n        return null;\n      }\n      ctx = {\n        projectName: this.project.get(\"name\")\n      };\n      return {\n        title: this.translate.instant(\"PROJECT.PAGE_TITLE\", ctx),\n        description: this.project.get(\"description\")\n      };\n    };\n\n    return ProjectController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"Project\", ProjectController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects.service.coffee\n */\n\n(function() {\n  var ProjectsService, groupBy, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  ProjectsService = (function(superClass) {\n    extend(ProjectsService, superClass);\n\n    ProjectsService.$inject = [\"tgResources\", \"$projectUrl\", \"tgLightboxFactory\"];\n\n    function ProjectsService(rs, projectUrl, lightboxFactory) {\n      this.rs = rs;\n      this.projectUrl = projectUrl;\n      this.lightboxFactory = lightboxFactory;\n    }\n\n    ProjectsService.prototype.getProjectBySlug = function(projectSlug) {\n      return this.rs.projects.getProjectBySlug(projectSlug).then((function(_this) {\n        return function(project) {\n          return _this._decorate(project);\n        };\n      })(this));\n    };\n\n    ProjectsService.prototype.getProjectStats = function(projectId) {\n      return this.rs.projects.getProjectStats(projectId);\n    };\n\n    ProjectsService.prototype.getProjectsByUserId = function(userId, paginate) {\n      return this.rs.projects.getProjectsByUserId(userId, paginate).then((function(_this) {\n        return function(projects) {\n          return projects.map(_this._decorate.bind(_this));\n        };\n      })(this));\n    };\n\n    ProjectsService.prototype._decorate = function(project) {\n      var url;\n      url = this.projectUrl.get(project.toJS());\n      project = project.set(\"url\", url);\n      return project;\n    };\n\n    ProjectsService.prototype.newProject = function() {\n      return this.lightboxFactory.create(\"tg-lb-create-project\", {\n        \"class\": \"wizard-create-project lightbox\"\n      });\n    };\n\n    ProjectsService.prototype.bulkUpdateProjectsOrder = function(sortData) {\n      return this.rs.projects.bulkUpdateOrder(sortData);\n    };\n\n    ProjectsService.prototype.transferValidateToken = function(projectId, token) {\n      return this.rs.projects.transferValidateToken(projectId, token);\n    };\n\n    ProjectsService.prototype.transferAccept = function(projectId, token, reason) {\n      return this.rs.projects.transferAccept(projectId, token, reason);\n    };\n\n    ProjectsService.prototype.transferReject = function(projectId, token, reason) {\n      return this.rs.projects.transferReject(projectId, token, reason);\n    };\n\n    return ProjectsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgProjectsService\", ProjectsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: cant-own-project-explanation.directive.coffee\n */\n\n(function() {\n  var CantOwnProjectExplanationDirective;\n\n  CantOwnProjectExplanationDirective = function() {\n    return {\n      templateUrl: \"projects/transfer/cant-own-project-explanation.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgCantOwnProjectExplanation\", CantOwnProjectExplanationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: transfer-project.directive.coffee\n */\n\n(function() {\n  var TransferProject, module;\n\n  module = angular.module('taigaProjects');\n\n  TransferProject = (function() {\n    TransferProject.$inject = [\"$routeParams\", \"tgProjectsService\", \"$location\", \"$tgAuth\", \"tgCurrentUserService\", \"$tgNavUrls\", \"$translate\", \"$tgConfirm\", \"tgErrorHandlingService\"];\n\n    function TransferProject(routeParams, projectService, location, authService, currentUserService, navUrls, translate, confirmService, errorHandlingService) {\n      this.routeParams = routeParams;\n      this.projectService = projectService;\n      this.location = location;\n      this.authService = authService;\n      this.currentUserService = currentUserService;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.confirmService = confirmService;\n      this.errorHandlingService = errorHandlingService;\n    }\n\n    TransferProject.prototype.initialize = function() {\n      this.projectId = this.project.get(\"id\");\n      this.token = this.routeParams.token;\n      this.showAddComment = false;\n      return this._refreshUserData();\n    };\n\n    TransferProject.prototype._validateToken = function() {\n      return this.projectService.transferValidateToken(this.projectId, this.token).then(null, (function(_this) {\n        return function(data, status) {\n          return _this.errorHandlingService.notfound();\n        };\n      })(this));\n    };\n\n    TransferProject.prototype._refreshUserData = function() {\n      return this.authService.refresh().then((function(_this) {\n        return function() {\n          _this._validateToken();\n          _this._setProjectData();\n          return _this._checkOwnerData();\n        };\n      })(this));\n    };\n\n    TransferProject.prototype._setProjectData = function() {\n      return this.canBeOwnedByUser = this.currentUserService.canOwnProject(this.project);\n    };\n\n    TransferProject.prototype._checkOwnerData = function() {\n      var currentUser, maxMemberships;\n      currentUser = this.currentUserService.getUser();\n      if (this.project.get('is_private')) {\n        this.ownerMessage = 'ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PRIVATE';\n        this.maxProjects = currentUser.get('max_private_projects');\n        if (this.maxProjects === null) {\n          this.maxProjects = this.translate.instant('ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS');\n        }\n        this.currentProjects = currentUser.get('total_private_projects');\n        maxMemberships = currentUser.get('max_memberships_private_projects');\n      } else {\n        this.ownerMessage = 'ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PUBLIC';\n        this.maxProjects = currentUser.get('max_public_projects');\n        if (this.maxProjects === null) {\n          this.maxProjects = this.translate.instant('ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS');\n        }\n        this.currentProjects = currentUser.get('total_public_projects');\n        maxMemberships = currentUser.get('max_memberships_public_projects');\n      }\n      return this.validNumberOfMemberships = maxMemberships === null || this.project.get('total_memberships') <= maxMemberships;\n    };\n\n    TransferProject.prototype.transferAccept = function(token, reason) {\n      this.loadingAccept = true;\n      return this.projectService.transferAccept(this.project.get(\"id\"), token, reason).then((function(_this) {\n        return function() {\n          var newUrl;\n          newUrl = _this.navUrls.resolve(\"project-admin-project-profile-details\", {\n            project: _this.project.get(\"slug\")\n          });\n          _this.loadingAccept = false;\n          _this.location.path(newUrl);\n          _this.confirmService.notify(\"success\", _this.translate.instant(\"ADMIN.PROJECT_TRANSFER.ACCEPTED_PROJECT_OWNERNSHIP\"), '', 5000);\n        };\n      })(this));\n    };\n\n    TransferProject.prototype.transferReject = function(token, reason) {\n      this.loadingReject = true;\n      return this.projectService.transferReject(this.project.get(\"id\"), token, reason).then((function(_this) {\n        return function() {\n          var newUrl;\n          newUrl = _this.navUrls.resolve(\"home\", {\n            project: _this.project.get(\"slug\")\n          });\n          _this.loadingReject = false;\n          _this.location.path(newUrl);\n          _this.confirmService.notify(\"success\", _this.translate.instant(\"ADMIN.PROJECT_TRANSFER.REJECTED_PROJECT_OWNERNSHIP\"), '', 5000);\n        };\n      })(this));\n    };\n\n    TransferProject.prototype.addComment = function() {\n      return this.showAddComment = true;\n    };\n\n    TransferProject.prototype.hideComment = function() {\n      this.showAddComment = false;\n      return this.reason = '';\n    };\n\n    return TransferProject;\n\n  })();\n\n  module.controller(\"TransferProjectController\", TransferProject);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: transfer-project.directive.coffee\n */\n\n(function() {\n  var TransferProjectDirective, module;\n\n  module = angular.module('taigaProjects');\n\n  TransferProjectDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.initialize();\n    };\n    return {\n      link: link,\n      scope: {},\n      bindToController: {\n        project: \"=\"\n      },\n      templateUrl: \"projects/transfer/transfer-project.html\",\n      controller: 'TransferProjectController',\n      controllerAs: 'vm'\n    };\n  };\n\n  module.directive('tgTransferProject', TransferProjectDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-resource.service.coffee\n */\n\n(function() {\n  var Resource, module, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  Resource = function(urlsService, http, config, $rootScope, $q, storage) {\n    var service;\n    service = {};\n    service.list = function(type, objectId, projectId) {\n      var httpOptions, params, url, urlname;\n      urlname = \"attachments/\" + type;\n      params = {\n        object_id: objectId,\n        project: projectId\n      };\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      url = urlsService.resolve(urlname);\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service[\"delete\"] = function(type, id) {\n      var url, urlname;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname) + (\"/\" + id);\n      return http[\"delete\"](url);\n    };\n    service.patch = function(type, id, patch) {\n      var url, urlname;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname) + (\"/\" + id);\n      return http.patch(url, patch);\n    };\n    service.create = function(type, projectId, objectId, file) {\n      var data, defered, maxFileSize, response, token, uploadComplete, uploadFailed, uploadProgress, url, urlname, xhr;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname);\n      defered = $q.defer();\n      if (file === void 0) {\n        defered.reject(null);\n        return defered.promise;\n      }\n      maxFileSize = config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered.reject(response);\n        return defered.promise;\n      }\n      uploadProgress = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            file.status = \"in-progress\";\n            file.size = sizeFormat(evt.total);\n            file.progressMessage = \"upload \" + (sizeFormat(evt.loaded)) + \" of \" + (sizeFormat(evt.total));\n            return file.progressPercent = (Math.round((evt.loaded / evt.total) * 100)) + \"%\";\n          });\n        };\n      })(this);\n      uploadComplete = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            var attachment, ref, status;\n            file.status = \"done\";\n            status = evt.target.status;\n            try {\n              attachment = JSON.parse(evt.target.responseText);\n            } catch (error) {\n              attachment = {};\n            }\n            if (status >= 200 && status < 400) {\n              attachment = Immutable.fromJS(attachment);\n              return defered.resolve(attachment);\n            } else {\n              response = {\n                status: status,\n                data: {\n                  _error_message: (ref = data['attached_file']) != null ? ref[0] : void 0\n                }\n              };\n              return defered.reject(response);\n            }\n          });\n        };\n      })(this);\n      uploadFailed = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            file.status = \"error\";\n            return defered.reject(\"fail\");\n          });\n        };\n      })(this);\n      data = new FormData();\n      data.append(\"project\", projectId);\n      data.append(\"object_id\", objectId);\n      data.append(\"attached_file\", file);\n      xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener(\"progress\", uploadProgress, false);\n      xhr.addEventListener(\"load\", uploadComplete, false);\n      xhr.addEventListener(\"error\", uploadFailed, false);\n      token = storage.get('token');\n      xhr.open(\"POST\", url);\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send(data);\n      return defered.promise;\n    };\n    return function() {\n      return {\n        \"attachments\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"$tgConfig\", \"$rootScope\", \"$q\", \"$tgStorage\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgAttachmentsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"epics\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.list = function(projectId) {\n      var params, url;\n      url = urlsService.resolve(\"epics\");\n      params = {\n        project: projectId\n      };\n      return http.get(url, params).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.patch = function(id, patch) {\n      var url;\n      url = urlsService.resolve(\"epics\") + (\"/\" + id);\n      return http.patch(url, patch).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.post = function(params) {\n      var url;\n      url = urlsService.resolve(\"epics\");\n      return http.post(url, params).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.reorder = function(id, data, setOrders) {\n      var options, url;\n      url = urlsService.resolve(\"epics\") + (\"/\" + id);\n      options = {\n        \"headers\": {\n          \"set-orders\": JSON.stringify(setOrders)\n        }\n      };\n      return http.patch(url, data, null, options);\n    };\n    service.addRelatedUserstory = function(epicId, userstoryId) {\n      var params, url;\n      url = urlsService.resolve(\"epic-related-userstories\", epicId);\n      params = {\n        user_story: userstoryId,\n        epic: epicId\n      };\n      return http.post(url, params);\n    };\n    service.reorderRelatedUserstory = function(epicId, userstoryId, data, setOrders) {\n      var options, url;\n      url = urlsService.resolve(\"epic-related-userstories\", epicId) + (\"/\" + userstoryId);\n      options = {\n        \"headers\": {\n          \"set-orders\": JSON.stringify(setOrders)\n        }\n      };\n      return http.patch(url, data, null, options);\n    };\n    service.bulkCreateRelatedUserStories = function(epicId, projectId, bulk_userstories) {\n      var params, url;\n      url = urlsService.resolve(\"epic-related-userstories-bulk-create\", epicId);\n      params = {\n        bulk_userstories: bulk_userstories,\n        project_id: projectId\n      };\n      return http.post(url, params);\n    };\n    service.deleteRelatedUserstory = function(epicId, userstoryId) {\n      var url;\n      url = urlsService.resolve(\"epic-related-userstories\", epicId) + (\"/\" + userstoryId);\n      return http[\"delete\"](url);\n    };\n    return function() {\n      return {\n        \"epics\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgEpicsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-apps-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.getApplicationToken = function(applicationId, state) {\n      var url;\n      url = urlsService.resolve(\"applications\");\n      url = url + \"/\" + applicationId + \"/token?state=\" + state;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.authorizeApplicationToken = function(applicationId, state) {\n      var data, url;\n      url = urlsService.resolve(\"application-tokens\");\n      url = url + \"/authorize\";\n      data = {\n        \"state\": state,\n        \"application\": applicationId\n      };\n      return http.post(url, data).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"externalapps\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgExternalAppsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: issues-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"issues\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"issues\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgIssuesResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects-resource.service.coffee\n */\n\n(function() {\n  var Resource, module, pagination;\n\n  pagination = function() {};\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getProjects = function(params, pagination) {\n      var httpOptions, url;\n      if (params == null) {\n        params = {};\n      }\n      if (pagination == null) {\n        pagination = true;\n      }\n      url = urlsService.resolve(\"projects\");\n      httpOptions = {};\n      if (!pagination) {\n        httpOptions = {\n          headers: {\n            \"x-lazy-pagination\": true\n          }\n        };\n      }\n      return http.get(url, params, httpOptions);\n    };\n    service.getAllProjects = function(params) {\n      var httpOptions, url;\n      if (params == null) {\n        params = {};\n      }\n      url = urlsService.resolve(\"projects\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions);\n    };\n    service.getProjectBySlug = function(projectSlug) {\n      var url;\n      url = urlsService.resolve(\"projects\");\n      url = url + \"/by_slug?slug=\" + projectSlug;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getProjectsByUserId = function(userId, paginate) {\n      var httpOptions, params, url;\n      if (paginate == null) {\n        paginate = false;\n      }\n      url = urlsService.resolve(\"projects\");\n      httpOptions = {};\n      if (!paginate) {\n        httpOptions.headers = {\n          \"x-disable-pagination\": \"1\"\n        };\n      }\n      params = {\n        \"member\": userId,\n        \"order_by\": \"user_order\"\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getProjectStats = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"projects\");\n      url = url + \"/\" + projectId;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.bulkUpdateOrder = function(bulkData) {\n      var url;\n      url = urlsService.resolve(\"bulk-update-projects-order\");\n      return http.post(url, bulkData);\n    };\n    service.getTimeline = function(projectId, page) {\n      var params, url;\n      params = {\n        page: page,\n        only_relevant: true\n      };\n      url = urlsService.resolve(\"timeline-project\");\n      url = url + \"/\" + projectId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.likeProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-like\", projectId);\n      return http.post(url);\n    };\n    service.unlikeProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-unlike\", projectId);\n      return http.post(url);\n    };\n    service.watchProject = function(projectId, notifyLevel) {\n      var data, url;\n      data = {\n        notify_level: notifyLevel\n      };\n      url = urlsService.resolve(\"project-watch\", projectId);\n      return http.post(url, data);\n    };\n    service.unwatchProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-unwatch\", projectId);\n      return http.post(url);\n    };\n    service.transferValidateToken = function(projectId, token) {\n      var data, url;\n      data = {\n        token: token\n      };\n      url = urlsService.resolve(\"project-transfer-validate-token\", projectId);\n      return http.post(url, data);\n    };\n    service.transferAccept = function(projectId, token, reason) {\n      var data, url;\n      data = {\n        token: token,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-accept\", projectId);\n      return http.post(url, data);\n    };\n    service.transferReject = function(projectId, token, reason) {\n      var data, url;\n      data = {\n        token: token,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-reject\", projectId);\n      return http.post(url, data);\n    };\n    service.transferRequest = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-transfer-request\", projectId);\n      return http.post(url);\n    };\n    service.transferStart = function(projectId, userId, reason) {\n      var data, url;\n      data = {\n        user: userId,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-start\", projectId);\n      return http.post(url, data);\n    };\n    return function() {\n      return {\n        \"projects\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"tgPaginateResponseService\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgProjectsResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: resources.coffee\n */\n\n(function() {\n  var Resources, services;\n\n  services = [\"tgProjectsResources\", \"tgUserResources\", \"tgUsersResources\", \"tgUserstoriesResource\", \"tgTasksResource\", \"tgIssuesResource\", \"tgExternalAppsResource\", \"tgAttachmentsResource\", \"tgStatsResource\", \"tgWikiHistory\", \"tgEpicsResource\"];\n\n  Resources = function($injector) {\n    var i, j, len, len1, ref, service, serviceFn, serviceName, serviceProperty;\n    for (i = 0, len = services.length; i < len; i++) {\n      serviceName = services[i];\n      serviceFn = $injector.get(serviceName);\n      service = $injector.invoke(serviceFn);\n      ref = Object.keys(service);\n      for (j = 0, len1 = ref.length; j < len1; j++) {\n        serviceProperty = ref[j];\n        if (this[serviceProperty]) {\n          console.warm(\"repeated resource \" + serviceProperty);\n        }\n        this[serviceProperty] = service[serviceProperty];\n      }\n    }\n    return this;\n  };\n\n  Resources.$inject = [\"$injector\"];\n\n  angular.module(\"taigaResources2\").service(\"tgResources\", Resources);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: stats-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.discover = function(applicationId, state) {\n      var url;\n      url = urlsService.resolve(\"stats-discover\");\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"stats\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgStatsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tasks-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"tasks\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"tasks\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgTasksResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getUserStorage = function(key) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-storage\");\n      if (key) {\n        url += '/' + key;\n      }\n      httpOptions = {};\n      return http.get(url, {}).then(function(response) {\n        return response.data.value;\n      });\n    };\n    service.setUserStorage = function(key, value) {\n      var params, url;\n      url = urlsService.resolve(\"user-storage\") + '/' + key;\n      params = {\n        key: key,\n        value: value\n      };\n      return http.put(url, params);\n    };\n    service.createUserStorage = function(key, value) {\n      var params, url;\n      url = urlsService.resolve(\"user-storage\");\n      params = {\n        key: key,\n        value: value\n      };\n      return http.post(url, params);\n    };\n    return function() {\n      return {\n        \"user\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUserResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: users-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getUserByUsername = function(username) {\n      var httpOptions, params, url;\n      url = urlsService.resolve(\"by_username\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      params = {\n        username: username\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getStats = function(userId) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-stats\", userId);\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, {}, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getContacts = function(userId) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-contacts\", userId);\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, {}, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getLiked = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-liked\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      params.only_relevant = true;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getVoted = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-voted\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getWatched = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-watched\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getProfileTimeline = function(userId, page) {\n      var params, url;\n      params = {\n        page: page\n      };\n      url = urlsService.resolve(\"timeline-profile\");\n      url = url + \"/\" + userId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getUserTimeline = function(userId, page) {\n      var params, url;\n      params = {\n        page: page,\n        only_relevant: true\n      };\n      url = urlsService.resolve(\"timeline-user\");\n      url = url + \"/\" + userId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    return function() {\n      return {\n        \"users\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"tgPaginateResponseService\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUsersResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: userstories-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"userstories\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.listAllInProject = function(projectId) {\n      var httpOptions, params, url;\n      url = urlsService.resolve(\"userstories\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      params = {\n        project: projectId\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.listInEpic = function(epicIid) {\n      var params, url;\n      url = urlsService.resolve(\"userstories\");\n      params = {\n        'epic': epicIid,\n        'order_by': 'epic_order',\n        'include_tasks': true\n      };\n      return http.get(url, params).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"userstories\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUserstoriesResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: wiki-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.getWikiHistory = function(wikiId) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"history/wiki\", wikiId);\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, null, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"wikiHistory\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgWikiHistory\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: search-form.controller.coffee\n */\n\n(function() {\n  var DateInputController;\n\n  DateInputController = (function() {\n    DateInputController.$inject = ['$timeout'];\n\n    function DateInputController(timeout) {\n      this.timeout = timeout;\n      this.fromFormats = {\n        from: \"From\",\n        hours_ago: \"hours ago\",\n        days_ago: \"days ago\",\n        weeks_ago: \"weeks ago\",\n        months_ago: \"months ago\",\n        years_ago: \"years ago\"\n      };\n      this.selectedFromFormat = \"from\";\n      this.timeDeltaFrom = null;\n      this.toFormats = {\n        end_of_day: \"Until\",\n        before: \"Before\",\n        in_hours: \"in hours\",\n        in_days: \"in days\",\n        in_weeks: \"in weeks\",\n        in_months: \"in months\",\n        in_years: \"in years\"\n      };\n      this.selectedToFormat = \"end_of_day\";\n      this.timeDeltaTo = null;\n    }\n\n    DateInputController.prototype.selectFromFormat = function(fromFormat) {\n      var previousFormat;\n      previousFormat = this.selectedFromFormat;\n      this.selectedFromFormat = fromFormat;\n      if (!this.isDateFormat(previousFormat) && !this.isDateFormat(fromFormat) && (this.timeDeltaFrom != null)) {\n        return this.submitTimeDelta();\n      } else if (this.isDateFormat(previousFormat)) {\n        return this.timeDeltaFrom = null;\n      } else if (this.isDateFormat(fromFormat)) {\n        return this.dateGte = \"\";\n      }\n    };\n\n    DateInputController.prototype.selectToFormat = function(toFormat) {\n      var previousFormat;\n      previousFormat = this.selectedToFormat;\n      this.selectedToFormat = toFormat;\n      if (!this.isDateFormat(previousFormat) && !this.isDateFormat(toFormat) && (this.timeDeltaTo != null)) {\n        return this.submitTimeDelta();\n      } else if (this.isDateFormat(previousFormat) && this.isDateFormat(toFormat)) {\n        return this.callback({});\n      } else if (this.isDateFormat(previousFormat)) {\n        return this.timeDeltaTo = null;\n      } else if (this.isDateFormat(toFormat)) {\n        return this.dateLte = \"\";\n      }\n    };\n\n    DateInputController.prototype.submitTimeDelta = function() {\n      return this.timeout((function(_this) {\n        return function() {\n          var dateGte, dateLte;\n          dateGte = _this.dateGte;\n          if (!_this.isDateFormat(_this.selectedFromFormat)) {\n            dateGte = _this.selectedFromFormat + (_this.timeDeltaFrom || 0);\n          }\n          dateLte = _this.dateLte;\n          if (!_this.isDateFormat(_this.selectedToFormat)) {\n            dateLte = _this.selectedToFormat + (_this.timeDeltaTo || 0);\n          }\n          _this.dateGte = dateGte;\n          return _this.dateLte = dateLte;\n        };\n      })(this));\n    };\n\n    DateInputController.prototype.resetDateValues = function(dateGte, dateLte) {\n      var k, ref, ref1, results, v;\n      if (dateGte == null) {\n        dateGte = \"\";\n      }\n      if (dateLte == null) {\n        dateLte = \"\";\n      }\n      this.dateGte = dateGte;\n      ref = this.fromFormats;\n      for (k in ref) {\n        v = ref[k];\n        if (dateGte.startsWith(k)) {\n          this.selectedFromFormat = k;\n          this.timeDeltaFrom = parseInt(dateGte.replace(RegExp(\"^\" + k), \"\"));\n          break;\n        }\n      }\n      if (dateLte.startsWith(\"end_of_day\")) {\n        this.selectedToFormat = \"end_of_day\";\n        return this.dateLte = dateLte.replace(/^end_of_day/, \"\");\n      } else if (dateLte.startsWith(\"before\")) {\n        this.selectedToFormat = \"before\";\n        return this.dateLte = dateLte.replace(/^before/, \"\");\n      } else {\n        this.dateLte = dateLte;\n        ref1 = this.toFormats;\n        results = [];\n        for (k in ref1) {\n          v = ref1[k];\n          if (dateLte.startsWith(k)) {\n            this.selectedToFormat = k;\n            this.timeDeltaTo = parseInt(dateLte.replace(RegExp(\"^\" + k), \"\"));\n            break;\n          } else {\n            results.push(void 0);\n          }\n        }\n        return results;\n      }\n    };\n\n    DateInputController.prototype.callback = function(params) {\n      var onChange, ref;\n      onChange = this.onChange();\n      if (onChange != null) {\n        if (!params.hasOwnProperty(\"dateGte\")) {\n          params[\"dateGte\"] = this.dateGte;\n        }\n        if (!params.hasOwnProperty(\"dateLte\")) {\n          params[\"dateLte\"] = this.dateLte;\n        }\n        if (this.selectedToFormat === \"end_of_day\" && ((ref = params.dateLte) != null ? ref.length : void 0) && !params.dateLte.startsWith(\"end_of_day\")) {\n          params = angular.copy(params);\n          params.dateLte = \"end_of_day\" + params.dateLte;\n        }\n        return onChange(params);\n      }\n    };\n\n    DateInputController.prototype.isDateFormat = function(format) {\n      return [\"from\", \"before\", \"end_of_day\"].indexOf(format) !== -1;\n    };\n\n    return DateInputController;\n\n  })();\n\n  angular.module(\"taigaSearch\").controller(\"DateInput\", DateInputController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: search.directive.coffee\n */\n\n(function() {\n  var SearchDateInputDirective;\n\n  SearchDateInputDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      ctrl.resetDateValues(scope.vm.inputDateGte, scope.vm.inputDateLte);\n      scope.$watch(\"vm.dateGte\", function(newValue, oldValue) {\n        if (newValue === \"\") {\n          newValue = null;\n        }\n        return ctrl.callback({\n          dateGte: newValue\n        });\n      });\n      return scope.$watch(\"vm.dateLte\", function(newValue, oldValue) {\n        if (newValue === \"\") {\n          newValue = null;\n        }\n        return ctrl.callback({\n          dateLte: newValue\n        });\n      });\n    };\n    return {\n      controller: \"DateInput\",\n      controllerAs: \"vm\",\n      templateUrl: 'search/components/date-input/' + 'date-input.html',\n      bindToController: true,\n      scope: {\n        inputDateGte: \"=dateGte\",\n        inputDateLte: \"=dateLte\",\n        onChange: \"&\"\n      },\n      link: link\n    };\n  };\n\n  angular.module('taigaSearch').directive('tgSearchDateInput', SearchDateInputDirective);\n\n}).call(this);\n\n(function() {\n  var generateHash, module, searchFilterParamsProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  searchFilterParamsProvider = function($repo, $model, $storage) {\n    var defineMethod, getGenericMap, getStatusMap, i, len, model, ref, service;\n    service = {\n      forModel: {}\n    };\n    getStatusMap = function(model) {\n      return $repo.queryMany(model + \"-statuses\").then(function(result) {\n        var base, description, i, key, len, map, r;\n        map = {};\n        for (i = 0, len = result.length; i < len; i++) {\n          description = result[i];\n          key = description.name.toLowerCase();\n          if (!map[key]) {\n            map[key] = {\n              name: description.name,\n              slug: description.slug,\n              details: []\n            };\n          }\n          map[key].details.push(description);\n        }\n        r = {\n          name: \"Status\",\n          param: \"status\",\n          choices: map\n        };\n        (base = service.forModel)[model] || (base[model] = {});\n        service.forModel[model][r[\"param\"]] = r;\n        return r;\n      });\n    };\n    service.getProjectMap = function() {\n      return $repo.queryMany(\"projects\").then(function(result) {\n        var base, description, i, key, len, map, r;\n        map = {};\n        for (i = 0, len = result.length; i < len; i++) {\n          description = result[i];\n          key = description.name.toLowerCase();\n          if (!map[key]) {\n            map[key] = {\n              name: description.name,\n              slug: description.slug,\n              details: []\n            };\n          }\n          map[key].details.push(description);\n        }\n        r = {\n          name: \"Project\",\n          param: \"project\",\n          choices: map\n        };\n        (base = service.forModel)[model] || (base[model] = {});\n        service.forModel[model][r[\"param\"]] = r;\n        return r;\n      });\n    };\n    getGenericMap = function(model, resource, param) {\n      var label;\n      label = _.capitalize(param);\n      return $repo.queryMany(resource).then(function(result) {\n        var base, description, i, key, len, map, r;\n        map = {};\n        for (i = 0, len = result.length; i < len; i++) {\n          description = result[i];\n          key = description.name.toLowerCase();\n          if (!map[key]) {\n            map[key] = {\n              name: description.name,\n              slug: description.slug,\n              details: []\n            };\n          }\n          map[key].details.push(description);\n        }\n        r = {\n          name: label,\n          param: param,\n          choices: map\n        };\n        (base = service.forModel)[model] || (base[model] = {});\n        service.forModel[model][r[\"param\"]] = r;\n        return r;\n      });\n    };\n    defineMethod = function(method) {\n      var args;\n      args = Array.prototype.slice.call(arguments).slice(1);\n      return function() {\n        return method.apply(null, args);\n      };\n    };\n    ref = [\"issue\", \"userstory\", \"task\"];\n    for (i = 0, len = ref.length; i < len; i++) {\n      model = ref[i];\n      service[\"get\" + (_.capitalize(model)) + \"StatusMap\"] = defineMethod(getStatusMap, model);\n    }\n    service[\"getIssueTypeMap\"] = defineMethod(getGenericMap, \"issue\", \"issue-types\", \"type\");\n    service[\"getIssueSeverityMap\"] = defineMethod(getGenericMap, \"issue\", \"severities\", \"severity\");\n    service[\"getIssuePriorityMap\"] = defineMethod(getGenericMap, \"issue\", \"priorities\", \"priority\");\n    service.getDateFilter = function(name, param) {\n      return {\n        name: name,\n        param: param,\n        date: true\n      };\n    };\n    service.getUserMap = function() {\n      return $repo.queryMany(\"users\").then(function(result) {\n        var description, j, key, len1, map;\n        map = {};\n        for (j = 0, len1 = result.length; j < len1; j++) {\n          description = result[j];\n          key = description.full_name.toLowerCase();\n          if (!map[key]) {\n            map[key] = {\n              name: description.full_name_display,\n              username: description.username,\n              id: description.id,\n              details: []\n            };\n          }\n          map[key].details.push(description);\n        }\n        return {\n          name: \"Assignee\",\n          param: \"assigned_to\",\n          choices: map\n        };\n      });\n    };\n    return service;\n  };\n\n  module = angular.module(\"taigaSearch\");\n\n  module.factory(\"$tgSearchFilterParamsProvider\", [\"$tgRepo\", \"$tgModel\", \"$tgStorage\", searchFilterParamsProvider]);\n\n}).call(this);\n\n(function() {\n  var highlightTerms, html5ToEntities, module;\n\n  module = angular.module(\"taigaSearch\");\n\n  html5ToEntities = function(value) {\n    return value.replace(/[\\u00A0-\\u9999<>\\&\\'\\\"]/gim, function(i) {\n      return '&#' + i.charCodeAt(0) + ';';\n    });\n  };\n\n  highlightTerms = function($sce) {\n    return function(text, search, limit) {\n      var j, len, regex, s, searchTerms;\n      if (limit == null) {\n        limit = 150;\n      }\n      if (!(text != null ? text.length : void 0) > 0) {\n        return \"\";\n      }\n      text = html5ToEntities(text);\n      if (!search) {\n        return text;\n      } else {\n        searchTerms = search.split(' ');\n        searchTerms.sort(function(a, b) {\n          return b.length - a.length;\n        });\n        for (j = 0, len = searchTerms.length; j < len; j++) {\n          s = searchTerms[j];\n          regex = RegExp(\"<span.*?<\\\\/span>|(\" + s + \")\", \"ig\");\n          text = text.replace(regex, '<span class=\"search-match\">$&</span>');\n        }\n        return $sce.trustAsHtml(text);\n      }\n    };\n  };\n\n  module.filter(\"highlightTerms\", ['$sce', highlightTerms]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: search-form.controller.coffee\n */\n\n(function() {\n  var FilterParamsController, SearchFormController, includesAny,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  includesAny = function(array, values) {\n    var entry, i, len;\n    for (i = 0, len = array.length; i < len; i++) {\n      entry = array[i];\n      if (_.includes(values, entry.id.toString())) {\n        return true;\n      }\n    }\n    return false;\n  };\n\n  FilterParamsController = (function() {\n    function FilterParamsController() {\n      this.filterSpecs || (this.filterSpecs = {});\n      this.resetFilterValues();\n      this.loadFilterSpecs(this.selectedSearchType).then((function(_this) {\n        return function() {\n          return _this.getFilterValuesFromRouteParams();\n        };\n      })(this));\n    }\n\n    FilterParamsController.prototype.resetFilterValues = function() {\n      var base;\n      this.filterValues = {};\n      if (this.selectedSearchType === \"text\") {\n        return (base = this.params).filter || (base.filter = 'all');\n      }\n    };\n\n    FilterParamsController.prototype.isSelectedFilterValue = function(param, choice) {\n      var base;\n      (base = this.filterValues)[param] || (base[param] = []);\n      return _.includes(this.filterValues[param], choice);\n    };\n\n    FilterParamsController.prototype.toggleFilterValue = function(param, choice) {\n      var base;\n      (base = this.filterValues)[param] || (base[param] = []);\n      if (this.isSelectedFilterValue(param, choice)) {\n        this.removeFilterValue(param, choice);\n      } else {\n        this.setFilterValue(param, choice);\n      }\n      return this.callback();\n    };\n\n    FilterParamsController.prototype.toggleAllFilterValues = function(filterSpec, negated_choice) {\n      var base, idx, param, ref, v;\n      param = filterSpec.param;\n      (base = this.filterValues)[param] || (base[param] = []);\n      if (((ref = this.filterValues[param]) != null ? ref.length : void 0) > 0) {\n        if (negated_choice != null) {\n          idx = this.filterValues[param].indexOf(negated_choice);\n          if (idx !== -1 || Object.keys(filterSpec.choices).length !== this.filterValues[param].length + 1) {\n            this.filterValues[param] = (function() {\n              var i, len, ref1, results;\n              ref1 = _.values(filterSpec.choices);\n              results = [];\n              for (i = 0, len = ref1.length; i < len; i++) {\n                v = ref1[i];\n                if (v !== negated_choice) {\n                  results.push(v);\n                }\n              }\n              return results;\n            })();\n          } else {\n            this.filterValues[param] = [negated_choice];\n          }\n        } else {\n          this.filterValues[param] = [];\n        }\n      } else {\n        this.filterValues[param] = (function() {\n          var i, len, ref1, results;\n          ref1 = _.values(filterSpec.choices);\n          results = [];\n          for (i = 0, len = ref1.length; i < len; i++) {\n            v = ref1[i];\n            if (v !== negated_choice) {\n              results.push(v);\n            }\n          }\n          return results;\n        })();\n      }\n      this.updateFilterValueParam(param);\n      return this.callback();\n    };\n\n    FilterParamsController.prototype.setFilterValue = function(param, choice) {\n      var base;\n      (base = this.filterValues)[param] || (base[param] = []);\n      this.filterValues[param].push(choice);\n      return this.updateFilterValueParam(param);\n    };\n\n    FilterParamsController.prototype.updateFilterValueParam = function(param) {\n      var c, e, paramValues, paramsValues;\n      paramValues = this.filterValues[param];\n      if ((paramValues != null ? paramValues.length : void 0) > 0) {\n        paramsValues = _.flatten((function() {\n          var i, len, results;\n          results = [];\n          for (i = 0, len = paramValues.length; i < len; i++) {\n            c = paramValues[i];\n            results.push((function() {\n              var j, len1, ref, results1;\n              ref = c.details;\n              results1 = [];\n              for (j = 0, len1 = ref.length; j < len1; j++) {\n                e = ref[j];\n                results1.push(e.id);\n              }\n              return results1;\n            })());\n          }\n          return results;\n        })());\n        paramsValues.sort();\n        return this.params[param] = paramsValues.join(\",\");\n      } else {\n        return this.params[param] = null;\n      }\n    };\n\n    FilterParamsController.prototype.getFilterValuesFromRouteParams = function() {\n      var c, filterSpec, i, len, ref, results, values;\n      ref = this.currentFilterSpecs();\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        filterSpec = ref[i];\n        if (this.routeParams[filterSpec.param] != null) {\n          values = this.routeParams[filterSpec.param].split(\",\");\n          results.push(this.filterValues[filterSpec.param] = (function() {\n            var j, len1, ref1, results1;\n            ref1 = _.values(filterSpec.choices);\n            results1 = [];\n            for (j = 0, len1 = ref1.length; j < len1; j++) {\n              c = ref1[j];\n              if (includesAny(c.details, values)) {\n                results1.push(c);\n              }\n            }\n            return results1;\n          })());\n        } else {\n          results.push(void 0);\n        }\n      }\n      return results;\n    };\n\n    FilterParamsController.prototype.removeFilterValue = function(param, choice) {\n      var base;\n      (base = this.filterValues)[param] || (base[param] = []);\n      _.remove(this.filterValues[param], choice);\n      return this.updateFilterValueParam(param);\n    };\n\n    FilterParamsController.prototype.loadFilterSpecs = function(type) {\n      var filters, method;\n      if (type == null) {\n        type = this.selectedSearchType;\n      }\n      method = \"get\" + (_.capitalize(type)) + \"FilterParams\";\n      filters = this.filterSpecs[type] || [];\n      if ((this.filterSpecs[type] != null) || (this[method] == null)) {\n        return this.$q.when(filters);\n      } else {\n        return this[method]().then((function(_this) {\n          return function(result) {\n            return _this.filterSpecs[type] = result;\n          };\n        })(this));\n      }\n    };\n\n    FilterParamsController.prototype.currentFilterSpecs = function() {\n      return this.filterSpecs[this.selectedSearchType] || [];\n    };\n\n    FilterParamsController.prototype.getIssuesFilterParams = function() {\n      console.log(\"caslaslasas\");\n      return this.$q.all(this.commonFilters([this.filterParams.getIssueTypeMap(), this.filterParams.getIssueSeverityMap(), this.filterParams.getIssuePriorityMap(), this.filterParams.getIssueStatusMap(), this.filterParams.getDateFilter(\"Due date\", \"due_date\")]));\n    };\n\n    FilterParamsController.prototype.getTasksFilterParams = function() {\n      return this.$q.all(this.commonFilters([this.filterParams.getTaskStatusMap(), this.filterParams.getDateFilter(\"Sprint start\", \"milestone__estimated_start\"), this.filterParams.getDateFilter(\"Sprint end\", \"milestone__estimated_end\")]));\n    };\n\n    FilterParamsController.prototype.getUserstoriesFilterParams = function() {\n      return this.$q.all(this.commonFilters([this.filterParams.getUserstoryStatusMap(), this.filterParams.getDateFilter(\"Sprint start\", \"milestone__estimated_start\"), this.filterParams.getDateFilter(\"Sprint end\", \"milestone__estimated_end\")]));\n    };\n\n    FilterParamsController.prototype.getSprintsFilterParams = function() {\n      return this.$q.all(this.commonFilters([this.filterParams.getDateFilter(\"Start\", \"estimated_start\"), this.filterParams.getDateFilter(\"End\", \"estimated_end\")], \"sprints\"));\n    };\n\n    FilterParamsController.prototype.commonFilters = function(moreFilters, model) {\n      return moreFilters.concat(_.compact([this.filterParams.getProjectMap(), this.filterParams.getDateFilter(\"Created\", \"created_date\"), this.filterParams.getDateFilter(\"Modified\", \"modified_date\"), model !== \"sprints\" ? this.filterParams.getUserMap() : void 0]));\n    };\n\n    return FilterParamsController;\n\n  })();\n\n  SearchFormController = (function(superClass) {\n    extend(SearchFormController, superClass);\n\n    SearchFormController.$inject = ['$q', '$tgLocation', '$tgNavUrls', '$routeParams', '$tgSearchFilterParamsProvider'];\n\n    function SearchFormController($q, location, navUrls, routeParams, filterParams) {\n      this.$q = $q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.routeParams = routeParams;\n      this.filterParams = filterParams;\n      this.searchTypes = {\n        text: \"SEARCH.SEARCH_TEXT\",\n        issues: \"SEARCH.FILTER_ISSUES\",\n        tasks: \"SEARCH.FILTER_TASKS\",\n        userstories: \"SEARCH.FILTER_USER_STORIES\",\n        sprints: \"SEARCH.FILTER_SPRINTS\"\n      };\n      this.selectedSearchType = this.routeParams.result_type || \"text\";\n      this.params = angular.copy(this.routeParams);\n      SearchFormController.__super__.constructor.apply(this, arguments);\n    }\n\n    SearchFormController.prototype.paramsChanged = function() {\n      var k, ref, v;\n      if (this.selectedSearchType !== this.routeParams.result_type) {\n        return true;\n      }\n      ref = this.params;\n      for (k in ref) {\n        v = ref[k];\n        if (v != null) {\n          if (k === \"storedSearchName\") {\n            continue;\n          }\n          if (v !== this.routeParams[k]) {\n            return true;\n          }\n        }\n      }\n      return false;\n    };\n\n    SearchFormController.prototype.getFiltersTemplate = function() {\n      if (this.selectedSearchType === \"text\") {\n        return \"search/components/search-form/text-search-params.html\";\n      } else {\n        return \"search/components/search-form/filtered-search-params.html\";\n      }\n    };\n\n    SearchFormController.prototype.selectSearchType = function(type) {\n      return this.loadFilterSpecs(type).then((function(_this) {\n        return function() {\n          _this.selectedSearchType = type;\n          return _this.resetParams();\n        };\n      })(this));\n    };\n\n    SearchFormController.prototype.getDateSelector = function(type) {\n      var selectDate;\n      selectDate = (function(_this) {\n        return function(params) {\n          var base, changed, dateGte, dateLte, key, update;\n          dateGte = params[\"dateGte\"];\n          dateLte = params[\"dateLte\"];\n          changed = false;\n          update = {};\n          update[type + \"__gte\"] = dateGte;\n          update[type + \"__lte\"] = dateLte;\n          for (key in update) {\n            update[key] || (update[key] = null);\n            (base = _this.params)[key] || (base[key] = null);\n            if (_this.params[key] !== update[key]) {\n              _this.params[key] = update[key];\n              changed = true;\n            }\n          }\n          if (changed) {\n            return _this.callback();\n          }\n        };\n      })(this);\n      return selectDate;\n    };\n\n    SearchFormController.prototype.resetParams = function() {\n      this.params = {};\n      return this.resetFilterValues();\n    };\n\n    SearchFormController.prototype.selectFilter = function(filter) {\n      this.params.filter = filter;\n      return this.callback();\n    };\n\n    SearchFormController.prototype.toggleItemType = function(itemType) {\n      var index;\n      index = this.params.item_types.indexOf(itemType);\n      if (index === -1) {\n        return this.params.item_types.push(itemType);\n      } else {\n        return this.params.item_types.splice(index, 1);\n      }\n    };\n\n    SearchFormController.prototype.submitFilter = function() {\n      return this.callback();\n    };\n\n    SearchFormController.prototype.currentResultType = function() {\n      return this.routeParams.result_type;\n    };\n\n    SearchFormController.prototype.callback = function(params) {\n      var k, onChange, result_type, url, v;\n      params = params || this.params;\n      for (k in params) {\n        v = params[k];\n        if (!(v != null ? v.length : void 0)) {\n          params[k] = null;\n        }\n      }\n      this.params['order_by'] = this.routeParams['order_by'];\n      if (this.searchTypes[this.selectedSearchType] == null) {\n        return;\n      }\n      result_type = {\n        result_type: this.selectedSearchType\n      };\n      onChange = this.onChange();\n      if (this.currentResultType() === this.selectedSearchType && (onChange != null)) {\n        this.location.search(params);\n        return onChange(params);\n      } else {\n        url = this.navUrls.resolve(\"search-results\", result_type);\n        delete params['result_type'];\n        return this.location.search(params).path(url);\n      }\n    };\n\n    return SearchFormController;\n\n  })(FilterParamsController);\n\n  angular.module(\"taigaSearch\").controller(\"SearchForm\", SearchFormController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: search.directive.coffee\n */\n\n(function() {\n  var SearchFormDirective;\n\n  SearchFormDirective = function(filterParams) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      controller: \"SearchForm\",\n      controllerAs: \"vm\",\n      templateUrl: 'search/components/search-form/' + 'search-form.html',\n      bindToController: true,\n      scope: {\n        q: \"=\",\n        filter: \"=\",\n        onChange: \"&\"\n      },\n      link: link\n    };\n  };\n\n  SearchFormDirective.$inject = [\"$tgSearchFilterParamsProvider\"];\n\n  angular.module('taigaSearch').directive('tgSearchForm', SearchFormDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: search-form.controller.coffee\n */\n\n(function() {\n  var StoredSearchInputController, generateHash, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  StoredSearchInputController = (function() {\n    StoredSearchInputController.$inject = ['$tgStoredSearchProvider', '$routeParams', '$tgNavUrls', '$httpParamSerializer', \"$location\"];\n\n    function StoredSearchInputController(storedSearch, routeParams, navUrls, paramSerializer, location) {\n      this.storedSearch = storedSearch;\n      this.routeParams = routeParams;\n      this.navUrls = navUrls;\n      this.paramSerializer = paramSerializer;\n      this.location = location;\n      this.initialParams = angular.copy(this.routeParams);\n      this.storedSearchName = this.routeParams.storedSearchName || \"\";\n      this.justSaved = false;\n    }\n\n    StoredSearchInputController.prototype.saveStoredSearchItem = function() {\n      this.routeParams.storedSearchName = this.storedSearchName;\n      this.storedSearch.updateStoredSearchItem(this.storedSearchName, (function(_this) {\n        return function() {\n          var updateLocation;\n          return _this.generateUrl(updateLocation = true);\n        };\n      })(this));\n      return this.justSaved = true;\n    };\n\n    StoredSearchInputController.prototype.generateUrl = function(updateLocation) {\n      var params, result_type, url;\n      if (updateLocation == null) {\n        updateLocation = false;\n      }\n      result_type = this.routeParams[\"result_type\"] || \"text\";\n      url = this.navUrls.resolve(\"search-results\", {\n        result_type: result_type\n      });\n      params = _.omit(this.routeParams, \"result_type\");\n      if (updateLocation) {\n        this.location.search(params);\n      }\n      return url + \"?\" + this.paramSerializer(params);\n    };\n\n    StoredSearchInputController.prototype.storedSearchItemExists = function() {\n      return this.storedSearch.getStoredSearchItem(this.storedSearchName) != null;\n    };\n\n    StoredSearchInputController.prototype.storedSearchUnmodified = function() {\n      return this.storedSearch.getStoredSearchItem(this.storedSearchName) === this.generateUrl();\n    };\n\n    return StoredSearchInputController;\n\n  })();\n\n  angular.module(\"taigaSearch\").controller(\"StoredSearchInput\", StoredSearchInputController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: search.directive.coffee\n */\n\n(function() {\n  var StoredSearchInputDirective;\n\n  StoredSearchInputDirective = function($timeout) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      controller: \"StoredSearchInput\",\n      controllerAs: \"vm\",\n      templateUrl: 'search/components/stored-search/input/' + 'input.html',\n      bindToController: true,\n      scope: {},\n      link: link\n    };\n  };\n\n  StoredSearchInputDirective.$inject = [\"$timeout\"];\n\n  angular.module('taigaSearch').directive('tgStoredSearchInput', StoredSearchInputDirective);\n\n}).call(this);\n\n\n/*\n        '$tgStoredSearch',\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: search-form.controller.coffee\n */\n\n(function() {\n  var StoredSearchItemsController, generateHash, taiga, taigaConfig;\n\n  taiga = this.taiga;\n\n  taigaConfig = this.taigaConfig;\n\n  generateHash = taiga.generateHash;\n\n  StoredSearchItemsController = (function() {\n    StoredSearchItemsController.$inject = ['$tgStoredSearchProvider'];\n\n    function StoredSearchItemsController(storedSearch) {\n      this.storedSearch = storedSearch;\n      this.items = this.storedSearch.getStoredSearchItems();\n    }\n\n    StoredSearchItemsController.prototype.deleteItem = function(name) {\n      return this.items = this.storedSearch.deleteStoredSearchItem(name);\n    };\n\n    StoredSearchItemsController.prototype.isEmpty = function() {\n      return Object.keys(this.items).length === 0;\n    };\n\n    StoredSearchItemsController.prototype.staticSearchesEmpty = function() {\n      return this.getStaticSeaches().length === 0;\n    };\n\n    StoredSearchItemsController.prototype.getStaticSeaches = function() {\n      return taigaConfig.staticSearches || [];\n    };\n\n    return StoredSearchItemsController;\n\n  })();\n\n  angular.module(\"taigaSearch\").controller(\"StoredSearchItems\", StoredSearchItemsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: search.directive.coffee\n */\n\n(function() {\n  var StoredSearchItemsDirective;\n\n  StoredSearchItemsDirective = function($timeout) {\n    var link;\n    link = function(scope, el, attrs, ctrl, form) {};\n    return {\n      controller: \"StoredSearchItems\",\n      controllerAs: \"vm\",\n      templateUrl: 'search/components/stored-search/items/' + 'items.html',\n      bindToController: true,\n      scope: {},\n      link: link\n    };\n  };\n\n  StoredSearchItemsDirective.$inject = [\"$timeout\"];\n\n  angular.module('taigaSearch').directive('tgStoredSearchItems', StoredSearchItemsDirective);\n\n}).call(this);\n\n(function() {\n  var generateHash, module, storedSearchProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  storedSearchProvider = function($storage) {\n    var service;\n    service = {\n      getStoredSearchItems: function() {\n        return $storage.get(\"searchStoredSearchItems\") || {};\n      },\n      setStoredSearchItems: function(items) {\n        return $storage.set(\"searchStoredSearchItems\", items);\n      },\n      getStoredSearchItem: function(name) {\n        return this.getStoredSearchItems()[name];\n      },\n      updateStoredSearchItem: function(name, callback) {\n        var items;\n        items = this.getStoredSearchItems();\n        items[name] = callback(items[name]);\n        this.setStoredSearchItems(items);\n        return items;\n      },\n      deleteStoredSearchItem: function(name) {\n        var items;\n        items = this.getStoredSearchItems();\n        delete items[name];\n        this.setStoredSearchItems(items);\n        return items;\n      }\n    };\n    return service;\n  };\n\n  module = angular.module(\"taigaSearch\");\n\n  module.factory(\"$tgStoredSearchProvider\", [\"$tgStorage\", storedSearchProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: working-on.controller.coffee\n */\n\n(function() {\n  var SearchHome;\n\n  SearchHome = (function() {\n    SearchHome.$inject = ['tgAppMetaService', '$translate'];\n\n    function SearchHome(appMetaService, translate) {\n      var description, title;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      title = \"Extended search\";\n      description = \"Full text and filtered search over all projects.\";\n      this.appMetaService.setAll(title, description);\n    }\n\n    return SearchHome;\n\n  })();\n\n  angular.module(\"taigaSearch\").controller(\"SearchHome\", SearchHome);\n\n}).call(this);\n\n(function() {\n  var TEXT_SEARCH_CONFIG;\n\n  TEXT_SEARCH_CONFIG = {\n    search_in: [\"projects\", \"userstories\", \"tasks\", \"issues\", \"wikipages\"],\n    projects: {\n      fields: [\"name\", \"tags\", \"description\"]\n    },\n    userstories: {\n      fields: [\"ref\", \"subject\", \"description\"]\n    },\n    issues: {\n      fields: [\"ref\", \"subject\", \"description\"]\n    },\n    tasks: {\n      fields: [\"ref\", \"subject\", \"description\"]\n    },\n    wikipages: {\n      fields: [\"slug\", \"content\"]\n    }\n  };\n\n  angular.module(\"taigaSearch\").constant(\"TEXT_SEARCH_CONFIG\", TEXT_SEARCH_CONFIG);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: search-results.controller.coffee\n */\n\n(function() {\n  var SearchResults,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  SearchResults = (function() {\n    SearchResults.$inject = ['$routeParams', 'tgSearchResultsService', '$route', 'tgAppMetaService', '$translate', '$tgSearchFilterParamsProvider'];\n\n    function SearchResults(routeParams, searchResultsService, route, appMetaService, translate, filterParams) {\n      var description, title;\n      this.routeParams = routeParams;\n      this.searchResultsService = searchResultsService;\n      this.route = route;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.filterParams = filterParams;\n      this.onChangeFilter = bind(this.onChangeFilter, this);\n      this.page = 1;\n      this.searchResult = null;\n      this.loadingGlobal = false;\n      this.loadingList = false;\n      this.loadingPagination = false;\n      title = this.translate.instant(\"DISCOVER.SEARCH.PAGE_TITLE\");\n      description = this.translate.instant(\"DISCOVER.SEARCH.PAGE_DESCRIPTION\");\n      this.appMetaService.setAll(title, description);\n    }\n\n    SearchResults.prototype.getSearchResultsListTemplate = function() {\n      var result_type;\n      result_type = this.getResultType();\n      return \"search/search-results/partials/\" + result_type + \".html\";\n    };\n\n    SearchResults.prototype.getResultType = function() {\n      return this.routeParams.result_type;\n    };\n\n    SearchResults.prototype.getResultCount = function() {\n      var count;\n      count = 0;\n      if (this.searchResult != null) {\n        if (Immutable.Iterable.isIterable(this.searchResult)) {\n          count = this.searchResult.size;\n        } else {\n          count = this.searchResult.length;\n        }\n      }\n      return count;\n    };\n\n    SearchResults.prototype.getRouteParamsFilter = function(name) {\n      return this.routeParams[name];\n    };\n\n    SearchResults.prototype.getFilterParamName = function(model, param, id) {\n      var choice, detail, filter_spec, i, k, len, ref, ref1, ref2;\n      filter_spec = (ref = this.filterParams.forModel[model]) != null ? ref[param] : void 0;\n      if (filter_spec != null) {\n        ref1 = filter_spec.choices;\n        for (k in ref1) {\n          choice = ref1[k];\n          ref2 = choice.details;\n          for (i = 0, len = ref2.length; i < len; i++) {\n            detail = ref2[i];\n            if (detail.id === id) {\n              return detail.name;\n            }\n          }\n        }\n      }\n      return id;\n    };\n\n    SearchResults.prototype.updateRouteParamsFilter = function(name, value) {\n      var params;\n      this.routeParams[name] = value;\n      params = {};\n      params[name] = value;\n      return this.route.updateParams(params);\n    };\n\n    SearchResults.prototype.updateRouteParamsFilters = function(params) {\n      _.assign(this.routeParams, params);\n      return this.route.updateParams(params);\n    };\n\n    SearchResults.prototype.fetch = function() {\n      this.page = 1;\n      this.searchResultsService.resetSearchResult();\n      return this.search();\n    };\n\n    SearchResults.prototype.fetchByGlobalSearch = function() {\n      if (this.loadingGlobal) {\n        return;\n      }\n      this.loadingGlobal = true;\n      return this.fetch().then((function(_this) {\n        return function() {\n          return _this.loadingGlobal = false;\n        };\n      })(this));\n    };\n\n    SearchResults.prototype.fetchList = function() {\n      if (this.loadingList) {\n        return;\n      }\n      this.loadingList = true;\n      return this.fetch().then((function(_this) {\n        return function() {\n          return _this.loadingList = false;\n        };\n      })(this));\n    };\n\n    SearchResults.prototype.showMore = function() {\n      if (this.loadingPagination) {\n        return;\n      }\n      this.loadingPagination = true;\n      this.page++;\n      return this.search().then((function(_this) {\n        return function() {\n          return _this.loadingPagination = false;\n        };\n      })(this));\n    };\n\n    SearchResults.prototype.search = function(params) {\n      if (params == null) {\n        params = this.routeParams;\n      }\n      params = _.omit(params, \"storedSearchName\");\n      return this.searchResultsService.fetchSearch(params).then((function(_this) {\n        return function(result) {\n          _this.activeParams = angular.copy(params);\n          _this.searchResult = result;\n          return result;\n        };\n      })(this));\n    };\n\n    SearchResults.prototype.onChangeFilter = function(params) {\n      this.updateRouteParamsFilters(params);\n      return this.fetchList();\n    };\n\n    SearchResults.prototype.onChangeOrder = function(orderBy) {\n      this.updateRouteParamsFilter(\"order_by\", orderBy);\n      return this.fetchList();\n    };\n\n    return SearchResults;\n\n  })();\n\n  angular.module(\"taigaSearch\").controller(\"SearchResults\", SearchResults);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: search-results.directive.coffee\n */\n\n(function() {\n  var SearchResultsDirective, SearchResultsTableDirective, startswith, taiga, toString, trim;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  startswith = this.taiga.startswith;\n\n  SearchResultsDirective = function() {\n    var link;\n    link = function(scope, element, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"SearchResults\",\n      controllerAs: \"vm\",\n      link: link\n    };\n  };\n\n  SearchResultsDirective.$inject = [];\n\n  angular.module(\"taigaSearch\").directive(\"tgSearchResults\", SearchResultsDirective);\n\n  SearchResultsTableDirective = function($compile) {\n    var link, linkOrdering;\n    linkOrdering = function($scope, $el, $attrs, $ctrl) {\n      var addOrderSvg, colHeadElement, currentOrder;\n      addOrderSvg = function(target, order) {\n        var icon, orderSvg;\n        icon = startswith(order, \"-\") ? \"icon-arrow-up\" : \"icon-arrow-down\";\n        orderSvg = $compile(\"<tg-svg svg-icon='\" + icon + \"'></tg-svg>\")($scope);\n        if (!_.endsWith(target.html(), \" \")) {\n          target.append(\" \");\n        }\n        return target.append(orderSvg);\n      };\n      currentOrder = $ctrl.getRouteParamsFilter(\"order_by\") || \"created_date\";\n      if (currentOrder) {\n        colHeadElement = $el.find(\".row.title > div[data-fieldname='\" + (trim(currentOrder, \"-\")) + \"']\");\n        addOrderSvg(colHeadElement, currentOrder);\n      }\n      return $el.on(\"click\", \".row.title > div[data-fieldname]\", function(event) {\n        var finalOrder, newOrder, target;\n        if ($ctrl.loadingList) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        currentOrder = $ctrl.getRouteParamsFilter(\"order_by\");\n        newOrder = target.data(\"fieldname\");\n        finalOrder = currentOrder === newOrder ? \"-\" + newOrder : newOrder;\n        return $scope.$apply(function() {\n          return $ctrl.onChangeOrder(finalOrder).then(function() {\n            $el.find(\".row.title > div > tg-svg\").remove();\n            return addOrderSvg(target, finalOrder);\n          });\n        });\n      });\n    };\n    link = function(scope, element, attrs) {\n      var ctrl;\n      ctrl = element.controller('tgSearchResults');\n      return linkOrdering(scope, element, attrs, ctrl);\n    };\n    return {\n      link: link\n    };\n  };\n\n  SearchResultsTableDirective.$inject = [\"$compile\"];\n\n  angular.module(\"taigaSearch\").directive(\"tgSearchResultsTable\", SearchResultsTableDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: search.service.coffee\n */\n\n(function() {\n  var SearchResultsService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  SearchResultsService = (function(superClass) {\n    extend(SearchResultsService, superClass);\n\n    SearchResultsService.$inject = [\"SearchTypeText\", \"SearchTypeFiltered\"];\n\n    function SearchResultsService(searchTypeText, searchTypeFiltered) {\n      this.searchTypeText = searchTypeText;\n      this.searchTypeFiltered = searchTypeFiltered;\n      this._searchResult = Immutable.List();\n      this._resultsCount = 0;\n      taiga.defineImmutableProperty(this, \"searchResult\", (function(_this) {\n        return function() {\n          return _this._searchResult;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"projectsCount\", (function(_this) {\n        return function() {\n          return _this._resultsCount;\n        };\n      })(this));\n    }\n\n    SearchResultsService.prototype.resetSearchResult = function() {\n      this._resultsCount = 0;\n      return this._searchResult = Immutable.List();\n    };\n\n    SearchResultsService.prototype.fetchSearch = function(params) {\n      var promise, searchType;\n      params = angular.copy(params);\n      searchType = params['result_type'];\n      delete params['result_type'];\n      if (searchType === 'text') {\n        promise = this.searchTypeText.getResults(params);\n      } else {\n        promise = this.searchTypeFiltered.getResults(searchType, params);\n      }\n      return promise.then((function(_this) {\n        return function(items) {\n          _this._resultsCount = items.size;\n          return _this._searchResult = items;\n        };\n      })(this));\n    };\n\n    return SearchResultsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaSearch\").service(\"tgSearchResultsService\", SearchResultsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: search.service.coffee\n */\n\n(function() {\n  var SearchTypeFiltered, dateFields, daysDelta, hoursDelta, montshDelta, taiga, transformToApi,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  hoursDelta = 60 * 60 * 1000;\n\n  daysDelta = hoursDelta * 24;\n\n  montshDelta = daysDelta * 30;\n\n  dateFields = {\n    hours_ago: function(value) {\n      return new Date(_.now() - parseInt(value) * hoursDelta).toString();\n    },\n    days_ago: function(value) {\n      return new Date(_.now() - parseInt(value) * daysDelta).toString();\n    },\n    weeks_ago: function(value) {\n      return new Date(_.now() - parseInt(value) * daysDelta * 7).toString();\n    },\n    months_ago: function(value) {\n      return new Date(_.now() - parseInt(value) * monthsDelta).toString();\n    },\n    years_ago: function(value) {\n      return new Date(_.now() - parseInt(value) * monthsDelta * 12).toString();\n    },\n    end_of_day: function(value) {\n      var date;\n      date = new Date(value);\n      date.setHours(23);\n      date.setMinutes(59);\n      date.setSeconds(59);\n      return date.toString();\n    },\n    in_hours: function(value) {\n      return new Date(_.now() + parseInt(value) * hoursDelta).toString();\n    },\n    in_days: function(value) {\n      return new Date(_.now() + parseInt(value) * daysDelta).toString();\n    },\n    in_weeks: function(value) {\n      return new Date(_.now() + parseInt(value) * daysDelta * 7).toString();\n    },\n    in_months: function(value) {\n      return new Date(_.now() + parseInt(value) * monthsDelta).toString();\n    },\n    in_years: function(value) {\n      return new Date(_.now() + parseInt(value) * monthsDelta * 12).toString();\n    }\n  };\n\n  transformToApi = function(field, value) {\n    var key, transform, transformed_value;\n    if (value != null ? value.length : void 0) {\n      for (key in dateFields) {\n        transform = dateFields[key];\n        if (_.startsWith(value, key)) {\n          transformed_value = value.replace(RegExp(\"^\" + key), \"\");\n          transformed_value = transform(transformed_value);\n          if (Number.isNaN(transformed_value)) {\n            console.log(value + \" is not a number\");\n            return null;\n          }\n          return transformed_value;\n        }\n      }\n    }\n    return value;\n  };\n\n  SearchTypeFiltered = (function(superClass) {\n    extend(SearchTypeFiltered, superClass);\n\n    SearchTypeFiltered.$inject = [\"tgResources\", \"$tgSprintsResourcesProvider\"];\n\n    function SearchTypeFiltered(rs, sprintsProvider) {\n      this.rs = rs;\n      this.sprintsProvider = sprintsProvider;\n      this.sprintsProvider(this.rs);\n    }\n\n    SearchTypeFiltered.prototype.getResults = function(type, client_params) {\n      var k, params, v;\n      params = {};\n      for (k in client_params) {\n        v = client_params[k];\n        if (v != null ? v.length : void 0) {\n          params[k] = transformToApi(k, v);\n        } else {\n          params[k] = v;\n        }\n      }\n      return this.rs[type].listInAllProjects(params).then(function(result) {\n        var i;\n        if (result.toJS != null) {\n          result = result.toJS();\n        } else {\n          result = (function() {\n            var j, len, results;\n            results = [];\n            for (j = 0, len = result.length; j < len; j++) {\n              i = result[j];\n              results.push(i.getAttrs());\n            }\n            return results;\n          })();\n        }\n        return result;\n      });\n    };\n\n    return SearchTypeFiltered;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaSearch\").service(\"SearchTypeFiltered\", SearchTypeFiltered);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: search.service.coffee\n */\n\n(function() {\n  var SearchTypeText, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  SearchTypeText = (function(superClass) {\n    extend(SearchTypeText, superClass);\n\n    SearchTypeText.$inject = [\"TEXT_SEARCH_CONFIG\", \"tgResources\", \"tgProjectsService\", \"$tgResources\", \"$q\"];\n\n    function SearchTypeText(config, rs, projectsService, projectsResources, q) {\n      this.config = config;\n      this.rs = rs;\n      this.projectsService = projectsService;\n      this.projectsResources = projectsResources;\n      this.q = q;\n      this.decorate = this.projectsService._decorate.bind(this.projectsService);\n    }\n\n    SearchTypeText.prototype.getResults = function(params) {\n      params = angular.copy(params);\n      _.assign(params, this.getFilter(params.filter));\n      return this._fetchOptionalSearches(params).then((function(_this) {\n        return function(projects) {\n          var p;\n          if (params.q) {\n            projects = (function() {\n              var i, len, results1;\n              results1 = [];\n              for (i = 0, len = projects.length; i < len; i++) {\n                p = projects[i];\n                if (p['matchCount'] > 0) {\n                  results1.push(p);\n                }\n              }\n              return results1;\n            })();\n          }\n          projects.sort(function(a, b) {\n            return b['matchCount'] - a['matchCount'];\n          });\n          projects = Immutable.fromJS(projects);\n          projects = projects.map(_this.decorate);\n          return projects;\n        };\n      })(this));\n    };\n\n    SearchTypeText.prototype.getFilter = function(filter) {\n      if (filter === 'people') {\n        return {\n          is_looking_for_people: true\n        };\n      } else if (filter === 'scrum') {\n        return {\n          is_backlog_activated: true\n        };\n      } else if (filter === 'kanban') {\n        return {\n          is_kanban_activated: true\n        };\n      }\n      return {};\n    };\n\n    SearchTypeText.prototype._fetchOptionalSearches = function(params) {\n      var projectParams, term;\n      term = params.q;\n      projectParams = _.extend({}, params);\n      delete projectParams.q;\n      return this.rs.projects.getAllProjects(projectParams).then((function(_this) {\n        return function(result) {\n          var p, projects, promises;\n          projects = result.data;\n          if ((term != null ? term.length : void 0) > 0) {\n            promises = (function() {\n              var i, len, results1;\n              results1 = [];\n              for (i = 0, len = projects.length; i < len; i++) {\n                p = projects[i];\n                results1.push(this._updateProject(p, params));\n              }\n              return results1;\n            }).call(_this);\n            return _this.q.all(promises).then(function(results) {\n              return projects;\n            });\n          } else {\n            return projects;\n          }\n        };\n      })(this));\n    };\n\n    SearchTypeText.prototype._updateProject = function(project, params) {\n      var term;\n      term = params.q;\n      project.matchCount = this._getMatchCount(project, this.config.projects.fields, term);\n      return this.projectsResources.search[\"do\"](project.id, term).then((function(_this) {\n        return function(result) {\n          var entry, fields, i, k, len, ref, v;\n          for (k in result) {\n            v = result[k];\n            project[k] = v;\n            for (i = 0, len = v.length; i < len; i++) {\n              entry = v[i];\n              fields = (ref = _this.config[k]) != null ? ref.fields : void 0;\n              if ((fields != null ? fields.length : void 0) > 0) {\n                project.matchCount += _this._getMatchCount(entry, fields, term);\n              }\n            }\n          }\n          return result;\n        };\n      })(this));\n    };\n\n    SearchTypeText.prototype._getMatchCount = function(instance, fields, search) {\n      var count, entry, field, i, j, l, len, len1, len2, ref, ref1, searchTerms, term;\n      searchTerms = search.split(' ');\n      count = 0;\n      for (i = 0, len = fields.length; i < len; i++) {\n        field = fields[i];\n        for (j = 0, len1 = searchTerms.length; j < len1; j++) {\n          term = searchTerms[j];\n          if (_.isArray(instance[field])) {\n            ref = instance[field];\n            for (l = 0, len2 = ref.length; l < len2; l++) {\n              entry = ref[l];\n              if (this._matches(entry, term)) {\n                count++;\n              }\n            }\n          } else if (((ref1 = instance[field]) != null ? ref1.length : void 0) > 0) {\n            if (this._matches(instance[field], term)) {\n              count++;\n            }\n          }\n        }\n      }\n      return count;\n    };\n\n    SearchTypeText.prototype._matches = function(text, term) {\n      return _.includes(text.toLowerCase(), term.toLowerCase());\n    };\n\n    return SearchTypeText;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaSearch\").service(\"SearchTypeText\", SearchTypeText);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: app-meta.service.coffee\n */\n\n(function() {\n  var AppMetaService, taiga, truncate;\n\n  taiga = this.taiga;\n\n  truncate = taiga.truncate;\n\n  AppMetaService = (function() {\n    AppMetaService.$inject = [\"$rootScope\"];\n\n    function AppMetaService(rootScope) {\n      this.rootScope = rootScope;\n    }\n\n    AppMetaService.prototype._set = function(key, value) {\n      var meta;\n      if (!key) {\n        return;\n      }\n      if (key === \"title\") {\n        meta = $(\"head title\");\n        if (meta.length === 0) {\n          meta = $(\"<title></title>\");\n          $(\"head\").append(meta);\n        }\n        return meta.text(value || \"\");\n      } else if (key.indexOf(\"og:\") === 0) {\n        meta = $(\"head meta[property='\" + key + \"']\");\n        if (meta.length === 0) {\n          meta = $(\"<meta property='\" + key + \"'/>\");\n          $(\"head\").append(meta);\n        }\n        return meta.attr(\"content\", value || \"\");\n      } else {\n        meta = $(\"head meta[name='\" + key + \"']\");\n        if (meta.length === 0) {\n          meta = $(\"<meta name='\" + key + \"'/>\");\n          $(\"head\").append(meta);\n        }\n        return meta.attr(\"content\", value || \"\");\n      }\n    };\n\n    AppMetaService.prototype.setTitle = function(title) {\n      return this._set('title', title);\n    };\n\n    AppMetaService.prototype.setDescription = function(description) {\n      return this._set(\"description\", truncate(description, 250));\n    };\n\n    AppMetaService.prototype.setTwitterMetas = function(title, description) {\n      this._set(\"twitter:card\", \"summary\");\n      this._set(\"twitter:site\", \"@taigaio\");\n      this._set(\"twitter:title\", title);\n      this._set(\"twitter:description\", truncate(description, 300));\n      return this._set(\"twitter:image\", window.location.origin + \"/\" + window._version + \"/images/logo-color.png\");\n    };\n\n    AppMetaService.prototype.setOpenGraphMetas = function(title, description) {\n      this._set(\"og:type\", \"object\");\n      this._set(\"og:site_name\", \"Taiga - Love your projects\");\n      this._set(\"og:title\", title);\n      this._set(\"og:description\", truncate(description, 300));\n      this._set(\"og:image\", window.location.origin + \"/\" + window._version + \"/images/logo-color.png\");\n      return this._set(\"og:url\", window.location.href);\n    };\n\n    AppMetaService.prototype.setAll = function(title, description) {\n      this.setTitle(title);\n      this.setDescription(description);\n      this.setTwitterMetas(title, description);\n      return this.setOpenGraphMetas(title, description);\n    };\n\n    AppMetaService.prototype.addMobileViewport = function() {\n      return $(\"head\").append(\"<meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\\\">\");\n    };\n\n    AppMetaService.prototype.removeMobileViewport = function() {\n      return $(\"head meta[name=\\\"viewport\\\"]\").remove();\n    };\n\n    AppMetaService.prototype.setfn = function(fn) {\n      if (this.listener) {\n        this._listener();\n      }\n      return this._listener = this.rootScope.$watchCollection(fn, (function(_this) {\n        return function(metas) {\n          if (metas) {\n            _this.setAll(metas.title, metas.description);\n            return _this._listener();\n          }\n        };\n      })(this));\n    };\n\n    return AppMetaService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgAppMetaService\", AppMetaService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments.service.coffee\n */\n\n(function() {\n  var AttachmentsService, sizeFormat;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  AttachmentsService = (function() {\n    AttachmentsService.$inject = [\"$tgConfirm\", \"$tgConfig\", \"$translate\", \"tgResources\"];\n\n    function AttachmentsService(confirm, config, translate, rs) {\n      this.confirm = confirm;\n      this.config = config;\n      this.translate = translate;\n      this.rs = rs;\n      this.maxFileSize = this.getMaxFileSize();\n      if (this.maxFileSize) {\n        this.maxFileSizeFormated = sizeFormat(this.maxFileSize);\n      }\n    }\n\n    AttachmentsService.prototype.sizeError = function(file) {\n      var message;\n      message = this.translate.instant(\"ATTACHMENT.ERROR_MAX_SIZE_EXCEEDED\", {\n        fileName: file.name,\n        fileSize: sizeFormat(file.size),\n        maxFileSize: this.maxFileSizeFormated\n      });\n      return this.confirm.notify(\"error\", message);\n    };\n\n    AttachmentsService.prototype.validate = function(file) {\n      if (this.maxFileSize && file.size > this.maxFileSize) {\n        this.sizeError(file);\n        return false;\n      }\n      return true;\n    };\n\n    AttachmentsService.prototype.getMaxFileSize = function() {\n      return this.config.get(\"maxUploadFileSize\", null);\n    };\n\n    AttachmentsService.prototype.list = function(type, objId, projectId) {\n      return this.rs.attachments.list(type, objId, projectId).then((function(_this) {\n        return function(attachments) {\n          return attachments.sortBy(function(attachment) {\n            return attachment.get('order');\n          });\n        };\n      })(this));\n    };\n\n    AttachmentsService.prototype[\"delete\"] = function(type, id) {\n      return this.rs.attachments[\"delete\"](type, id);\n    };\n\n    AttachmentsService.prototype.saveError = function(file, data) {\n      var message;\n      message = \"\";\n      if (file) {\n        message = this.translate.instant(\"ATTACHMENT.ERROR_UPLOAD_ATTACHMENT\", {\n          fileName: file.name,\n          errorMessage: data.data._error_message\n        });\n      }\n      return this.confirm.notify(\"error\", message);\n    };\n\n    AttachmentsService.prototype.upload = function(file, objId, projectId, type) {\n      var promise;\n      promise = this.rs.attachments.create(type, projectId, objId, file);\n      promise.then(null, this.saveError.bind(this, file));\n      return promise;\n    };\n\n    AttachmentsService.prototype.patch = function(id, type, patch) {\n      var promise;\n      promise = this.rs.attachments.patch(type, id, patch);\n      promise.then(null, this.saveError.bind(this, null));\n      return promise;\n    };\n\n    return AttachmentsService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgAttachmentsService\", AttachmentsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: avatar.service.coffee\n */\n\n(function() {\n  var AvatarService,\n    modulo = function(a, b) { return (+a % (b = +b) + b) % b; };\n\n  AvatarService = (function() {\n    function AvatarService() {\n      var COLORS, IMAGES;\n      IMAGES = [\"/\" + window._version + \"/images/user-avatars/user-avatar-01.png\", \"/\" + window._version + \"/images/user-avatars/user-avatar-02.png\", \"/\" + window._version + \"/images/user-avatars/user-avatar-03.png\", \"/\" + window._version + \"/images/user-avatars/user-avatar-04.png\", \"/\" + window._version + \"/images/user-avatars/user-avatar-05.png\"];\n      COLORS = [\"rgba( 178, 176, 204, 1 )\", \"rgba( 183, 203, 131, 1 )\", \"rgba( 210, 198, 139, 1 )\", \"rgba( 214, 161, 212, 1 )\", \"rgba( 247, 154, 154, 1 )\"];\n      this.logos = _.cartesianProduct(IMAGES, COLORS);\n    }\n\n    AvatarService.prototype.getDefault = function(key) {\n      var idx, logo;\n      idx = modulo(murmurhash3_32_gc(key, 42), this.logos.length);\n      logo = this.logos[idx];\n      return {\n        src: logo[0],\n        color: logo[1]\n      };\n    };\n\n    AvatarService.prototype.getUnnamed = function() {\n      return {\n        url: \"/\" + window._version + \"/images/unnamed.png\"\n      };\n    };\n\n    AvatarService.prototype.getAvatar = function(user, type) {\n      var avatarParamName, gravatar, logo, logoUrl, photo, root;\n      if (!user) {\n        return this.getUnnamed();\n      }\n      avatarParamName = 'photo';\n      if (type === 'avatarBig') {\n        avatarParamName = 'big_photo';\n      }\n      photo = null;\n      if (user instanceof Immutable.Map) {\n        gravatar = user.get('gravatar_id');\n        photo = user.get(avatarParamName);\n      } else {\n        gravatar = user.gravatar_id;\n        photo = user[avatarParamName];\n      }\n      if (!gravatar) {\n        return this.getUnnamed();\n      }\n      if (photo) {\n        return {\n          url: photo\n        };\n      } else if (location.host.indexOf('localhost') !== -1) {\n        root = location.protocol + '//' + location.host;\n        logo = this.getDefault(gravatar);\n        return {\n          url: root + logo.src,\n          bg: logo.color\n        };\n      } else {\n        root = location.protocol + '//' + location.host;\n        logo = this.getDefault(gravatar);\n        logoUrl = encodeURIComponent(root + logo.src);\n        return {\n          url: 'https://www.gravatar.com/avatar/' + gravatar + \"?d=\" + logoUrl,\n          bg: logo.color\n        };\n      }\n    };\n\n    return AvatarService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgAvatarService\", AvatarService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: check-permissions.service.coffee\n */\n\n(function() {\n  var CheckPermissionsService, taiga;\n\n  taiga = this.taiga;\n\n  CheckPermissionsService = (function() {\n    CheckPermissionsService.$inject = [\"tgProjectService\"];\n\n    function CheckPermissionsService(projectService) {\n      this.projectService = projectService;\n    }\n\n    CheckPermissionsService.prototype.check = function(permission) {\n      if (!this.projectService.project) {\n        return false;\n      }\n      return this.projectService.project.get('my_permissions').indexOf(permission) !== -1;\n    };\n\n    return CheckPermissionsService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgCheckPermissionsService\", CheckPermissionsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: current-user.service.coffee\n */\n\n(function() {\n  var CurrentUserService, groupBy, taiga;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  CurrentUserService = (function() {\n    CurrentUserService.$inject = [\"tgProjectsService\", \"$tgStorage\", \"tgResources\"];\n\n    function CurrentUserService(projectsService, storageService, rs) {\n      this.projectsService = projectsService;\n      this.storageService = storageService;\n      this.rs = rs;\n      this._user = null;\n      this._projects = Immutable.Map();\n      this._projectsById = Immutable.Map();\n      this._joyride = null;\n      taiga.defineImmutableProperty(this, \"projects\", (function(_this) {\n        return function() {\n          return _this._projects;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"projectsById\", (function(_this) {\n        return function() {\n          return _this._projectsById;\n        };\n      })(this));\n    }\n\n    CurrentUserService.prototype.isAuthenticated = function() {\n      if (this.getUser() !== null) {\n        return true;\n      }\n      return false;\n    };\n\n    CurrentUserService.prototype.getUser = function() {\n      var userData;\n      if (!this._user) {\n        userData = this.storageService.get(\"userInfo\");\n        if (userData) {\n          userData = Immutable.fromJS(userData);\n          this.setUser(userData);\n        }\n      }\n      return this._user;\n    };\n\n    CurrentUserService.prototype.removeUser = function() {\n      this._user = null;\n      this._projects = Immutable.Map();\n      this._projectsById = Immutable.Map();\n      return this._joyride = null;\n    };\n\n    CurrentUserService.prototype.setUser = function(user) {\n      this._user = user;\n      return this._loadUserInfo();\n    };\n\n    CurrentUserService.prototype.bulkUpdateProjectsOrder = function(sortData) {\n      return this.projectsService.bulkUpdateProjectsOrder(sortData).then((function(_this) {\n        return function() {\n          return _this.loadProjects();\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype.loadProjects = function() {\n      return this.projectsService.getProjectsByUserId(this._user.get(\"id\")).then((function(_this) {\n        return function(projects) {\n          return _this.setProjects(projects);\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype.disableJoyRide = function(section) {\n      if (section) {\n        this._joyride[section] = false;\n      } else {\n        this._joyride = {\n          backlog: false,\n          kanban: false,\n          dashboard: false\n        };\n      }\n      return this.rs.user.setUserStorage('joyride', this._joyride);\n    };\n\n    CurrentUserService.prototype.loadJoyRideConfig = function() {\n      return new Promise((function(_this) {\n        return function(resolve) {\n          if (_this._joyride !== null) {\n            resolve(_this._joyride);\n            return;\n          }\n          return _this.rs.user.getUserStorage('joyride').then(function(config) {\n            _this._joyride = config;\n            return resolve(_this._joyride);\n          })[\"catch\"](function() {\n            _this._joyride = {\n              backlog: true,\n              kanban: true,\n              dashboard: true\n            };\n            _this.rs.user.createUserStorage('joyride', _this._joyride);\n            return resolve(_this._joyride);\n          });\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype._loadUserInfo = function() {\n      return Promise.all([this.loadProjects()]);\n    };\n\n    CurrentUserService.prototype.setProjects = function(projects) {\n      this._projects = this._projects.set(\"all\", projects);\n      this._projects = this._projects.set(\"recents\", projects.slice(0, 10));\n      this._projectsById = Immutable.fromJS(groupBy(projects.toJS(), function(p) {\n        return p.id;\n      }));\n      return this.projects;\n    };\n\n    CurrentUserService.prototype.canCreatePrivateProjects = function() {\n      var user;\n      user = this.getUser();\n      if (user.get('max_private_projects') !== null && user.get('total_private_projects') >= user.get('max_private_projects')) {\n        return {\n          valid: false,\n          reason: 'max_private_projects',\n          type: 'private_project'\n        };\n      }\n      return {\n        valid: true\n      };\n    };\n\n    CurrentUserService.prototype.canCreatePublicProjects = function() {\n      var user;\n      user = this.getUser();\n      if (user.get('max_public_projects') !== null && user.get('total_public_projects') >= user.get('max_public_projects')) {\n        return {\n          valid: false,\n          reason: 'max_public_projects',\n          type: 'public_project'\n        };\n      }\n      return {\n        valid: true\n      };\n    };\n\n    CurrentUserService.prototype.canOwnProject = function(project) {\n      var result, user;\n      user = this.getUser();\n      if (project.get('is_private')) {\n        result = this.canCreatePrivateProjects();\n        if (!result.valid) {\n          return result;\n        }\n        if (user.get('max_memberships_private_projects') !== null && project.get('total_memberships') > user.get('max_memberships_private_projects')) {\n          return {\n            valid: false,\n            reason: 'max_members_private_projects',\n            type: 'private_project'\n          };\n        }\n      } else {\n        result = this.canCreatePublicProjects();\n        if (!result.valid) {\n          return result;\n        }\n        if (user.get('max_memberships_public_projects') !== null && project.get('total_memberships') > user.get('max_memberships_public_projects')) {\n          return {\n            valid: false,\n            reason: 'max_members_public_projects',\n            type: 'public_project'\n          };\n        }\n      }\n      return {\n        valid: true\n      };\n    };\n\n    return CurrentUserService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgCurrentUserService\", CurrentUserService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: error-handling.service.coffee\n */\n\n(function() {\n  var ErrorHandlingService, taiga;\n\n  taiga = this.taiga;\n\n  ErrorHandlingService = (function() {\n    ErrorHandlingService.$inject = [\"$rootScope\"];\n\n    function ErrorHandlingService(rootScope) {\n      this.rootScope = rootScope;\n    }\n\n    ErrorHandlingService.prototype.init = function() {\n      return this.rootScope.errorHandling = {};\n    };\n\n    ErrorHandlingService.prototype.notfound = function() {\n      this.rootScope.errorHandling.showingError = true;\n      return this.rootScope.errorHandling.notfound = true;\n    };\n\n    ErrorHandlingService.prototype.error = function() {\n      this.rootScope.errorHandling.showingError = true;\n      return this.rootScope.errorHandling.error = true;\n    };\n\n    ErrorHandlingService.prototype.permissionDenied = function() {\n      this.rootScope.errorHandling.showingError = true;\n      return this.rootScope.errorHandling.permissionDenied = true;\n    };\n\n    ErrorHandlingService.prototype.block = function() {\n      this.rootScope.errorHandling.showingError = true;\n      return this.rootScope.errorHandling.blocked = true;\n    };\n\n    return ErrorHandlingService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgErrorHandlingService\", ErrorHandlingService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: lightbox-factory.service.coffee\n */\n\n(function() {\n  var LightboxFactory;\n\n  LightboxFactory = (function() {\n    LightboxFactory.$inject = [\"$rootScope\", \"$compile\"];\n\n    function LightboxFactory(rootScope, compile) {\n      this.rootScope = rootScope;\n      this.compile = compile;\n    }\n\n    LightboxFactory.prototype.create = function(name, attrs, scopeAttrs) {\n      var elm, html, scope;\n      scope = this.rootScope.$new();\n      scope = _.merge(scope, scopeAttrs);\n      elm = $(\"<div>\").attr(name, true).attr(\"tg-bind-scope\", true);\n      if (attrs) {\n        elm.attr(attrs);\n      }\n      elm.addClass(\"remove-on-close\");\n      html = this.compile(elm)(scope);\n      $(document.body).append(html);\n    };\n\n    return LightboxFactory;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgLightboxFactory\", LightboxFactory);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: paginate-response.service.coffee\n */\n\n(function() {\n  var PaginateResponse;\n\n  PaginateResponse = function() {\n    return function(result) {\n      var paginateResponse;\n      paginateResponse = Immutable.Map({\n        \"data\": result.get(\"data\"),\n        \"next\": !!result.get(\"headers\")(\"x-pagination-next\"),\n        \"prev\": !!result.get(\"headers\")(\"x-pagination-prev\"),\n        \"current\": result.get(\"headers\")(\"x-pagination-current\"),\n        \"count\": result.get(\"headers\")(\"x-pagination-count\")\n      });\n      return paginateResponse;\n    };\n  };\n\n  angular.module(\"taigaCommon\").factory(\"tgPaginateResponseService\", PaginateResponse);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo.service.coffee\n */\n\n(function() {\n  var ProjectLogoService,\n    modulo = function(a, b) { return (+a % (b = +b) + b) % b; };\n\n  ProjectLogoService = (function() {\n    function ProjectLogoService() {\n      var COLORS, IMAGES;\n      IMAGES = [\"/\" + window._version + \"/images/project-logos/project-logo-01.png\", \"/\" + window._version + \"/images/project-logos/project-logo-02.png\", \"/\" + window._version + \"/images/project-logos/project-logo-03.png\", \"/\" + window._version + \"/images/project-logos/project-logo-04.png\", \"/\" + window._version + \"/images/project-logos/project-logo-05.png\"];\n      COLORS = [\"rgba( 153,  214, 220, 1 )\", \"rgba( 213,  156,  156, 1 )\", \"rgba( 214, 161, 212,  1 )\", \"rgba( 164, 162, 219, 1 )\", \"rgba( 152, 224, 168,  1 )\"];\n      this.logos = _.cartesianProduct(IMAGES, COLORS);\n    }\n\n    ProjectLogoService.prototype.getDefaultProjectLogo = function(slug, id) {\n      var idx, key, logo;\n      key = slug + \"-\" + id;\n      idx = modulo(murmurhash3_32_gc(key, 42), this.logos.length);\n      logo = this.logos[idx];\n      return {\n        src: logo[0],\n        color: logo[1]\n      };\n    };\n\n    return ProjectLogoService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgProjectLogoService\", ProjectLogoService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.service.coffee\n */\n\n(function() {\n  var ProjectService, taiga;\n\n  taiga = this.taiga;\n\n  ProjectService = (function() {\n    ProjectService.$inject = [\"tgProjectsService\", \"tgXhrErrorService\"];\n\n    function ProjectService(projectsService, xhrError) {\n      this.projectsService = projectsService;\n      this.xhrError = xhrError;\n      this._project = null;\n      this._section = null;\n      this._sectionsBreadcrumb = Immutable.List();\n      this._activeMembers = Immutable.List();\n      taiga.defineImmutableProperty(this, \"project\", (function(_this) {\n        return function() {\n          return _this._project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"section\", (function(_this) {\n        return function() {\n          return _this._section;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"sectionsBreadcrumb\", (function(_this) {\n        return function() {\n          return _this._sectionsBreadcrumb;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"activeMembers\", (function(_this) {\n        return function() {\n          return _this._activeMembers;\n        };\n      })(this));\n    }\n\n    ProjectService.prototype.cleanProject = function() {\n      this._project = null;\n      this._activeMembers = Immutable.List();\n      this._section = null;\n      return this._sectionsBreadcrumb = Immutable.List();\n    };\n\n    ProjectService.prototype.setSection = function(section) {\n      this._section = section;\n      if (section) {\n        return this._sectionsBreadcrumb = this._sectionsBreadcrumb.push(this._section);\n      } else {\n        return this._sectionsBreadcrumb = Immutable.List();\n      }\n    };\n\n    ProjectService.prototype.setProject = function(project) {\n      this._project = project;\n      return this._activeMembers = this._project.get('members').filter(function(member) {\n        return member.get('is_active');\n      });\n    };\n\n    ProjectService.prototype.setProjectBySlug = function(pslug) {\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          if (!_this.project || _this.project.get('slug') !== pslug) {\n            return _this.projectsService.getProjectBySlug(pslug).then(function(project) {\n              _this.setProject(project);\n              return resolve();\n            })[\"catch\"](function(xhr) {\n              return _this.xhrError.response(xhr);\n            });\n          } else {\n            return resolve();\n          }\n        };\n      })(this));\n    };\n\n    ProjectService.prototype.fetchProject = function() {\n      var pslug;\n      pslug = this.project.get('slug');\n      return this.projectsService.getProjectBySlug(pslug).then((function(_this) {\n        return function(project) {\n          return _this.setProject(project);\n        };\n      })(this));\n    };\n\n    ProjectService.prototype.hasPermission = function(permission) {\n      return this._project.get('my_permissions').indexOf(permission) !== -1;\n    };\n\n    ProjectService.prototype.isEpicsDashboardEnabled = function() {\n      return this._project.get(\"is_epics_activated\");\n    };\n\n    return ProjectService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgProjectService\", ProjectService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: theme.service.coffee\n */\n\n(function() {\n  var ThemeService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ThemeService = (function(superClass) {\n    extend(ThemeService, superClass);\n\n    function ThemeService() {\n      return ThemeService.__super__.constructor.apply(this, arguments);\n    }\n\n    return ThemeService;\n\n  })(taiga.Service = function() {\n    return {\n      use: function(themeName) {\n        var stylesheetEl;\n        stylesheetEl = $(\"link[rel='stylesheet']:first\");\n        if (stylesheetEl.length === 0) {\n          stylesheetEl = $(\"<link rel='stylesheet' href='' type='text/css'>\");\n          $(\"head\").append(stylesheetEl);\n        }\n        return stylesheetEl.attr(\"href\", \"/\" + window._version + \"/styles/theme-\" + themeName + \".css\");\n      }\n    };\n  });\n\n  angular.module(\"taigaCommon\").service(\"tgThemeService\", ThemeService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user.service.coffee\n */\n\n(function() {\n  var UserService, bindMethods, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  bindMethods = taiga.bindMethods;\n\n  UserService = (function(superClass) {\n    extend(UserService, superClass);\n\n    UserService.$inject = [\"tgResources\"];\n\n    function UserService(rs) {\n      this.rs = rs;\n      bindMethods(this);\n    }\n\n    UserService.prototype.getUserByUserName = function(username) {\n      return this.rs.users.getUserByUsername(username);\n    };\n\n    UserService.prototype.getContacts = function(userId) {\n      return this.rs.users.getContacts(userId);\n    };\n\n    UserService.prototype.getLiked = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getLiked(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getVoted = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getVoted(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getWatched = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getWatched(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getStats = function(userId) {\n      return this.rs.users.getStats(userId);\n    };\n\n    UserService.prototype.attachUserContactsToProjects = function(userId, projects) {\n      return this.getContacts(userId).then(function(contacts) {\n        projects = projects.map(function(project) {\n          var contactsFiltered;\n          contactsFiltered = contacts.filter(function(contact) {\n            var contactId;\n            contactId = contact.get(\"id\");\n            return project.get('members').indexOf(contactId) !== -1;\n          });\n          project = project.set(\"contacts\", contactsFiltered);\n          return project;\n        });\n        return projects;\n      });\n    };\n\n    return UserService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaCommon\").service(\"tgUserService\", UserService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: xhrError.service.coffee\n */\n\n(function() {\n  var xhrError,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  xhrError = (function(superClass) {\n    extend(xhrError, superClass);\n\n    xhrError.$inject = [\"$q\", \"tgErrorHandlingService\"];\n\n    function xhrError(q, errorHandlingService) {\n      this.q = q;\n      this.errorHandlingService = errorHandlingService;\n    }\n\n    xhrError.prototype.notFound = function() {\n      return this.errorHandlingService.notfound();\n    };\n\n    xhrError.prototype.permissionDenied = function() {\n      return this.errorHandlingService.permissionDenied();\n    };\n\n    xhrError.prototype.response = function(xhr) {\n      if (xhr) {\n        if (xhr.status === 404) {\n          this.notFound();\n        } else if (xhr.status === 403) {\n          this.permissionDenied();\n        }\n      }\n      return this.q.reject(xhr);\n    };\n\n    return xhrError;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaCommon\").service(\"tgXhrErrorService\", xhrError);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-attachment.directive.coffee\n */\n\n(function() {\n  var UserTimelineAttachmentDirective;\n\n  UserTimelineAttachmentDirective = function(template, $compile) {\n    var isImage, link, validFileExtensions;\n    validFileExtensions = [\".jpg\", \".jpeg\", \".bmp\", \".gif\", \".png\"];\n    isImage = function(url) {\n      url = url.toLowerCase();\n      return _.some(validFileExtensions, function(extension) {\n        return url.indexOf(extension, url - extension.length) !== -1;\n      });\n    };\n    link = function(scope, el) {\n      var is_image, templateHtml;\n      is_image = isImage(scope.attachment.get('url'));\n      if (is_image) {\n        templateHtml = template.get(\"user-timeline/user-timeline-attachment/user-timeline-attachment-image.html\");\n      } else {\n        templateHtml = template.get(\"user-timeline/user-timeline-attachment/user-timeline-attachment.html\");\n      }\n      el.html(templateHtml);\n      $compile(el.contents())(scope);\n      return el.find(\"img\").error(function() {\n        return this.remove();\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        attachment: \"=tgUserTimelineAttachment\"\n      }\n    };\n  };\n\n  UserTimelineAttachmentDirective.$inject = [\"$tgTemplate\", \"$compile\"];\n\n  angular.module(\"taigaUserTimeline\").directive(\"tgUserTimelineAttachment\", UserTimelineAttachmentDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item-title.service.coffee\n */\n\n(function() {\n  var UserTimelineItemTitle, unslugify;\n\n  unslugify = this.taiga.unslugify;\n\n  UserTimelineItemTitle = (function() {\n    UserTimelineItemTitle.$inject = [\"$translate\", \"$sce\"];\n\n    UserTimelineItemTitle.prototype._fieldTranslationKey = {\n      'status': 'COMMON.FIELDS.STATUS',\n      'subject': 'COMMON.FIELDS.SUBJECT',\n      'description_diff': 'COMMON.FIELDS.DESCRIPTION',\n      'points': 'COMMON.FIELDS.POINTS',\n      'assigned_to': 'COMMON.FIELDS.ASSIGNED_TO',\n      'severity': 'ISSUES.FIELDS.SEVERITY',\n      'priority': 'ISSUES.FIELDS.PRIORITY',\n      'type': 'ISSUES.FIELDS.TYPE',\n      'is_iocaine': 'TASK.FIELDS.IS_IOCAINE',\n      'is_blocked': 'COMMON.FIELDS.IS_BLOCKED',\n      'color': 'COMMON.FIELDS.COLOR'\n    };\n\n    UserTimelineItemTitle.prototype._params = {\n      username: function(timeline, event) {\n        var title_attr, url, user;\n        user = timeline.getIn(['data', 'user']);\n        if (user.get('is_profile_visible')) {\n          title_attr = this.translate.instant('COMMON.SEE_USER_PROFILE', {\n            username: user.get('username')\n          });\n          url = \"user-profile:username=timeline.getIn(['data', 'user', 'username'])\";\n          return this._getLink(url, user.get('name'), title_attr);\n        } else {\n          return this._getUsernameSpan(user.get('name'));\n        }\n      },\n      field_name: function(timeline, event) {\n        var field_name;\n        field_name = timeline.getIn(['data', 'value_diff', 'key']);\n        return this.translate.instant(this._fieldTranslationKey[field_name]);\n      },\n      project_name: function(timeline, event) {\n        var url;\n        url = \"project:project=timeline.getIn(['data', 'project', 'slug'])\";\n        return this._getLink(url, timeline.getIn([\"data\", \"project\", \"name\"]));\n      },\n      new_value: function(timeline, event) {\n        var new_value, value;\n        if (_.isArray(timeline.getIn([\"data\", \"value_diff\", \"value\"]).toJS())) {\n          value = timeline.getIn([\"data\", \"value_diff\", \"value\"]).get(1);\n          if (value === null && timeline.getIn([\"data\", \"value_diff\", \"key\"]) === 'assigned_to') {\n            value = this.translate.instant('ACTIVITY.VALUES.UNASSIGNED');\n          }\n          new_value = value;\n        } else {\n          new_value = timeline.getIn([\"data\", \"value_diff\", \"value\"]).first().get(1);\n        }\n        return _.escape(new_value);\n      },\n      sprint_name: function(timeline, event) {\n        var url;\n        url = \"project-taskboard:project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['data', 'milestone', 'slug'])\";\n        return this._getLink(url, timeline.getIn(['data', 'milestone', 'name']));\n      },\n      us_name: function(timeline, event) {\n        var event_us, obj, text, url;\n        obj = this._getTimelineObj(timeline, event).get('userstory');\n        event_us = {\n          obj: 'parent_userstory'\n        };\n        url = this._getDetailObjUrl(event_us);\n        text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        return this._getLink(url, text);\n      },\n      related_us_name: function(timeline, event) {\n        var obj, text, url;\n        obj = timeline.getIn([\"data\", \"userstory\"]);\n        url = \"project-userstories-detail:project=timeline.getIn(['data', 'userstory', 'project', 'slug']),ref=timeline.getIn(['data', 'userstory', 'ref'])\";\n        text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        return this._getLink(url, text);\n      },\n      epic_name: function(timeline, event) {\n        var obj, text, url;\n        obj = timeline.getIn([\"data\", \"epic\"]);\n        url = \"project-epics-detail:project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['data', 'epic', 'ref'])\";\n        text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        return this._getLink(url, text);\n      },\n      obj_name: function(timeline, event) {\n        var obj, text, url;\n        obj = this._getTimelineObj(timeline, event);\n        url = this._getDetailObjUrl(event);\n        if (event.obj === 'wikipage') {\n          text = unslugify(obj.get('slug'));\n        } else if (event.obj === 'milestone') {\n          text = obj.get('name');\n        } else {\n          text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        }\n        return this._getLink(url, text);\n      },\n      role_name: function(timeline, event) {\n        return _.escape(timeline.getIn(['data', 'value_diff', 'value']).keySeq().first());\n      }\n    };\n\n    function UserTimelineItemTitle(translate, sce) {\n      this.translate = translate;\n      this.sce = sce;\n    }\n\n    UserTimelineItemTitle.prototype._translateTitleParams = function(param, timeline, event) {\n      return this._params[param].call(this, timeline, event);\n    };\n\n    UserTimelineItemTitle.prototype._getTimelineObj = function(timeline, event) {\n      return timeline.getIn(['data', event.obj]);\n    };\n\n    UserTimelineItemTitle.prototype._getDetailObjUrl = function(event) {\n      var url;\n      url = {\n        \"issue\": [\"project-issues-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"wikipage\": [\"project-wiki-page\", \":project=timeline.getIn(['data', 'project', 'slug']),slug=timeline.getIn(['obj', 'slug'])\"],\n        \"task\": [\"project-tasks-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"userstory\": [\"project-userstories-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"parent_userstory\": [\"project-userstories-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'userstory', 'ref'])\"],\n        \"milestone\": [\"project-taskboard\", \":project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['obj', 'slug'])\"],\n        \"epic\": [\"project-epics-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"]\n      };\n      return url[event.obj][0] + url[event.obj][1];\n    };\n\n    UserTimelineItemTitle.prototype._getLink = function(url, text, title) {\n      var span;\n      title = title || text;\n      span = $('<span>').attr('ng-non-bindable', true).text(text);\n      return $('<a>').attr('tg-nav', url).attr('title', title).append(span).prop('outerHTML');\n    };\n\n    UserTimelineItemTitle.prototype._getUsernameSpan = function(text) {\n      var title;\n      title = title || text;\n      return $('<span>').addClass('username').text(text).prop('outerHTML');\n    };\n\n    UserTimelineItemTitle.prototype._getParams = function(timeline, event, timeline_type) {\n      var params;\n      params = {};\n      timeline_type.translate_params.forEach((function(_this) {\n        return function(param) {\n          return params[param] = _this._translateTitleParams(param, timeline, event);\n        };\n      })(this));\n      return params;\n    };\n\n    UserTimelineItemTitle.prototype.getTitle = function(timeline, event, type) {\n      var params, paramsKeys, translation;\n      params = this._getParams(timeline, event, type);\n      paramsKeys = {};\n      Object.keys(params).forEach(function(key) {\n        return paramsKeys[key] = '{{' + key + '}}';\n      });\n      translation = this.translate.instant(type.key, paramsKeys);\n      Object.keys(params).forEach(function(key) {\n        var find;\n        find = '{{' + key + '}}';\n        return translation = translation.replace(new RegExp(find, 'g'), params[key]);\n      });\n      return translation;\n    };\n\n    return UserTimelineItemTitle;\n\n  })();\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineItemTitle\", UserTimelineItemTitle);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item-type.service.coffee\n */\n\n(function() {\n  var UserTimelineType, timelineType;\n\n  timelineType = function(timeline, event) {\n    var types;\n    types = [\n      {\n        check: function(timeline, event) {\n          return event.obj === 'membership';\n        },\n        key: 'TIMELINE.NEW_MEMBER',\n        translate_params: ['project_name'],\n        member: function(timeline) {\n          return Immutable.Map({\n            user: timeline.getIn(['data', 'user']),\n            role: timeline.getIn(['data', 'role'])\n          });\n        }\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'project' && event.type === 'create';\n        },\n        key: 'TIMELINE.NEW_PROJECT',\n        translate_params: ['username', 'project_name'],\n        description: function(timeline) {\n          return timeline.getIn(['data', 'project', 'description']);\n        }\n      }, {\n        check: function(timeline, event) {\n          return event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'attachments';\n        },\n        key: 'TIMELINE.UPLOAD_ATTACHMENT',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'create';\n        },\n        key: 'TIMELINE.US_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'create';\n        },\n        key: 'TIMELINE.ISSUE_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'wikipage' && event.type === 'create';\n        },\n        key: 'TIMELINE.WIKI_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'create' && !timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'create' && timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_CREATED_WITH_US',\n        translate_params: ['username', 'project_name', 'obj_name', 'us_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'milestone' && event.type === 'create';\n        },\n        key: 'TIMELINE.MILESTONE_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'epic' && event.type === 'create';\n        },\n        key: 'TIMELINE.EPIC_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'relateduserstory' && event.type === 'create';\n        },\n        key: 'TIMELINE.EPIC_RELATED_USERSTORY_CREATED',\n        translate_params: ['username', 'project_name', 'related_us_name', 'epic_name']\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'userstory';\n        },\n        key: 'TIMELINE.NEW_COMMENT_US',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'issue';\n        },\n        key: 'TIMELINE.NEW_COMMENT_ISSUE',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'task';\n        },\n        key: 'TIMELINE.NEW_COMMENT_TASK',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'epic';\n        },\n        key: 'TIMELINE.NEW_COMMENT_EPIC',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && timeline.hasIn(['data', 'value_diff', 'value', 'backlog_order']) && event.type === 'change';\n        },\n        key: 'TIMELINE.US_MOVED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && event.type === 'change' && event.obj === 'userstory') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'milestone']).get(1) === null;\n          }\n          return false;\n        },\n        key: 'TIMELINE.US_REMOVED_FROM_MILESTONE',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && event.type === 'change' && event.obj === 'userstory';\n        },\n        key: 'TIMELINE.US_ADDED_MILESTONE',\n        translate_params: ['username', 'obj_name', 'sprint_name']\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'blocked' && event.type === 'change') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'is_blocked']).get(1) === true;\n          }\n          return false;\n        },\n        key: 'TIMELINE.BLOCKED',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          if (timeline.hasIn(['data', 'value_diff', 'value', 'blocked_note_html'])) {\n            text = timeline.getIn(['data', 'value_diff', 'value', 'blocked_note_html']).get(1);\n            return $($.parseHTML(text)).text();\n          } else {\n            return false;\n          }\n        }\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'blocked' && event.type === 'change') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'is_blocked']).get(1) === false;\n          }\n          return false;\n        },\n        key: 'TIMELINE.UNBLOCKED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'milestone' && event.type === 'change';\n        },\n        key: 'TIMELINE.MILESTONE_UPDATED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'wikipage' && event.type === 'change';\n        },\n        key: 'TIMELINE.WIKI_UPDATED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'points';\n        },\n        key: 'TIMELINE.US_UPDATED_POINTS',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value', 'role_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.US_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change';\n        },\n        key: 'TIMELINE.US_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.ISSUE_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'change';\n        },\n        key: 'TIMELINE.ISSUE_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && !timeline.getIn(['data', 'task', 'userstory']) && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.TASK_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && timeline.getIn(['data', 'task', 'userstory']) && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_US',\n        translate_params: ['username', 'field_name', 'obj_name', 'us_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && !timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_US_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'us_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'epic' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.EPIC_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'epic' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'color';\n        },\n        key: 'TIMELINE.EPIC_UPDATED_WITH_NEW_COLOR',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'epic' && event.type === 'change';\n        },\n        key: 'TIMELINE.EPIC_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'user' && event.type === 'create';\n        },\n        key: 'TIMELINE.NEW_USER',\n        translate_params: ['username']\n      }\n    ];\n    return _.find(types, function(obj) {\n      return obj.check(timeline, event);\n    });\n  };\n\n  UserTimelineType = (function() {\n    function UserTimelineType() {}\n\n    UserTimelineType.prototype.getType = function(timeline, event) {\n      return timelineType(timeline, event);\n    };\n\n    return UserTimelineType;\n\n  })();\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineItemType\", UserTimelineType);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item.directive.coffee\n */\n\n(function() {\n  var UserTimelineItemDirective;\n\n  UserTimelineItemDirective = function() {\n    return {\n      templateUrl: \"user-timeline/user-timeline-item/user-timeline-item.html\",\n      scope: {\n        timeline: \"=tgUserTimelineItem\"\n      }\n    };\n  };\n\n  angular.module(\"taigaUserTimeline\").directive(\"tgUserTimelineItem\", UserTimelineItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-pagination-sequence.service.coffee\n */\n\n(function() {\n  var UserTimelinePaginationSequence;\n\n  UserTimelinePaginationSequence = function() {\n    var obj;\n    obj = {};\n    obj.generate = function(config) {\n      var getContent, items, next, page;\n      page = 1;\n      items = Immutable.List();\n      config.minItems = config.minItems || 20;\n      next = function() {\n        items = Immutable.List();\n        return getContent();\n      };\n      getContent = function() {\n        return config.fetch(page).then(function(response) {\n          var data;\n          page++;\n          data = response.get(\"data\");\n          if (config.filter) {\n            data = config.filter(data);\n          }\n          if (config.map) {\n            data = data.map(config.map);\n          }\n          items = items.concat(data);\n          if (items.size < config.minItems && response.get(\"next\")) {\n            return getContent();\n          }\n          return Immutable.Map({\n            items: items,\n            next: response.get(\"next\")\n          });\n        });\n      };\n      return {\n        next: function() {\n          return next();\n        }\n      };\n    };\n    return obj;\n  };\n\n  angular.module(\"taigaUserTimeline\").factory(\"tgUserTimelinePaginationSequenceService\", UserTimelinePaginationSequence);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/profile/profile-timeline/profile-timeline.controller.coffee\n */\n\n(function() {\n  var UserTimelineController, mixOf, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  UserTimelineController = (function(superClass) {\n    extend(UserTimelineController, superClass);\n\n    UserTimelineController.$inject = [\"tgUserTimelineService\"];\n\n    function UserTimelineController(userTimelineService) {\n      this.userTimelineService = userTimelineService;\n      this.timelineList = Immutable.List();\n      this.scrollDisabled = false;\n      this.timeline = null;\n      if (this.projectId) {\n        this.timeline = this.userTimelineService.getProjectTimeline(this.projectId);\n      } else if (this.currentUser) {\n        this.timeline = this.userTimelineService.getProfileTimeline(this.user.get(\"id\"));\n      } else {\n        this.timeline = this.userTimelineService.getUserTimeline(this.user.get(\"id\"));\n      }\n    }\n\n    UserTimelineController.prototype.loadTimeline = function() {\n      this.scrollDisabled = true;\n      return this.timeline.next().then((function(_this) {\n        return function(response) {\n          _this.timelineList = _this.timelineList.concat(response.get(\"items\"));\n          if (response.get(\"next\")) {\n            _this.scrollDisabled = false;\n          }\n          return _this.timelineList;\n        };\n      })(this));\n    };\n\n    return UserTimelineController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  angular.module(\"taigaUserTimeline\").controller(\"UserTimeline\", UserTimelineController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.directive.coffee\n */\n\n(function() {\n  var UserTimelineDirective;\n\n  UserTimelineDirective = function() {\n    return {\n      templateUrl: \"user-timeline/user-timeline/user-timeline.html\",\n      controller: \"UserTimeline\",\n      controllerAs: \"vm\",\n      scope: {\n        projectId: \"=projectid\",\n        user: \"=\",\n        currentUser: \"=\"\n      },\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgUserTimeline\", UserTimelineDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.service.coffee\n */\n\n(function() {\n  var UserTimelineService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  UserTimelineService = (function(superClass) {\n    extend(UserTimelineService, superClass);\n\n    UserTimelineService.$inject = [\"tgResources\", \"tgUserTimelinePaginationSequenceService\", \"tgUserTimelineItemType\", \"tgUserTimelineItemTitle\"];\n\n    function UserTimelineService(rs, userTimelinePaginationSequenceService, userTimelineItemType, userTimelineItemTitle) {\n      this.rs = rs;\n      this.userTimelinePaginationSequenceService = userTimelinePaginationSequenceService;\n      this.userTimelineItemType = userTimelineItemType;\n      this.userTimelineItemTitle = userTimelineItemTitle;\n    }\n\n    UserTimelineService.prototype._valid_fields = ['status', 'subject', 'description_diff', 'assigned_to', 'points', 'severity', 'priority', 'type', 'attachments', 'is_iocaine', 'content_diff', 'name', 'estimated_finish', 'estimated_start', 'blocked', 'moveInBacklog', 'milestone', 'color'];\n\n    UserTimelineService.prototype._invalid = [\n      {\n        check: function(timeline) {\n          var fieldKey, value_diff;\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          if (value_diff) {\n            fieldKey = value_diff.get('key');\n            if (this._valid_fields.indexOf(fieldKey) === -1) {\n              return true;\n            } else if (fieldKey === 'attachments' && value_diff.get('value').get('new').size === 0) {\n              return true;\n            }\n          }\n          return false;\n        }\n      }, {\n        check: function(timeline) {\n          var event, value_diff;\n          event = timeline.get('event_type').split(\".\");\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          return event[2] === 'change' && value_diff === void 0;\n        }\n      }, {\n        check: function(timeline) {\n          var event;\n          event = timeline.get('event_type').split(\".\");\n          return event[2] === 'delete';\n        }\n      }, {\n        check: function(timeline) {\n          var event;\n          event = timeline.get('event_type').split(\".\");\n          return event[1] === 'project' && event[2] === 'change';\n        }\n      }, {\n        check: function(timeline) {\n          return !!timeline.get(\"data\").get(\"comment_deleted\");\n        }\n      }, {\n        check: function(timeline) {\n          var event, value_diff;\n          event = timeline.get('event_type').split(\".\");\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          if (value_diff && event[1] === \"task\" && event[2] === \"change\" && value_diff.get(\"key\") === \"milestone\") {\n            return timeline.get(\"data\").get(\"value_diff\").get(\"value\");\n          }\n          return false;\n        }\n      }\n    ];\n\n    UserTimelineService.prototype._isInValidTimeline = function(timeline) {\n      return _.some(this._invalid, (function(_this) {\n        return function(invalid) {\n          return invalid.check.call(_this, timeline);\n        };\n      })(this));\n    };\n\n    UserTimelineService.prototype._parseEventType = function(event_type) {\n      event_type = event_type.split(\".\");\n      return {\n        section: event_type[0],\n        obj: event_type[1],\n        type: event_type[2]\n      };\n    };\n\n    UserTimelineService.prototype._getTimelineObject = function(timeline, event) {\n      if (timeline.get('data').get(event.obj)) {\n        return timeline.get('data').get(event.obj);\n      }\n    };\n\n    UserTimelineService.prototype._attachExtraInfoToTimelineEntry = function(timeline, event, type) {\n      var title;\n      title = this.userTimelineItemTitle.getTitle(timeline, event, type);\n      timeline = timeline.set('title_html', title);\n      timeline = timeline.set('obj', this._getTimelineObject(timeline, event));\n      if (type.description) {\n        timeline = timeline.set('description', type.description(timeline));\n      }\n      if (type.member) {\n        timeline = timeline.set('member', type.member(timeline));\n      }\n      if (timeline.getIn(['data', 'value_diff', 'key']) === 'attachments' && timeline.hasIn(['data', 'value_diff', 'value', 'new'])) {\n        timeline = timeline.set('attachments', timeline.getIn(['data', 'value_diff', 'value', 'new']));\n      }\n      return timeline;\n    };\n\n    UserTimelineService.prototype._parseTimeline = function(response) {\n      var newdata;\n      newdata = Immutable.List();\n      response.get('data').forEach((function(_this) {\n        return function(item) {\n          var data, event, newItem, values_diff;\n          event = _this._parseEventType(item.get('event_type'));\n          data = item.get('data');\n          values_diff = data.get('values_diff');\n          if (values_diff && values_diff.count()) {\n            if (values_diff.has('is_blocked')) {\n              values_diff = Immutable.Map({\n                'blocked': values_diff\n              });\n            }\n            if (values_diff.has('milestone')) {\n              if (event.obj === 'userstory') {\n                values_diff = Immutable.Map({\n                  'moveInBacklog': values_diff\n                });\n              } else {\n                values_diff = values_diff.deleteIn(['values_diff', 'milestone']);\n              }\n            } else if (event.obj === 'milestone') {\n              values_diff = Immutable.Map({\n                'milestone': values_diff\n              });\n            }\n            return values_diff.forEach(function(value, key) {\n              var newItem, obj;\n              obj = Immutable.Map({\n                key: key,\n                value: value\n              });\n              newItem = item.setIn(['data', 'value_diff'], obj);\n              newItem = newItem.deleteIn(['data', 'values_diff']);\n              return newdata = newdata.push(newItem);\n            });\n          } else {\n            newItem = item.deleteIn(['data', 'values_diff']);\n            return newdata = newdata.push(newItem);\n          }\n        };\n      })(this));\n      return response.set('data', newdata);\n    };\n\n    UserTimelineService.prototype._addEntyAttributes = function(item) {\n      var event, type;\n      event = this._parseEventType(item.get('event_type'));\n      type = this.userTimelineItemType.getType(item, event);\n      return this._attachExtraInfoToTimelineEntry(item, event, type);\n    };\n\n    UserTimelineService.prototype.getProfileTimeline = function(userId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.users.getProfileTimeline(userId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    UserTimelineService.prototype.getUserTimeline = function(userId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.users.getUserTimeline(userId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    UserTimelineService.prototype.getProjectTimeline = function(projectId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.projects.getTimeline(projectId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    return UserTimelineService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineService\", UserTimelineService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: isolate-click.directive.coffee\n */\n\n(function() {\n  var IsolateClickDirective;\n\n  IsolateClickDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {\n      return el.on('click', (function(_this) {\n        return function(e) {\n          return e.stopPropagation();\n        };\n      })(this));\n    };\n    return {\n      link: link\n    };\n  };\n\n  angular.module(\"taigaUtils\").directive(\"tgIsolateClick\", IsolateClickDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: wiki-history.directive.coffee\n */\n\n(function() {\n  var WikiHistoryDiffDirective, module;\n\n  module = angular.module('taigaWikiHistory');\n\n  WikiHistoryDiffDirective = function() {\n    return {\n      templateUrl: \"wiki/history/wiki-history-diff.html\",\n      scope: {\n        key: \"<\",\n        diff: \"<\"\n      }\n    };\n  };\n\n  module.directive(\"tgWikiHistoryDiff\", WikiHistoryDiffDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: wiki-history.directive.coffee\n */\n\n(function() {\n  var WikiHistoryEntryDirective, module;\n\n  module = angular.module('taigaWikiHistory');\n\n  WikiHistoryEntryDirective = function() {\n    var link;\n    link = function(scope, el, attr) {\n      return scope.singleHistoryEntry = scope.historyEntry.toJS();\n    };\n    return {\n      link: link,\n      templateUrl: \"wiki/history/wiki-history-entry.html\",\n      scope: {\n        historyEntry: \"<\"\n      }\n    };\n  };\n\n  module.directive(\"tgWikiHistoryEntry\", WikiHistoryEntryDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: wiki-history.controller.coffee\n */\n\n(function() {\n  var WikiHistoryController, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaWikiHistory\");\n\n  WikiHistoryController = (function() {\n    WikiHistoryController.$inject = [\"tgWikiHistoryService\"];\n\n    function WikiHistoryController(wikiHistoryService) {\n      this.wikiHistoryService = wikiHistoryService;\n      taiga.defineImmutableProperty(this, 'historyEntries', (function(_this) {\n        return function() {\n          return _this.wikiHistoryService.historyEntries;\n        };\n      })(this));\n    }\n\n    WikiHistoryController.prototype.initializeHistoryEntries = function(wikiId) {\n      if (wikiId) {\n        this.wikiHistoryService.setWikiId(wikiId);\n      }\n      return this.wikiHistoryService.loadHistoryEntries();\n    };\n\n    return WikiHistoryController;\n\n  })();\n\n  module.controller(\"WikiHistoryCtrl\", WikiHistoryController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: wiki-history.directive.coffee\n */\n\n(function() {\n  var WikiHistoryDirective, bindOnce, module;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module('taigaWikiHistory');\n\n  WikiHistoryDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return bindOnce(scope, 'vm.wikiId', function(value) {\n        return ctrl.initializeHistoryEntries(value);\n      });\n    };\n    return {\n      scope: {},\n      bindToController: {\n        wikiId: \"<\"\n      },\n      controller: \"WikiHistoryCtrl\",\n      controllerAs: \"vm\",\n      templateUrl: \"wiki/history/wiki-history.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgWikiHistory\", WikiHistoryDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: wiki-history.service.coffee\n */\n\n(function() {\n  var WikiHistoryService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  module = angular.module('taigaWikiHistory');\n\n  WikiHistoryService = (function(superClass) {\n    extend(WikiHistoryService, superClass);\n\n    WikiHistoryService.$inject = [\"tgResources\", \"tgXhrErrorService\"];\n\n    function WikiHistoryService(rs, xhrError) {\n      this.rs = rs;\n      this.xhrError = xhrError;\n      this._wikiId = null;\n      this._historyEntries = Immutable.List();\n      taiga.defineImmutableProperty(this, \"wikiId\", (function(_this) {\n        return function() {\n          return _this._wikiId;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"historyEntries\", (function(_this) {\n        return function() {\n          return _this._historyEntries;\n        };\n      })(this));\n    }\n\n    WikiHistoryService.prototype.setWikiId = function(wikiId) {\n      this._wikiId = wikiId;\n      return this._historyEntries = Immutable.List();\n    };\n\n    WikiHistoryService.prototype.loadHistoryEntries = function() {\n      if (!this._wikiId) {\n        return;\n      }\n      return this.rs.wikiHistory.getWikiHistory(this._wikiId).then((function(_this) {\n        return function(historyEntries) {\n          if (historyEntries.size) {\n            return _this._historyEntries = historyEntries.reverse();\n          }\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    _;\n\n    return WikiHistoryService;\n\n  })(taiga.Service);\n\n  module.service(\"tgWikiHistoryService\", WikiHistoryService);\n\n}).call(this);\n\n//# sourceMappingURL=maps/app.js.map\n"]}